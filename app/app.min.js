Ext.define("Ext.ux.SlidingPager",{requires:["Ext.slider.Single","Ext.slider.Tip"],constructor:function(a){a&&Ext.apply(this,a)},init:function(a){var b,c=a.items.indexOf(a.child("#inputItem"));Ext.each(a.items.getRange(c-2,c+2),function(a){a.hide()}),b=Ext.create("Ext.slider.Single",{width:114,minValue:1,maxValue:1,hideLabel:!0,tipText:function(a){return Ext.String.format("Page <b>{0}</b> of <b>{1}</b>",a.value,a.slider.maxValue)},listeners:{changecomplete:function(b,c){a.store.loadPage(c)}}}),a.insert(c+1,b),a.on({change:function(a,c){b.setMaxValue(c?c.pageCount:1),b.setValue(c?c.currentPage:1)}})}}),Ext.define("Ext.ux.PreviewPlugin",{extend:"Ext.AbstractPlugin",alias:"plugin.preview",requires:["Ext.grid.feature.RowBody","Ext.grid.feature.RowWrap"],hideBodyCls:"x-grid-row-body-hidden",bodyField:"",previewExpanded:!0,setCmp:function(a){this.callParent(arguments);var b=this.bodyField,c=this.hideBodyCls,d=[{ftype:"rowbody",getAdditionalData:function(d){var e=Ext.grid.feature.RowBody.prototype.getAdditionalData,f={rowBody:d[b],rowBodyCls:a.previewExpanded?"":c};return e&&Ext.apply(f,e.apply(this,arguments)),f}},{ftype:"rowwrap"}];a.previewExpanded=this.previewExpanded,a.features||(a.features=[]),a.features=d.concat(a.features)},toggleExpanded:function(a){var b=this.getCmp();this.previewExpanded=b.previewExpanded=a,b.refresh()}}),Ext.define("Ext.ux.form.SearchField",{extend:"Ext.form.field.Trigger",alias:"widget.searchfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",hasSearch:!1,paramName:"query",initComponent:function(){var a=this;a.callParent(arguments),a.on("specialkey",function(b,c){c.getKey()==c.ENTER&&a.onTrigger2Click()}),a.store.remoteFilter=!0,a.store.proxy.hasOwnProperty("filterParam")||(a.store.proxy.filterParam=a.paramName),a.store.proxy.encodeFilters=function(a){return a[0].value}},afterRender:function(){this.callParent(),this.triggerCell.item(0).setDisplayed(!1)},onTrigger1Click:function(){var a=this;a.hasSearch&&(a.setValue(""),a.store.clearFilter(),a.hasSearch=!1,a.triggerCell.item(0).setDisplayed(!1),a.updateLayout())},onTrigger2Click:function(){var a=this,b=a.getValue();b.length>0&&(a.store.filter({id:a.paramName,property:a.paramName,value:b}),a.hasSearch=!0,a.triggerCell.item(0).setDisplayed(!0),a.updateLayout())}}),Ext.define("Ext.ux.statusbar.StatusBar",{extend:"Ext.toolbar.Toolbar",alternateClassName:"Ext.ux.StatusBar",alias:"widget.statusbar",requires:["Ext.toolbar.TextItem"],cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5e3,emptyText:"&#160;",activeThreadId:0,initComponent:function(){var a="right"===this.statusAlign;this.callParent(arguments),this.currIconCls=this.iconCls||this.defaultIconCls,this.statusEl=Ext.create("Ext.toolbar.TextItem",{cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""}),a?(this.cls+=" x-status-right",this.add("->"),this.add(this.statusEl)):(this.insert(0,this.statusEl),this.insert(1,"->"))},setStatus:function(a){var b=this;if(a=a||{},Ext.suspendLayouts(),Ext.isString(a)&&(a={text:a}),void 0!==a.text&&b.setText(a.text),void 0!==a.iconCls&&b.setIcon(a.iconCls),a.clear){var c=a.clear,d=b.autoClear,e={useDefaults:!0,anim:!0};Ext.isObject(c)?(c=Ext.applyIf(c,e),c.wait&&(d=c.wait)):Ext.isNumber(c)?(d=c,c=e):Ext.isBoolean(c)&&(c=e),c.threadId=this.activeThreadId,Ext.defer(b.clearStatus,d,b,[c])}return Ext.resumeLayouts(!0),b},clearStatus:function(a){a=a||{};var b=this,c=b.statusEl;if(a.threadId&&a.threadId!==b.activeThreadId)return b;var d=a.useDefaults?b.defaultText:b.emptyText,e=a.useDefaults&&b.defaultIconCls?b.defaultIconCls:"";return a.anim?c.el.puff({remove:!1,useDisplay:!0,callback:function(){c.el.show(),b.setStatus({text:d,iconCls:e})}}):b.setStatus({text:d,iconCls:e}),b},setText:function(a){var b=this;return b.activeThreadId++,b.text=a||"",b.rendered&&b.statusEl.setText(b.text),b},getText:function(){return this.text},setIcon:function(a){var b=this;return b.activeThreadId++,a=a||"",b.rendered?(b.currIconCls&&(b.statusEl.removeCls(b.currIconCls),b.currIconCls=null),a.length>0&&(b.statusEl.addCls(a),b.currIconCls=a)):b.currIconCls=a,b},showBusy:function(a){return Ext.isString(a)&&(a={text:a}),a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls}),this.setStatus(a)}}),Ext.define("Ext.ux.LiveSearchGridPanel",{extend:"Ext.grid.Panel",requires:["Ext.toolbar.TextItem","Ext.form.field.Checkbox","Ext.form.field.Text","Ext.ux.statusbar.StatusBar"],searchValue:null,indexes:[],currentIndex:null,searchRegExp:null,caseSensitive:!1,regExpMode:!1,matchCls:"x-livesearch-match",defaultStatusText:"Nothing Found",initComponent:function(){var a=this;a.tbar=["Search",{xtype:"textfield",name:"searchField",hideLabel:!0,width:200,listeners:{change:{fn:a.onTextFieldChange,scope:this,buffer:100}}},{xtype:"button",text:"&lt;",tooltip:"Find Previous Row",handler:a.onPreviousClick,scope:a},{xtype:"button",text:"&gt;",tooltip:"Find Next Row",handler:a.onNextClick,scope:a},"-",{xtype:"checkbox",hideLabel:!0,margin:"0 0 0 4px",handler:a.regExpToggle,scope:a},"Regular expression",{xtype:"checkbox",hideLabel:!0,margin:"0 0 0 4px",handler:a.caseSensitiveToggle,scope:a},"Case sensitive"],a.bbar=Ext.create("Ext.ux.StatusBar",{defaultText:a.defaultStatusText,name:"searchStatusBar"}),a.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments),a.textField=a.down("textfield[name=searchField]"),a.statusBar=a.down("statusbar[name=searchStatusBar]")},tagsRe:/<[^>]*>/gm,tagsProtect:"",regExpProtect:/\\|\/|\+|\\|\.|\[|\]|\{|\}|\?|\$|\*|\^|\|/gm,getSearchValue:function(){var a=this,b=a.textField.getValue();if(""===b)return null;if(a.regExpMode){try{new RegExp(b)}catch(c){return a.statusBar.setStatus({text:c.message,iconCls:"x-status-error"}),null}if("^"===b||"$"===b)return null}else b=b.replace(a.regExpProtect,function(a){return"\\"+a});return b},onTextFieldChange:function(){var a=this,b=0;a.view.refresh(),a.statusBar.setStatus({text:a.defaultStatusText,iconCls:""}),a.searchValue=a.getSearchValue(),a.indexes=[],a.currentIndex=null,null!==a.searchValue&&(a.searchRegExp=new RegExp(a.searchValue,"g"+(a.caseSensitive?"":"i")),a.store.each(function(c,d){for(var e,f,g,h=Ext.fly(a.view.getNode(d)).down("td");h;)e=h.down(".x-grid-cell-inner"),f=e.dom.innerHTML.match(a.tagsRe),g=e.dom.innerHTML.replace(a.tagsRe,a.tagsProtect),g=g.replace(a.searchRegExp,function(c){return b+=1,-1===Ext.Array.indexOf(a.indexes,d)&&a.indexes.push(d),null===a.currentIndex&&(a.currentIndex=d),'<span class="'+a.matchCls+'">'+c+"</span>"}),Ext.each(f,function(b){g=g.replace(a.tagsProtect,b)}),e.dom.innerHTML=g,h=h.next()},a),null!==a.currentIndex&&(a.getSelectionModel().select(a.currentIndex),a.statusBar.setStatus({text:b+" matche(s) found.",iconCls:"x-status-valid"}))),null===a.currentIndex&&a.getSelectionModel().deselectAll(),a.textField.focus()},onPreviousClick:function(){var a,b=this;-1!==(a=Ext.Array.indexOf(b.indexes,b.currentIndex))&&(b.currentIndex=b.indexes[a-1]||b.indexes[b.indexes.length-1],b.getSelectionModel().select(b.currentIndex))},onNextClick:function(){var a,b=this;-1!==(a=Ext.Array.indexOf(b.indexes,b.currentIndex))&&(b.currentIndex=b.indexes[a+1]||b.indexes[0],b.getSelectionModel().select(b.currentIndex))},caseSensitiveToggle:function(a,b){this.caseSensitive=b,this.onTextFieldChange()},regExpToggle:function(a,b){this.regExpMode=b,this.onTextFieldChange()}}),Ext.define("Ext.ux.IFrame",{extend:"Ext.Component",alias:"widget.uxiframe",loadMask:"Loading...",src:"about:blank",renderTpl:['<iframe src="{src}" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'],initComponent:function(){this.callParent(),this.frameName=this.frameName||this.id+"-frame",this.addEvents("beforeload","load"),Ext.apply(this.renderSelectors,{iframeEl:"iframe"})},initEvents:function(){var a=this;a.callParent(),a.iframeEl.on("load",a.onLoad,a)},initRenderData:function(){return Ext.apply(this.callParent(),{src:this.src,frameName:this.frameName})},getBody:function(){var a=this.getDoc();return a.body||a.documentElement},getDoc:function(){try{return this.getWin().document}catch(a){return null}},getWin:function(){var a=this,b=a.frameName,c=Ext.isIE?a.iframeEl.dom.contentWindow:window.frames[b];return c},getFrame:function(){var a=this;return a.iframeEl.dom},beforeDestroy:function(){this.cleanupListeners(!0),this.callParent()},cleanupListeners:function(a){var b,c;if(this.rendered)try{if(b=this.getDoc(),b&&(Ext.EventManager.removeAll(b),a))for(c in b)b.hasOwnProperty&&b.hasOwnProperty(c)&&delete b[c]}catch(d){}},onLoad:function(){var a=this,b=a.getDoc(),c=a.onRelayedEvent;if(b){try{Ext.EventManager.removeAll(b),Ext.EventManager.on(b,{mousedown:c,mousemove:c,mouseup:c,click:c,dblclick:c,scope:a})}catch(d){}Ext.EventManager.on(this.getWin(),"beforeunload",a.cleanupListeners,a),this.el.unmask(),this.fireEvent("load",this)}else a.src&&""!=a.src&&(this.el.unmask(),this.fireEvent("error",this))},onRelayedEvent:function(a){var b=this.iframeEl,c=Ext.Element.getTrueXY(b),d=a.getXY(),e=Ext.EventManager.getPageXY(a.browserEvent);a.xy=[c[0]+e[0],c[1]+e[1]],a.injectEvent(b),a.xy=d},load:function(a){var b=this,c=b.loadMask,d=b.getFrame();b.fireEvent("beforeload",b,a)!==!1&&(c&&b.el&&b.el.mask(c),d.src=b.src=a||b.src)}}),Ext.define("Ext.ux.DataTip",function(){function a(){var a=this.isXType("panel")?this.body:this.el;this.dataTip.renderToTarget&&this.dataTip.render(a),this.dataTip.setTarget(a)}function b(a,b){if(a.rendered){if(a.host.fireEvent("beforeshowtip",a.eventHost,a,b)===!1)return!1;a.update(b)}else Ext.isString(b)?a.html=b:a.data=b}function c(a){var c,d=this.view.getRecord(a.triggerElement);return d?(c=a.initialConfig.data?Ext.apply(a.initialConfig.data,d.data):d.data,b(a,c)):!1}function d(a){var c=Ext.getCmp(a.triggerElement.id);return c&&(c.tooltip||a.tpl)?b(a,c.tooltip||c):!1}return{extend:"Ext.tip.ToolTip",mixins:{plugin:"Ext.AbstractPlugin"},alias:"plugin.datatip",lockableScope:"both",constructor:function(a){var b=this;b.callParent([a]),b.mixins.plugin.constructor.call(b,a)},init:function(b){var e=this;e.mixins.plugin.init.call(e,b),b.dataTip=e,e.host=b,b.isXType("tablepanel")?(e.view=b.getView(),b.ownerLockable&&(e.host=b.ownerLockable),e.delegate=e.delegate||e.view.getDataRowSelector(),e.on("beforeshow",c)):b.isXType("dataview")?(e.view=e.host,e.delegate=e.delegate||b.itemSelector,e.on("beforeshow",c)):b.isXType("form")?(e.delegate="."+Ext.form.Labelable.prototype.formItemCls,e.on("beforeshow",d)):b.isXType("combobox")&&(e.view=b.getPicker(),e.delegate=e.delegate||e.view.getItemSelector(),e.on("beforeshow",c)),b.rendered?a.call(b):b.onRender=Ext.Function.createSequence(b.onRender,a)}}}),Ext.define("Ext.ux.BoxReorderer",{mixins:{observable:"Ext.util.Observable"},itemSelector:".x-box-item",animate:100,constructor:function(){this.addEvents("StartDrag","Drag","ChangeIndex","Drop"),this.mixins.observable.constructor.apply(this,arguments)},init:function(a){var b=this;b.container=a,b.animatePolicy={},b.animatePolicy[a.getLayout().names.x]=!0,b.container.on({scope:b,boxready:b.afterFirstLayout,beforedestroy:b.onContainerDestroy})},onContainerDestroy:function(){var a=this.dd;a&&(a.unreg(),this.dd=null)},afterFirstLayout:function(){var a,b=this,c=b.container.getLayout(),d=c.names;a=b.dd=Ext.create("Ext.dd.DD",c.innerCt,b.container.id+"-reorderer"),Ext.apply(a,{animate:b.animate,reorderer:b,container:b.container,getDragCmp:this.getDragCmp,clickValidator:Ext.Function.createInterceptor(a.clickValidator,b.clickValidator,b,!1),onMouseDown:b.onMouseDown,startDrag:b.startDrag,onDrag:b.onDrag,endDrag:b.endDrag,getNewIndex:b.getNewIndex,doSwap:b.doSwap,findReorderable:b.findReorderable}),a.dim=d.width,a.startAttr=d.beforeX,a.endAttr=d.afterX},getDragCmp:function(a){return this.container.getChildByElement(a.getTarget(this.itemSelector,10))},clickValidator:function(a){var b=this.getDragCmp(a);return!(!b||b.reorderable===!1)},onMouseDown:function(a){var b,c,d,e=this,f=e.container;e.dragCmp=e.getDragCmp(a),e.dragCmp&&(c=e.dragCmp.getEl(),e.startIndex=e.curIndex=f.items.indexOf(e.dragCmp),d=c.getBox(),e.lastPos=d[this.startAttr],b=f.el.getBox(),"width"===e.dim?(e.minX=b.left,e.maxX=b.right-d.width,e.minY=e.maxY=d.top,e.deltaX=a.getPageX()-d.left):(e.minY=b.top,e.maxY=b.bottom-d.height,e.minX=e.maxX=d.left,e.deltaY=a.getPageY()-d.top),e.constrainY=e.constrainX=!0)},startDrag:function(){var a=this,b=a.dragCmp;b?(b.setPosition=Ext.emptyFn,b.animate=!1,a.animate&&(a.container.getLayout().animatePolicy=a.reorderer.animatePolicy),a.dragElId=b.getEl().id,a.reorderer.fireEvent("StartDrag",a,a.container,b,a.curIndex),b.suspendEvents(),b.disabled=!0,b.el.setStyle("zIndex",100)):a.dragElId=null},findReorderable:function(a){var b,c=this,d=c.container.items;if(d.getAt(a).reorderable===!1)if(b=d.getAt(a),a>c.startIndex)for(;b&&b.reorderable===!1;)a++,b=d.getAt(a);else for(;b&&b.reorderable===!1;)a--,b=d.getAt(a);return a=Math.min(Math.max(a,0),d.getCount()-1),d.getAt(a).reorderable===!1?-1:a},doSwap:function(a){var b,c,d,e=this,f=e.container.items,g=e.container,h=e.container._isLayoutRoot;a=e.findReorderable(a),-1!==a&&(e.reorderer.fireEvent("ChangeIndex",e,g,e.dragCmp,e.startIndex,a),b=f.getAt(e.curIndex),c=f.getAt(a),f.remove(b),d=Math.min(Math.max(a,0),f.getCount()-1),f.insert(d,b),f.remove(c),f.insert(e.curIndex,c),g._isLayoutRoot=!0,g.updateLayout(),g._isLayoutRoot=h,e.curIndex=a)},onDrag:function(a){var b,c=this;b=c.getNewIndex(a.getPoint()),void 0!==b&&(c.reorderer.fireEvent("Drag",c,c.container,c.dragCmp,c.startIndex,c.curIndex),c.doSwap(b))},endDrag:function(a){a&&a.stopEvent();var b,c=this,d=c.container.getLayout();c.dragCmp&&(delete c.dragElId,delete c.dragCmp.setPosition,c.dragCmp.animate=!0,c.dragCmp.lastBox[d.names.x]=c.dragCmp.getPosition(!0)[d.names.widthIndex],c.container._isLayoutRoot=!0,c.container.updateLayout(),c.container._isLayoutRoot=void 0,b=Ext.fx.Manager.getFxQueue(c.dragCmp.el.id)[0],b?b.on({afteranimate:c.reorderer.afterBoxReflow,scope:c}):Ext.Function.defer(c.reorderer.afterBoxReflow,1,c),c.animate&&delete d.animatePolicy,c.reorderer.fireEvent("drop",c,c.container,c.dragCmp,c.startIndex,c.curIndex))},afterBoxReflow:function(){var a=this;a.dragCmp.el.setStyle("zIndex",""),a.dragCmp.disabled=!1,a.dragCmp.resumeEvents()},getNewIndex:function(){var a,b,c,d=this,e=d.getDragEl(),f=Ext.fly(e).getBox(),g=0,h=d.container.items.items,i=h.length,j=d.lastPos;for(d.lastPos=f[d.startAttr];i>g;g++)if(a=h[g].getEl(),a.is(d.reorderer.itemSelector))if(b=a.getBox(),c=b[d.startAttr]+(b[d.dim]>>1),g<d.curIndex){if(f[d.startAttr]<j&&f[d.startAttr]<c-5)return g}else if(g>d.curIndex&&f[d.startAttr]>j&&f[d.endAttr]>c+5)return g}}),Ext.define("Ext.ux.ToolbarDroppable",{constructor:function(a){Ext.apply(this,a)},init:function(a){this.toolbar=a,this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=Ext.create("Ext.dd.DropTarget",this.toolbar.getEl(),{notifyOver:Ext.Function.bind(this.notifyOver,this),notifyDrop:Ext.Function.bind(this.notifyDrop,this)})},addDDGroup:function(a){this.dropTarget.addToGroup(a)},calculateEntryIndex:function(a){for(var b,c,d,e,f=0,g=this.toolbar,h=g.items.items,i=h.length,j=a.getXY()[0],k=0;i>k;k++){if(b=h[k].getEl(),c=b.getXY()[0],d=b.getWidth(),e=c+d/2,e>j){f=k;break}f=k+1}return f},canDrop:function(){return!0},notifyOver:function(){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(a,b,c){var d=this.canDrop(a,b,c),e=this.toolbar;if(d){var f=this.calculateEntryIndex(b);e.insert(f,this.createItem(c)),e.doLayout(),this.afterLayout()}return d},createItem:function(){Ext.Error.raise("The createItem method must be implemented in the ToolbarDroppable plugin")},afterLayout:Ext.emptyFn}),Ext.define("App.ux.state.Model",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"uid",type:"int"},{name:"name",type:"string"},{name:"value",type:"string"}]}),Ext.define("App.ux.state.Store",{extend:"Ext.data.Store",requires:["App.ux.state.Model"],model:"App.ux.state.Model",pageSize:-1,proxy:{type:"direct",api:{read:"AppState.AppStateGet",create:"AppState.AppStateSet",update:"AppState.AppStateSet",destroy:"AppState.AppStateUnSet"},reader:{type:"json",root:"data"},writer:{type:"json"}}}),Ext.define("App.ux.state.HttpProvider",{extend:"Ext.state.Provider",requires:["App.ux.state.Store"],uses:["Ext.state.Provider","Ext.util.Observable"],store:null,storeSyncOnLoadEnabled:!1,buffered:!0,writeBuffer:2e3,onFirstLoad:Ext.emptyFn,constructor:function(a){a=a||{};var b=this;if(Ext.apply(b,a),b.store||(b.store=b.buildStore()),b.storeSyncOnLoadEnabled){var c=Ext.data.Connection.prototype.async;Ext.data.Connection.prototype.async=!1,b.store.load({callback:b.onFirstLoad}),Ext.data.Connection.prototype.async=c}b.callParent(arguments),b.on(b.buffered?{statechange:{scope:b,buffer:b.writeBuffer,fn:b.sync}}:{statechange:{scope:b,fn:b.sync}})},set:function(a,b){var c,d=this,e=d.store.findExact("name",a);e>-1?(c=d.store.getAt(e),c.set("value",d.encodeValue(b))):d.store.add({uid:app.user.id,name:a,value:d.encodeValue(b)}),d.fireEvent("statechange",d,a,b)},get:function(a,b){var c,d,e=this,f=e.store.findExact("name",a);return f>-1?(c=e.store.getAt(f),d=e.decodeValue(c.get("value"))):d=b,d},clear:function(a){var b=this,c=b.store.findExact("name",a);c>-1&&(b.store.removeAt(c),b.fireEvent("statechange",b,a,null))},sync:function(){this.store.sync()},buildStore:function(){return Ext.create("App.ux.state.Store")}}),Ext.define("App.ux.HelpBtn",{extend:"Ext.button.Button",xtype:"helpbutton",icon:"resources/images/icons/icohelp.png",tooltip:_("help_document"),hrefTarget:"_blank",href:"about:blank"}),Ext.define("App.ux.ActivityMonitor",{singleton:!0,controller:null,ui:null,runner:null,task:null,lastActive:null,locked:!1,ready:!1,verbose:!1,interval:6e4,maxLock:6e5,maxInactive:3e5,init:function(a){a||(a={}),Ext.apply(this,a,{runner:new Ext.util.TaskRunner,ui:Ext.getBody(),task:{run:this.monitorUI,interval:a.interval||this.interval,scope:this}}),this.ready=!0},isReady:function(){return this.ready},isActive:Ext.emptyFn,isInactive:Ext.emptyFn,isLock:Ext.emptyFn,isUnLock:Ext.emptyFn,start:function(){return this.isReady()?(this.ui.on("mousemove",this.captureActivity,this),this.ui.on("keydown",this.captureActivity,this),this.lastActive=new Date,this.log("ActivityMonitor has been started."),this.runner.start(this.task),!0):(this.log("Please run ActivityMonitor.init()"),!1)},stop:function(){return this.isReady()?(this.runner.stop(this.task),this.lastActive=null,this.ui.un("mousemove",this.captureActivity),this.ui.un("keydown",this.captureActivity),this.log("ActivityMonitor has been stopped."),!0):(this.log("Please run ActivityMonitor.init()"),!1)},captureActivity:function(){this.controller.logoutWarinigWindow&&this.controller.cancelAutoLogout(),this.locked&&(this.isUnLock(),this.locked=!1),this.lastActive=new Date},monitorUI:function(){var a=new Date,b=a-this.lastActive;!this.locked&&b>=this.maxLock&&(this.log("MAXIMUM LOCK TIME HAS BEEN REACHED"),this.locked=!0,this.isLock()),b>=this.maxInactive?(this.log("MAXIMUM INACTIVE TIME HAS BEEN REACHED"),this.stop(),this.isInactive()):(this.log("CURRENTLY INACTIVE FOR "+Math.floor(b/1e3)+" SECONDS)"),this.isActive())},log:function(a){this.verbose&&window.console.log(a)}}),Ext.define("App.ux.RatingField",{extend:"Ext.form.field.Number",alias:"widget.ratingField",componentCls:"x-form-rating",ratingClassReset:"ux-rating-reset",starCls:"ux-rating-star",margin:"4 10",numberOfStars:5,minValue:0,maxValue:5,split:1,canReset:!0,resetPosition:"right",emptyText:"",keyNavEnabled:!0,initComponent:function(){var a=this;Ext.applyIf(a,{maxValue:5,minValue:0,split:1,numberOfStars:5,titles:{}});{var b,c,d,e,f,g=[],h=a.split,i=16/h,j=a.numberOfStars,k=j*h-1,l=a.minValue;a.maxValue}for(c in a.titles)g.push({val:1*c,title:a.titles[c]});for(b=!!g.length,Ext.Array.sort(g,function(a,b){return a.val>b.val}),a.stars=[],a.values=[],a.titles=[],a.starWidth=i,a.value||(a.value=l),f=0;k>=f;f++)d=f+1,b?(g.length&&g[1].val<=d&&(g=g.slice(1)),e=g[0].title):e=d,a.stars.push({key:d,title:e,margin:f%h*i}),a.values.push(d),a.titles.push(e);a.msgTarget="side",a.starClsOn=a.starCls+"-on",a.starClsHover=a.starCls+"-hover",a.starClsFocus=a.starCls+"-focus",a.callParent()},setValue:function(val){var me=this;me.callParent(arguments),me.afterSetValue(eval(val))},afterSetValue:function(a){var b=this;if(b.rendered){var c=b.getValueIndex(a);-1===c?(b.canReset&&b.resetEl.setOpacity(.5),b.fillNone(),b.selected=-1):c!==b.selected&&(b.canReset&&b.resetEl.setOpacity(.99),b.selected=c,b.fillTo(c,!1))}},getValueIndex:function(a){var b=this;if(a==b.emptyText||!Ext.isDefined(a)||a>b.maxValue||a<b.minValue)return-1;var c=b.values.indexOf(a);return c>-1?c:Ext.each(b.values,function(b){return b>=a?!1:void 0})},addFocusListener:function(){var a=this;a.focusListenerAdded||(a.focusEl.on({focus:a.onFocus,blur:a.onBlur,scope:a}),a.focusListenerAdded=!0)},onFocus:function(){var a=this;a.isReactive()&&a.bodyEl.addCls(a.starClsFocus)},onBlur:function(){var a=this;a.bodyEl.removeCls(a.starClsFocus)},afterRender:function(){var a=this,b="right"==a.resetPosition,c='<div class="reset-el '+a.ratingClassReset+'" title="reset" style="margin-'+(b?"left":"right")+':5px;"></div>';a.callParent();var d=new Ext.XTemplate('<div class="ux-rating-container ux-rating-clearfix" tabIndex="'+a.tabIndex+'">',b?"":c,'<tpl for=".">','<div key="{key}" class="',a.starCls,'" style="width: ',a.starWidth,'px;">','<a title="{title}" style="margin-left: -{margin}px;">{key}</a>',"</div>","</tpl>",'<input type="hidden" name="',a.getName(),'" class="input-el" tabIndex="'+a.tabIndex+'"></hidden>',b?c:"",'<a class="focus-el" tabIndex="0"></a>',"</div>",{compiled:!0});a.stars=d.overwrite(a.bodyEl,a.stars,!0).query("."+a.starCls),a.focusEl=Ext.get(Ext.query("a.focus-el",a.bodyEl.dom[0])),a.inputEl=Ext.get(Ext.query("input.input-el",a.bodyEl.dom)[0]),a.resetEl=Ext.get(Ext.query("div.reset-el",a.bodyEl.dom)[0])},initEvents:function(){var a=this;a.callParent(arguments),a.bodyEl.on({click:a.onStarClick,mouseover:a.onStarOver,mouseout:a.onStarOut,scope:a,delegate:"div.ux-rating-star"}),a.canReset&&(a.resetEl.visibilityMode=Ext.Element.DISPLAY,a.resetEl.hover(function(){a.isReactive()&&a.getValue()>0&&Ext.fly(this).addCls("ux-rating-reset-hover")},function(){a.isReactive()&&Ext.fly(this).removeCls("ux-rating-reset-hover")}),a.resetEl.on("click",a.reset,a)),a.keyNavEnabled&&(a.spinnerKeyNav=new Ext.util.KeyNav(a.focusEl,{scope:a,up:a.spinUp,down:a.spinDown,right:a.spinUp,left:a.spinDown,space:a.reset,del:a.reset})),a.setValue(a.value)},reset:function(){this.isReactive()&&this.getValue()>0&&(this.setValue(0),this.fireEvent("click",this,0))},isReactive:function(){return!this.readOnly&&!this.disabled},onStarClick:function(a,b){var c,d=this;d.isReactive()&&(c=d.values[d.stars.indexOf(b)],d.setValue(c),d.fireEvent("click",d,c))},onStarOver:function(a,b){this.isReactive()&&this.fillTo(this.stars.indexOf(b),!0)},onStarOut:function(){this.isReactive()&&this.fillTo(this.selected)},fillTo:function(a,b){var c=this;if(-1!=a){var d=b?c.starClsHover:c.starClsOn,e=b?c.starClsOn:c.starClsHover;Ext.each(c.stars.slice(0,a+1),function(){Ext.fly(this).removeCls(e).addCls(d)}),Ext.each(c.stars.slice(a+1),function(){Ext.fly(this).removeCls([e,d])})}else c.fillNone()},fillNone:function(){this.bodyEl.select(".ux-rating-star").removeCls(["ux-rating-star-hover","ux-rating-star-on"])}}),Ext.define("App.ux.LiveICDXSearch",{extend:"Ext.form.ComboBox",alias:"widget.liveicdxsearch",hideLabel:!0,triggerTip:_("click_to_clear_selection"),spObj:"",spForm:"",spExtraParam:"",qtip:_("clearable_combo_box"),trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-clear-trigger",displayField:"code_text",valueField:"code",emptyText:_("search")+"...",typeAhead:!1,minChars:1,anchor:"100%",listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">{code_type} <span style="font-weight: bold;">{code}</span>: {code_text} - ({occurrences})</div>'}},initComponent:function(){var a=this;Ext.define("liveICDXSearchModel"+this.id,{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"code",type:"string"},{name:"xcode",type:"string"},{name:"code_text",type:"string"},{name:"code_type",type:"string"},{name:"occurrences",type:"int"}],proxy:{type:"direct",api:{read:"DiagnosisCodes.ICDCodeSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveICDXSearchModel"+this.id,pageSize:1e3,autoLoad:!1}),Ext.apply(this,{store:a.store}),a.callParent(),a.on("select",a.addOccurrence)},addOccurrence:function(a,b){b.length>0&&""!==b[0].get("code")&&DiagnosisCodes.addOccurrence(b[0].get("code"))},onRender:function(){var a,b=this.getId();this.callParent(arguments),this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+b,name:"trigger2"+b,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(a){a.target.name=="trigger2"+b&&(this.reset(),this.oldValue=null,""!==this.spObj&&""!==this.spExtraParam&&(Ext.getCmp(this.spObj).store.setExtraParam(this.spExtraParam,""),Ext.getCmp(this.spObj).store.load()),""!==this.spForm&&Ext.getCmp(this.spForm).getForm().reset())},this),a=Ext.get("trigger2"+b),a.addClsOnOver("x-form-trigger-over")}}),Ext.define("App.ux.LiveCPTSearch",{extend:"Ext.form.field.ComboBox",xtype:"livecptsearch",hideLabel:!0,triggerTip:_("click_to_clear_selection"),spObj:"",spForm:"",spExtraParam:"",displayField:"code_text_medium",valueField:"code",qtip:_("clearable_combo_box"),trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-clear-trigger",hideTrigger:!0,initComponent:function(){var a=this;Ext.define("liveCPTSearchModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"eid"},{name:"code",type:"strig"},{name:"code_text",type:"string"},{name:"code_text_medium",type:"string"},{name:"code_type",type:"string",defaultValue:"CPT"},{name:"place_of_service",type:"string"},{name:"emergency",type:"string"},{name:"charge",type:"string"},{name:"days_of_units",type:"string"},{name:"essdt_plan",type:"string"},{name:"modifiers",type:"string"}],proxy:{type:"direct",api:{read:"Services.liveCodeSearch"},reader:{totalProperty:"totals",root:"rows"},extraParams:{code_type:"cpt"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveCPTSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,emptyText:_("search")+"...",typeAhead:!1,minChars:1,anchor:"100%",listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">{code}: {code_text_medium}</div>'}},pageSize:25}),a.callParent()},onRender:function(){var a=this;a.callParent(arguments);var b=a.getId();a.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+b,name:"trigger2"+b,cls:"x-form-trigger "+a.trigger2Class}]},a.triggerEl.replaceWith(a.triggerConfig),a.triggerEl.on("mouseup",function(c){c.target.name=="trigger2"+b&&(a.clearValue(),a.oldValue=null,""!==a.spObj&&""!==a.spExtraParam&&(Ext.getCmp(a.spObj).store.setExtraParam(a.spExtraParam,""),Ext.getCmp(a.spObj).store.load()),""!==a.spForm&&Ext.getCmp(a.spForm).getForm().reset())});var c=Ext.get("trigger2"+b);c.addClsOnOver("x-form-trigger-over")}}),Ext.define("App.ux.AbstractPanel",{calculatePercent:function(a,b){return 100*(a/b)},setReadOnly:function(a){for(var b=this.query("form"),c=0;c<b.length;c++){var d,e=b[c];if(e.readOnly!=a){e.readOnly=a,d=e.getForm().getFields().items;for(var f=0;f<d.length;f++)d[f].setReadOnly(a)}}return a},setButtonsDisabled:function(a,b){for(var c=b||app.patient.readOnly,d=0;d<a.length;d++){var e=a[d];e.disabled!=c&&(e.disabled=c,e.setDisabled(c))}},goBack:function(){app.nav.goBack()},checkIfCurrPatient:function(){return app.getCurrPatient()},patientInfoAlert:function(){var a=app.getCurrPatient();Ext.Msg.alert(_("status"),_("patient")+": "+a.name+" ("+a.pid+")")},currPatientError:function(){Ext.Msg.show({title:"Oops! "+_("no_patient_selected"),msg:_("select_patient_patient_live_search"),scope:this,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(){this.goBack()}})},getFormItems:function(formPanel,formToRender,callback){formPanel&&formPanel.removeAll(),FormLayoutEngine.getFields({formToRender:formToRender},function(provider,response){var items=eval(response.result),form=formPanel?formPanel.add(items):!1;return"function"==typeof callback&&callback(formPanel,items,!0),form})},boolRenderer:function(a){return"1"==a||1==a||"true"==a?'<div style="margin-left:auto; margin-right:auto; width:16"><img src="resources/images/icons/yes.png" /></div>':"0"==a||0==a||"false"==a?'<div style="margin-left:auto; margin-right:auto; width:16"><img src="resources/images/icons/no.png" /></div>':a},alertRenderer:function(a){return"1"==a||1==a||"true"==a?'<img style="padding-left: 13px" src="resources/images/icons/no.png" />':"0"==a||0==a||"false"==a?'<img style="padding-left: 13px" src="resources/images/icons/yes.png" />':a},warnRenderer:function(a,b,c){var d=c.data.warningMsg?c.data.warningMsg:"";return"1"==a||1==a||"true"==a?'<img src="resources/images/icons/icoImportant.png" '+d+" />":a},onExpandRemoveMask:function(a){a.picker.loadMask.destroy()},strToLowerUnderscores:function(a){return a.toLowerCase().replace(/ /gi,"_")},getCurrPatient:function(){return app.getCurrPatient()},getApp:function(){return app.getApp()},msg:function(a,b){app.msg(a,b)},alert:function(a,b){app.alert(a,b)},passwordVerificationWin:function(a){var b=Ext.Msg.prompt(_("password_verification"),_("please_enter_your_password")+":",function(b,c){a(b,c)}),c=b.textField.getInputId();return document.getElementById(c).type="password",b},getPageHeader:function(){return this.getComponent("RenderPanel-header")},getPageBodyContainer:function(){return this.getComponent("RenderPanel-body-container")},getPageBody:function(){return this.getPageBodyContainer().down("panel")}}),Ext.define("App.ux.LiveImmunizationSearch",{extend:"Ext.form.ComboBox",xtype:"immunizationlivesearch",hideLabel:!0,displayField:"name",valueField:"cvx_code",emptyText:_("immunization_search")+"...",typeAhead:!0,minChars:1,initComponent:function(){var a=this;Ext.define("liveImmunizationSearchModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"cvx_code",type:"string"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"note",type:"string"},{name:"status",type:"string"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Immunizations.getImmunizationLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveImmunizationSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">CVX - {cvx_code}: <span style="font-weight: normal;" class="list-status-{status}">{name} ({status})</span></div>'}},pageSize:10}),a.callParent()}}),Ext.define("App.ux.LiveLabsSearch",{extend:"Ext.form.ComboBox",xtype:"labslivetsearch",hideLabel:!0,initComponent:function(){var a=this;Ext.define("liveLoincSearchModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"loinc_name"},{name:"loinc_number"}],proxy:{type:"direct",api:{read:"Laboratories.getLabLoincLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveLoincSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(this,{store:a.store,displayField:"loinc_name",valueField:"loinc_name",emptyText:_("laboratories_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:1,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{loinc_name} ({loinc_number})</h3></div>'
}},pageSize:10}),a.callParent()}}),Ext.define("App.ux.LiveCDTSearch",{extend:"Ext.form.ComboBox",alias:"widget.cdtlivetsearch",hideLabel:!0,initComponent:function(){var a=this;Ext.define("liveCDTSearchModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"code"},{name:"text"}],proxy:{type:"direct",api:{read:"Medical.getCDTLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveCDTSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(this,{store:a.store,displayField:"text",valueField:"code",emptyText:_("search_for_a_CDT")+"...",typeAhead:!1,hideTrigger:!0,minChars:1,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{code}<span style="font-weight: normal"> ({text}) </span></h3></div>'}},pageSize:10}),a.callParent()}}),Ext.define("App.ux.LiveRXNORMAllergySearch",{extend:"Ext.form.ComboBox",alias:"widget.rxnormallergylivetsearch",hideLabel:!0,displayField:"STR",valueField:"STR",initComponent:function(){var a=this;Ext.define("liveRXNORMAllergySearchModel",{extend:"Ext.data.Model",fields:[{name:"RXCUI",type:"auto"},{name:"CODE",type:"auto"},{name:"STR",type:"auto"},{name:"DST",type:"auto"},{name:"DRT",type:"auto"},{name:"DDF",type:"auto"},{name:"DDFA",type:"auto"},{name:"RXN_QUANTITY",type:"auto"},{name:"SAB",type:"auto"},{name:"RXAUI",type:"auto"},{name:"CodeType",defaultValue:"RXNORM"},{name:"occurrences",type:"int"}],proxy:{type:"direct",api:{read:"Rxnorm.getRXNORMAllergyLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveRXNORMAllergySearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,emptyText:_("allergy_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,maxLength:255,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{STR}<span style="font-weight: normal"> ({RXCUI}) ({occurrences}) </span></h3></div>'}},pageSize:25}),a.callParent(),a.on("select",a.addOccurrence)},addOccurrence:function(a,b){b.length>0&&""!==b[0].get("RXCUI")&&Rxnorm.addOccurrence(b[0].get("RXCUI"))}}),Ext.define("App.ux.LiveSigsSearch",{extend:"Ext.form.field.ComboBox",alias:"widget.livesigssearch",initComponent:function(){var a=this;Ext.define("liveSigsSearchModel",{extend:"Ext.data.Model",fields:[{name:"option_value",type:"string"},{name:"option_name",type:"string"}],proxy:{type:"direct",api:{read:"Prescriptions.getSigCodesByQuery"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveSigsSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(a,{store:a.store,displayField:"option_value",valueField:"option_value",emptyText:_("search")+"...",typeAhead:!1,hideTrigger:!0,minChars:1,anchor:"100%",listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">{option_value} ({option_name})</div>'}},listeners:{scope:a,beforeselect:a.onBeforeSigSelect,select:a.onBeSigSelect}}),a.callParent(arguments)},onBeforeSigSelect:function(){},onBeSigSelect:function(){}}),Ext.define("App.ux.LivePatientSearch",{extend:"Ext.form.ComboBox",alias:"widget.patienlivetsearch",hideLabel:!0,displayField:"fullname",valueField:"pid",emptyText:_("search_for_a_patient")+"...",maxLength:40,queryMode:"remote",allowBlank:!0,typeAhead:!1,forceSelection:!1,allowOnlyWhitespace:!0,hideTrigger:!0,validateBlank:!0,submitValue:!0,minChars:1,queryDelay:500,resetEnabled:!1,newPatientEnabled:!1,newPatientCallback:void 0,initComponent:function(){var me=this;Ext.define("patientLiveSearchModel",{extend:"Ext.data.Model",fields:[{name:"pid",type:"int"},{name:"pubpid",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"email",type:"string"},{name:"phone_mobile",type:"string"},{name:"phone_mobile",type:"string"},{name:"phone_home",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.lname+", "+b.data.fname+" "+b.data.mname}},{name:"hl7_fullname",type:"string",convert:function(a,b){var c=[b.data.lname];return b.data.fname&&c.push(b.data.fname),b.data.mname&&c.push(b.data.mname),c.join("^")}},{name:"DOB",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"sex",type:"string"},{name:"SS",type:"string"}],proxy:{type:"direct",api:{read:"Patient.patientLiveSearch"},writer:{writeAllFields:!0},reader:{totalProperty:"totals",root:"rows"}}}),me.store=Ext.create("Ext.data.Store",{model:"patientLiveSearchModel",pageSize:15,autoLoad:!1}),Ext.apply(me,{store:me.store,listConfig:{loadingText:_("searching")+"...",minWidth:600,maxHeight:600,getInnerTpl:function(){var pid=eval(g("display_pubpid"))?"pubpid":"pid";return'<div class="search-item"><div style="float: right; font-size: 10px;">#{'+pid+'}</div><div style="font-weight: bold;">{fullname}&nbsp;&nbsp;-&nbsp;&nbsp;{[Ext.Date.format(values.DOB, g("date_display_format"))]} ({[app.getAge(values.DOB)[\'years\']]}Y)</div> </div>'}},pageSize:15}),this.resetEnabled&&(me.hideTrigger=!1,me.triggerTip=_("click_to_clear_selection"),me.spObj="",me.spForm="",me.spExtraParam="",me.qtip=_("clearable_combo_box"),me.trigger1Class="x-form-select-trigger",me.trigger2Class="x-form-clear-trigger"),me.callParent(),me.on("render",function(){me.getPicker().down("toolbar").insert(0,{xtype:"button",text:_("new_patient"),cls:"btnGreenBackground",itemId:"SearchNewPatientBtn",newPatientCallback:function(a){me.newPatientCallback&&me.newPatientCallback(me,a)},handler:function(){me.reset(),me.picker.hide()}})})},onRender:function(){var a,b=this.getId();this.callParent(arguments),this.resetEnabled&&(this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+b,name:"trigger2"+b,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(a){a.target.name=="trigger2"+b&&(this.reset(),this.fireEvent("reset",this))},this),a=Ext.get("trigger2"+b),a.addClsOnOver("x-form-trigger-over"))}}),Ext.define("App.ux.LiveRadsSearch",{extend:"Ext.form.ComboBox",xtype:"radslivetsearch",hideLabel:!0,initComponent:function(){var a=this;Ext.define("liveRadLoincSearchModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"loinc_name"},{name:"loinc_number"},{name:"code_type",defaultValue:"LOINC"}],proxy:{type:"direct",api:{read:"Laboratories.getRadLoincLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveRadLoincSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(this,{store:a.store,displayField:"loinc_name",valueField:"loinc_name",emptyText:_("radiology_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:1,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{loinc_name} ({loinc_number})</h3></div>'}},pageSize:10}),a.callParent()}}),Ext.define("App.ux.LiveReferringPhysicianSearch",{extend:"Ext.form.ComboBox",xtype:"referringphysicianlivetsearch",hideLabel:!0,displayField:"fullname",valueField:"id",emptyText:_("search_for_a_physician")+"...",queryMode:"remote",allowBlank:!0,typeAhead:!1,forceSelection:!1,allowOnlyWhitespace:!0,validateBlank:!0,submitValue:!0,minChars:0,queryDelay:200,enableAddTrigger:!0,trigger1Cls:"x-form-add-trigger",trigger2Cls:"x-form-clear-trigger",hideTrigger1:!1,onTrigger1Click:function(){a("allow_add_referring_physician")?app.fireEvent("referringproviderddbtnclick",this,this.findRecordByValue(this.getValue())):app.msg(_("oops"),"Not Authorized",!0)},onTrigger2Click:function(){this.reset(),this.oldValue=null,this.fireEvent("fieldreset",this)},initComponent:function(){var a=this;Ext.define("referringPhysicianLiveSearchModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"organization_name",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.lname?b.data.lname+", "+b.data.fname+" "+b.data.mname:b.data.organization_name}},{name:"upin",type:"string"},{name:"lic",type:"string"},{name:"npi",type:"string"},{name:"ssn",type:"string"},{name:"taxonomy",type:"string"},{name:"email",type:"string"},{name:"direct_address",type:"string"},{name:"phone_number",type:"string"},{name:"fax_number",type:"string"},{name:"cel_number",type:"string"}],proxy:{type:"direct",api:{read:"ReferringProviders.referringPhysicianLiveSearch"},writer:{writeAllFields:!0},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"referringPhysicianLiveSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(a,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3><span>{fullname}</span></h3><b>NPI:</b> {npi} <b>LIC.:</b> {lic}</div>'}},pageSize:10}),a.callParent(),a.on("change",a.onReferringValueChange,a)},onReferringValueChange:function(a,b){if(Ext.isNumber(b)&&"0"!=b){var c=this;App.model.administration.ReferringProvider.load(b,{success:function(a){null===c.store.getById(a.get("id"))&&(c.store.add(a.data),c.setValue(b))}})}}}),Ext.define("App.ux.LiveUserSearch",{extend:"Ext.form.ComboBox",alias:"widget.userlivetsearch",hideLabel:!0,displayField:"fullname",valueField:"id",emptyText:_("search_for_a_user")+"...",maxLength:40,typeAhead:!1,queryMode:"remote",allowBlank:!0,minChars:1,queryDelay:200,acl:null,triggerTip:_("click_to_clear_selection"),spObj:"",spForm:"",spExtraParam:"",qtip:_("clearable_combo_box"),trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-clear-trigger",listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">{fullname} <b>({role})</b></div>'}},initComponent:function(){var a=this;Ext.define("userLiveSearchModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"code",type:"string"},{name:"role",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.fname+" "+b.data.mname+" "+b.data.lname}}]}),a.store=Ext.create("Ext.data.Store",{model:"userLiveSearchModel",pageSize:10,autoLoad:!1,proxy:{type:"direct",api:{read:"User.userLiveSearch"},extraParams:{acl:a.acl},reader:{root:"data"},writer:{writeAllFields:!0}}}),Ext.apply(a,{store:a.store,pageSize:10}),a.callParent()},onRender:function(){var a,b=this.getId();this.callParent(arguments),this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+b,name:"trigger2"+b,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(a){a.target.name=="trigger2"+b&&(this.reset(),this.fireEvent("reset",this))},this),a=Ext.get("trigger2"+b),a.addClsOnOver("x-form-trigger-over")}}),function(){var Element=Ext.core.Element,DomHelper=Ext.core.DomHelper,slice=Array.prototype.slice;Ext.define("App.ux.ManagedIframe",{extend:"Ext.Component",alias:"widget.miframe",hideMode:Ext.isIE?"display":"nosize",autoScroll:!0,frameStyle:null,frameConfig:void 0,frameCls:"ux-miframe",shimCls:"ux-miframe-shim",shimUrl:Ext.BLANK_IMAGE_URL,eventsFollowFrameLinks:!0,src:"about:blank",autoMask:!1,maskMessage:"Loading...",resetUrl:void 0,ariaRole:"presentation",unsupportedText:"Frames are disabled",initComponent:function(){var a=this;a.frameStyle=Ext.isString(a.frameStyle)?Element.parseStyles(a.frameStyle):a.frameStyle||{},a.frameName=a.frameName||a.getId(),a.autoEl=a.autoEl||{cn:[Ext.applyIf(a.frameConfig||{},{tag:"iframe",cls:a.frameCls,style:Ext.apply({height:"100%",width:"100%"},a.frameStyle),frameBorder:"no",role:a.ariaRole,name:a.frameName}),{tag:"noframes",html:a.unsupportedText},{tag:"img",cls:a.shimCls,galleryimg:"no",style:"position:absolute;top:0;left:0;display:none;z-index:20;height:100%;width:100%;",src:a.shimUrl}]},this.callParent()},renderSelectors:{frameElement:"iframe.ux-miframe",frameShim:"img.ux-miframe-shim"},iframeMessageListener:function(event){if(event.origin===window.location.origin&&event.data.match&&event.data.match(/^documentedit/)){var data=event.data.replace(/^documentedit/,"");app.fireEvent("documentedit",eval("("+data+")"))}},afterRender:function(){var a,b=this;b.callParent(),b.iframeMessageListener&&(window.addEventListener?window.addEventListener("message",b.iframeMessageListener,!1):window.attachEvent("onmessage",b.iframeMessageListener)),b.frameShim&&(b.frameShim.autoBoxAdjust=!1,b.frameShim.setVisibilityMode(Element.DISPLAY)),(a=b.frameElement)&&(a=b.frameElement=new App.ux.ManagedIframe.Element(a.dom),a.eventsFollowFrameLinks=!1,a.on({dataavailable:b.onFrameDataAvailable,scope:b}),this.autoLoad?(a.isReset=Ext.isIE,a.eventsFollowFrameLinks=!!b.eventsFollowFrameLinks):Ext.Function.defer(a.reset,100,a,[b.resetUrl,function(){var b=this;a.eventsFollowFrameLinks=!!b.eventsFollowFrameLinks,b.src||b.defaultSrc?b.setSrc():(b.data||b.html)&&b.update(b.data||b.html)},b]))},getContentTarget:function(){return this.frameElement},getActionEl:function(){return this.frameElement||this.el},onFrameDataAvailable:function(){this.autoMask&&this.setLoading(!1)},setSrc:function(a,b,c){var d=this;return a=a||d.src||d.defaultSrc,a&&d.rendered&&d.frameElement&&(d.autoMask&&d.isVisible(!0)&&d.setLoading(d.maskMessage||"",!0),d.frameElement.setSrc(a,!1,b,c)),d.src=a,d},setLoading:function(a){var b=this;a!==!1?b.el.mask(b.maskMessage||""):b.el.unmask()},initContent:function(){{var a=this;a.data||a.html}a.contentEl&&Ext.isDefined(Ext.global.console)&&Ext.global.console.warn("App.ux.ManagedIframe: 'contentEl' is not supported by this class."),a.tpl&&a.setTpl(a.tpl),delete a.contentEl},setTpl:function(a){return this.tpl=a&&!a.isTemplate?Ext.create("Ext.XTemplate",a):a,this},update:function(a,b,c,d){var e=this,f=a;if((e.tpl&&Ext.isArray(f)||Ext.isObject(f))&&(e.data=f,f=e.tpl.apply(f||{})),e.rendered){e.autoMask&&e.isVisible(!0)&&e.setLoading(e.maskMessage||"");var g=e.getContentTarget();Ext.defer(function(){g.update(f,b,c,d)},e.autoMask?100:10,e,[])}return e},setAutoScroll:function(a){var b,c=this;return Ext.isDefined(a)&&(a=!!a,c.rendered&&(b=c.getContentTarget())&&b.setStyle("overflow",a?"auto":"hidden"),c.autoScroll=a),c},toggleShim:function(a){var b=this;return b.frameShim&&b.frameShim[a?"show":"hide"](),b.frameShim},onDestroy:function(){var a,b=this;(a=b.frameElement)&&a.remove(),b.deleteMembers("frameElement","frameShim"),b.iframeMessageListener&&(window.addEventListener?removeEventListener("message",b.iframeMessageListener,!1):detachEvent("onmessage",b.iframeMessageListener)),b.callParent()}});var MIF=App.ux.ManagedIframe,EC=Ext.cache,DOC=window.document,addListener=function(){var a;a=window.addEventListener?function(a,b,c,d){a.addEventListener(b,c,!!d)}:window.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(){};return a}(),removeListener=function(){var a;a=window.removeEventListener?function(a,b,c,d){a.removeEventListener(b,c,d)}:window.detachEvent?function(a,b,c){a.detachEvent("on"+b,c)}:function(){};return a}();Ext.define("App.ux.ManagedIframe.Element",{extend:"Ext.core.Element",alias:"widget.miframeelement",visibilityMode:Element.ASCLASS,eventsFollowFrameLinks:!0,focusOnLoad:Ext.isIE,constructor:function(a){var b,c="string"==typeof a?DOC.getElementById(a):(a||{}).dom||a;return c?(b=c.id,this.dom=c,this.id=b||Ext.id(c),this.dom.name=this.dom.name||this.id,window.frames[this.dom.name]=this.dom,this.dom.manager=this,this._flyweights={},EC[this.id]&&EC[this.id].el?EC[this.id].el=this:Element.addToCache(this),Ext.isGecko||Ext.isWebkit||this.on(Ext.isOpera?"DOMFrameContentLoaded":"readystatechange",this.loadHandler,this,Ext.isOpera?{buffer:this.operaLoadBuffer||2e3}:null),void this.on({dataavailable:function(a){a&&Ext.apply(a,{frameAction:this._frameAction,frameResetting:this.isReset})},load:this.loadHandler,scope:this})):null},getFrameDocument:function(){var a=this.getWindow(),b=null;try{b=a.contentDocument||this.dom.contentDocument||window.frames[this.dom.name].document||a.document}catch(c){b=!1}return b||!1},getDoc:function(){return this.fly(this.getFrameDocument())},getBody:function(){var a;return(a=this.getFrameDocument())?this.get(a.body):null},get:function(a){return this.fly(a)},fly:function(a,b){var c,d=this,e=null,f=d.getFrameDocument();return f&&a?(b=b||"_global",a=Ext.getDom(a,!1,f),a&&(c=Ext.EventManager.getId(a),(d._flyweights[c]=d._flyweights[c]||new MIF.Element.Flyweight).dom=a,e=d._flyweights[c]),e):e},select:function(a){var b;return(b=this.getFrameDocument())?Element.select(a,!1,b):b=null},query:function(a){var b;return(b=this.getFrameDocument())?Ext.DomQuery.select(a,b):b=null},getDocumentURI:function(){var a,b;try{a=this.src&&(b=this.getFrameDocument())?b.location.href:null}catch(c){}return a||(Ext.isFunction(this.src)?this.src():this.src)},getWindowURI:function(){var a,b,c=this;try{a=(b=c.getWindow())?b.location.href:null}catch(d){}return a||(Ext.isFunction(c.src)?c.src():c.src)},getWindow:function(){var a=this.dom,b=null;try{b=a.contentWindow||window.frames[a.name]||null}catch(c){}return b},scrollChildIntoView:function(a,b,c){var d,e=this,f=e.getFrameDocument();return f&&(b=(b?Ext.getDom(b,!0,f):null)||(!Ext.isWebKit&&Ext.isDocumentStrict(f)?f.documentElement:f.body),(d=e.fly(a))&&d.scrollIntoView(b,c)),e},loadHandler:function(a,b,c){a=a||{};var d=this,e="readystatechange"==a.type?(d.dom||{}).readyState:a.type;if(d.eventsFollowFrameLinks||d._frameAction||d.isReset){switch(d.isReset&&a.stopEvent&&a.stopEvent(),e){case"domready":case"DOMFrameContentLoaded":d._onDocReady(e,a),d.fireDOMEvent("domready",null,{message:a.message});break;case"interactive":d.domReady=d.loaded=!1,d.isReset||d.assertOnReady();break;case"complete":d.loaded=!0,d.fireDOMEvent("complete",null,{message:a.message});break;case"load":d.loaded=!0,Ext.apply(a,{frameAction:d._frameAction,frameResetting:d.isReset}),d._onDocLoaded(e,a),d.dispatchCallbacks(a,b,c);break;case"error":d.fireDOMEvent("error",null,{message:a.message}),d._frameAction=!1}d.frameState=e}},_onDocReady:function(){var a=this;a.domReady=!0;try{!a.isReset&&a.focusOnLoad&&a.focus()}catch(b){}a.fireDOMEvent("datasetchanged"),a.isReset||a.domReadyFired||!a._renderHooks()||a.isReset||(a.domReadyFired=!0,a.fireDOMEvent("dataavailable"))},_onDocLoaded:function(){var a=this;!a.isReset&&(!a._frameAction||a.eventsFollowFrameLinks)&&!a.domReady&&a._onDocReady(),a._frameAction=a.domReadyFired=a.isReset=a.domReady=!1,a._targetURI=null},createEvent:document.createEvent?function(a,b,c,d){d=d||{bubbles:!0,cancelable:!1},b=b||"Event";var e=document.createEvent(b);return e.initEvent(a,!!Ext.value(d.bubbles,!0),!!Ext.value(d.cancelable,!1)),e}:function(a,b,c,d){d=d||{type:"on"+a,bubbles:!0,cancelable:!1};var e=document.createEventObject(c);return Ext.apply(e,d)},dispatchEvent:document.createEvent?function(a){return this.dom?!this.dom.dispatchEvent(a):null}:function(a,b){return this.dom?this.dom.fireEvent("on"+b,a):null},fireDOMEvent:function(a,b,c){return this.dispatchEvent(this.createEvent(a,null,b,c),a,c)},_renderHooks:function(){var a=this;a._windowContext=null,Ext.destroy(a.CSS),delete a.CSS,a._hooked=!1;try{if(a.writeScript('(function(){(window.hostMIF = parent.document.getElementById("'+a.id+'").manager)._windowContext='+(Ext.isIE?"window":'{eval:function(s){return new Function("return ("+s+")")();}}')+";})()")){var b,c=addListener,d=a._frameProxy||(a._frameProxy=Ext.bind(MIF.Element.eventProxy,a)),e=a.getFrameDocument();e&&(b=a.getWindow())&&(c(Ext.isIE?e.body||e.documentElement:b,"focus",d),c(Ext.isIE?e.body||e.documentElement:b,"blur",d),c(b,"resize",d),c(b,"beforeunload",d))}}catch(f){}return a._hooked=a.domWritable()},domWritable:function(){return!!this._windowContext&&!!this.getFrameDocument()},_unHook:function(){var a=this;if(a._hooked){try{a._windowContext&&(a._windowContext.hostMIF=null)}catch(b){}a._windowContext=null;var c,d=removeListener,e=a._frameProxy,f=a.getFrameDocument();e&&f&&(c=a.getWindow())&&(d(Ext.isIE?f.body||f.documentElement:c,"focus",e),d(Ext.isIE?f.body||f.documentElement:c,"blur",e),d(c,"resize",e),d(c,"beforeunload",e))}a._flyweights={},Ext.destroy(a.CSS),delete a.CSS,a._frameAction=a.domReady=a.domFired=a._hooked=!1},submitAsTarget:function(a){var b=a||{},c=this.getParentDocument(),d=Ext.getDom(b.form?b.form.form||b.form:null,!1,c)||Ext.DomHelper.append(c.body,{tag:"form",cls:"x-hide-offsets x-mif-form",encoding:"multipart/form-data"}),e=Ext.fly(d,"_dynaForm"),f={target:d.target||"",method:d.method||"",encoding:d.encoding||"",enctype:d.enctype||"",action:d.action||""},g=b.encoding||d.encoding,h=b.method||d.method||"POST";e.set({target:this.dom.name,method:h,encoding:g,action:b.url||b.action||d.action}),("POST"==h||b.enctype)&&e.set({enctype:b.enctype||d.enctype||g});var i,j,k;return b.params&&(k=Ext.isFunction(b.params)?b.params():b.params)&&(i=[],Ext.iterate(k="string"==typeof k?Ext.urlDecode(k,!1):k,function(a,b){Ext.fly(j=D.createElement("input")).set({type:"hidden",name:a,value:b}),d.appendChild(j),i.push(j)})),Ext.isFunction(b.callback)&&this.on("datasetchanged",b.callback,b.scope||this,{single:!0,submitOptions:b}),this._frameAction=!0,this._targetURI=location.href,d.submit(),i&&Ext.each(i,Ext.removeNode,Ext),e.hasClass("x-mif-form")?e.remove():e.set(f),e=null,this},resetUrl:function(){return Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:"about:blank"}(),setSrc:function(a,b,c,d){var e=a||this.src||this.resetUrl;Ext.isFunction(c)&&this.queueCallback(c,d||this),b!==!0&&(this.src=e);var f=this._targetURI=Ext.isFunction(e)?e()||"":e;try{this._frameAction=!0,this.dom.src=f,Ext.isIE||this.assertOnReady()}catch(g){}return this},setLocation:function(a,b,c,d){var e=this,f=a||e.src||e.resetUrl;e._unHook(),Ext.isFunction(c)&&e.queueCallback(c,d);var g=e._targetURI=Ext.isFunction(f)?f()||"":f;b!==!0&&(e.src=f);try{e._frameAction=!0,e.getWindow().location.replace(g),Ext.isIE||e.assertOnReady()}catch(h){}return e},reset:function(a,b,c){var d,e=this,f=a;return e._unHook(),(d=e.getWindow())&&(e.isReset=e._frameAction=!0,Ext.isFunction(b)&&e.queueCallback(b,c),Ext.isFunction(a)&&(f=a()),f=e._targetURI=Ext.isEmpty(f,!0)?e.resetUrl:f,d.location.href=f),e},queueCallback:function(a,b){var c=this;return c.callbacks=c.callbacks||[],c.callbacks.push(b?Ext.bind(a,b||c):a),c},dispatchCallbacks:function(a,b,c){var d=this;if(d.callbacks&&d.callbacks.length)for(;d.callbacks.length;)d.callbacks.shift()(a,b,c)},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(a,b,c,d){var e=this;a=DomHelper.markup(a||""),a=b!==!1?a:a.replace(e.scriptRE,"");var f;return(f=e.getFrameDocument())&&a.length?(e._unHook(),e.src=null,Ext.isFunction(c)&&e.queueCallback(c,d||this),e._targetURI=null,e._frameAction=!0,f.open(),f.write(a),e.assertOnReady(),f.close()):Ext.callback(c,d||e),e},execCommand:function(a,b,c,d){var e,f;if((e=this.getFrameDocument())&&a)try{return Ext.isIE&&this.focus(),f=d&&Ext.isFunction(e.queryCommandEnabled)?e.queryCommandEnabled(a):!0,f&&e.execCommand(a,!!b,c)}catch(g){return!1}return!1},setDesignMode:function(a){var b;return(b=this.getFrameDocument())&&(b.designMode=/on|true/i.test(String(a))?"On":"Off"),this},print:function(){try{var a;(a=this.getWindow())&&(Ext.isIE&&a.focus(),a.print())}catch(b){var c=this.statics().Error;c.raise({msg:c.message.printexception||b.description||b.message,error:b,win:a})}return this},writeScript:function(a,b){b=Ext.apply({},b||{},{type:"text/javascript",text:a});try{var c,d,e=this.getFrameDocument();if(e&&"undefined"!=typeof e.getElementsByTagName&&((c=e.getElementsByTagName("head")[0])||(c=e.createElement("head"),e.getElementsByTagName("html")[0].appendChild(c)),c&&(d=e.createElement("script")))){for(var f in b)b.hasOwnProperty(f)&&f in d&&(d[f]=b[f]);return!!c.appendChild(d)}}catch(g){}finally{d=c=null}return!1},execScript:function(a,b){var c=this;try{if(!c.domWritable()){var d=this.statics().Error;throw new d({msg:d.message["execscript-secure-context"],script:a})}if(!b)return c._windowContext.eval(a);c.writeScript(a)}catch(e){return!1}return!0},loadFunction:function(a,b,c){var d=a.name||a,e=a.fn||window[a];d&&e&&this.execScript(d+"="+e,b),c&&this.execScript(d+"()")},assertOnReady:function(){if(!Ext.isGecko&&!this.isReset){var a,b,c,d,e=0,f=this,g=!1,h=this.domReadyRetries||5e3,i=!1,j=(this.getFrameDocument()||{location:{}}).location.href,k=/undefined|unknown/i,l=function(m){if(!this.domReady){if(b=this.getFrameDocument()){d=b.location.href||"",i=!m||d&&(d!=j||d.indexOf(m)>-1),c=0;try{c=k.test(typeof b.fileSize)?0:parseFloat(b.fileSize)}catch(n){}if(g=!!c||i&&(a=b.body)&&!!(a.innerHTML||"").length)return f.loadHandler.call(f,{type:"domready"})}f.loaded||++e>h||Ext.defer(l,2,f,slice.call(arguments,0))}};l.call(f,f._targetURI)}},focus:function(a){var b=this,c=b.getWindow();if(c)try{Number(a)?Ext.defer(b.focus,a,b,[null]):c.focus()}catch(d){}return c=null,b},blur:function(){var a=this,b=a.getWindow();if(b)try{b.blur()}catch(c){}return b=null,a},remove:function(){var a=this,b=a.dom;b&&(a.reset(),Ext.removeNode(b),delete a.dom)},statics:{addMethods:function(a){Ext.apply(MIF.Element.prototype,a)},DOMFrameReadyHandler:function(a){var b;try{b=a.target?a.target.manager:null}catch(c){}b&&b.loadHandler.call(b,a)},eventProxy:function(a){if(a){var b,c;if(!a.eventPhase||a.eventPhase==(a.AT_TARGET||2))switch(a.type){case"blur":case"focus":c="UIEvents";case"resize":if(Ext.isIE)break;case"scroll":b=this.dispatchEvent(this.createEvent(a.type,c||"HTMLEvents"),a.type);break;case"unload":case"beforeunload":this._unHook()}return b}},Flyweight:Element.Flyweight,getParentDocument:Element.getParentDocument,isDocumentStrict:function(a){return a&&a.compatMode&&"BackCompat"!=a.compatMode},getDocumentHeight:function(a){a=a||window;var b=this.getParentDocument(a);return Math.max(this.isDocumentStrict(b)?b.documentElement.scrollHeight:b.body.scrollHeight,this.getViewportHeight(a))},getDocumentWidth:function(a){a=a||window;var b=this.getParentDocument(a);return Math.max(this.isDocumentStrict(b)?b.documentElement.scrollWidth:b.body.scrollWidth,this.getViewportWidth(a))},getViewportHeight:function(a){return(a||window).innerHeight},getViewportWidth:function(a){return(a||window).innerWidth},getViewSize:function(a){return a=a||window,{width:this.getViewportWidth(a),height:this.getViewportHeight(a)}},fromPoint:function(a,b,c){return c=this.getParentDocument(c||document),c?Ext.fly(c.elementFromPoint(a,b),"_fromPoint"):null}}}),Ext.define("App.ux.ManagedIframe.Error",{extend:"Ext.Error",name:"App.ux.ManagedIframe.Error",statics:{raise:Ext.Error.raise,ignore:!1,handle:function(){return this.ignore},message:{"execscript-secure-context":"An attempt was made at script execution within a document context with restricted access.",printexception:"An Error was encountered attempting the print the frame contents (document access is likely restricted)."}}}),MIF.Element.addStatics({Error:App.ux.ManagedIframe.Error}),window.addEventListener&&(window.addEventListener("DOMFrameContentLoaded",MIF.Element.DOMFrameReadyHandler,!1),Ext.EventManager.on(window,"beforeunload",function(){window.removeEventListener("DOMFrameContentLoaded",MIF.Element.DOMFrameReadyHandler,!1)}))}(),Ext.define("App.ux.NodeDisabled",{alias:"plugin.nodedisabled",extend:"Ext.AbstractPlugin",disabledCls:"tree-node-disabled",preventSelection:!0,preventChecking:!0,init:function(a){var b,c,d=this,e=a.getView();d.callParent(arguments),b=e.getRowClass,b?(c=e.scope||d,Ext.apply(e,{getRowClass:function(){var a,e;return a=b.apply(c,arguments)||"",e=d.getRowClass.apply(d,arguments)||"",a&&e?a+" "+e:a+e}})):Ext.apply(e,{getRowClass:Ext.Function.bind(d.getRowClass,d)}),d.preventSelection&&a.getSelectionModel().on("beforeselect",d.onBeforeNodeSelect,d),d.preventChecking&&a.on("checkchange",d.checkchange,d)},getCmp:function(){return this.callParent(arguments)},getRowClass:function(a){return a.get("disabled")?this.disabledCls:""},onBeforeNodeSelect:function(a,b){return b.get("disabled")?!1:void 0},checkchange:function(a,b){a.get("disabled")&&a.set("checked",!b)}}),Ext.define("App.ux.PhotoIdWindow",{extend:"Ext.window.Window",alias:"widget.photoidwindow",height:320,width:320,layout:"fit",renderTo:document.body,initComponent:function(){var a=this;window.webcam.set_api_url("dataProvider/WebCamImgHandler.php"),window.webcam.set_swf_url("lib/jpegcam/htdocs/webcam.swf"),window.webcam.set_quality(100),window.webcam.set_shutter_sound(!0,"lib/jpegcam/htdocs/shutter.mp3"),window.webcam.set_hook("onComplete","onWebCamComplete"),Ext.apply(a,{html:window.webcam.get_html(320,320),buttons:[{text:_("capture"),iconCls:"save",handler:a.captureToCanvas},{text:_("cancel"),scope:a,handler:function(){this.close()}}]}),a.callParent(arguments)},captureToCanvas:function(){window.webcam.snap()}}),Ext.define("App.ux.PatientEncounterCombo",{extend:"Ext.form.ComboBox",alias:"widget.patientEncounterCombo",hideLabel:!0,displayField:"display_string",valueField:"eid",emptyText:_("select")+"...",width:400,editable:!1,queryMode:"local",includeAllSelection:!0,initComponent:function(){var a=this;Ext.define("patientEncounterComboModel",{extend:"Ext.data.Model",fields:[{name:"eid",type:"string"},{name:"brief_description",type:"string"},{name:"service_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"close_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"display_string",type:"string",convert:function(a,b){return Ext.Date.format(b.data.service_date,g("date_time_display_format"))+" - "+Ext.String.ellipsis(b.data.brief_description,25)}}],proxy:{type:"direct",api:{read:"Encounter.getEncounters"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"patientEncounterComboModel",pageSize:500,autoLoad:!1,sorters:[{property:"service_date",direction:"ASC"}],listeners:{load:function(){a.includeAllSelection&&(a.store.insert(0,{eid:"no_enc",brief_description:_("no_encounters"),service_date:"0000-00-00"}),a.store.insert(0,{eid:"all_enc",brief_description:_("all_encounters"),service_date:"0000-00-00"}))}}}),a.callParent()}}),Ext.define("App.ux.RenderPanel",{extend:"Ext.container.Container",alias:"widget.renderpanel",cls:"RenderPanel",layout:"border",frame:!1,border:!1,pageLayout:"fit",pageBody:[],pageTitle:"",pageButtons:null,pageTBar:null,pageBBar:null,pagePadding:null,showRating:!1,pageAutoScroll:!1,initComponent:function(){var a=this;Ext.apply(a,{items:[a.mainHeader=Ext.widget("container",{cls:"RenderPanel-header",itemId:"RenderPanel-header",region:"north",layout:"hbox",height:30}),{cls:"RenderPanel-body-container",itemId:"RenderPanel-body-container",xtype:"container",region:"center",layout:"fit",padding:null==this.pagePadding?5:this.pagePadding,items:[a.mainBoddy=Ext.widget("panel",{cls:"RenderPanel-body",frame:!0,border:!1,itemId:"pageLayout",defaults:{frame:!1,border:!1,autoScroll:!0},autoScroll:a.pageAutoScroll,layout:a.pageLayout,items:a.pageBody,tbar:a.pageTBar,bbar:a.pageBBar,buttons:a.pageButtons})]}]}),a.pageTitleDiv=a.mainHeader.add(Ext.widget("container",{cls:"panel_title",html:a.pageTitle})),a.pageReadOnlyDiv=a.mainHeader.add(Ext.widget("container")),a.showRating&&(a.pageRankingDiv=a.mainHeader.add(Ext.widget("ratingField",{flex:1,listeners:{scope:a,click:function(a,b){Patient.setPatientRating({pid:app.patient.pid,rating:b},function(){app.msg(_("sweet"),_("record_saved"))})}}}))),a.pageTimerDiv=a.mainHeader.add(Ext.widget("container",{width:200})),a.callParent(arguments)},updateTitle:function(a,b,c){this.pageTitleDiv.update(a),this.pageReadOnlyDiv.update(b?_("read_only"):""),this.pageTimerDiv.update(c)},getPageHeader:function(){return this.getComponent("RenderPanel-header")},getPageBodyContainer:function(){return this.getComponent("RenderPanel-body-container")},getPageBody:function(){return this.mainBoddy},onActive:function(a){"function"==typeof a&&a(!0)}}),Ext.define("App.ux.form.fields.Checkbox",{extend:"Ext.form.field.Checkbox",alias:"widget.mitos.checkbox",inputValue:"1",uncheckedValue:"0"}),Ext.define("App.ux.form.fields.ColorPicker",{extend:"Ext.form.field.Trigger",alias:"widget.colorcombo",triggerTip:"Please select a color.",onTriggerClick:function(){var a=this;
picker=Ext.create("Ext.picker.Color",{pickerField:this,ownerCt:this,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,style:{backgroundColor:"#fff"},listeners:{scope:this,select:function(b,c){a.setValue("#"+c),a.inputEl.setStyle({backgroundColor:c}),picker.hide()},show:function(a){a.getEl().monitorMouseLeave(500,a.hide,a)}}}),picker.alignTo(a.inputEl,"tl-bl?"),picker.show(a.inputEl)}}),Ext.define("App.ux.form.fields.Help",{extend:"Ext.Img",alias:"widget.helpbutton",src:"resources/images/icons/icohelp.png",height:16,width:16,margin:"3 10",helpMsg:_("help_message"),initComponent:function(){var a=this;a.listeners={render:function(b){a.setToolTip(b.getEl())}},a.callParent()},setToolTip:function(a){Ext.create("Ext.tip.ToolTip",{target:a,dismissDelay:0,html:this.helpMsg})}}),Ext.define("App.ux.form.fields.CheckBoxWithText",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},xtype:"checkboxwithtext",layout:"hbox",boxLabel:"boxLabel",emptyText:"",readOnly:!1,msgTarget:"under",width:400,inputValue:"1",uncheckedValue:"0",textField1:void 0,textField2:void 0,initComponent:function(){var a=this;a.items=a.items||[],a.items=[{xtype:"checkbox",boxLabel:a.boxLabel,submitValue:!1,inputValue:a.inputValue,width:150,margin:"0 10 0 0"}],a.textField1=a.textField1||{xtype:"textField1"},Ext.apply(a.textField1,{submitValue:!1,flex:1,hidden:!0,emptyText:a.emptyText}),a.items.push(a.textField1),a.textField2&&(Ext.apply(a.textField2,{submitValue:!1,flex:1,hidden:!0,emptyText:a.emptyText}),a.items.push(a.textField2)),"vbox"==a.layout&&(a.height=44),a.callParent(),a.chekboxField=a.items.items[0],a.textField1=a.items.items[1],a.chekboxField.on("change",a.settextField1,a),a.items.items[2]&&(a.textField2=a.items.items[2],a.chekboxField.on("change",a.settextField2,a)),a.initField()},settextField1:function(a,b){if(this.textField1){var c=this.up("window").body,d=c.getScroll();0==b||"off"==b||0==b?(this.textField1.reset&&this.textField1.reset(),this.textField1.hide(),this.textField1.disable()):(this.textField1.show(),this.textField1.enable()),c.scrollTo("top",d.top,!1)}},settextField2:function(a,b){if(this.textField2){var c=this.up("window").body,d=c.getScroll();0==b||"off"==b||0==b?(this.textField2.reset&&this.textField2.reset(),this.textField2.hide(),this.textField2.disable()):(this.textField2.show(),this.textField2.enable()),c.scrollTo("top",d.top,!1)}},getValue:function(){var a="",b=this.chekboxField.getSubmitValue(),c=this.textField1.getSubmitValue()||"";return b&&(a=b+"~"+c,this.textField2&&(a+="~"+(this.textField2.getSubmitValue()||""))),a},getSubmitValue:function(){return this.getValue()},setValue:function(a){if(a&&a.split){var b=a.split("~");return this.chekboxField.setValue(b[0]||0),this.textField1.setValue(b[1]||""),void(this.textField2&&this.textField1.setValue(b[2]||""))}this.chekboxField.setValue(0),this.textField1.setValue(""),this.textField2&&this.textField2.setValue("")},getSubmitData:function(){var a=this,b=null;return a.disabled||!a.submitValue||a.isFileUpload()||(b={},b[a.getName()]=""+a.getSubmitValue()),b},setReadOnly:function(a){this.chekboxField.setReadOnly(a),this.textField1.setReadOnly(a),this.textField2&&this.textField2.setReadOnly(a)},isValid:function(){return this.chekboxField.isValid()&&this.textField1.isValid()}}),Ext.define("App.ux.form.fields.Currency",{extend:"Ext.form.field.Number",alias:"widget.mitos.currency",currencySymbol:g("gbl_currency_symbol"),useThousandSeparator:!0,thousandSeparator:",",alwaysDisplayDecimals:!0,fieldStyle:"text-align: right;",hideTrigger:!0,initComponent:function(){this.useThousandSeparator&&","==this.decimalSeparator&&","==this.thousandSeparator?this.thousandSeparator=".":this.allowDecimals&&"."==this.thousandSeparator&&"."==this.decimalSeparator&&(this.decimalSeparator=","),this.callParent(arguments)},setValue:function(a){App.ux.form.fields.Currency.superclass.setValue.call(this,null!=a?a.toString().replace(".",this.decimalSeparator):a),this.setRawValue(this.getFormattedValue(this.getValue()))},getFormattedValue:function(a){if(Ext.isEmpty(a)||!this.hasFormat())return a;var b=null;if(a=(b=0>a)?-1*a:a,a=this.allowDecimals&&this.alwaysDisplayDecimals?a.toFixed(this.decimalPrecision):a,this.useThousandSeparator){if(this.useThousandSeparator&&Ext.isEmpty(this.thousandSeparator))throw"NumberFormatException: invalid thousandSeparator, property must has a valid character.";if(this.thousandSeparator==this.decimalSeparator)throw"NumberFormatException: invalid thousandSeparator, thousand separator must be different from decimalSeparator.";a=a.toString();var c=a.split(".");c[1]=c[1]?c[1]:null;for(var d=c[0],e=/(\d+)(\d{3})/,f=this.thousandSeparator;e.test(d);)d=d.replace(e,"$1"+f+"$2");a=d+(c[1]?this.decimalSeparator+c[1]:"")}return Ext.String.format("{0}{1}{2}",b?"-":"",Ext.isEmpty(this.currencySymbol)?"":this.currencySymbol,a)},parseValue:function(a){return App.ux.form.fields.Currency.superclass.parseValue.call(this,this.removeFormat(a))},removeFormat:function(a){return Ext.isEmpty(a)||!this.hasFormat()?a:(a=a.toString().replace(this.currencySymbol,""),a=this.useThousandSeparator?a.replace(new RegExp("["+this.thousandSeparator+"]","g"),""):a)},getErrors:function(a){return App.ux.form.fields.Currency.superclass.getErrors.call(this,this.removeFormat(a))},hasFormat:function(){return"."!=this.decimalSeparator||1==this.useThousandSeparator&&null!=this.getRawValue()||!Ext.isEmpty(this.currencySymbol)||this.alwaysDisplayDecimals},onFocus:function(){this.setRawValue(this.removeFormat(this.getRawValue())),this.callParent(arguments)}}),Ext.define("App.ux.form.fields.Percent",{extend:"Ext.form.field.Number",alias:"widget.mitos.percent",currencySymbol:"%",useThousandSeparator:!1,thousandSeparator:",",alwaysDisplayDecimals:!0,fieldStyle:"text-align: right;",hideTrigger:!0,initComponent:function(){this.useThousandSeparator&&","==this.decimalSeparator&&","==this.thousandSeparator?this.thousandSeparator=".":this.allowDecimals&&"."==this.thousandSeparator&&"."==this.decimalSeparator&&(this.decimalSeparator=","),this.callParent(arguments)},setValue:function(a){App.ux.form.fields.Currency.superclass.setValue.call(this,null!=a?a.toString().replace(".",this.decimalSeparator):a),this.setRawValue(this.getFormattedValue(this.getValue()))},getFormattedValue:function(a){if(Ext.isEmpty(a)||!this.hasFormat())return a;var b=null;if(a=(b=0>a)?-1*a:a,a=this.allowDecimals&&this.alwaysDisplayDecimals?a.toFixed(this.decimalPrecision):a,this.useThousandSeparator){if(this.useThousandSeparator&&Ext.isEmpty(this.thousandSeparator))throw"NumberFormatException: invalid thousandSeparator, property must has a valid character.";if(this.thousandSeparator==this.decimalSeparator)throw"NumberFormatException: invalid thousandSeparator, thousand separator must be different from decimalSeparator.";a=a.toString();var c=a.split(".");c[1]=c[1]?c[1]:null;for(var d=c[0],e=/(\d+)(\d{3})/,f=this.thousandSeparator;e.test(d);)d=d.replace(e,"$1"+f+"$2");a=d+(c[1]?this.decimalSeparator+c[1]:"")}return Ext.String.format("{0}{1}{2}",b?"-":"",a,Ext.isEmpty(this.currencySymbol)?"":this.currencySymbol)},parseValue:function(a){return App.ux.form.fields.Currency.superclass.parseValue.call(this,this.removeFormat(a))},removeFormat:function(a){return Ext.isEmpty(a)||!this.hasFormat()?a:(a=a.toString().replace(this.currencySymbol,""),a=this.useThousandSeparator?a.replace(new RegExp("["+this.thousandSeparator+"]","g"),""):a)},getErrors:function(a){return App.ux.form.fields.Currency.superclass.getErrors.call(this,this.removeFormat(a))},hasFormat:function(){return"."!=this.decimalSeparator||1==this.useThousandSeparator&&null!=this.getRawValue()||!Ext.isEmpty(this.currencySymbol)||this.alwaysDisplayDecimals},onFocus:function(){this.setRawValue(this.removeFormat(this.getRawValue())),this.callParent(arguments)}}),Ext.define("App.ux.form.fields.MultiText",{extend:"Ext.form.FieldContainer",xtype:"multitextfield",layout:{type:"vbox",align:"stretch"},name:null,numbers:!0,initComponent:function(){var a=this;a.lastField=null,a.callParent(),a.addField()},addField:function(a){var b=this;b.lastField=b.add({xtype:"textfield",name:"_"+b.name,anchor:"100%",value:a||"",labelWidth:20,margin:"0 0 5 0",enableKeyEvents:!0}),b.numbers&&b.lastField.setFieldLabel((b.items.items.indexOf(b.lastField)+1).toString()),b.lastField.on("keyup",this.onFieldKeyUp,this)},onFieldKeyUp:function(a,b){if(b.getKey()!=b.TAB){var c=this,d=c.items.items.indexOf(a),e=c.items.items.length,f=d+1==e,g=d+2==e;f&&a.getValue().length>0&&this.lastField==a&&b.getKey()!=b.DELETE&&b.getKey()!=b.BACKSPACE?(this.addField(),c.doLayout()):g&&0==a.getValue().length&&c.lastField!=a&&(c.remove(c.lastField),c.doLayout(),c.lastField=a)}},setValue:function(a){var b=this;if(b.removeAll(!0),Ext.isString(a)&&""!=a)b.addField(a);else if(Ext.isArray(a))for(var c=0;c<a.length;c++)b.addField(a[c]);b.addField("")},getValue:function(){var a=this,b=a.up("form").getForm().getValues()["_"+a.name];return""==b[b.length-1]&&Ext.Array.erase(b,b.length-1,1),b}}),Ext.define("App.ux.form.fields.CustomTrigger",{extend:"Ext.form.field.Trigger",alias:"widget.customtrigger",hideLabel:!0,triggerTip:_("click_to_clear_selection"),qtip:_("clearable_combo_box"),trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-clear-trigger",onRender:function(){this.callParent(arguments);var a=this.getId();this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+a,name:"trigger2"+a,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(){this.destroy()},this);var b=Ext.get("trigger2"+a);b.addClsOnOver("x-form-trigger-over")}}),Ext.define("App.ux.form.fields.Switch",{extend:"Ext.slider.Single",xtype:"switchfield",cls:"switch-field-slider",onValue:"true",offValue:"false",neutralValue:null,width:150,value:null,increment:1,minValue:0,maxValue:2,animate:!1,labelWidth:150,mapSliderToValue:{},mapValueToSlider:{},boxLabel:"",boxLabelCls:Ext.baseCSSPrefix+"form-cb-label",boxLabelAlign:"after",initComponent:function(){var a=this;a.mapSliderToValue[0]=a.offValue,a.mapSliderToValue[1]=null,a.mapSliderToValue[2]=a.onValue,a.mapValueToSlider[a.offValue]=0,a.mapValueToSlider["null"]=1,a.mapValueToSlider[a.onValue]=2,a.boxLabel&&a.on("render",a.doBoxLabel,a),a.on("change",a.onSliderValueChange,a),a.callParent(arguments),a.onSliderValueChange(a,a.mapValueToSlider[a.value])},doBoxLabel:function(){this.inputRow.appendChild({tag:"td",width:this.labelWidth,html:Ext.String.format('<label class="{0} {0}-{1}" style="width:100%;">{2}</label>',this.boxLabelCls,this.boxLabelAlign,this.boxLabel)})},onSliderValueChange:function(a,b){0===b?(this.addCls("switch-field-off"),this.removeCls("switch-field-on")):2===b?(this.addCls("switch-field-on"),this.removeCls("switch-field-off")):(this.removeCls("switch-field-off"),this.removeCls("switch-field-on"))},getSubmitData:function(){var a={};return a[this.getName()]=this.getValue(),a},getValue:function(){return this.mapSliderToValue[this.callParent([0])]},setValue:function(a){var b=arguments,c=b.length;(0===c||void 0===b[0]||void 0===a)&&(b[0]=1);var d=this.mapValueToSlider[b[0]];return void 0!==d&&(b[0]=d),this.onSliderValueChange(this,b[0]),this.callParent(b)}}),Ext.define("App.ux.form.fields.DateTime",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},alias:"widget.mitos.datetime",combineErrors:!0,layout:"hbox",readOnly:!1,allowBlank:!0,dateFormat:g("date_display_format"),dateSubmitFormat:"Y-m-d",timeFormat:"g:i a",dateTimeFormat:"Y-m-d H:i:s",dateConfig:{},timeConfig:{},dateValue:null,dateField:null,timeField:null,initComponent:function(){var a=this;a.items=a.items||[],a.dateConfig.allowBlank=a.allowBlank,a.dateField=Ext.create("Ext.form.field.Date",Ext.apply({format:a.dateFormat,submitFormat:a.dateSubmitFormat,flex:1,emptyText:_("date"),margin:0,submitValue:!1},a.dateConfig)),a.items.push(a.dateField),a.timeField=Ext.create("Ext.form.field.Time",Ext.apply({format:a.timeFormat,flex:1,emptyText:_("time"),margin:0,submitValue:!1},a.timeConfig)),a.items.push(a.timeField);for(var b=0;b<a.items.length;b++)a.items[b].on("focus",Ext.bind(a.onItemFocus,a)),a.items[b].on("blur",Ext.bind(a.onItemBlur,a)),a.items[b].on("specialkey",function(b,c){var d=c.getKey(),e=d==c.TAB;return e&&a.focussedItem==a.dateField?(c.stopEvent(),void a.timeField.focus()):void a.fireEvent("specialkey",b,c)});"vbox"==a.layout&&(a.height=44),a.callParent(),a.initField()},focus:function(){this.callParent(),this.dateField.focus()},onItemFocus:function(a){this.blurTask&&this.blurTask.cancel(),this.focussedItem=a},onItemBlur:function(a){var b=this;a==b.focussedItem&&(b.blurTask=new Ext.util.DelayedTask(function(){b.fireEvent("blur",b)}),b.blurTask.delay(100))},getValue:function(){var a=null,b=this.dateField.getSubmitValue(),c=this.timeField.getSubmitValue();if(b)if(c){var d=this.getFormat();a=Ext.Date.parse(b+" "+c,d)}else a=this.dateField.getValue();return a},getSubmitValue:function(){var a=this.getValue();return a?Ext.Date.format(a,this.dateTimeFormat):null},setValue:function(a){Ext.isString(a)&&(a=Ext.Date.parse(a,this.dateTimeFormat)),this.dateField.setValue(a),this.timeField.reset(),this.timeField.setValue(a)},getFormat:function(){return(this.dateField.submitFormat||this.dateField.format)+" "+(this.timeField.submitFormat||this.timeField.format)},getSubmitData:function(){var a=this,b=null;return a.disabled||!a.submitValue||a.isFileUpload()||(b={},b[a.getName()]=""+a.getSubmitValue()),b},setReadOnly:function(a){this.dateField.setReadOnly(a),this.timeField.setReadOnly(a)},setMaxValue:function(a){this.dateField.setMaxValue(a)}}),Ext.define("App.ux.form.fields.PhysicalExamField",{extend:"Ext.form.FieldContainer",xtype:"physicalexamfield",labelAlign:"top",isFormField:!0,submitValue:!0,name:void 0,getName:function(){return this.name},validate:function(){return!0},isValid:function(){return!0},isDirty:function(){return!1},initComponent:function(){var a=this;a.items=[{xtype:"checkbox",boxLabel:"Normal "+a.boxLabel,action:"normal",inputValue:!0,uncheckedValue:!1,submitValue:!1},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",boxLabel:"ABN: ",action:"abnormal",inputValue:!0,uncheckedValue:!1,submitValue:!1},{xtype:"textfield",margin:"0 0 0 5",width:200,action:"abnormalnote",submitValue:!1}]}],a.callParent(),a.normalCk=a.down("checkbox[action=normal]"),a.abnormalCk=a.down("checkbox[action=abnormal]"),a.abnormalNote=a.down("textfield[action=abnormalnote]"),a.normalCk.on("change",function(b){a.normalCk.ignoreChange!==!0&&(a.abnormalCk.ignoreChange=!0,a.abnormalCk.setValue(!b),a.abnormalCk.ignoreChange=!1)}),a.abnormalCk.on("change",function(b){a.abnormalCk.ignoreChange!==!0&&(a.normalCk.ignoreChange=!0,a.normalCk.setValue(!b),a.normalCk.ignoreChange=!1)})},getSubmitData:function(){return this.getValue()},getValue:function(){var a={};return a[this.name]={label:this.fieldLabel,normal:this.normalCk.getValue(),abnormal:this.abnormalCk.getValue(),abnormal_note:this.abnormalNote.getValue()},a},setValue:function(a){var b=this;say(a),b.normalCk.ignoreChange=!0,b.abnormalCk.ignoreChange=!0,b.normalCk.setValue(a.normal),b.abnormalCk.setValue(a.abnormal),b.abnormalNote.setValue(a.abnormal_note),b.normalCk.ignoreChange=!1,b.abnormalCk.ignoreChange=!1}}),Ext.define("App.ux.grid.DeleteColumn",{extend:"Ext.grid.column.Action",xtype:"griddeletecolumn",icon:"resources/images/icons/delete.png",tooltip:_("delete"),acl:"*",width:30,forceSync:!0,handler:function(grid,rowIndex,colIndex,item,e,record){var me=this,acl=Ext.isString(this.acl)?a(this.acl):eval(this.acl),eid=record.get("eid");if(say(eid),eid!==app.patient.eid&&0!==eid&&!Ext.isEmpty(eid))return void app.msg(_("oops"),_("remove_encounter_related_error"),!0);if(acl!==!0)return void app.msg(_("oops"),_("permission_denied"),!0);var store=grid.store;store.remove(record),(store.autoSync||me.forceSync)&&Ext.Msg.show({title:_("wait"),msg:_("delete_record_confirmation"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a?!store.autoSync&&me.forceSync?store.sync({callback:function(){app.msg(_("sweet"),_("record_removed"),"yellow")}}):app.msg(_("sweet"),_("record_removed"),"yellow"):store.rejectChanges()}})}}),Ext.define("App.ux.form.fields.plugin.BadgeText",{extend:"Ext.AbstractPlugin",alias:"plugin.badgetext",disableBg:"gray",enableBg:"red",textSize:15,textColor:"white",defaultText:" ",disableOpacity:0,align:"left",text:" ",disable:!0,button:null,init:function(a){var b=this;b.button=a,b.text=b.defaultText,a.on("render",b.addBadgeEl,b),Ext.apply(a,{setBadgeText:function(c){return b.disable="undefined"==typeof c||c===b.defaultText,b.text=b.disable?b.defaultText:c,a.rendered&&(a.badgeEl.update(c.toString?c.toString():c),Ext.isStrict&&Ext.isIE8&&a.el.repaint(),b.setDisabled(b.disable)),a},getBadgeText:function(){return b.text}})},addBadgeEl:function(a){var b=this,c={position:"absolute","background-color":b.disableBg,"font-size":b.textSize+"px",color:b.textColor,padding:"1px 5px",index:50,top:"-3px","border-radius":"15px","font-weight":"bold","text-shadow":"rgba(0, 0, 0, 0.5) 0 -0.08em 0","box-shadow":"rgba(0, 0, 0, 0.3) 0 0.1em 0.1em",cursor:"pointer"};"left"==b.align?c.left="-3px":c.right="-3px",a.badgeEl=Ext.DomHelper.append(a.el,{tag:"div",cls:"badgeText x-unselectable"},!0),a.badgeEl.setOpacity(b.disableOpacity),a.badgeEl.setStyle(c),a.badgeEl.update(b.text.toString?b.text.toString():b.text),a.el.setStyle({overflow:"hidden"})},onBadgeClick:function(){var a=this;a.button.fireEvent("badgeclick",a.button,a.text)},setDisabled:function(a){var b=this;b.button.badgeEl.setStyle({"background-color":a?b.disableBg:b.enableBg,opacity:a?b.disableOpacity:1}),b.button.badgeEl.clearListeners(),a||b.button.badgeEl.on("click",b.onBadgeClick,b,{preventDefault:!0,stopEvent:!0})}}),Ext.define("App.ux.grid.EventHistory",{extend:"Ext.grid.Panel",alias:"widget.mitos.eventhistorygrid",initComponent:function(){Ext.apply(this,{columns:[{header:_("date"),dataIndex:"date",width:140,renderer:Ext.util.Format.dateRenderer("Y-m-d g:i:s a")},{header:_("user"),dataIndex:"user",width:150},{header:_("event"),dataIndex:"event",flex:1}]},null),this.callParent(arguments)}}),Ext.define("App.ux.form.fields.plugin.ReadOnlyLabel",{extend:"Ext.AbstractPlugin",alias:"plugin.readonlylabel",align:"right",text:_("read_only"),textBg:"red",textSize:"14",textColor:"white",textOpacity:.4,init:function(a){var b=this;a.on("render",b.onRender,b),a.on("writeablechange",b.setReadOnly,b)},setReadOnly:function(a,b){a.readOnlyEl.setVisible(b)},onRender:function(a){this.addReadOnlyEl(a),this.setReadOnly(a,a.readOnly)},addReadOnlyEl:function(a){var b=this,c={position:"absolute","background-color":b.textBg,"font-size":b.textSize+"px",color:b.textColor,padding:"5px 10px",index:50,top:"10px","border-radius":"5px",visibility:"hidden"};"left"==b.align?c.left="10px":c.right="10px",a.readOnlyEl=Ext.DomHelper.append(a.el,{tag:"div",cls:"badgeText x-unselectable"},!0),a.readOnlyEl.setOpacity(b.textOpacity),a.readOnlyEl.setStyle(c),a.readOnlyEl.update(b.text.toString?b.text.toString():b.text)}}),Ext.define("App.ux.form.Panel",{extend:"Ext.form.Panel",alias:"widget.mitos.form",bodyStyle:"padding: 10px;",autoWidth:!0,border:!1}),Ext.define("App.ux.form.AdvanceForm",{extend:"Ext.AbstractPlugin",alias:"plugin.advanceform",syncAcl:!0,autoSync:!1,enabled:!0,autoSyncTool:!0,syncDelay:3e3,init:function(a){this.callParent(arguments),a.advanceFormPlugin=this,this.formPanel=a,this.formPanel.autoSync=this.autoSync,this.formPanel.on("beforerender",this.setFieldEvent,this),this.form=this.formPanel.getForm(),this.form.loadRecord=this.loadRecord,this.autoSyncTool&&this.addTool()},loadRecord:function(a){var b=this,c=b.owner,d=this.owner.advanceFormPlugin;return a?(b.isLoading=!0,b._record=a,d.setFormFieldsClean(!1),a.store.on("write",d.onStoreWrite,d),a.store.on("beforesync",function(a,b){c.fireEvent("beforesync",a,b)},d),a.store.on("update",function(a,b){c.fireEvent("update",a,b)},d),b.setValues(a.data),c.fireEvent("recordloaded",b,a),b.isLoading=!1,b):b},onStoreWrite:function(a,b){this.setFormFieldsClean(),this.formPanel.fireEvent("write",a,b),app.msg("Sweet!","Record Saved"),delete this.bufferSyncFormFn},setFieldEvent:function(a){for(var b=a.getForm().getFields().items,c=0;c<b.length;c++)"textfield"===b[c].xtype||"textarea"===b[c].xtype||"textareafield"===b[c].xtype?(b[c].enableKeyEvents=!0,b[c].on("keyup",this.setFieldCondition,this),b[c].on("change",this.setFieldCondition,this)):"radiofield"===b[c].xtype||"checkbox"===b[c].xtype||"switchfield"===b[c].xtype?(b[c].scope=this,b[c].handler=this.setFieldCondition,b[c].on("change",this.setFieldCondition,this)):"datefield"===b[c].xtype?(b[c].on("select",this.setFieldCondition,this),b[c].on("change",this.setFieldCondition,this)):b[c].on("select",this.setFieldCondition,this)},setFieldCondition:function(a){if(this.enabled){var b,c=this,d=c.form.getRecord(),e=d?d.store:null,f={},g=c.getFieldEl(a);null!=e&&(!c.form.isLoading&&"radiofield"!==a.xtype||!c.form.isLoading&&"radiofield"===a.xtype&&a.checked)&&(f[a.name]=a.getSubmitValue(),d.set(f),b=0!==Object.getOwnPropertyNames(d.getChanges()).length,b===!0?c.setFieldDirty(a,g,!0):c.setFieldDirty(a,g,!1),this.formPanel.autoSync&&this.syncAcl&&("undefined"==typeof c.bufferSyncFormFn?(c.bufferSyncFormFn=Ext.Function.createBuffered(function(){e.sync()},c.syncDelay),c.bufferSyncFormFn()):b===!0?c.bufferSyncFormFn():(c.setFormFieldsClean(),delete c.bufferSyncFormFn)))}},setFieldDirty:function(a,b,c){if(a.el.hasChanged&&!c||!a.el.hasChanged&&c){var d="textarea"===a.xtype?a.inputEl.el:a.el;a.el.hasChanged=c,d.setStyle(c?{"background-image":"none",backgroundColor:"FFDDDD"}:{"background-image":null,backgroundColor:null})}},getFieldEl:function(a){return"textfield"==a.xtype||"textareafield"==a.xtype?a.inputEl:"radiofield"==a.xtype?a.ownerCt.el:"checkbox"==a.xtype?a.el:a.el},setFormFieldsClean:function(){for(var a,b=this,c=b.form.getFields().items,d=0;d<c.length;d++)a=b.getFieldEl(c[d]),"undefined"!=typeof c[d].el&&c[d].el.hasChanged&&b.setFieldDirty(c[d],a,!1)},addTool:function(){var a=this,b=a.formPanel.getDockedItems()[0],c=a.formPanel.autoSync?"autosave":"";b&&a.autoSyncTool&&b.insert(b.items.length-1,Ext.create("Ext.panel.Tool",{type:"save",cls:c,tooltip:"Autosave",handler:function(b,c,d,e){a.formPanel.autoSync=!a.formPanel.autoSync,a.formPanel.autoSync?e.addCls("autosave"):e.removeCls("autosave"),app.msg("Sweet!","AutoSave is "+(a.formPanel.autoSync?"On":"Off"))}}))}}),Ext.define("App.ux.combo.ActiveFacilities",{extend:"Ext.form.ComboBox",xtype:"activefacilitiescombo",storeAutoLoad:!0,editable:!1,queryMode:"local",valueField:"option_value",displayField:"option_name",emptyText:_("select"),initComponent:function(){var a=this;Ext.define("ActiveFacilitiesComboModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"int"}],proxy:{type:"direct",api:{read:"CombosData.getActiveFacilities"}}}),a.store=Ext.create("Ext.data.Store",{model:"ActiveFacilitiesComboModel",autoLoad:a.storeAutoLoad}),a.callParent(arguments)}}),Ext.define("App.ux.window.voidComment",{extend:"Ext.window.Window",xtype:"voidcommentwindow",itemId:"VoidCommentWindow",alias:"widget.voidwindow",closable:!1,frame:!1,frameHeader:!1,title:_("void_comment"),init:function(){},items:[{xtype:"textfield",itemId:"VOIDComment",name:"void_comment",allowBlank:!1,hideLabel:!0,grow:!0,growMax:600}],buttons:[{xtype:"button",action:"save",text:_("save")},{xtype:"button",action:"cancel",text:_("cancel"),listeners:{click:function(){me.close()}}}]}),Ext.define("App.ux.grid.SlidingPagerAndPageSize",{requires:["Ext.slider.Single","Ext.slider.Tip"],constructor:function(a){a&&Ext.apply(this,a)},init:function(a){var b,c,d=a.items.indexOf(a.child("#inputItem"));Ext.each(a.items.getRange(d-2,d+2),function(a){a.hide()}),b=Ext.create("Ext.slider.Single",{width:114,minValue:1,maxValue:1,hideLabel:!0,tipText:function(a){return Ext.String.format("Page <b>{0}</b> of <b>{1}</b>",a.value,a.slider.maxValue)},listeners:{changecomplete:function(b,c){a.store.loadPage(c)}}}),c=Ext.create("Ext.form.field.ComboBox",{width:120,value:a.pageSize,editable:!1,fieldLabel:"Page Size",labelWidth:55,labelAlign:"right",store:[10,25,50,100,500,1e3,2e3,4e3],listeners:{select:function(b){a.pageSize=b.getValue(),a.store.pageSize=b.getValue(),a.store.loadPage(1)}}}),a.insert(d+1,b),a.insert(d+6,c),a.on({change:function(a,c){b.setMaxValue(c?c.pageCount:1),b.setValue(c?c.currentPage:1)}})}}),Ext.define("App.ux.combo.ActiveInsurances",{extend:"Ext.form.ComboBox",xtype:"activeinsurancescombo",editable:!1,displayField:"option_name",valueField:"option_value",emptyText:_("select"),initComponent:function(){var a=this;Ext.define("ActiveInsurancesComboModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"int"}],proxy:{type:"direct",api:{read:"CombosData.getActiveInsurances"}}}),a.store=Ext.create("Ext.data.Store",{model:"ActiveInsurancesComboModel",autoLoad:!0}),a.callParent()}}),Ext.define("App.ux.combo.AclPermissions",{extend:"Ext.form.ComboBox",xtype:"aclpermissions",typeAhead:!0,typeAheadDelay:50,queryMode:"local",displayField:"display_text",valueField:"perm_key",emptyText:_("acl_permission"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"perm_key",type:"string"},{name:"perm_name",type:"string"},{name:"perm_cat",type:"string"},{name:"display_text",type:"string",convert:function(a,b){return Ext.String.format("{0}: {1}",b.get("perm_cat"),b.get("perm_name"))}}],sorters:[{property:"perm_cat",direction:"ASC"},{property:"perm_name",direction:"ASC"}],remoteSort:!0,pageSize:2e3,autoLoad:!0,proxy:{type:"direct",api:{read:"ACL.getAclPermissions"},reader:{type:"json"}},listeners:{load:function(){this.insert(0,[{perm_key:"*",perm_name:"No Restriction",perm_cat:"NONE"}])}}}),a.callParent(arguments)}}),Ext.define("App.ux.grid.RowFormEditor",{extend:"Ext.form.Panel",requires:["Ext.tip.ToolTip","Ext.util.HashMap","Ext.util.KeyNav"],saveBtnText:"Update",cancelBtnText:"Cancel",removeBtnText:"Remove",errorsText:"Errors",dirtyText:"Commit Cancel Your Changes",lastScrollLeft:0,lastScrollTop:0,bodyPadding:5,padding:"0 0 5 0",border:!1,saveBtnEnabled:!1,buttonAlign:"center",hideMode:"offsets",errorSummary:!1,style:"background-color:#E0E0E0",initComponent:function(){var a,b,c=this;c.cls=Ext.baseCSSPrefix+"grid-row-editor grid-row-form-editor",c.currRowH=null,b=c.editingPlugin,c.items=b.items,c.fieldDefaults=b.fieldDefaults;var d=[{action:"update",xtype:"button",itemId:"update",handler:b.completeEdit,scope:b,text:c.saveBtnText,disabled:!c.isValid},{xtype:"button",itemId:"cancel",handler:b.cancelEdit,scope:b,text:c.cancelBtnText}];b.enableRemove&&d.push({xtype:"button",itemId:"remove",handler:b.completeRemove,scope:b,text:c.removeBtnText}),c.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",margin:0,layout:{pack:"center"},cls:"x-grid-row-editor x-panel-body",style:"border-top:none !important",defaults:{minWidth:Ext.panel.Panel.prototype.minButtonWidth},items:d}],c.callParent(arguments),a=c.getForm(),c.setFields(),a.trackResetOnLoad=!0,c.floatingButtons=c.getDockedItems('toolbar[dock="bottom"]')[0]},onFieldValueChange:function(){var a,b=this,c=b.getForm(),d=c.isValid();b.errorSummary&&b.isVisible()&&b[d?"hideToolTip":"showToolTip"](),a=b.query('button[action="update"]')[0],a&&a.setDisabled(!d),b.isValid=d},afterRender:function(){var a=this,b=a.editingPlugin,c=b.grid,d=c.lockable?c.normalGrid.view:c.view;a.callParent(arguments),a.scrollingView=d,a.scrollingViewEl=d.el,a.mon(a.renderTo,"scroll",a.onCtScroll,a,{buffer:100}),a.mon(a.el,{click:Ext.emptyFn,stopPropagation:!0}),a.el.swallowEvent(["keypress","keydown"]),a.keyNav=new Ext.util.KeyNav(a.el,{esc:b.onEscKey,scope:b}),a.mon(b.view,{beforerefresh:a.onBeforeViewRefresh,refresh:a.onViewRefresh,scope:a})},onBeforeViewRefresh:function(a){var b=this,c=a.el.dom;b.el.dom.parentNode===c&&c.removeChild(b.el.dom)},onViewRefresh:function(a){var b,c=this,d=a.el.dom,e=c.context;d.appendChild(c.el.dom),e&&(b=e.store.indexOf(e.record))>=0?(e.row=a.getNode(b),c.reposition(),c.tooltip&&c.tooltip.isVisible()&&c.tooltip.setTarget(e.row)):c.editingPlugin.cancelEdit()},onCtScroll:function(a,b){var c=this,d=b.scrollTop,e=b.scrollLeft;d!==c.lastScrollTop&&(c.lastScrollTop=d,(c.tooltip&&c.tooltip.isVisible()||c.hiddenTip)&&c.repositionTip()),e!==c.lastScrollLeft&&(c.lastScrollLeft=e,c.reposition())},reposition:function(a){this.currRowH&&this.currRow.setHeight(this.currRowH);var b,c,d=this,e=d.context,f=e&&Ext.get(e.row),g=d.editingPlugin.grid,h=g.view.el,i=g.verticalScroller,j=g.headerCt.getFullWidth(),k=g.getWidth(),l=(Math.min(j,k),g.view.el.dom.scrollLeft,function(){i&&(i.invalidate(),btnEl.scrollIntoView(h,!1)),a&&a.callback&&a.callback.call(a.scope||d)});if(f&&Ext.isElement(f.dom))if(f.scrollIntoView(h,!1),b=f.getXY()[1]+19,d.currRowH=f.getHeight(),d.currRow=f,f.setHeight(d.getHeight()+19),Ext.isIE&&(c+=2),a){var m={to:{y:b},duration:a.duration||125,listeners:{afteranimate:function(){l(),b=f.getXY()[1]+19,d.el.setY(b)}}};d.animate(m)}else d.el.setY(b),l();d.getWidth()!=j&&d.setWidth(j)},resizeEditor:function(){this.currRowH&&this.currRow.setHeight(this.currRowH);{var a,b,c=this,d=c.context,e=d&&Ext.get(d.row),f=c.editingPlugin.grid,g=f.view.el,h=(f.verticalScroller,f.headerCt.getFullWidth()),i=f.getWidth();Math.min(h,i),f.view.el.dom.scrollLeft}e&&Ext.isElement(e.dom)&&(e.scrollIntoView(g,!1),a=e.getXY()[1]+19,c.currRowH=e.getHeight(),c.currRow=e,e.setHeight(c.getHeight()+19),Ext.isIE&&(b+=2)),c.getWidth()!=h&&c.setWidth(h)},getGridStores:function(){for(var a=this,b=a.query("grid"),c=[],d=0;d<b.length;d++)c.push(b[d].store);return c},syncChildStoresChanges:function(){for(var a=this,b=a.getGridStores(),c=0;c<b.length;c++)b[c].sync()},rejectChildStoresChanges:function(){for(var a=this,b=a.getGridStores(),c=0;c<b.length;c++)b[c].rejectChanges()},getEditor:function(a){var b=this;return Ext.isNumber(a)?b.query(">[isFormField]")[a]:a instanceof Ext.grid.column.Column?a.getEditor():!1},setFields:function(){for(var a=this,b=a.getForm(),c=b.getFields().items,d=a.query("container"),e=0;e<c.length;e++)a.mon(c[e],"change",a.onFieldValueChange,a);for(var f=0;f<d.length;f++)a.mon(d[f],"resize",a.resizeEditor,a)},loadRecord:function(a){var b=this,c=b.getForm(),d=b.query('button[action="update"]')[0],e=a.phantom?"Save":"Update";b.editingPlugin.fireEvent("beforerecordload",b,a),c.loadRecord(a),b.editingPlugin.fireEvent("recordload",b,a),d.setText(e),b.saveBtnEnabled&&d.setDisabled(!b.saveBtnEnabled),this.errorSummary&&(c.isValid()?b.hideToolTip():b.showToolTip()),Ext.Array.forEach(b.query(">displayfield"),function(c){b.renderColumnData(c,a)},b)},renderColumnData:function(a,b){var c=this,d=c.editingPlugin.grid,e=(d.headerCt,d.view),f=(e.store,c.getForm());f.loadRecord(b)},beforeEdit:function(){var a=this;return a.getGridStores(),a.isVisible()&&!a.autoCancel&&a.isDirty()?(a.showToolTip(),!1):void 0},startEdit:function(a){var b=this,c=b.editingPlugin.grid,d=(c.getView(),c.store),e=b.context=Ext.apply(b.editingPlugin.context,{view:c.getView(),store:d});e.grid.getSelectionModel().select(a),b.loadRecord(a),b.isVisible()?b.reposition({callback:this.focusContextCell}):(b.show(),b.focusContextCell())},focusContextCell:function(){var a=this.getEditor(this.context.colIdx);a&&a.focus&&a.focus()},cancelEdit:function(){var a=this,b=a.getForm();a.rejectChildStoresChanges(),a.hide(),b.clearInvalid(),b.reset()},completeEdit:function(){var a=this,b=a.getForm();if(b.isValid())return a.context.record.set(a.context.newValues),a.editingPlugin.autoSync&&a.context.record.store.sync({callback:function(){a.fireEvent("sync",a,a.context)}}),a.syncChildStoresChanges(),a.hide(),!0},completeRemove:function(){var a=this,b=a.getForm(),c=a.context.view,d=a.context.store,e=c.getSelectionModel().getLastSelected();
c.panel.fireEvent("beforeremove",a,d,e)&&Ext.Msg.show({title:"WAIT!!!",msg:"Are you sure you want to remove this record?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,scope:a,fn:function(f){"yes"==f&&(e.parentNode?e.parentNode.removeChild(e):d.remove(e),c.panel.fireEvent("remove",a,d,e),a.hide(),b.clearInvalid(),b.reset(),a.editingPlugin.autoSync&&d.sync({callback:function(){a.fireEvent("sync",a,a.context)}}))}})},onShow:function(){var a=this;a.callParent(arguments),a.reposition()},onHide:function(){var a=this;a.callParent(arguments),a.hideToolTip(),a.invalidateScroller(),a.context&&(a.context.view.focus(),a.context=null),a.currRow.setHeight(a.currRowH),a.currRowH=null},isDirty:function(){var a=this,b=a.getForm();return b.isDirty()},getToolTip:function(){return this.tooltip||(this.tooltip=new Ext.tip.ToolTip({cls:Ext.baseCSSPrefix+"grid-row-editor-errors",title:this.errorsText,autoHide:!1,closable:!0,closeAction:"disable",anchor:"left",anchorToTarget:!1}))},hideToolTip:function(){var a=this,b=a.getToolTip();b.rendered&&b.disable(),a.hiddenTip=!1},showToolTip:function(){var a=this,b=a.getToolTip();b.showAt([0,0]),b.update(a.getErrors()),a.repositionTip(),b.enable()},repositionTip:function(){var a=this,b=a.getToolTip(),c=a.context,d=Ext.get(c.row),e=a.scrollingViewEl,f=e.dom.clientHeight,g=a.lastScrollTop,h=g+f,i=d.getHeight(),j=d.getOffsetsTo(a.context.view.body)[1],k=j+i;k>g&&h>j?(b.showAt(b.getAlignToXY(e,"tl-tr",[15,d.getOffsetsTo(e)[1]])),a.hiddenTip=!1):(b.hide(),a.hiddenTip=!0)},getErrors:function(){var a,b=this,c=[],d=b.query("[isFormField]"),e=d.length;for(a=0;e>a;a++)c=c.concat(Ext.Array.map(d[a].getErrors(),b.createErrorListItem));return c.length||b.autoCancel||!b.isDirty()||(c[0]=b.createErrorListItem(b.dirtyText)),'<ul class="'+Ext.plainListCls+'">'+c.join("")+"</ul>"},createErrorListItem:function(a){return'<li class="'+Ext.baseCSSPrefix+'grid-row-editor-errors-item">'+a+"</li>"},invalidateScroller:function(){var a=this,b=a.context,c=b.grid.verticalScroller;c&&c.invalidate()}}),Ext.define("App.ux.combo.AllergiesSeverity",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergiesseveritycombo",initComponent:function(){var a=this;Ext.define("allergiesseverityModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:84}}}),a.store=Ext.create("Ext.data.Store",{model:"allergiesseverityModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.AllergiesAbdominal",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergiesabdominalcombo",initComponent:function(){var a=this;Ext.define("allergiesabdominalModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"}}}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:Ext.create("Ext.data.Store",{model:"allergiesabdominalModel",autoLoad:!1})}),a.callParent(arguments)}}),Ext.define("App.ux.combo.ActiveProviders",{extend:"Ext.form.ComboBox",xtype:"activeproviderscombo",displayField:"option_name",valueField:"option_value",editable:!1,emptyText:_("select"),initComponent:function(){var a=this;Ext.define("ActiveProvidersModel"+this.id,{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.title+" "+b.data.lname+", "+b.data.fname+" "+b.data.mname}},{name:"option_name",type:"string",convert:function(a,b){return b.data.title+" "+b.data.lname+", "+b.data.fname+" "+b.data.mname}},{name:"option_value",type:"int",convert:function(a,b){return b.data.id}}],proxy:{type:"direct",api:{read:"User.getActiveProviders"}}}),a.store=Ext.create("Ext.data.Store",{model:"ActiveProvidersModel"+this.id,autoLoad:!0}),a.callParent(arguments)}}),Ext.define("App.ux.combo.AllergiesMetals",{extend:"Ext.form.ComboBox",xtype:"allergiesmetalcombo",editable:!1,queryMode:"local",displayField:"Term",valueField:"ConceptId",emptyText:_("select"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!0,fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string"}],proxy:{type:"direct",api:{read:"SnomedCodes.getMetalAllergiesCodes"}}}),a.callParent(arguments)}}),Ext.define("App.ux.combo.Allergies",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergiescombo",initComponent:function(){var a=this;Ext.define("AllergiesComboModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"allergy_name"},{name:"allergy_type",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getAllergiesByType}}}),a.store=Ext.create("Ext.data.Store",{model:"AllergiesComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"allergy_name",valueField:"allergy_name",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.AllergiesLocation",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergieslocationcombo",initComponent:function(){var a=this;Ext.define("allergieslocationModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:79}}}),a.store=Ext.create("Ext.data.Store",{model:"allergieslocationModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.CalendarCategories",{extend:"Ext.form.ComboBox",alias:"widget.mitos.calcategoriescombobox",editable:!1,displayField:"catname",valueField:"catid",emptyText:_("select"),initComponent:function(){var a=this;Ext.define("CalendarCategoriesModel",{extend:"Ext.data.Model",fields:[{name:"catid",type:"int"},{name:"catname",type:"string"}],idProperty:"catid",proxy:{type:"direct",api:{read:CombosData.getCalendarCategories}}}),a.store=Ext.create("Ext.data.Store",{model:"CalendarCategoriesModel",autoLoad:!0}),Ext.apply(this,{store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.CodesTypes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.codestypescombo",initComponent:function(){var a=this;Ext.define("CodesTypesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:56}}}),a.store=Ext.create("Ext.data.Store",{model:"CodesTypesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",valueField:"option_value",displayField:"option_name",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Authorizations",{extend:"Ext.form.ComboBox",alias:"widget.mitos.authorizationscombo",initComponent:function(){var a=this;Ext.define("AuthorizationsModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getAuthorizations}}}),a.store=Ext.create("Ext.data.Store",{model:"AuthorizationsModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",valueField:"id",displayField:"name",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.AllergiesTypes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergiestypescombo",initComponent:function(){var a=this;Ext.define("AllergiesTypesComboModel",{extend:"Ext.data.Model",fields:[{name:"allergy_type",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getAllergyTypes"}}}),a.store=Ext.create("Ext.data.Store",{model:"AllergiesTypesComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,displayField:"allergy_type",valueField:"allergy_type",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.BillingFacilities",{extend:"Ext.form.ComboBox",alias:"widget.mitos.billingfacilitiescombo",initComponent:function(){var a=this;Ext.define("BillingFacilitiesComboModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"int"}],proxy:{type:"direct",api:{read:"CombosData.getBillingFacilities"}}}),a.store=Ext.create("Ext.data.Store",{model:"BillingFacilitiesComboModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",valueField:"option_value",displayField:"option_name",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.CalendarStatus",{extend:"Ext.form.ComboBox",alias:"widget.mitos.calstatuscombobox",name:"status",initComponent:function(){var a=this;Ext.define("CalendarStatusModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:30}}}),a.store=Ext.create("Ext.data.Store",{model:"CalendarStatusModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.ComboOptionListSimple",{extend:"Ext.form.ComboBox",alias:"widget.gaiaehr.listcombosimple",displayField:"option_name",valueField:"option_value",emptyText:_("select"),forceSelection:!1,editable:!1,list:null,list_key:null,loadStore:!0,valueDataType:"string",initComponent:function(){var a=this,b=a.id+"ComboOptionModel";Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:a.valueDataType}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:a.list,list_key:a.list_key}},idProperty:"option_value"}),a.store=Ext.create("Ext.data.Store",{model:b,autoLoad:a.loadStore}),a.callParent(arguments)}}),Ext.define("App.ux.combo.EncounterICDS",{extend:"Ext.form.ComboBox",alias:"widget.encountericdscombo",initComponent:function(){var a=this;Ext.define("EncounterICDXComboModel",{extend:"Ext.data.Model",fields:[{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"short_desc",type:"string"},{name:"code_and_code_type",type:"string",convert:function(a,b){return b.data.code_type+":"+b.data.code}}],proxy:{type:"direct",api:{read:"Encounter.getEncounterDxs"}}}),Ext.apply(this,{queryMode:"local",editable:!1,multiSelect:!0,displayField:"code_and_code_type",valueField:"code_and_code_type",emptyText:_("select"),store:Ext.create("Ext.data.Store",{model:"EncounterICDXComboModel",autoLoad:!1}),listConfig:{getInnerTpl:function(){return'<span style="font-weight:bold">{code}</span> - {short_desc}</div>'}}}),a.callParent(arguments)}}),Ext.define("App.ux.combo.CVXManufacturers",{extend:"Ext.form.ComboBox",alias:"widget.cvxmanufacturerscombo",initComponent:function(){var a=this;Ext.define("CVXManufacturersComboModel",{extend:"Ext.data.Model",fields:[{name:"mvx_code",type:"string"},{name:"manufacturer",type:"string"}],proxy:{type:"direct",api:{read:Immunizations.getMvx}}}),a.store=Ext.create("Ext.data.Store",{model:"CVXManufacturersComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,valueField:"mvx_code",displayField:"manufacturer",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.CVXManufacturersForCvx",{extend:"Ext.form.ComboBox",alias:"widget.cvxmanufacturersforcvxcombo",initComponent:function(){var a=this;Ext.define("CVXManufacturersForCvxComboModel",{extend:"Ext.data.Model",fields:[{name:"mvx_code",type:"string"},{name:"manufacturer",type:"string"}],proxy:{type:"direct",api:{read:"Immunizations.getMvxForCvx"}}}),a.store=Ext.create("Ext.data.Store",{model:"CVXManufacturersForCvxComboModel",autoLoad:!1}),Ext.apply(this,{queryMode:"local",valueField:"mvx_code",displayField:"manufacturer",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.ComboOptionList",{extend:"Ext.form.ComboBox",alias:"widget.gaiaehr.listcombo",displayField:"option_value",valueField:"option_value",emptyText:_("select"),forceSelection:!1,editable:!1,listKey:null,list:null,loadStore:!1,valueDataType:"string",initComponent:function(){var a=this,b=a.id+"ComboOptionModel";Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:a.valueDataType},{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"color",type:"string"},{name:"extraListClass",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:a.list,list_key:a.listKey}},idProperty:"option_value"}),a.store=Ext.create("Ext.data.Store",{model:b,autoLoad:a.loadStore}),a.listConfig={itemTpl:new Ext.XTemplate('<tpl>   <div style="white-space: nowrap;">{option_value} (<span style="font-weight: bold;">{option_name}</span>)</div>',"</tpl>")},a.callParent(arguments)}}),Ext.define("App.ux.combo.Combo",{extend:"Ext.form.ComboBox",alias:"widget.gaiaehr.combo",displayField:"option_name",valueField:"option_value",emptyText:_("select"),forceSelection:!1,editable:!0,listKey:null,list:null,loadStore:!1,valueDataType:"string",resetable:!1,addUnknownOption:!1,initComponent:function(){var a=this,b=a.id+"ComboModel";Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:a.valueDataType},{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"color",type:"string"},{name:"extraListClass",type:"string"},{name:"bg_color",type:"string",convert:function(b,c){if("bgcolor"==c.data.code_type){var d=c?c.data.code:"#FFFFFF";return c.set({color:a.getContrastYIQ(d),extraListClass:"listwith"}),d}}}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:a.list,list_key:a.listKey}},idProperty:"option_value"}),a.store=Ext.create("Ext.data.Store",{model:b,autoLoad:a.loadStore}),a.store.on("load",function(b,c){a.addUnknownOption&&b.insert(0,{bg_color:void 0,code:"UNK",code_type:"UNK",color:"",extraListClass:"",option_name:"UNKNOWN",option_value:"UNK"}),a.fireEvent("load",a,b,c)}),a.listConfig={itemTpl:new Ext.XTemplate('<tpl if="this.hasColorBg(code_type)">   <div class="combo-list-icon" style="background-color:{bg_color}">&#160;</div>{option_name}',"<tpl else>   {option_name}","</tpl>",{hasColorBg:function(a){return"bgcolor"==a}})},a.resetable&&(a.trigger1Class="x-form-select-trigger",a.trigger2Class="x-form-clear-trigger"),a.callParent(arguments),a.on("change",function(b,c){a.setFieldBgColor(b,c)})},onRender:function(){if(this.callParent(arguments),this.resetable){var a=this.getId();this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+a,name:"trigger2"+a,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(b){b.target.name=="trigger2"+a&&(this.reset(),this.fireEvent("fieldreset",this))},this);var b=Ext.get("trigger2"+a);b.addClsOnOver("x-form-trigger-over")}},setFieldBgColor:function(a,b){var c=this;null!=b&&Ext.Function.defer(function(){var d=a.getStore();if(d){var e=a.findRecordByValue(b);if(d.isLoading()){if(a.tries=a.tries?a.tries+1:1,a.tries>2)return;Ext.Function.defer(function(){c.setFieldBgColor(a,b)},1e3)}else if(e!==!1&&"bgcolor"==e.data.code_type)a.inputEl.setStyle({"background-color":e.data.bg_color,"background-image":"none",color:e.data.color});else{if(a.tries=a.tries?a.tries+1:1,a.tries>2)return;Ext.Function.defer(function(){c.setFieldBgColor(a,b)},1e3)}}},100)},getContrastYIQ:function(a){"#"!=a[0]&&(a=this.getHexColor(a)),a=a.replace("#","");var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=129?"black":"white"},getHexColor:function(a){a=a.toLowerCase();var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},c=b[a];return void 0===c?"Invalid Color Name":c}}),Ext.define("App.ux.combo.FloorPlanAreas",{extend:"Ext.form.ComboBox",alias:"widget.floorplanareascombo",initComponent:function(){var a=this;Ext.define("FloorPlanAreasModel",{extend:"Ext.data.Model",fields:[{name:"title",type:"string"},{name:"id",type:"int"}],proxy:{type:"direct",api:{read:"CombosData.getFloorPlanAreas"}}}),a.store=Ext.create("Ext.data.Store",{model:"FloorPlanAreasModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"title",valueField:"id",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Facilities",{extend:"Ext.form.ComboBox",alias:"widget.mitos.facilitiescombo",editable:!1,queryMode:"local",valueField:"id",displayField:"name",emptyText:_("select"),initComponent:function(){var a=this;Ext.define("FacilitiesComboModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"name",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getFacilities"}}}),a.store=Ext.create("Ext.data.Store",{model:"FacilitiesComboModel",autoLoad:!0}),a.callParent(arguments)}}),Ext.define("App.ux.combo.FollowUp",{extend:"Ext.form.ComboBox",alias:"widget.mitos.followupcombo",initComponent:function(){var a=this;Ext.define("FollowUpModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:90}}}),a.store=Ext.create("Ext.data.Store",{model:"FollowUpModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.EncounterPriority",{extend:"App.ux.combo.Combo",xtype:"encounterprioritycombo",editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("priority"),list:94,loadStore:!0}),Ext.define("App.ux.combo.Ethnicity",{extend:"Ext.form.ComboBox",alias:"widget.ethnicitycombo",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{indent_index} <b>{code_description}</b> [{code}]</div>',"</tpl>"),typeAhead:!0,typeAheadDelay:50,queryMode:"local",displayField:"code_description",valueField:"code",emptyText:_("ethnicity"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"code_description",type:"string"},{name:"indent_index",type:"int",convert:function(a){for(var b="";a>0;)b+="----",a--;return b.trim()}}],autoLoad:!0,proxy:{type:"ajax",url:"resources/code_sets/HL7v3-Ethnicity.json",reader:{type:"json"}},listeners:{load:function(){this.insert(0,[{code:"ASKU",code_type:"CDA",code_description:"Declined to specify"}])}}}),a.callParent(arguments)}}),Ext.define("App.ux.combo.Languages",{extend:"Ext.form.ComboBox",alias:"widget.languagescombo",editable:!1,valueField:"code",displayField:"description",emptyText:_("select"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[{name:"code",type:"string"},{name:"description",type:"string"}],proxy:{type:"direct",api:{read:"i18nRouter.getAvailableLanguages"}}}),a.callParent()}}),Ext.define("App.ux.combo.LabsTypes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.labstypescombo",initComponent:function(){var a=this;Ext.define("LabsTypesComboModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"code_text_short"},{name:"parent_name",type:"string"},{name:"loinc_name",type:"string"}],proxy:{type:"direct",api:{read:Laboratories.getActiveLaboratoryTypes}}}),a.store=Ext.create("Ext.data.Store",{model:"LabsTypesComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,displayField:"loinc_name",valueField:"loinc_name",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.MedicalIssues",{extend:"Ext.form.ComboBox",alias:"widget.mitos.medicalissuescombo",initComponent:function(){var a=this;Ext.define("MedicalIssuesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:75}}}),a.store=Ext.create("Ext.data.Store",{model:"MedicalIssuesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Medications",{extend:"Ext.form.ComboBox",alias:"widget.mitos.medicationscombo",initComponent:function(){var a=this;Ext.define("MedicationsModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:74}}}),a.store=Ext.create("Ext.data.Store",{model:"MedicationsModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.InsurancePayerType",{extend:"Ext.form.ComboBox",alias:"widget.mitos.insurancepayertypecombo",initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:["id","name"],data:[{id:"1",name:_("all")},{id:"16",name:_("other_hcfa")},{id:"MB",name:_("medicare_part_b")},{id:"MC",name:_("medicaid")},{id:"CH",name:_("champusva")},{id:"CH",name:_("champus")},{id:"BL",name:_("blue_cross_blue_shield")},{id:"16",name:_("feca")},{id:"09",name:_("self_pay")},{id:"10",name:_("central_certification")},{id:"11",name:_("other_nonfederal_programs")},{id:"12",name:_("ppo")},{id:"13",name:_("pos")},{id:"14",name:_("epo")},{id:"15",name:_("indemnity_insurance")},{id:"16",name:_("hmo")},{id:"AM",name:_("automobile_medical")},{id:"CI",name:_("commercial_insurance")},{id:"DS",name:_("disability")},{id:"HM",name:_("health_maintenance_organization")},{id:"LI",name:_("liability")},{id:"LM",name:_("liability_medical")},{id:"OF",name:_("other_federal_program")},{id:"TV",name:_("title_v")},{id:"VA",name:_("veterans_administration_plan")},{id:"WC",name:_("workers_compensation_health_plan")},{id:"ZZ",name:_("mutually_defined")}]}),Ext.apply(this,{name:"freeb_type",editable:!1,displayField:"name",valueField:"id",queryMode:"local",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.LabObservations",{extend:"Ext.form.ComboBox",alias:"widget.labobservationscombo",initComponent:function(){var a=this;Ext.define("labObservationsComboModel",{extend:"Ext.data.Model",fields:[{name:"label"},{name:"name"},{name:"unit"},{name:"range_start"},{name:"range_end"},{name:"threshold"},{name:"notes"}],proxy:{type:"direct",api:{read:"Services.getAllLabObservations"}}}),a.store=Ext.create("Ext.data.Store",{model:"labObservationsComboModel",autoLoad:!1}),Ext.apply(this,{store:a.store,displayField:"label",valueField:"id",emptyText:_("select_existing_observation"),editable:!1,width:810,listConfig:{getInnerTpl:function(){return'<div><span style="width:200px;display:inline-block;"><span style="font-weight:bold;">'+_("Label")+':</span> {label},</span><span style="width:90px;display:inline-block;"><span style="font-weight:bold;">'+_("unit")+':</span> {unit},</span><span style="width:150px;display:inline-block;"><span style="font-weight:bold;">'+_("range_start")+':</span> {range_start},</span><span style="width:130px;display:inline-block;"><span style="font-weight:bold;">'+_("range_end")+':</span> {range_end},</span><span style="width:100px;display:inline-block;"><span style="font-weight:bold;">'+_("threshold")+":</span> {threshold}</span></div>"}}},null),a.callParent()}}),Ext.define("App.ux.combo.Lists",{extend:"Ext.form.ComboBox",alias:"widget.mitos.listscombo",width:250,iconCls:"icoListOptions",initComponent:function(){var a=this;Ext.define("ListComboModel",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"title",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getLists}}}),a.store=Ext.create("Ext.data.Store",{model:"ListComboModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",valueField:"id",displayField:"title",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.MsgStatus",{extend:"Ext.form.ComboBox",alias:"widget.msgstatuscombo",initComponent:function(){var a=this;Ext.define("MsgStatusModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:45}}}),a.store=Ext.create("Ext.data.Store",{model:"MsgStatusModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.MsgNoteType",{extend:"Ext.form.ComboBox",alias:"widget.msgnotetypecombo",initComponent:function(){var a=this;Ext.define("MsgNoteTypeModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:28}}}),a.store=Ext.create("Ext.data.Store",{model:"MsgNoteTypeModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.Outcome",{extend:"Ext.form.ComboBox",alias:"widget.mitos.outcomecombo",initComponent:function(){var a=this;Ext.define("OutcomeModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:27}}}),a.store=Ext.create("Ext.data.Store",{model:"OutcomeModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Occurrence",{extend:"Ext.form.ComboBox",alias:"widget.mitos.occurrencecombo",initComponent:function(){var a=this;Ext.define("OccurrenceModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:26}}}),a.store=Ext.create("Ext.data.Store",{model:"OccurrenceModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.Outcome2",{extend:"Ext.form.ComboBox",alias:"widget.mitos.outcome2combo",initComponent:function(){var a=this;Ext.define("Outcome2model",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:74}}}),a.store=Ext.create("Ext.data.Store",{model:"Outcome2model",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.PayingEntity",{extend:"Ext.form.ComboBox",alias:"widget.mitos.payingentitycombo",initComponent:function(){var a=this;Ext.define("PayingEntityModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:54}}}),a.store=Ext.create("Ext.data.Store",{model:"PayingEntityModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.PaymentCategory",{extend:"Ext.form.ComboBox",alias:"widget.mitos.paymentcategorycombo",initComponent:function(){var a=this;Ext.define("PaymentCategoryModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:49}}}),a.store=Ext.create("Ext.data.Store",{model:"PaymentCategoryModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.PaymentMethod",{extend:"Ext.form.ComboBox",alias:"widget.mitos.paymentmethodcombo",initComponent:function(){var a=this;Ext.define("PaymentMethodModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:51}}}),a.store=Ext.create("Ext.data.Store",{model:"PaymentMethodModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)
}}),Ext.define("App.ux.combo.PrescriptionHowTo",{extend:"Ext.form.ComboBox",alias:"widget.mitos.prescriptionhowto",initComponent:function(){var a=this;Ext.define("PrescriptionHowTomodel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:88}}}),a.store=Ext.create("Ext.data.Store",{model:"PrescriptionHowTomodel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.posCodes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.poscodescombo",initComponent:function(){var a=this;Ext.define("PosCodesModel",{extend:"Ext.data.Model",fields:[{name:"code",type:"string"},{name:"title",type:"string",convert:function(a,b){return b.data.code+" - "+a}}],proxy:{type:"direct",api:{read:"CombosData.getPosCodes"}}}),a.store=Ext.create("Ext.data.Store",{model:"PosCodesModel",autoLoad:!0}),Ext.apply(a,{editable:!1,queryMode:"local",valueField:"code",displayField:"title",emptyText:_("select"),store:a.store}),a.callParent()}}),Ext.define("App.ux.combo.Pharmacies",{extend:"Ext.form.ComboBox",alias:"widget.mitos.pharmaciescombo",initComponent:function(){var a=this;Ext.define("PharmaciesComboModel",{extend:"Ext.data.Model",fields:[{name:"option_name"},{name:"option_value"}],proxy:{type:"direct",api:{read:"CombosData.getActivePharmacies"}}}),a.store=Ext.create("Ext.data.Store",{model:"PharmaciesComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.PrescriptionOften",{extend:"Ext.form.ComboBox",alias:"widget.mitos.prescriptionoften",initComponent:function(){var a=this;Ext.define("PrescriptionOftenmodel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:86}}}),a.store=Ext.create("Ext.data.Store",{model:"PrescriptionOftenmodel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Providers",{extend:"Ext.form.ComboBox",alias:"widget.mitos.providerscombo",editable:!1,queryMode:"local",displayField:"name",valueField:"id",emptyText:_("select"),initComponent:function(){var a=this;Ext.define("ProvidersComboBoxModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"email",type:"string"},{name:"mobile",type:"string"},{name:"name",type:"string",convert:function(a,b){return Ext.String.format("{0}, {1} {2}",b.get("lname"),b.get("fname"),b.get("mname"))}}],proxy:{type:"direct",api:{read:"User.getProviders"}}}),a.store=Ext.create("Ext.data.Store",{model:"ProvidersComboBoxModel",autoLoad:!0}),a.callParent(arguments)}}),Ext.define("App.ux.combo.ProceduresBodySites",{extend:"Ext.form.ComboBox",alias:"widget.mitos.proceduresbodysitescombo",initComponent:function(){var a=this;Ext.define("ProceduresBodySitesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:34}}}),a.store=Ext.create("Ext.data.Store",{model:"ProceduresBodySitesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.PreventiveCareTypes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.preventivecaretypescombo",initComponent:function(){var a=this;Ext.define("PreventiveCareTypesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:78}}}),a.store=Ext.create("Ext.data.Store",{model:"PreventiveCareTypesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",valueField:"option_value",displayField:"option_name",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.PrescriptionTypes",{extend:"Ext.form.ComboBox",alias:"widget.mitos.prescriptiontypes",initComponent:function(){var a=this;Ext.define("PrescriptionTypesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:89}}}),a.store=Ext.create("Ext.data.Store",{model:"PrescriptionTypesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.combo.PrescriptionWhen",{extend:"Ext.form.ComboBox",alias:"widget.mitos.prescriptionwhen",initComponent:function(){var a=this;Ext.define("PrescriptionWhenmodel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:87}}}),a.store=Ext.create("Ext.data.Store",{model:"PrescriptionWhenmodel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.model.administration.PrinterCombo",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"printer_description",type:"string"},{name:"local",type:"bool"},{name:"facility_id",type:"int"},{name:"active",type:"bool"},{name:"display_value",convert:function(a,b){return b.get("local")?b.get("name")+" (local)":b.get("printer_description")+" (remote)"}}]}),Ext.define("App.store.administration.PrinterCombo",{extend:"Ext.data.Store",requires:["App.model.administration.PrinterCombo"],model:"App.model.administration.PrinterCombo"}),Ext.define("App.ux.form.fields.CheckBoxWithFamilyRelation",{extend:"App.ux.form.fields.CheckBoxWithText",xtype:"checkboxwithfamilyhistory",initComponent:function(){var a=this;a.textField1={xtype:"fieldcontainer",layout:{type:"vbox",align:"stretch"},getSubmitValue:function(){var a=[];return this.items.each(function(b){var c=b.getComponent(0),d=c.store,e=d.getById(c.getSubmitValue()),f=b.getComponent(1).getValue();e&&a.push(Ext.String.format("{0}:{1}:{2}:{3}",e.get("code_type"),e.get("code"),e.get("option_name"),f))}),a.join(",")},getValue:function(){return this.getSubmitValue()},setValue:function(){},isValid:function(){}},a.inputValue=a.code||"1",a.callParent(),a.addRelationField()},addRelationField:function(){var a=this;a.textField1.add({xtype:"fieldcontainer",action:"fieldscontainer",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gaiaehr.combo",fieldLabel:_("relation"),labelAlign:"right",action:"relationcmb",labelWidth:100,list:109,allowBlank:!1,loadStore:!0,editable:!1,resetable:!0,value:"",isEmpty:!0,submitValue:!1,listeners:{select:a.onRelationComoSelect,fieldreset:a.onRelationComoReset,scope:a}},{xtype:"textfield",fieldLabel:_("note"),labelAlign:"right",labelWidth:80,flex:1}]})},onRelationComoReset:function(a){say("onRelationComoReset"),1!==this.textField1.items.length&&this.textField1.remove(a.up("fieldcontainer"))},onRelationComoSelect:function(a,b){b.length>0&&(a.isEmpty=!1);var c=(a.up("fieldcontainer"),this.textField1.query("[action=relationcmb][isEmpty]"));b.length>0&&0===c.length&&this.addRelationField()},getValue:function(){var a,b="",c=this.chekboxField.getSubmitValue();return"0"!=c?(c+=":"+this.chekboxField.boxLabel,a=this.textField1.getSubmitValue()):a="0",c&&(b=c+"~"+a,this.textField2&&(b+="~"+this.textField2.getSubmitValue()||"")),say("getValue"),say(b),b},setValue:function(){}}),Ext.define("App.ux.grid.RowFormEditing",{extend:"Ext.grid.plugin.Editing",alias:"plugin.rowformediting",requires:["App.ux.grid.RowFormEditor"],lockableScope:"top",editStyle:"row",enableRemove:!1,enableAddBtn:!1,addBtnText:"Add",addBtnIconCls:null,toolbarDock:"top",fieldDefaults:{},saveBtnEnabled:!1,autoSync:!0,autoCancel:!0,errorSummary:!1,constructor:function(){var a=this;a.callParent(arguments),a.clicksToMoveEditor||(a.clicksToMoveEditor=a.clicksToEdit),a.autoCancel=!!a.autoCancel},init:function(a){var b,c=this;c.callParent(arguments),c.enableAddBtn&&(b=a.getDockedItems('toolbar[dock="'+c.toolbarDock+'"]')[0]||a.addDocked({xtype:"toolbar",dock:c.toolbarDock})[0],b.add({xtype:"button",text:c.addBtnText,iconCls:c.addBtnIconCls,handler:c.doAddRecord,scope:c})),c.grid.on("beforeselect",c.editHandler,c),c.grid.on("beforecellclick",c.editHandler,c),c.grid.on("beforecelldblclick",c.editHandler,c),c.grid.on("beforecellmousedown",c.editHandler,c)},editHandler:function(){return!this.editing},doAddRecord:function(){var a=this,b=a.grid,c=b.store;a.cancelEdit(),c.insert(0,{}),a.startEdit(0,0)},destroy:function(){var a=this;Ext.destroy(a.editor),a.callParent(arguments)},startEdit:function(){var a,b=this,c=b.getEditor();return c.beforeEdit()!==!1&&(a=b.callParent(arguments))?(b.context=a,b.lockingPartner&&b.lockingPartner.cancelEdit(),c.startEdit(a.record,a.column,a),!0):!1},cancelEdit:function(){var a=this;return a.editing?(a.getEditor().cancelEdit(),a.callParent(arguments),a.autoCancel&&a.view.store.rejectChanges(),void a.fireEvent("canceledit",a.context)):!0},completeEdit:function(){var a=this;a.editing&&a.validateEdit()&&(a.editing=!1,a.fireEvent("edit",a,a.context))},completeRemove:function(){var a=this;a.editing&&(a.getEditor().completeRemove(),a.fireEvent("completeremove",a,a.context))},validateEdit:function(){var a=this,b=a.editor,c=a.context,d=c.record,e={},f=b.getForm().getValues();return Ext.Object.each(f,function(a){e[a]=d.get(a)}),Ext.apply(c,{newValues:f,originalValues:e}),a.fireEvent("validateedit",a,c)!==!1&&!c.cancel&&a.getEditor().completeEdit()},getEditor:function(){var a=this;return a.editor||(a.editor=a.initEditor()),a.editor},initEditor:function(){return new App.ux.grid.RowFormEditor(this.initEditorConfig())},initEditorConfig:function(){var a,b,c=this,d=c.grid,e=c.view,f=d.headerCt,g=["saveBtnText","cancelBtnText","errorsText","dirtyText"],h=g.length,i={autoCancel:c.autoCancel,errorSummary:c.errorSummary,saveBtnEnabled:c.disableValidation,fields:f.getGridColumns(),hidden:!0,view:e,editingPlugin:c,renderTo:e.el};for(a=0;h>a;a++)b=g[a],Ext.isDefined(c[b])&&(i[b]=c[b]);return i},initEditTriggers:function(){var a=this,b=1===a.clicksToMoveEditor?"click":"dblclick";a.callParent(arguments),a.clicksToMoveEditor!==a.clicksToEdit&&a.mon(a.view,"cell"+b,a.moveEditorByClick,a)},startEditByClick:function(){var a=this;a.editing&&a.clicksToMoveEditor!==a.clicksToEdit||a.callParent(arguments)},moveEditorByClick:function(){var a=this;a.editing&&a.superclass.onCellClick.apply(a,arguments)},onCellClick:function(){var a=this;a.autoCancel&&(a.view.store.rejectChanges(),a.editor&&a.editor.rejectChildStoresChanges()),a.callParent(arguments)},setColumnField:function(a){var b=this;editor.removeField(a),b.callParent(arguments),b.getEditor().setField(a.field,a)}}),Ext.define("App.ux.combo.Sex",{extend:"Ext.form.ComboBox",alias:"widget.gaiaehr.sexcombo",initComponent:function(){var a=this;Ext.define("Sexmodel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:19}}}),a.store=Ext.create("Ext.data.Store",{model:"Sexmodel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("sex"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Race",{extend:"Ext.form.ComboBox",alias:"widget.racecombo",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{indent_index} <b>{code_description}</b> [{code}]</div>',"</tpl>"),typeAhead:!0,typeAheadDelay:50,queryMode:"local",displayField:"code_description",valueField:"code",emptyText:_("race"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"code_description",type:"string"},{name:"indent_index",type:"int",convert:function(a){for(var b="";a>0;)b+="----",a--;return b.trim()}}],autoLoad:!0,proxy:{type:"ajax",url:"resources/code_sets/HL7v3-Race.json",reader:{type:"json"}},listeners:{load:function(){this.insert(0,[{code:"ASKU",code_type:"CDA",code_description:"Declined to specify"}])}}}),a.callParent(arguments)}}),Ext.define("App.ux.combo.SmokingStatus",{extend:"App.ux.combo.Combo",alias:"widget.mitos.smokingstatuscombo",list:58,loadStore:!0}),Ext.define("App.ux.combo.Surgery",{extend:"Ext.form.ComboBox",alias:"widget.mitos.surgerycombo",initComponent:function(){var a=this;Ext.define("SurgeryModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:76}}}),a.store=Ext.create("Ext.data.Store",{model:"SurgeryModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Roles",{extend:"Ext.form.ComboBox",alias:"widget.mitos.rolescombo",editable:!1,queryMode:"local",valueField:"id",displayField:"role_name",emptyText:_("select"),includeAllOption:!1,initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!0,fields:[{name:"id",type:"int"},{name:"role_name",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getRoles"},extraParams:{includeAllOption:a.includeAllOption}}}),a.callParent(arguments)}}),Ext.define("App.ux.combo.TaxId",{extend:"Ext.form.ComboBox",alias:"widget.mitos.taxidcombo",initComponent:function(){var a=this;Ext.define("TaxIdsModel",{extend:"Ext.data.Model",fields:[{name:"option_id",type:"string"},{name:"title",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getTaxIds}}}),a.store=Ext.create("Ext.data.Store",{model:"TaxIdsModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"title",valueField:"option_id",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.Templates",{extend:"Ext.form.ComboBox",alias:"widget.documentstemplatescombo",initComponent:function(){var a=this;Ext.define("DocumentsTemplatesComboModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"body",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getTemplatesTypes"}}}),Ext.apply(this,{editable:!1,displayField:"title",valueField:"id",queryMode:"local",emptyText:_("select"),store:Ext.create("Ext.data.Store",{model:"DocumentsTemplatesComboModel",autoLoad:!1})}),a.callParent(arguments),a.listeners={scope:a,beforerender:function(){a.getStore().load()}}}}),Ext.define("App.ux.combo.TransmitMethod",{extend:"Ext.form.ComboBox",alias:"widget.transmitmethodcombo",initComponent:function(){var a=this;a.storeTrsmit=Ext.create("Ext.data.Store",{fields:["id","name"],data:[{id:"1",name:"Print"},{id:"2",name:"Email"},{id:"3",name:"Email"}]}),Ext.apply(this,{name:"transmit_method",editable:!1,displayField:"name",valueField:"id",queryMode:"local",emptyText:_("select"),store:a.storeTrsmit},null),a.callParent()}}),Ext.define("App.ux.combo.Titles",{extend:"Ext.form.ComboBox",alias:"widget.mitos.titlescombo",initComponent:function(){var a=this;Ext.define("TitlesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:22}}}),a.store=Ext.create("Ext.data.Store",{model:"TitlesModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Themes",{extend:"Ext.form.ComboBox",alias:"widget.themescombo",initComponent:function(){var a=this;Ext.define("ThemesComboModel",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getThemes"}}}),a.store=Ext.create("Ext.data.Store",{model:"ThemesComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,valueField:"value",displayField:"name",emptyText:_("select"),store:a.store},null),a.callParent()}}),Ext.define("App.ux.combo.Time",{extend:"Ext.form.ComboBox",alias:"widget.mitos.timecombo",initComponent:function(){var a=this;Ext.define("Timemodel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:77}}}),a.store=Ext.create("Ext.data.Store",{model:"Timemodel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Types",{extend:"Ext.form.ComboBox",alias:"widget.mitos.typescombobox",initComponent:function(){var a=this;Ext.define("TypesModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:32}}}),a.store=Ext.create("Ext.data.Store",{model:"TypesModel",autoLoad:!0}),Ext.apply(this,{name:"abook_type",editable:!1,displayField:"option_name",valueField:"option_value",queryMode:"local",store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.ComboEvents",{extend:"Ext.form.ComboBox",alias:"widget.eventlist",displayField:"event",valueField:"event",forceSelection:!1,editable:!1,list:null,loadStore:!1,valueDataType:"string",initComponent:function(){var a=this,b=a.id+"ComboEventListModel";Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"event",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getEventList"}},idProperty:"event"}),a.store=Ext.create("Ext.data.Store",{model:b,autoLoad:a.loadStore}),a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),a.callParent(arguments)}}),Ext.define("App.ux.combo.Units",{extend:"Ext.form.ComboBox",alias:"widget.mitos.unitscombo",initComponent:function(){var a=this;Ext.define("UnitsModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:38}}}),a.store=Ext.create("Ext.data.Store",{model:"UnitsModel",autoLoad:!0}),Ext.apply(this,{queryMode:"local",valueField:"option_value",displayField:"option_name",store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.ComboTable",{extend:"Ext.form.ComboBox",alias:"widget.tablelist",displayField:"table_name",valueField:"table_name",forceSelection:!1,editable:!1,list:null,loadStore:!1,valueDataType:"string",initComponent:function(){var a=this,b=a.id+"ComboTableListModel";Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"table_name",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getTableList"}},idProperty:"table_name"}),a.store=Ext.create("Ext.data.Store",{model:b,autoLoad:a.loadStore}),a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),a.callParent(arguments)}}),Ext.define("App.ux.combo.YesNoNa",{extend:"Ext.form.ComboBox",alias:"widget.mitos.yesnonacombo",initComponent:function(){var a=this;Ext.define("yesnonaModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:93}}}),a.store=Ext.create("Ext.data.Store",{model:"yesnonaModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.ux.combo.Users",{extend:"Ext.form.ComboBox",alias:"widget.userscombo",acl:null,includeAllOption:!1,editable:!1,queryMode:"local",valueField:"id",displayField:"name",emptyText:_("select"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!0,fields:[{name:"id",type:"int"},{name:"name",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getUsers"},extraParams:{acl:a.acl,includeAllOption:a.includeAllOption}}}),a.callParent()}}),Ext.define("App.ux.window.Window",{extend:"Ext.window.Window",autoHeight:!0,modal:!0,border:!0,autoScroll:!0,resizable:!1,closeAction:"hide",initComponent:function(){this.callParent(arguments)},updateTitle:function(a,b){this.setTitle(a+(b?"[ Read Only ]":""))},setReadOnly:function(){var a,b,c,d,e=this.query("form"),f=app.patient.readOnly;for(a=0;a<e.length;a++)if(b=e[a],b.readOnly!=f)for(b.readOnly=f,d=b.getForm().getFields().items,c=0;c<d.length;c++)d[c].setReadOnly(f);return f},setButtonsDisabled:function(a){var b,c,d=app.patient.readOnly;for(b=0;b<a.length;b++)c=a[b],c.disabled!=d&&(c.disabled=d,c.setDisabled(d))},checkIfCurrPatient:function(){return app.getCurrPatient()},patientInfoAlert:function(){var a=app.getCurrPatient();Ext.Msg.alert(_("status"),_("patient")+": "+a.name+" ("+a.pid+")")},currPatientError:function(){Ext.Msg.show({title:_("oops")+" "+_("no_patient_selected"),msg:_("select_patient_patient_live_search"),scope:this,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(){this.goBack()}})},getFormItems:function(formPanel,formToRender,callback){var items;formPanel.removeAll(),FormLayoutEngine.getFields({formToRender:formToRender},function(provider,response){items=eval(response.result),formPanel.add(items),formPanel.fireEvent("formitemsadded",formPanel),"function"==typeof callback&&callback(formPanel,items,!0)})},boolRenderer:function(a){return"1"==a||1==a||"true"==a?'<img style="padding-left: 13px" src="resources/images/icons/yes.png" />':"0"==a||0==a||"false"==a?'<img style="padding-left: 13px" src="resources/images/icons/no.png" />':a},alertRenderer:function(a){return"1"==a||1==a||"true"==a?'<img style="padding-left: 13px" src="resources/images/icons/no.png" />':"0"==a||0==a||"false"==a?'<img style="padding-left: 13px" src="resources/images/icons/yes.png" />':a},warnRenderer:function(a,b,c){var d=c.data.warningMsg?' data-qtip="'+c.data.warningMsg+'" ':"";return"1"==a||1==a||"true"==a?'<img src="resources/images/icons/icoImportant.png" '+d+" />":void 0},onExpandRemoveMask:function(a){a.picker.loadMask.destroy()},strToLowerUnderscores:function(a){return a.toLowerCase().replace(/ /gi,"_")},getCurrPatient:function(){return app.getCurrPatient()},getApp:function(){return app.getApp()},msg:function(a,b){app.msg(a,b)},passwordVerificationWin:function(a){var b,c;return b=Ext.Msg.prompt(_("password_verification"),_("please_enter_your_password")+":",function(b,c){a(b,c)}),c=b.textField.getInputId(),document.getElementById(c).type="password",b}}),Ext.define("App.ux.combo.YesNo",{extend:"Ext.form.ComboBox",alias:"widget.mitos.yesnocombo",initComponent:function(){var a=this;Ext.define("yesnoModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:CombosData.getOptionsByListId},extraParams:{list_id:23}}}),a.store=Ext.create("Ext.data.Store",{model:"yesnoModel",autoLoad:!0}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store},null),a.callParent(arguments)}}),Ext.define("App.view.search.PatientSearch",{extend:"App.ux.RenderPanel",id:"panelPatientSearch",pageTitle:_("advance_patient_search"),pageLayout:"border",uses:["Ext.grid.Panel"],initComponent:function(){var a=this;a.form=Ext.create("Ext.form.FormPanel",{region:"north",height:200,bodyPadding:10,margin:"0 0 3 0",buttonAlign:"left",items:[{xtype:"fieldcontainer",fieldLabel:_("name"),layout:"hbox",defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",emptyText:_("first_name"),name:"fname"},{xtype:"textfield",emptyText:_("middle_name"),name:"mname"},{xtype:"textfield",emptyText:_("last_name"),name:"lname"}]}],buttons:[{text:_("search"),iconCls:"save",handler:function(){}},"-",{text:_("reset"),iconCls:"save",tooltip:_("hide_selected_office_note"),handler:function(){}}]}),a.grid=Ext.create("Ext.grid.Panel",{region:"center",columns:[{header:"id",sortable:!1,dataIndex:"id",hidden:!0},{width:150,header:_("date"),sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s")},{width:150,header:_("user"),sortable:!0,dataIndex:"user"},{flex:1,header:_("note"),sortable:!0,dataIndex:"body"}],tbar:Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager",{})})}),a.pageBody=[a.form,a.grid],a.callParent(arguments)},onActive:function(a){a(!0)}}),Ext.define("App.ux.button.Print",{extend:"Ext.button.Split",xtype:"printbutton",text:"Print",numberOfCopies:1,menu:[{text:"Print 2 Copies",numberOfCopies:2,handler:function(a){a.up("button").fireEvent("click",a)}},{text:"Print 3 Copies",numberOfCopies:3,handler:function(a){a.up("button").fireEvent("click",a)}}]}),Ext.define("App.model.administration.MedicationInstruction",{extend:"Ext.data.Model",table:{name:"rxinstructions"},fields:[{name:"id",type:"int"},{name:"rxcui",type:"string",index:!0},{name:"occurrence",type:"int",index:!0},{name:"instruction",type:"string",len:140}],proxy:{type:"direct",api:{read:"Rxnorm.getMedicationInstructions",create:"Rxnorm.addMedicationInstruction",update:"Rxnorm.updateMedicationInstructions",destroy:"Rxnorm.destroyMedicationInstructions"},remoteGroup:!1}}),Ext.define("App.ux.combo.ComboResettable",{extend:"Ext.form.ComboBox",xtype:"comboresettable",triggerTip:_("click_to_clear_selection"),spObj:"",spForm:"",spExtraParam:"",qtip:_("clearable_combo_box"),trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-clear-trigger",onRender:function(){this.callParent(arguments);var a=this.getId();this.triggerConfig={tag:"div",cls:"x-form-twin-triggers",style:"display:block;",cn:[{tag:"img",style:Ext.isIE?"margin-left:0;height:21px":"",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+a,name:"trigger2"+a,cls:"x-form-trigger "+this.trigger2Class}]},this.triggerEl.replaceWith(this.triggerConfig),this.triggerEl.on("mouseup",function(b){b.target.name=="trigger2"+a&&(this.reset(),this.oldValue=null,""!==this.spObj&&""!==this.spExtraParam&&(Ext.getCmp(this.spObj).store.setExtraParam(this.spExtraParam,""),Ext.getCmp(this.spObj).store.load()),""!==this.spForm&&Ext.getCmp(this.spForm).getForm().reset(),this.fireEvent("fieldreset",this))},this);var b=Ext.get("trigger2"+a);b.addClsOnOver("x-form-trigger-over")}}),Ext.define("App.ux.grid.LiveSearchGridPanel",{extend:"Ext.grid.Panel",xtype:"gridlivesearch",requires:["Ext.toolbar.TextItem","Ext.form.field.Checkbox","Ext.form.field.Text","Ext.ux.statusbar.StatusBar"],searchValue:null,indexes:[],currentIndex:null,searchRegExp:null,caseSensitive:!1,regExpMode:!1,matchCls:"x-livesearch-match",defaultStatusText:"Nothing Found",searchBuffer:100,filterStore:!1,initComponent:function(){var a=this;a.onTextFieldChangeBuffer=Ext.Function.createBuffered(a.onTextFieldChange,a.searchBuffer,a),a.callParent(arguments),a.addDocked({xtype:"toolbar",dock:"top",items:[_("search"),{xtype:"textfield",name:"searchField",hideLabel:!0,width:200,listeners:{change:{fn:a.onTextFieldChangeBuffer,scope:this,buffer:100}}},"-",{xtype:"button",text:"&lt;",tooltip:"Find Previous Row",handler:a.onPreviousClick,scope:a},{xtype:"button",text:"&gt;",tooltip:"Find Next Row",handler:a.onNextClick,scope:a},"-","->","-",{xtype:"tbtext",text:a.defaultStatusText,action:"searchStatus",scope:a}]})},afterRender:function(){var a=this;a.callParent(arguments),a.textField=a.down("textfield[name=searchField]"),a.statusBar=a.down("tbtext[action=searchStatus]")},tagsRe:/<[^>]*>/gm,tagsProtect:"",regExpProtect:/\\|\/|\+|\\|\.|\[|\]|\{|\}|\?|\$|\*|\^|\|/gm,getSearchValue:function(){var a=this,b=a.textField.getValue();if(""===b)return null;if(a.regExpMode){try{new RegExp(b)}catch(c){return a.statusBar.setText(c.message),null}if("^"===b||"$"===b)return null}else b=b.replace(a.regExpProtect,function(a){return"\\"+a});return b},onTextFieldChange:function(){var a=this,b=0;a.view.refresh(),a.statusBar.setText(a.defaultStatusText),a.searchValue=a.getSearchValue(),a.indexes=[],a.currentIndex=null,a.filterStore&&a.store.clearFilter(),null!==a.searchValue&&(a.searchRegExp=new RegExp(a.searchValue,"g"+(a.caseSensitive?"":"i")),a.store.each(function(c){var d,e,f,g,h,i=Ext.fly(a.view.getNode(c));if(null!=i)for(d=i.down("td");d&&null!=d;){if(h=!1,e=d.down(".x-grid-cell-inner"),f=e.dom.innerHTML.match(a.tagsRe),g=e.dom.innerHTML.replace(a.tagsRe,a.tagsProtect),f)for(var j=0;j<f.length;j++)if(-1!==f[j].indexOf("x-grid-row-checker")){h=!0;break}h||(g=g.replace(a.searchRegExp,function(d){return b+=1,-1===Ext.Array.indexOf(a.indexes,c)&&a.indexes.push(c),null===a.currentIndex&&(a.currentIndex=c),'<span class="'+a.matchCls+'">'+d+"</span>"}),Ext.each(f,function(b){g=g.replace(a.tagsProtect,b)}),e.dom.innerHTML=g),d=d.next()}},a),a.filterStore&&a.store.filterBy(function(b){return Ext.Array.contains(a.indexes,b)},a),null!==a.currentIndex&&a.statusBar.setText(b+" matche(s) found.")),null===a.currentIndex,a.textField.focus()},onPreviousClick:function(){var a,b=this;-1!==(a=Ext.Array.indexOf(b.indexes,b.currentIndex))&&(b.currentIndex=b.indexes[a-1]||b.indexes[b.indexes.length-1],b.getSelectionModel().select(b.currentIndex))},onNextClick:function(){var a,b=this;-1!==(a=Ext.Array.indexOf(b.indexes,b.currentIndex))&&(b.currentIndex=b.indexes[a+1]||b.indexes[0],b.getSelectionModel().select(b.currentIndex))},caseSensitiveToggle:function(a,b){this.caseSensitive=b,this.onTextFieldChange()},regExpToggle:function(a,b){this.regExpMode=b,this.onTextFieldChange()}}),Ext.define("App.ux.LiveRXNORMSearch",{extend:"Ext.form.ComboBox",requires:["App.model.administration.MedicationInstruction"],alias:"widget.rxnormlivetsearch",itemId:"RxNormLiveSearch",hideLabel:!0,displayField:"STR",valueField:"RXCUI",initComponent:function(){var a=this;Ext.define("liveRXNORMSearchModel",{extend:"Ext.data.Model",fields:[{name:"RXCUI",type:"string"},{name:"CODE",type:"string"},{name:"GS_CODE",type:"string"},{name:"NDC",type:"string"},{name:"STR",type:"string",convert:function(a){return a=a.replace(/\(.*\) | \(.*\)|\(.*\)/g,""),a=a.replace(/[\[\]]/g,""),a=a.replace(/\+/g,"")}},{name:"TTY",type:"auto"},{name:"DST",type:"auto"},{name:"DRT",type:"auto"},{name:"DDF",type:"auto"},{name:"DDFA",type:"auto"},{name:"RXN_QUANTITY",type:"auto"},{name:"SAB",type:"auto"},{name:"RXAUI",type:"auto"},{name:"CodeType",defaultValue:"RXNORM"},{name:"occurrences",type:"int"}],proxy:{type:"direct",api:{read:"Rxnorm.getRXNORMLiveSearch"},reader:{totalProperty:"totals",root:"rows"}},hasMany:[{model:"App.model.administration.MedicationInstruction",name:"instructions",primaryKey:"RXCUI",foreignKey:"rxcui"}]}),a.store=Ext.create("Ext.data.Store",{model:"liveRXNORMSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,emptyText:_("medication_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,maxLength:255,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item {[values.TTY == "SCD" ? "lightGreenBg" : "" ]}"><b>{STR}</b><br>RxNorm: {RXCUI} NDC: {NDC} ({occurrences})</div>'}},pageSize:25}),a.callParent(),a.on("select",a.addOccurrence)},addOccurrence:function(a,b){b.length>0&&""!==b[0].get("RXCUI")&&Rxnorm.addOccurrence(b[0].get("RXCUI"))
}}),Ext.define("App.ux.combo.FloorPlanZones",{extend:"App.ux.combo.ComboResettable",xtype:"floorplanazonescombo",editable:!1,displayField:"title",valueField:"id",emptyText:_("all"),initComponent:function(){this.store||(this.store=Ext.create("App.store.administration.FloorPlanZones",{autoLoad:!1,remoteFilter:!1})),this.callParent()}}),Ext.define("App.ux.combo.Printers",{extend:"App.ux.combo.ComboResettable",xtype:"printerscombo",editable:!1,queryMode:"local",displayField:"display_value",valueField:"id",emptyText:_("select"),width:200,stateful:!0,stateId:"PrinterComboState",store:Ext.create("App.store.administration.PrinterCombo"),showAllPrinters:function(){this.store.clearFilter()},showRemotePrinters:function(){this.store.clearFilter(!0),this.store.filter({property:"local",value:!1})},showLocalPrinters:function(){this.store.clearFilter(!0),this.store.filter({property:"local",value:!0})},showPrintersByFacility:function(){this.store.clearFilter(!0),this.store.filter({filterFn:function(a){return a.get("facility_id")===app.user.facility&&a.get("active")||a.get("local")}},{property:"local",value:!0})}}),Ext.define("App.model.miscellaneous.AddressBook",{extend:"Ext.data.Model",table:{name:"address_book",comment:"Address Book"},fields:[{name:"id",type:"int"},{name:"title",type:"string",len:10},{name:"fname",type:"string",len:80,index:!0},{name:"mname",type:"string",len:80,index:!0},{name:"lname",type:"string",len:80,index:!0},{name:"email",type:"string",len:100,index:!0},{name:"direct_address",type:"string",len:150,index:!0},{name:"url",type:"string",len:150},{name:"organization",type:"string",len:160},{name:"street",type:"string",len:180},{name:"street_cont",type:"string",len:180},{name:"city",type:"string",len:80,index:!0},{name:"state",type:"string",len:100,index:!0},{name:"zip",type:"string",len:15,index:!0},{name:"country",type:"string",len:160},{name:"phone",type:"string",len:20,index:!0},{name:"phone2",type:"string",len:20},{name:"mobile",type:"string",len:20,comment:"cell phone"},{name:"fax",type:"string",len:20},{name:"fullname",type:"string",store:!1,convert:function(a,b){return b.data.fname+" "+b.data.mname+" "+b.data.lname}},{name:"notes",type:"string",len:600}],proxy:{type:"direct",api:{read:"AddressBook.getContacts",create:"AddressBook.addContact",update:"AddressBook.updateContact",destroy:"AddressBook.destroyContact"},reader:{totalProperty:"totals",root:"data"}}}),Ext.define("App.model.patient.CarePlanGoal",{extend:"Ext.data.Model",table:{name:"patient_care_plan_goals",comment:"Patient Care Plan Goals"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"goal",type:"string",len:300},{name:"goal_code",type:"string",len:20},{name:"goal_code_type",type:"string",len:15},{name:"instructions",type:"string",len:500},{name:"plan_date",type:"date",dateFormat:"Y-m-d",dataType:"date"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"CarePlanGoals.getPatientCarePlanGoals",create:"CarePlanGoals.addPatientCarePlanGoal",update:"CarePlanGoals.updatePatientCarePlanGoal",destroy:"CarePlanGoals.destroyPatientCarePlanGoal"}}}),Ext.define("App.model.patient.CognitiveAndFunctionalStatus",{extend:"Ext.data.Model",table:{name:"patient_cognitive_functional_status",comment:"Patient Cognitive Functional Status"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"category",type:"string",len:20},{name:"category_code",type:"string",len:20},{name:"category_code_type",type:"string",len:20},{name:"code",type:"string",len:20},{name:"code_text",type:"string",len:300},{name:"code_type",type:"string",len:15},{name:"status",type:"string",len:20},{name:"status_code",type:"string",len:40},{name:"status_code_type",type:"string",len:15},{name:"note",type:"string",len:500},{name:"begin_date",type:"date",dateFormat:"Y-m-d",dataType:"date"},{name:"end_date",type:"date",dateFormat:"Y-m-d",dataType:"date"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"CognitiveAndFunctionalStatus.getPatientCognitiveAndFunctionalStatuses",create:"CognitiveAndFunctionalStatus.addPatientCognitiveAndFunctionalStatus",update:"CognitiveAndFunctionalStatus.updateCognitiveAndFunctionalStatus",destroy:"CognitiveAndFunctionalStatus.destroyCognitiveAndFunctionalStatus"}}}),Ext.define("App.model.patient.SmokeStatus",{extend:"Ext.data.Model",table:{name:"patient_smoke_status",comment:"Patient Smoke status"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0,comment:"encounter id"},{name:"pid",type:"int",index:!0,comment:"patient ID"},{name:"status",type:"string",len:80},{name:"status_code",type:"string",len:20},{name:"status_code_type",type:"string",len:20},{name:"counseling",type:"bool",comment:"1 if counseling received"},{name:"counseling_text",type:"string",len:80},{name:"counseling_code",type:"string",len:20},{name:"counseling_code_type",type:"string",len:20},{name:"note",type:"string",dataType:"text"},{name:"start_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"create_uid",type:"int",comment:"user ID who created the record"},{name:"update_uid",type:"int",comment:"user ID who updated the record"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"SocialHistory.getSmokeStatus",create:"SocialHistory.addSmokeStatus",update:"SocialHistory.updateSmokeStatus",destroy:"SocialHistory.destroySmokeStatus"}}}),Ext.define("App.model.administration.ActiveProblems",{extend:"Ext.data.Model",table:{name:"activeproblems",comment:"Active Problems"},fields:[{name:"id",type:"int",comment:"Active Problems ID"},{name:"code_text",type:"string"},{name:"code",type:"string"}]}),Ext.define("App.model.administration.Applications",{extend:"Ext.data.Model",table:{name:"applications",comment:"Applications"},fields:[{name:"id",type:"int",comment:"Applications ID"},{name:"app_name",type:"string",len:120},{name:"pvt_key",type:"string",len:80},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"Applications.getApplications",create:"Applications.addApplication",update:"Applications.updateApplication",destroy:"Applications.deleteApplication"}}}),Ext.define("App.model.administration.DefaultDocuments",{extend:"Ext.data.Model",table:{name:"defaultdocuments",comment:"Default Documents"},fields:[{name:"id",type:"int",comment:"Default Documents ID"},{name:"title",type:"string"},{name:"body",type:"string"},{name:"template_type",type:"string"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]}),Ext.define("App.model.administration.DocumentsTemplates",{extend:"Ext.data.Model",table:{name:"documents_templates",comment:"Documents Templates",data:"App.data.administration.DocumentTemplates"},fields:[{name:"id",type:"int",comment:"Documentation Templates ID"},{name:"facility_id",type:"int",index:!0},{name:"title",type:"string",len:50},{name:"template_type",type:"string",len:50},{name:"body",type:"string",dataType:"text"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"to be replace by created_date"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"updated_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"created_by_uid",type:"int"},{name:"updated_by_uid",type:"int"},{name:"facility_name",type:"string",store:!1}]}),Ext.define("App.model.administration.DocumentToken",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Documentation Token ID"},{name:"title",type:"string"},{name:"token",type:"string"}]}),Ext.define("App.model.administration.ExternalDataLoads",{extend:"Ext.data.Model",table:{name:"externaldataloads",comment:"External Data Loads"},fields:[{name:"id",type:"int",comment:"External Data Loads ID"},{name:"date",type:"date",dateFormat:"Y-m-d"},{name:"version",type:"string"},{name:"path",type:"string"},{name:"basename",type:"string"},{name:"codeType",type:"string"}]}),Ext.define("App.model.administration.Facility",{extend:"Ext.data.Model",table:{name:"facility",comment:"Facilities"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:15},{name:"name",type:"string",len:60,comment:"Facility Name"},{name:"legal_name",type:"string",len:60},{name:"lname",type:"string",len:35},{name:"fname",type:"string",len:35},{name:"mname",type:"string",len:35},{name:"facility_entity",type:"string",len:1},{name:"attn",type:"string",len:80},{name:"region",type:"string",len:45},{name:"phone",type:"string",len:25},{name:"fax",type:"string",len:25},{name:"email",type:"string",len:180},{name:"address",type:"string",len:55},{name:"address_cont",type:"string",len:55},{name:"city",type:"string",len:30},{name:"state",type:"string",len:2},{name:"postal_code",type:"string",len:15},{name:"country_code",type:"string",len:3},{name:"postal_address",type:"string",len:55},{name:"postal_address_cont",type:"string",len:55},{name:"postal_city",type:"string",len:30},{name:"postal_state",type:"string",len:2},{name:"postal_zip_code",type:"string",len:15},{name:"postal_country_code",type:"string",len:3},{name:"billing_location",type:"bool"},{name:"pos_code",type:"string",len:2},{name:"service_loc_code",type:"string",len:10},{name:"ein",type:"string",len:15},{name:"clia",type:"string",len:15},{name:"fda",type:"string",len:15},{name:"npi",type:"string",len:15},{name:"ess",type:"string",len:15},{name:"external_id",type:"string",len:25},{name:"global_id",type:"string",len:50},{name:"coordinates",type:"string",len:120},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Facilities.getFacilities",create:"Facilities.addFacility",update:"Facilities.updateFacility",destroy:"Facilities.deleteFacility"}},reader:{totalProperty:"total",root:"data"}}),Ext.define("App.model.administration.FloorPlans",{extend:"Ext.data.Model",table:{name:"floor_plans",comment:"Floor Plans",data:"App.data.administration.FloorPlans"},fields:[{name:"id",type:"int",comment:"Floor Plans ID"},{name:"title",type:"string",len:180,comment:"Floor Title"},{name:"facility_id",type:"int",comment:"facility ID",index:!0},{name:"active",type:"bool",comment:"Active Floor Plan?",index:!0}],proxy:{type:"direct",api:{read:"FloorPlans.getFloorPlans",create:"FloorPlans.createFloorPlan",update:"FloorPlans.updateFloorPlan",destroy:"FloorPlans.removeFloorPlan"}}}),Ext.define("App.model.administration.FacilityStructure",{extend:"Ext.data.Model",table:{name:"facility_structures",comment:"Facilities Dept and Specialties"},fields:[{name:"id",type:"string"},{name:"fid",type:"int",index:!0},{name:"parentId",type:"string",index:!0},{name:"foreign_id",type:"int",index:!0},{name:"foreign_type",type:"string",len:1,index:!0,comment:"D = department S = specialty"},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"leaf",type:"bool",store:!1,convert:function(a,b){return"S"==b.data.foreign_type}},{name:"text",type:"string",store:!1}],idProperty:"id",proxy:{type:"direct",api:{read:"Facilities.getFacilityConfigs",create:"Facilities.addFacilityConfig",update:"Facilities.updateFacilityConfig",destroy:"Facilities.deleteFacilityConfig"},writer:{writeAllFields:!0}}}),Ext.define("App.model.administration.FloorPlanZones",{extend:"Ext.data.Model",table:{name:"floor_plans_zones",comment:"Floor Plan Zones"},fields:[{name:"id",type:"int",comment:"Floor Plan Zones ID"},{name:"floor_plan_id",type:"int",index:!0},{name:"code",type:"string",len:40,index:!0},{name:"title",type:"string",len:180},{name:"type",type:"string",len:100},{name:"bg_color",type:"string",lem:10,useNull:!0},{name:"border_color",type:"string",lem:10,useNull:!0},{name:"scale",type:"string",lem:30,defaultValue:"medium"},{name:"width",type:"int",useNull:!0},{name:"height",type:"int",useNull:!0},{name:"x",type:"int"},{name:"y",type:"int"},{name:"show_priority_color",type:"bool"},{name:"show_patient_preview",type:"bool"},{name:"is_multi_patient",type:"bool"},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"FloorPlans.getFloorPlanZones",create:"FloorPlans.createFloorPlanZone",update:"FloorPlans.updateFloorPlanZone",destroy:"FloorPlans.removeFloorPlanZone"}}}),Ext.define("App.model.administration.FormListOptions",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Form List Options ID"},{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"}}}),Ext.define("App.model.administration.FormsList",{extend:"Ext.data.Model",table:{name:"forms_layout",comment:"Form List"},fields:[{name:"id",type:"int"},{name:"name",type:"string",len:80},{name:"form_data",type:"string",len:80},{name:"model",type:"string",len:80},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"FormLayoutBuilder.getForms"}}}),Ext.define("App.model.administration.Globals",{extend:"Ext.data.Model",table:{name:"globals",comment:"Global Settings"},fields:[{name:"id",type:"int"},{name:"gl_name",type:"string",comment:"Global Setting Unique Name or Key"},{name:"gl_value",type:"string",comment:"Global Setting Value"},{name:"gl_category",type:"string",comment:"Category"},{name:"gl_index",type:"int",comment:"Global Setting Index"}],proxy:{type:"direct",api:{read:"Globals.getGlobals",update:"Globals.updateGlobals"},remoteGroup:!1}}),Ext.define("App.model.administration.HeadersAndFooters",{extend:"Ext.data.Model",table:{name:"headersandfooters",comment:"Headers And Footers"},fields:[{name:"id",type:"int",comment:"Headers and Footers ID"},{name:"title",type:"string"},{name:"template_type",type:"string"},{name:"body",type:"string"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"}]}),Ext.define("App.model.administration.ImmunizationRelations",{extend:"Ext.data.Model",table:{name:"immunizationrelations",comment:"Immunization Relations"},fields:[{name:"id",type:"int",comment:"Immunization Relations ID"},{name:"immunization_id",type:"int"},{name:"foreign_id",type:"int"},{name:"code"},{name:"code_text",type:"string"},{name:"code_type"}],proxy:{type:"direct",api:{read:"PreventiveCare.getRelations",create:"PreventiveCare.addRelations",destroy:"PreventiveCare.removeRelations"},writer:{writeAllFields:!0}}}),Ext.define("App.model.administration.InsuranceCompany",{extend:"Ext.data.Model",table:{name:"insurance_companies",comment:"Insurance Companies"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:50,index:!0,comment:"use to reference the insurance to another software"},{name:"name",type:"string",len:60},{name:"attn",type:"string",len:60},{name:"address1",type:"string",len:55},{name:"address2",type:"string",len:55},{name:"city",type:"string",len:30},{name:"state",type:"string",len:2},{name:"zip_code",type:"string",len:15},{name:"country",type:"string",len:3},{name:"phone1",type:"string",len:25},{name:"phone2",type:"string",len:25},{name:"fax",type:"string",len:25},{name:"active",type:"bool"},{name:"dx_type",type:"string",len:5},{name:"external_id",type:"string",len:25},{name:"global_id",type:"string",len:50},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"address_full",type:"string",convert:function(a,b){return b.data.address1+" "+b.data.address2+" "+b.data.city+" "+b.data.state+", "+b.data.zip_code},store:!1},{name:"combo_text",type:"string",sort:!0,convert:function(a,b){return(b.data.name?b.data.name:" * ")+" "+(b.data.active?"":"("+_("inactive")+")")},store:!1}],proxy:{type:"direct",api:{read:"Insurance.getInsuranceCompanies",create:"Insurance.addInsuranceCompany",update:"Insurance.updateInsuranceCompany"},reader:{root:"data"}}}),Ext.define("App.model.administration.LabObservations",{extend:"Ext.data.Model",table:{name:"labs_panels",comment:"Laboratory Observations"},fields:[{name:"id",type:"string",comment:"LOINC"},{name:"code_text_short",type:"string"},{name:"parent_id",type:"int",dataType:"bigint"},{name:"parent_loinc",type:"string",dataType:"text"},{name:"parent_name",type:"string",dataType:"text"},{name:"sequence",type:"string",dataType:"text"},{name:"loinc_number",type:"string",dataType:"text"},{name:"loinc_name",type:"string",dataType:"text"},{name:"default_unit",type:"string"},{name:"range_start",type:"string"},{name:"range_end",type:"string"},{name:"required_in_panel",type:"string",dataType:"text"},{name:"description",type:"string",dataType:"text"},{name:"active",type:"bool"}]}),Ext.define("App.model.administration.Laboratories",{extend:"Ext.data.Model",table:{name:"laboratories",comment:"Laboratories Grid"},fields:[{name:"id",type:"int",comment:"Laboratory ID"},{name:"name",type:"string"},{name:"transmit_method",type:"string"},{name:"email",type:"string"},{name:"address_id",type:"int"},{name:"line1",type:"string",store:!1},{name:"line2",type:"string",store:!1},{name:"city",type:"string",store:!1},{name:"state",type:"string",store:!1},{name:"zip",type:"string",store:!1},{name:"plus_four",type:"string",store:!1},{name:"country",type:"string",store:!1},{name:"address_full",type:"string",store:!1},{name:"phone_id",type:"int"},{name:"phone_country_code",type:"string",store:!1},{name:"phone_area_code",type:"string",store:!1},{name:"phone_prefix",type:"string",store:!1},{name:"phone_number",type:"string",store:!1},{name:"phone_full",type:"string",store:!1},{name:"fax_id",type:"int"},{name:"fax_country_code",type:"string",store:!1},{name:"fax_area_code",type:"string",store:!1},{name:"fax_prefix",type:"string",store:!1},{name:"fax_number",type:"string",store:!1},{name:"fax_full",type:"string",store:!1},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"Practice.getLaboratories",create:"Practice.addLaboratory",update:"Practice.updateLaboratory"}}}),Ext.define("App.model.administration.LayoutTree",{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"parentId",type:"string"},{name:"text",type:"string"},{name:"index",type:"int",mapping:"x_index"},{name:"text",type:"string"},{name:"index",type:"int"},{name:"xtype",type:"string"},{name:"form_id",type:"int"},{name:"title",type:"string"},{name:"fieldLabel",type:"string"},{name:"emptyText",type:"string"},{name:"labelWidth",type:"string"},{name:"hideLabel",type:"bool",useNull:!0,defaultValue:null},{name:"layout",type:"string"},{name:"width",type:"string"},{name:"height",type:"string"},{name:"anchor",type:"string"},{name:"margin",type:"string"},{name:"flex",type:"string"},{name:"collapsible",type:"bool",useNull:!0,defaultValue:null},{name:"checkboxToggle",type:"bool",useNull:!0,defaultValue:null},{name:"collapsed",type:"bool",useNull:!0,defaultValue:null},{name:"inputValue",type:"string"},{name:"allowBlank",type:"string"},{name:"value",type:"string"},{name:"minLength",type:"string"},{name:"maxLength",type:"string"},{name:"maxValue",type:"string"},{name:"minValue",type:"string"},{name:"columnWidth",type:"string"},{name:"columns",type:"string"},{name:"boxLabel",type:"string"},{name:"grow",type:"bool",useNull:!0,defaultValue:null},{name:"growMin",type:"string"},{name:"growMax",type:"string"},{name:"increment",type:"string"},{name:"code",type:"string"},{name:"name",type:"string"},{name:"list_id",type:"string"},{name:"itemId",type:"string"},{name:"action",type:"string"}],proxy:{type:"direct",api:{read:"FormLayoutBuilder.getFormFieldsTree",create:"FormLayoutBuilder.createFormField",update:"FormLayoutBuilder.updateFormField",destroy:"FormLayoutBuilder.removeFormField"},writer:{writeAllFields:!0}}}),Ext.define("App.model.administration.ListOptions",{extend:"Ext.data.Model",table:{name:"combo_lists_options",comment:"Combo List Options"},fields:[{name:"id",type:"int",comment:"List Options ID"},{name:"list_id",type:"int",index:!0,comment:"List ID"},{name:"list_key",type:"string",index:!0,len:40},{name:"option_value",type:"string",index:!0,comment:"Value"},{name:"option_name",type:"string",comment:"Name"},{name:"code",type:"string",len:15,index:!0,comment:"value code"},{name:"code_type",type:"string",len:10,comment:"CPT4 LOINC SNOMEDCT ICD9 ICD10 RXNORM"},{name:"seq",type:"int",comment:"Sequence"},{name:"notes",type:"string",comment:"Notes"},{name:"active",type:"bool",comment:"Active?"}],proxy:{type:"direct",api:{read:"Lists.getOptions",create:"Lists.addOption",update:"Lists.updateOption"}}}),Ext.define("App.model.administration.Lists",{extend:"Ext.data.Model",table:{name:"combo_lists",comment:"Combo List"},fields:[{name:"id",type:"int",comment:"List Options ID"},{name:"list_key",type:"string",comment:"List key for this list"},{name:"title",type:"string",comment:"Title of the combo"},{name:"active",type:"bool",comment:"Active?"},{name:"in_use",type:"bool",persist:!1}],proxy:{type:"direct",api:{read:"Lists.getLists",create:"Lists.addList",update:"Lists.updateList",destroy:"Lists.deleteList"}}}),Ext.define("App.model.administration.Medications",{extend:"Ext.data.Model",fields:[{name:"RXCUI",type:"auto"},{name:"CODE",type:"auto"},{name:"STR",type:"auto"},{name:"DST",type:"auto"},{name:"DRT",type:"auto"},{name:"DDF",type:"auto"},{name:"DDFA",type:"auto"},{name:"RXN_QUANTITY",type:"auto"},{name:"SAB",type:"auto"},{name:"RXAUI",type:"auto"}],proxy:{type:"direct",api:{read:"Rxnorm.getRXNORMList"},reader:{totalProperty:"totals",root:"data"},filterParam:"query",encodeFilters:function(a){return a[0].value}}}),Ext.define("App.model.administration.Modules",{extend:"Ext.data.Model",table:{name:"modules",comment:"Modules"},fields:[{name:"id",type:"int"},{name:"title",type:"string",len:80},{name:"name",type:"string",len:100},{name:"description",type:"string"},{name:"enable",type:"bool"},{name:"installed_version",type:"string",len:20},{name:"sql_version",type:"string",len:20},{name:"required_core_version",type:"string",len:20},{name:"licensekey",type:"string"},{name:"localkey",type:"string"}],proxy:{type:"direct",api:{read:"Modules.getActiveModules",update:"Modules.updateModule"},writer:{writeAllFields:!0}}}),Ext.define("App.model.administration.ParentFields",{extend:"Ext.data.Model",table:{name:"parentfields",comment:"Parent Fields"},fields:[{name:"name",type:"string"},{name:"value",type:"string"}],proxy:{type:"direct",api:{read:"FormLayoutBuilder.getParentFields"}}}),Ext.define("App.model.administration.Pharmacies",{extend:"Ext.data.Model",table:{name:"pharmacies",comment:"Pharmacies"},fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"transmit_method",type:"string"},{name:"email",type:"string"},{name:"address_id",type:"int"},{name:"line1",type:"string",store:!1},{name:"line2",type:"string",store:!1},{name:"city",type:"string",store:!1},{name:"state",type:"string",store:!1},{name:"zip",type:"string",store:!1},{name:"plus_four",type:"string",store:!1},{name:"country",type:"string",store:!1},{name:"address_full",type:"string",store:!1},{name:"phone_id",type:"int"},{name:"phone_country_code",type:"string",store:!1},{name:"phone_country_code",type:"string",store:!1},{name:"phone_area_code",type:"string",store:!1},{name:"phone_prefix",type:"string",store:!1},{name:"phone_number",type:"string",store:!1},{name:"phone_full",type:"string",store:!1},{name:"fax_id",type:"int"},{name:"fax_country_code",type:"string",store:!1},{name:"fax_area_code",type:"string",store:!1},{name:"fax_prefix",type:"string",store:!1},{name:"fax_number",type:"string",store:!1},{name:"fax_full",type:"string",store:!1},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"Practice.getPharmacies",create:"Practice.addPharmacy",update:"Practice.updatePharmacy"},writer:{writeAllFields:!0}}}),Ext.define("App.model.administration.PreventiveCare",{extend:"Ext.data.Model",table:{name:"preventivecare",comment:"Preventive Care"},fields:[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"preventive_care_id",type:"int"},{name:"uid",type:"int"},{name:"description",type:"string"},{name:"age_start",type:"string"},{name:"age_end",type:"string"},{name:"sex",type:"string"},{name:"pregnant",type:"bool"},{name:"frequency",type:"string"},{name:"category_id",type:"string"},{name:"code",type:"string"},{name:"coding_system",type:"string"},{name:"dismiss",type:"bool"},{name:"frequency_type",type:"string"},{name:"reason",type:"string"},{name:"times_to_perform",type:"string"},{name:"doc_url1",type:"string"},{name:"doc_url2",type:"string"},{name:"doc_url3",type:"string"},{name:"active",type:"bool"}]}),Ext.define("App.model.administration.PreventiveCareActiveProblems",{extend:"Ext.data.Model",table:{name:"preventivecareactiveproblems",comment:"Preventive Care Active Problems"},fields:[{name:"guideline_id",type:"int"},{name:"code",type:"string"},{name:"code_text",type:"string"}]}),Ext.define("App.model.administration.PreventiveCareLabs",{extend:"Ext.data.Model",table:{name:"preventivecarelabs",comment:"Preventive Care Labs"},fields:[{name:"id",type:"int"},{name:"value_name",type:"string"},{name:"greater_than",type:"string"},{name:"less_than",type:"string"},{name:"equal_to",type:"string"},{name:"code",type:"string"},{name:"preventive_care_id",type:"string"}]}),Ext.define("App.model.administration.PreventiveCareMedications",{extend:"Ext.data.Model",table:{name:"preventivecaremedications",comment:"Preventive Care Medications"},fields:[{name:"guideline_id",type:"int"},{name:"code",type:"string"},{name:"code_text",type:"string"}]}),Ext.define("App.model.administration.ProviderCredentialization",{extend:"Ext.data.Model",table:{name:"provider_credentializations"},fields:[{name:"id",type:"int"},{name:"provider_id",type:"int",index:!0},{name:"insurance_company_id",type:"int",index:!0},{name:"insurance_company_name",type:"string",store:!1},{name:"start_date",type:"date",dataType:"date",dateFormat:"Y-m-d",index:!0},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d",index:!0},{name:"credentialization_notes",type:"string"},{name:"active",type:"bool",store:!1,convert:function(a,b){var c=new Date;return b.data.start_date<=c&&b.data.end_date>=c}},{name:"create_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_uid",type:"int"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Providers.getProviderCredentializations",create:"Providers.addProviderCredentialization",update:"Providers.updateProviderCredentialization",destroy:"Providers.deleteProviderCredentialization"},reader:{root:"data"}}}),Ext.define("App.model.administration.ReferringProviderFacility",{extend:"Ext.data.Model",table:{name:"referring_providers_facilities"},fields:[{name:"id",type:"int"},{name:"referring_provider_id",type:"int",index:!0},{name:"facility_id",type:"int",index:!0},{name:"name",type:"string",len:60},{name:"address",type:"string",len:55},{name:"address_cont",type:"string",len:55},{name:"city",type:"string",len:30},{name:"state",type:"string",len:2},{name:"postal_code",type:"string",len:15},{name:"country",type:"string",len:3},{name:"email",type:"string",len:180},{name:"phone_number",type:"string",len:25},{name:"fax_number",type:"string",len:25},{name:"notes",type:"string",len:600},{name:"is_default",type:"bool"},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"ReferringProviders.getReferringProviderFacilities",create:"ReferringProviders.addReferringProviderFacility",update:"ReferringProviders.updateReferringProviderFacility",destroy:"ReferringProviders.deleteReferringProviderFacility"}}}),Ext.define("App.model.administration.Services",{extend:"Ext.data.Model",table:{name:"services",comment:"Services"},fields:[{name:"id",type:"string",comment:"Services ID"},{name:"code_text",type:"string"},{name:"sg_code",type:"string"},{name:"long_desc",type:"string"},{name:"code_text_short",type:"string"},{name:"code",type:"string"},{name:"code_type",type:"string"},{name:"modifier",type:"string"},{name:"units",type:"string"},{name:"fee",type:"int"},{name:"superbill",type:"string"},{name:"related_code",type:"string"},{name:"taxrates",type:"string"},{name:"active",type:"bool"},{name:"reportable",type:"string"},{name:"has_children",type:"bool"},{name:"sex",type:"string"},{name:"age_start",type:"int"},{name:"age_end",type:"int"},{name:"times_to_perform",type:"int"},{name:"frequency_number",type:"int"},{name:"frequency_time",type:"string"},{name:"pregnant",type:"bool"},{name:"only_once",type:"bool"},{name:"active_problems",type:"string"},{name:"medications",type:"string"},{name:"labs",type:"string"},{name:"has_children",type:"bool"},{name:"class",type:"string"}]}),Ext.define("App.model.administration.Specialty",{extend:"Ext.data.Model",table:{name:"specialties",comment:"Providers Specialties"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:5,index:!0},{name:"title",type:"string",len:100},{name:"taxonomy",type:"string",len:15},{name:"modality",type:"string",len:50},{name:"medical_education",type:"string"},{name:"modality",type:"string",len:50},{name:"isFda",type:"bool"},{name:"external_id",type:"string",len:25},{name:"global_id",type:"string",len:50},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"text_details",type:"string",convert:function(a,b){return b.data.id+": "+b.data.title},store:!1},{name:"combo_text",type:"string",convert:function(a,b){return b.data.id+": "+b.data.title+" "+(b.data.active?"("+_("not_active")+")":"")},store:!1}],proxy:{type:"direct",api:{read:"Specialties.getSpecialties",create:"Specialties.addSpecialty",update:"Specialties.updateSpecialty"},reader:{root:"data"}}}),Ext.define("App.model.administration.EncounterTemplatePanel",{extend:"Ext.data.Model",table:{name:"template_panels"},fields:[{name:"id",type:"int"},{name:"specialty_id",type:"int",index:!0},{name:"description",type:"string",len:300},{name:"sex",type:"string",len:1,index:!0},{name:"order",type:"int"},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"TemplatePanels.getTemplatePanels",create:"TemplatePanels.createTemplatePanel",update:"TemplatePanels.updateTemplatePanel",destroy:"TemplatePanels.deleteTemplatePanel"},reader:{root:"data"},remoteGroup:!1},hasMany:[{model:"App.model.administration.EncounterTemplatePanelTemplate",name:"templates",foreignKey:"panel_id",storeConfig:{groupField:"template_type"}}]}),Ext.define("App.model.administration.EncounterTemplatePanelTemplate",{extend:"Ext.data.Model",table:{name:"template_panels_templates"},fields:[{name:"id",type:"int"},{name:"panel_id",type:"int"},{name:"template_type",type:"string",len:80,comment:"rx lab rad etc"},{name:"description",type:"string",len:300},{name:"template_data",type:"string",dataType:"mediumtext"},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"TemplatePanels.getTemplatePanelTemplates",create:"TemplatePanels.createTemplatePanelTemplate",update:"TemplatePanels.updateTemplatePanelTemplate",destroy:"TemplatePanels.deleteTemplatePanelTemplate"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.model.administration.TransactionLog",{extend:"Ext.data.Model",table:{name:"audit_transaction_log"},fields:[{name:"id",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"Date of the event"},{name:"pid",type:"int",comment:"Patient ID"},{name:"eid",type:"int",comment:"Encounter ID"},{name:"uid",type:"int",comment:"User ID"},{name:"fid",type:"int",comment:"Facility ID"},{name:"pk",type:"string",comment:"Primary Key"},{name:"category",type:"string",len:50},{name:"event",type:"string",len:100,comment:"Event UPDATE INSERT DELETE"},{name:"table_name",type:"string",len:60},{name:"sql_string",type:"string",dataType:"mediumtext"},{name:"data",type:"array",dataType:"mediumtext",convert:function(a,b){return b.serializeEventData(a)
},comment:"serialized data"},{name:"ip",type:"string",len:40},{name:"user_title",type:"string",store:!1},{name:"user_fname",type:"string",store:!1},{name:"user_mname",type:"string",store:!1},{name:"user_lname",type:"string",store:!1},{name:"patient_title",type:"string",store:!1},{name:"patient_fname",type:"string",store:!1},{name:"patient_mname",type:"string",store:!1},{name:"patient_lname",type:"string",store:!1},{name:"user_name",type:"string",convert:function(a,b){var c="";return b.data.user_lname&&(c+=b.data.user_lname+", "),b.data.user_fname&&(c+=b.data.user_fname+" "),b.data.user_mname&&(c+=b.data.user_mname),c},store:!1},{name:"patient_name",type:"string",convert:function(a,b){var c="";return b.data.patient_lname&&(c+=b.data.patient_lname+", "),b.data.patient_fname&&(c+=b.data.patient_fname+" "),b.data.patient_mname&&(c+=b.data.patient_mname),c},store:!1},{name:"valid",type:"bool",store:!1},{name:"checksum",type:"string",len:80}],proxy:{type:"direct",api:{read:"TransactionLog.getTransactionLog"},reader:{root:"data"}},serializeEventData:function(a){var b="";return Ext.Object.each(a,function(a,c){b+=a+" - "+c+"<br>"}),b}}),Ext.define("App.model.administration.EncounterEventHistory",{extend:"Ext.data.Model",table:{name:"encounter_event_history",comment:"Encounter Event History"},fields:[{name:"c",type:"int",comment:"Encounter Event History ID"},{name:"eid",type:"int",comment:"Encounter ID",index:!0},{name:"pid",type:"int",comment:"Patient ID",index:!0},{name:"uid",type:"int",comment:"User ID",index:!0},{name:"fid",type:"int",comment:"Facility ID",index:!0},{name:"event",type:"string",len:200,comment:"Event description"},{name:"user_title",type:"string",store:!1},{name:"user_fname",type:"string",store:!1},{name:"user_mname",type:"string",store:!1},{name:"user_lname",type:"string",store:!1},{name:"patient_title",type:"string",store:!1},{name:"patient_fname",type:"string",store:!1},{name:"patient_mname",type:"string",store:!1},{name:"patient_lname",type:"string",store:!1},{name:"user_name",type:"string",store:!1,convert:function(a,b){var c="";return b.data.user_title&&(c+=b.data.user_title+" "),b.data.user_fname&&(c+=b.data.user_fname+" "),b.data.user_mname&&(c+=b.data.user_mname+" "),b.data.user_lname&&(c+=b.data.user_lname),c}},{name:"patient_name",type:"string",store:!1,convert:function(a,b){var c="";return b.data.patient_title&&(c+=b.data.patient_title+" "),b.data.patient_fname&&(c+=b.data.patient_fname+" "),b.data.patient_mname&&(c+=b.data.patient_mname+" "),b.data.patient_lname&&(c+=b.data.patient_lname),c}},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"Date of the event"}],proxy:{type:"direct",api:{read:"EncounterEventHistory.getLogs",create:"EncounterEventHistory.setLog",update:"EncounterEventHistory.setLog"},reader:{totalProperty:"totals",root:"data"}}}),Ext.define("App.model.administration.XtypesComboModel",{extend:"Ext.data.Model",table:{name:"xtypescombo",comment:"XTYPE Combos"},fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getFiledXtypes"}},autoLoad:!0}),Ext.define("App.model.administration.User",{extend:"Ext.data.Model",table:{name:"users",comment:"User accounts"},fields:[{name:"id",type:"int"},{name:"global_id",type:"string",len:40},{name:"external_id",type:"string",len:80},{name:"code",type:"string",len:15},{name:"providerCode",type:"string",len:40},{name:"role_id",type:"int",comment:"acl_user_roles relation"},{name:"facility_id",type:"int",comment:"default facility",index:!0},{name:"department_id",type:"int",comment:"default department",index:!0},{name:"warehouse_id",type:"int",comment:"default warehouse"},{name:"username",type:"string",comment:"username",len:20,index:!0},{name:"password",type:"string",comment:"password",dataType:"blob",encrypt:!0},{name:"pwd_history1",type:"string",comment:"first password history backwards",dataType:"blob",encrypt:!0},{name:"pwd_history2",type:"string",comment:"second password history backwards",dataType:"blob",encrypt:!0},{name:"password_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"password_force_reset",type:"bool"},{name:"title",type:"string",comment:"title (Mr. Mrs.)",len:10},{name:"fname",type:"string",comment:"first name",len:80,index:!0},{name:"mname",type:"string",comment:"middle name",len:80,index:!0},{name:"lname",type:"string",comment:"last name",len:120,index:!0},{name:"signature",type:"string",len:100},{name:"pin",type:"string",comment:"pin number",useNull:!0,len:10},{name:"npi",type:"string",comment:"National Provider Identifier",len:15,index:!0},{name:"lic",type:"string",len:80},{name:"ess",type:"string",len:10},{name:"upin",type:"string",len:80},{name:"fedtaxid",type:"string",comment:"federal tax id",len:80},{name:"feddrugid",type:"string",comment:"federal drug id",len:80},{name:"statedrugid",type:"string",comment:"state tax id",len:80},{name:"notes",type:"string",len:300},{name:"email",type:"string",len:150,index:!0},{name:"specialty",type:"array",comment:"specialty",len:80},{name:"medical_education",type:"string",len:1},{name:"taxonomy",type:"string",comment:"taxonomy",defaultValue:"207Q00000X",len:15,index:!0},{name:"calendar",type:"bool",comment:"has calendar? 0=no 1=yes",index:!0},{name:"authorized",type:"bool"},{name:"active",type:"bool",index:!0},{name:"direct_address",type:"string",comment:"direct_address",len:150,index:!0},{name:"city",type:"string",len:55},{name:"state",type:"string",len:55},{name:"postal_code",type:"string",len:15},{name:"street",type:"string",len:55},{name:"street_cont",type:"string",len:55},{name:"country_code",type:"string",len:15},{name:"phone",type:"string",len:80},{name:"mobile",type:"string",len:80},{name:"create_uid",type:"int",comment:"create user ID"},{name:"update_uid",type:"int",comment:"update user ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"is_attending",type:"bool",index:!0},{name:"is_resident",type:"bool",index:!0},{name:"default_attending",type:"string",len:40,index:!0},{name:"fullname",type:"string",comment:"title full name",store:!1},{name:"shortname",type:"string",comment:"title and last name",store:!1},{name:"role",type:"string",store:!1},{name:"department",type:"string",store:!1},{name:"authy_id",type:"string",index:!0}],proxy:{type:"direct",api:{read:"User.getUsers",create:"User.addUser",update:"User.updateUser"},reader:{root:"data"}},hasMany:[{model:"App.model.Phones",name:"phones",primaryKey:"id",foreignKey:"use_id"},{model:"App.model.Address",name:"address",primaryKey:"id",foreignKey:"use_id"}]}),Ext.define("App.model.administration.IpAccessLog",{extend:"Ext.data.Model",table:{name:"ip_access_log"},fields:[{name:"id",type:"int"},{name:"ip",type:"string",len:40},{name:"country_code",type:"string",len:130},{name:"event",type:"string",len:10},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"IpAccessRules.getIpAccessLogs"},reader:{totalProperty:"total",root:"data"}}}),Ext.define("App.model.administration.IpAccessRule",{extend:"Ext.data.Model",table:{name:"ip_access_rules"},fields:[{name:"id",type:"int"},{name:"ip",type:"string",len:40},{name:"ip_from",type:"string",len:40},{name:"ip_to",type:"string",len:40},{name:"country_code",type:"string",len:50},{name:"country_name",type:"string",len:100},{name:"country",type:"string",store:!1,convert:function(a,b){return b.data.country_name+"("+b.data.country_code+")"}},{name:"rule",type:"string",len:10},{name:"weight",type:"int",index:!0},{name:"active",type:"bool",index:!0},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"IpAccessRules.getIpAccessRules",create:"IpAccessRules.createIpAccessRule",update:"IpAccessRules.updateIpAccessRule"},writer:{writeAllFields:!0},reader:{totalProperty:"total",root:"data"}}}),Ext.define("App.model.administration.CronJob",{extend:"Ext.data.Model",table:{name:"cronjob",comment:"Holds all the available scripts that runs on the background."},fields:[{name:"id",type:"int"},{name:"name",type:"string",dataType:"varchar",len:45},{name:"filename",type:"string",dataType:"varchar",len:45},{name:"minute",dataType:"varchar",len:3},{name:"hour",dataType:"varchar",len:3},{name:"month_day",dataType:"varchar",len:3},{name:"month",dataType:"varchar",len:3},{name:"week_day",dataType:"varchar",len:3},{name:"pid",dataType:"varchar",len:10},{name:"running",type:"bool"},{name:"last_run_date",type:"date"},{name:"elapsed",type:"string",store:!1},{name:"timeout",type:"int"},{name:"params",type:"string",len:50},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"CronJob.getCronJob",update:"CronJob.updateCronJob"},reader:{root:"data"}}}),Ext.define("App.model.miscellaneous.OfficeNotes",{extend:"Ext.data.Model",table:{name:"office_notes",comment:"Office Notes"},fields:[{name:"id",type:"int",comment:"Office Notes ID"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"body",type:"string"},{name:"user",type:"string"},{name:"facility_id",type:"string"},{name:"activity",type:"string"}],proxy:{type:"direct",api:{read:"OfficeNotes.getOfficeNotes",create:"OfficeNotes.addOfficeNotes",update:"OfficeNotes.updateOfficeNotes"}}}),Ext.define("App.model.miscellaneous.Amendment",{extend:"Ext.data.Model",table:{name:"patient_amendments"},fields:[{name:"id",type:"int"},{name:"portal_id",type:"int"},{name:"pid",type:"int"},{name:"amendment_type",type:"string",len:1,comment:"P = patient or D = Doctor or O = organization"},{name:"amendment_data",type:"array",dataType:"mediumtext"},{name:"amendment_message",type:"string",dataType:"text"},{name:"amendment_status",type:"string",len:1,comment:"W = waiting or A = approved or D = denied or C = canceled"},{name:"response_message",type:"string",len:500,comment:"denial or approval reason"},{name:"is_read",type:"bool"},{name:"is_viewed",type:"bool"},{name:"is_synced",type:"bool"},{name:"assigned_to_uid",type:"int"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"response_uid",type:"int"},{name:"approved_by",type:"string",len:80},{name:"assigned_date",type:"date",comment:"Assigned date",dateFormat:"Y-m-d H:i:s"},{name:"response_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"cancel_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"cancel_by",type:"string",len:15,comment:"U for user P patient and ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"responded_by",type:"string",store:!1,convert:function(a,b){return"A"===b.data.amendment_status||"D"===b.data.amendment_status?b.data.response_title+" "+b.data.response_fname+" "+b.data.response_mname+" "+b.data.response_lname:""}},{name:"response_title",type:"string",store:!1},{name:"response_fname",type:"string",store:!1},{name:"response_mname",type:"string",store:!1},{name:"response_lname",type:"string",store:!1}],proxy:{type:"direct",api:{read:"Amendments.getAmendments",create:"Amendments.addAmendment",update:"Amendments.updateAmendment"},reader:{root:"data"}}}),Ext.define("App.model.account.VoucherLine",{extend:"Ext.data.Model",table:{name:"accvoucherline",comment:"Voucher / Receipt"},fields:[{name:"id",type:"int"},{name:"createUid",type:"int"},{name:"createDate",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"writeUid",type:"int"},{name:"writeDate",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"voucherId",type:"int",comment:"Voucher"},{name:"accountId",type:"int",comment:"Account"},{name:"moveLineId",type:"int",comment:"Journal Item"},{name:"reconcile",type:"bool",defaultValue:!1,comment:"Full Reconcile"},{name:"code",type:"string",comment:"COPAY/CPT/HCPCS/SKU codes"},{name:"name",type:"string",comment:"Description"},{name:"type",type:"string",comment:"debit/credit"},{name:"amountUnreconciled",type:"float",comment:"Open Balance"},{name:"amountUntax",type:"float",comment:"Untax Amount"},{name:"amountOriginal",type:"float",comment:"Default Amount"},{name:"amount",type:"float",comment:"Amount"}],proxy:{type:"direct",api:{read:"AccVoucher.getVoucherLines",create:"AccVoucher.addVoucherLine",update:"AccVoucher.updateVoucherLine",destroy:"AccVoucher.destroyVoucherLine"}},associations:[{type:"belongsTo",model:"App.model.account.Voucher",foreignKey:"voucherId",setterName:"setVoucher",getterName:"getVoucher"}]}),Ext.define("App.model.account.Voucher",{extend:"Ext.data.Model",table:{name:"accvoucher",comment:"Voucher / Receipt"},fields:[{name:"id",type:"int"},{name:"createUid",type:"int"},{name:"createDate",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"writeUid",type:"int"},{name:"writeDate",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"dateDue",type:"date",dateFormat:"Y-m-d H:i:s",comment:"Due Date"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"Date"},{name:"encounterId",type:"int",comment:"Encounter"},{name:"accountId",type:"int",comment:"Account"},{name:"journalId",type:"int",comment:"Journal"},{name:"moveId",type:"int",comment:"Account Entry"},{name:"active",type:"bool",defaultValue:!0,comment:"Active?"},{name:"comment",type:"string",comment:"Comment"},{name:"reference",type:"string",comment:"Ref"},{name:"number",type:"string",comment:"Number"},{name:"notes",type:"string",mapping:"narration",comment:"Notes"},{name:"status",type:"string",mapping:"state",comment:"Status"},{name:"type",type:"string",comment:"visit/product/office"},{name:"amount",type:"float",defaultValue:0,comment:"Total Amount"}],proxy:{type:"direct",api:{read:"AccVoucher.getVoucher",create:"AccVoucher.addVoucher",update:"AccVoucher.updateVoucher",destroy:"AccVoucher.destroyVoucher"}},hasMany:[{model:"App.model.account.VoucherLine",name:"voucherlines",foreignKey:"voucherId"}]}),Ext.define("App.model.documents.AdministrativeDocuments",{extend:"Ext.data.Model",table:{name:"administrative_documents",comment:"Administrative Documents Storage"},fields:[{name:"id",type:"int"},{name:"belongs_to",type:"string",len:75,useNull:!0,index:!0},{name:"belongs_to_id",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"docType",type:"string",index:!0},{name:"docTypeCode",type:"string",len:20,index:!0},{name:"filesystem_id",type:"int",index:!0},{name:"path",type:"string"},{name:"name",type:"string"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"note",type:"string",dataType:"MEDIUMTEXT"},{name:"title",type:"string"},{name:"hash",type:"string"},{name:"encrypted",type:"bool",defaultValue:0},{name:"entered_in_error",type:"bool",defaultValue:0},{name:"error_note",type:"string",len:300},{name:"groupDate",type:"string",store:!1,convert:function(a,b){return Ext.util.Format.date(b.get("date"),g("date_display_format"))}},{name:"document_instance",type:"string",len:10},{name:"document",type:"string",dataType:"longblob"},{name:"document_id",type:"int"}],proxy:{type:"direct",api:{read:"DocumentHandler.getAdministrativeDocuments",create:"DocumentHandler.addAdministrativeDocument",update:"DocumentHandler.updateAdministrativeDocument"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.model.fees.Billing",{extend:"Ext.data.Model",table:{name:"billing",comment:"Billing"},fields:[{name:"eid",type:"int "},{name:"pid",type:"int"},{name:"patientName",type:"string"},{name:"primaryProvider",type:"string"},{name:"encounterProvider",type:"string"},{name:"supervisorProvider",type:"string"},{name:"facility",type:"string"},{name:"billing_facility",type:"string"},{name:"service_date",type:"date"},{name:"close_date",type:"date"},{name:"billing_stage",type:"int"},{name:"dxCodes",type:"auto"}],proxy:{type:"direct",api:{read:"Fees.getFilterEncountersBillingData"},reader:{root:"encounters",totalProperty:"totals"}}}),Ext.define("App.model.patient.EncounterService",{extend:"Ext.data.Model",table:{name:"encounter_services"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"reference_type",type:"string",len:40,index:!0},{name:"reference_id",type:"int",index:!0},{name:"billing_reference",type:"string",len:20,index:!0},{name:"code",type:"string",len:40,index:!0},{name:"code_type",type:"string",len:40},{name:"code_text",type:"string",dataType:"text"},{name:"units",type:"int",len:5},{name:"tooth",type:"string",len:10},{name:"surface",type:"string",len:5},{name:"cavity_quadrant",type:"string",len:2},{name:"modifiers",type:"array"},{name:"dx_group_id",type:"int"},{name:"dx_pointers",type:"array"},{name:"status",type:"string",len:20},{name:"financial_class",type:"string",len:4},{name:"financial_name",type:"string",len:4,store:!1},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"date_create",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"date_update",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Services.getEncounterServices",create:"Services.addEncounterService",update:"Services.updateEncounterService",destroy:"Services.removeEncounterService"},writer:{writeAllFields:!0}}}),Ext.define("App.model.patient.Vitals",{extend:"Ext.data.Model",table:{name:"encounter_vitals"},fields:[{name:"id",type:"int",comment:"Vital ID"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"auth_uid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"weight_lbs",type:"float",useNull:!0,len:10},{name:"weight_kg",type:"float",useNull:!0,len:10},{name:"height_in",type:"float",useNull:!0,len:10},{name:"height_cm",type:"float",useNull:!0,len:10},{name:"bp_systolic",type:"float",useNull:!0,len:10},{name:"bp_diastolic",type:"float",useNull:!0,len:10},{name:"pulse",type:"int",useNull:!0,len:10,convert:function(a){return a>0?a:null}},{name:"respiration",type:"int",useNull:!0,len:10,convert:function(a){return a>0?a:null}},{name:"temp_f",type:"float",useNull:!0,len:10,convert:function(a){return a>0?a:null}},{name:"temp_c",type:"float",useNull:!0,len:10,convert:function(a){return a>0?a:null}},{name:"temp_location",type:"string",len:40},{name:"oxygen_saturation",type:"float",useNull:!0,len:10},{name:"oxygen_inhaled_concentration",type:"float",useNull:!0,len:10},{name:"head_circumference_in",type:"float",useNull:!0,len:10},{name:"head_circumference_cm",type:"float",useNull:!0,len:10},{name:"waist_circumference_in",type:"float",useNull:!0,len:10},{name:"waist_circumference_cm",type:"float",useNull:!0,len:10},{name:"bmi",type:"float",useNull:!0,len:10,convert:function(a){return a>0?a:null}},{name:"bmi_status",type:"string",useNull:!0,len:20},{name:"other_notes",type:"string",len:600},{name:"bp_systolic_normal",type:"int",defaultValue:120,store:!1},{name:"bp_diastolic_normal",type:"int",defaultValue:80,store:!1},{name:"group_field",type:"string",store:!1,convert:function(a,b){return b.get("eid")===app.patient.eid?"Encounter Vitals":"History"}},{name:"administer_by",type:"string",store:!1},{name:"authorized_by",type:"string",store:!1},{name:"patient_record_number",type:"string",store:!1},{name:"patient_fname",type:"string",store:!1},{name:"patient_mname",type:"string",store:!1},{name:"patient_lname",type:"string",store:!1},{name:"administer_fname",type:"string",store:!1},{name:"administer_mname",type:"string",store:!1},{name:"administer_lname",type:"string",store:!1},{name:"authorized_fname",type:"string",store:!1},{name:"authorized_mname",type:"string",store:!1},{name:"authorized_name",type:"string",store:!1}],proxy:{type:"direct",api:{read:"Vitals.getVitals",create:"Vitals.addVitals",update:"Vitals.updateVitals",destroy:"Vitals.removeVitals"},writer:{writeAllFields:!0}}}),Ext.define("App.model.patient.HCFAOptions",{extend:"Ext.data.Model",table:{name:"encounter_1500_options"},fields:[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"uid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"employment_related",type:"bool"},{name:"auto_accident",type:"bool"},{name:"state",type:"string",len:80},{name:"other_accident",type:"bool"},{name:"similar_illness_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"unable_to_work_from",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"unable_to_work_to",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"hops_date_to",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"out_lab_used",type:"bool"},{name:"amount_charges",type:"string",len:10},{name:"medicaid_resubmission_code",type:"string",len:15},{name:"medicaid_original_reference_number",type:"string",len:60},{name:"prior_authorization_number",type:"string",len:60},{name:"replacement_claim",type:"bool"},{name:"notes",type:"string",dataType:"text"}],proxy:{type:"direct",api:{update:"Encounter.updateHCFA"}},belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"}}),Ext.define("App.model.fees.PaymentTransactions",{extend:"Ext.data.Model",table:{name:"paymenttransactions",comment:"Payment Transactions"},fields:[],proxy:{type:"direct",api:{read:"Fees.getPaymentsBySearch"},reader:{root:"rows",totalProperty:"totals"}}}),Ext.define("App.model.patient.ReviewOfSystems",{extend:"Ext.data.Model",table:{name:"encounter_review_of_systems",comment:"Review of system"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"weight_change",type:"bool"},{name:"weakness",type:"bool"},{name:"fatigue",type:"bool"},{name:"anorexia",type:"bool"},{name:"fever",type:"bool"},{name:"chills",type:"bool"},{name:"night_sweats",type:"bool"},{name:"insomnia",type:"bool"},{name:"irritability",type:"bool"},{name:"heat_or_cold",type:"bool"},{name:"intolerance",type:"bool"},{name:"change_in_vision",type:"bool"},{name:"eye_pain",type:"bool"},{name:"family_history_of_glaucoma",type:"bool"},{name:"irritation",type:"bool"},{name:"redness",type:"bool"},{name:"excessive_tearing",type:"bool"},{name:"double_vision",type:"bool"},{name:"blind_spots",type:"bool"},{name:"photophobia",type:"bool"},{name:"hearing_loss",type:"bool"},{name:"discharge",type:"bool"},{name:"pain",type:"bool"},{name:"vertigo",type:"bool"},{name:"tinnitus",type:"bool"},{name:"frequent_colds",type:"bool"},{name:"sore_throat",type:"bool"},{name:"sinus_problems",type:"bool"},{name:"post_nasal_drip",type:"bool"},{name:"nosebleed",type:"bool"},{name:"snoring",type:"bool"},{name:"apnea",type:"bool"},{name:"breast_mass",type:"bool"},{name:"abnormal_mammogram",type:"bool"},{name:"biopsy",type:"bool"},{name:"cough",type:"bool"},{name:"sputum",type:"bool"},{name:"shortness_of_breath",type:"bool"},{name:"wheezing",type:"bool"},{name:"hemoptysis",type:"bool"},{name:"asthma",type:"bool"},{name:"copd",type:"bool"},{name:"thyroid_problems",type:"bool"},{name:"diabetes",type:"bool"},{name:"abnormal_blood_test",type:"bool"},{name:"chest_pain",type:"bool"},{name:"palpitation",type:"bool"},{name:"syncope",type:"bool"},{name:"pnd",type:"bool"},{name:"doe",type:"bool"},{name:"orthopnea",type:"bool"},{name:"peripheral",type:"bool"},{name:"edema",type:"bool"},{name:"leg_pain_cramping",type:"bool"},{name:"arrythmia",type:"bool"},{name:"heart_problem",type:"bool"},{name:"history_of_heart_murmur",type:"bool"},{name:"polyuria",type:"bool"},{name:"polydypsia",type:"bool"},{name:"dysuria",type:"bool"},{name:"hematuria",type:"bool"},{name:"frequency",type:"bool"},{name:"urgency",type:"bool"},{name:"utis",type:"bool"},{name:"incontinence",type:"bool"},{name:"renal_stones",type:"bool"},{name:"hesitancy",type:"bool"},{name:"dribbling",type:"bool"},{name:"stream",type:"bool"},{name:"nocturia",type:"bool"},{name:"erections",type:"bool"},{name:"ejaculations",type:"bool"},{name:"cancer",type:"bool"},{name:"psoriasis",type:"bool"},{name:"acne",type:"bool"},{name:"disease",type:"bool"},{name:"other",type:"bool"},{name:"anemia",type:"bool"},{name:"hiv",type:"bool"},{name:"f_h_blood_problems",type:"bool"},{name:"hai_status",type:"bool"},{name:"allergies",type:"bool"},{name:"bleeding_problems",type:"bool"},{name:"frequent_illness",type:"bool"},{name:"dysphagia",type:"bool"},{name:"heartburn",type:"bool"},{name:"food_intolerance",type:"bool"},{name:"belching",type:"bool"},{name:"bloating",type:"bool"},{name:"flatulence",type:"bool"},{name:"nausea",type:"bool"},{name:"vomiting",type:"bool"},{name:"jaundice",type:"bool"},{name:"h_o_hepatitis",type:"bool"},{name:"hematemesis",type:"bool"},{name:"diarrhea",type:"bool"},{name:"hematochezia",type:"bool"},{name:"changed_bowel",type:"bool"},{name:"constipation",type:"bool"},{name:"female_g",type:"bool"},{name:"female_p",type:"bool"},{name:"female_ap",type:"bool"},{name:"lmp",type:"bool"},{name:"female_lc",type:"bool"},{name:"menopause",type:"bool"},{name:"flow",type:"bool"},{name:"abnormal_hair_growth",type:"bool"},{name:"menarche",type:"bool"},{name:"symptoms",type:"bool"},{name:"f_h_female_hirsutism_striae",type:"bool"},{name:"anxiety",type:"bool"},{name:"depression",type:"bool"},{name:"psychiatric_medication",type:"bool"},{name:"social_difficulties",type:"bool"},{name:"psychiatric_diagnosis",type:"bool"},{name:"fms",type:"bool"},{name:"swelling",type:"bool"},{name:"warm",type:"bool"},{name:"muscle",type:"bool"},{name:"stiffness",type:"bool"},{name:"aches",type:"bool"},{name:"arthritis",type:"bool"},{name:"chronic_joint_pain",type:"bool"},{name:"loc",type:"bool"},{name:"stroke",type:"bool"},{name:"paralysis",type:"bool"},{name:"tia",type:"bool"},{name:"numbness",type:"bool"},{name:"memory_problems",type:"bool"},{name:"seizures",type:"bool"},{name:"intellectual_decline",type:"bool"},{name:"dementia",type:"bool"},{name:"headache",type:"bool"},{name:"cons_weakness",type:"bool"},{name:"brest_discharge",type:"bool"},{name:"fem_frequency",type:"bool"},{name:"notes",type:"string",dataType:"mediumtext"}],proxy:{type:"direct",api:{update:"Encounter.updateReviewOfSystems"}},belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"}}),Ext.define("App.model.patient.FamilyHistory",{extend:"Ext.data.Model",table:{name:"patient_family_history"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"condition",type:"string",len:60},{name:"condition_code",type:"string",len:60},{name:"condition_code_type",type:"string",len:60},{name:"relation",type:"string",len:60},{name:"relation_code",type:"string",len:60},{name:"relation_code_type",type:"string",len:60},{name:"notes",type:"string",dataType:"TEXT"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"FamilyHistory.getFamilyHistory",create:"FamilyHistory.addFamilyHistory",update:"FamilyHistory.updateFamilyHistory"},remoteGroup:!1},belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"},parsed_data:{primaryKey:"id",fields:["id","pid","eid","condition","condition_code","condition_code_type","relation","relation_code","relation_code_type","notes","create_uid","update_uid","create_date","update_date"],encryptedFields:!1,phantomFields:!1,arrayFields:!1,fieldsProperties:{id:{name:"id",type:"int"},pid:{name:"pid",type:"int",index:!0},eid:{name:"eid",type:"int",index:!0},condition:{name:"condition",type:"string",len:60},condition_code:{name:"condition_code",type:"string",len:60},condition_code_type:{name:"condition_code_type",type:"string",len:60},relation:{name:"relation",type:"string",len:60},relation_code:{name:"relation_code",type:"string",len:60},relation_code_type:{name:"relation_code_type",type:"string",len:60},notes:{name:"notes",type:"string",dataType:"TEXT"},create_uid:{name:"create_uid",type:"int"},update_uid:{name:"update_uid",type:"int"},create_date:{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},update_date:{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}}}}),Ext.define("App.model.fees.Checkout",{extend:"Ext.data.Model",table:{name:"checkout",comment:"Checkout"},fields:[{name:"id",type:"int",comment:"Checkout ID"},{name:"time",type:"string"},{name:"follow_up_facility",type:"string"},{name:"note",type:"string"},{name:"reminder",type:"string"},{name:"patient_name",type:"string"},{name:"encounter_number",type:"int"},{name:"transaction_facility",type:"string"},{name:"transaction_number",type:"int"},{name:"transaction_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"payment_amount",type:"string"},{name:"paying_entity",type:"string"},{name:"post_to_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"check_number",type:"int"}],proxy:{type:"direct",api:{read:"Fees.getPaymentsBySearch"},reader:{root:"rows",totalProperty:"totals"}}}),Ext.define("App.model.navigation.Navigation",{extend:"Ext.data.Model",fields:[{name:"text",type:"string"},{name:"disabled",type:"bool",defaultValue:!1}],proxy:{type:"direct",api:{read:"Navigation.getNavigation"}}}),Ext.define("App.model.fees.EncountersPayments",{extend:"Ext.data.Model",table:{name:"encounterspayments",comment:"Encounters Payments"},fields:[{name:"id",type:"int",dataType:"bigint",len:20,primaryKey:!0,autoIncrement:!0,allowNull:!1,store:!0,comment:"Encounter Payments ID"},{name:"paying_entity",type:"string"},{name:"payment_from",type:"string"},{name:"no",type:"int"},{name:"payment_method",type:"string"},{name:"pay_to",type:"string"},{name:"amount",type:"string"},{name:"date_from",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"date_to",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"note",type:"string"}],proxy:{type:"direct",api:{read:"Fees.getPaymentsBySearch"},reader:{root:"rows",totalProperty:"totals"}}}),Ext.define("App.model.patient.Dictation",{extend:"Ext.data.Model",table:{name:"encounter_dictation"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"dictation",type:"string",dataType:"longtext"},{name:"additional_notes",type:"string",dataType:"longtext"}],proxy:{type:"direct",api:{read:"Dictation.getDictations",create:"Dictation.addDictation",update:"Dictation.updateDictation"}},belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"}}),Ext.define("App.model.patient.PhysicalExam",{extend:"Ext.data.Model",table:{name:"patient_physical_exams"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"exam_data",type:"array"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"PhysicalExams.getPhysicalExams",create:"PhysicalExams.addPhysicalExam",update:"PhysicalExams.updatePhysicalExam"},writer:{writeAllFields:!0}}}),Ext.define("App.model.patient.encounter.Procedures",{extend:"Ext.data.Model",table:{name:"encounter_procedures",comment:"Patient Encounter Procedures"},fields:[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"performer_id",type:"int"},{name:"procedure_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"code",type:"string",len:40},{name:"code_text",type:"string",len:300},{name:"code_type",type:"string",len:15},{name:"status_code",type:"string",len:40},{name:"status_code_text",type:"string",len:300},{name:"status_code_type",type:"string",len:15},{name:"target_site_code",type:"string",len:40},{name:"target_site_code_text",type:"string",len:300},{name:"target_site_code_type",type:"string",len:15},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"encounter_dx_id",type:"int"},{name:"observation",type:"string"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Procedures.loadProcedures",create:"Procedures.saveProcedure",update:"Procedures.saveProcedure",destroy:"Procedures.destroyProcedure"}}}),Ext.define("App.model.patient.EducationResource",{extend:"Ext.data.Model",requires:[],table:{name:"patient_education_resources"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"uid",type:"int"},{name:"title",type:"string",len:300},{name:"url",type:"string",dataType:"text"},{name:"snippet",type:"string",dataType:"text"},{name:"organization_name",type:"string",dataType:"text"},{name:"provided_date",type:"date",dateFormat:"Y-m-d"}],proxy:{type:"direct",api:{read:"EducationResources.getPatientEducationResources",create:"EducationResources.addPatientEducationResource",update:"EducationResources.updatePatientEducationResource",destroy:"EducationResources.destroyPatientEducationResource"},remoteGroup:!1}}),Ext.define("App.model.patient.AppointmentRequest",{extend:"Ext.data.Model",table:{name:"patient_appointment_requests"},fields:[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"appointment_id",type:"int"},{name:"requested_uid",type:"int"},{name:"approved_uid",type:"int"},{name:"is_approved",type:"bool",persist:!1,convert:function(a,b){return b.data.approved_uid>1
}},{name:"requested_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"approved_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"notes",type:"string"},{name:"procedure1",type:"string",len:180},{name:"procedure1_code",type:"string",len:10},{name:"procedure1_code_type",type:"string",len:10},{name:"procedure2",type:"string",len:180},{name:"procedure2_code",type:"string",len:10},{name:"procedure2_code_type",type:"string",len:10},{name:"procedure3",type:"string",len:180},{name:"procedure3_code",type:"string",len:10},{name:"procedure3_code_type",type:"string",len:10},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"}],proxy:{type:"direct",api:{read:"AppointmentRequest.getAppointmentRequests",create:"AppointmentRequest.addAppointmentRequest",update:"AppointmentRequest.updateAppointmentRequest",destroy:"AppointmentRequest.deleteAppointmentRequest"}}}),Ext.define("App.model.patient.AdvanceDirective",{extend:"Ext.data.Model",table:{name:"patient_advance_directives"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"code",type:"string",len:80},{name:"code_text",type:"string",len:160},{name:"code_type",type:"string",len:20},{name:"status_code",type:"string",len:80},{name:"status_code_text",type:"string",len:160},{name:"status_code_type",type:"string",len:20},{name:"notes",len:300,type:"string"},{name:"start_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"end_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"verified_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"verified_uid",type:"int"},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s",defaultValue:"CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"}],proxy:{type:"direct",api:{read:"AdvanceDirective.getPatientAdvanceDirectives",create:"AdvanceDirective.addPatientAdvanceDirective",update:"AdvanceDirective.updatePatientAdvanceDirective"}}}),Ext.define("App.model.patient.Dental",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Dental Data ID"},{name:"eid",type:"int"},{name:"pid",type:"int"},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"cdt_code",type:"string"},{name:"description",type:"string"},{name:"begin_date",type:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dateFormat:"Y-m-d"},{name:"ocurrence",type:"string"},{name:"referred_by",type:"string"},{name:"outcome",type:"string"},{name:"destination",type:"string"},{name:"alert",type:"bool"}],proxy:{type:"direct",api:{read:"Medical.getPatientDental",create:"Medical.addPatientDental",update:"Medical.updatePatientDental"}}}),Ext.define("App.model.patient.Allergies",{extend:"Ext.data.Model",table:{name:"patient_allergies",comment:"Patient Allergies"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"allergy_type",type:"string",len:80},{name:"allergy_type_code",type:"string",len:20},{name:"allergy_type_code_type",type:"string",len:20},{name:"allergy",len:80,type:"string"},{name:"allergy_code",type:"string",len:20,comment:"RxNORM RXCUI code if food allergy"},{name:"allergy_code_type",len:20,type:"string"},{name:"location",len:80,type:"string"},{name:"reaction",len:80,type:"string"},{name:"reaction_code",len:20,type:"string"},{name:"reaction_code_type",len:20,type:"string"},{name:"severity",len:80,type:"string"},{name:"severity_code",len:20,type:"string"},{name:"severity_code_type",len:20,type:"string"},{name:"status",len:15,type:"string"},{name:"status_code",len:20,type:"string"},{name:"status_code_type",len:20,type:"string"},{name:"begin_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"reconciled",type:"bool",index:!0},{name:"reconciled_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"active",type:"bool",store:!1,convert:function(a,b){return""==b.data.end_date||null==b.data.end_date}},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s",defaultValue:"CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"},{name:"source",type:"string",store:!1}],proxy:{type:"direct",api:{read:"Allergies.getPatientAllergies",create:"Allergies.addPatientAllergy",update:"Allergies.updatePatientAllergy"}}}),Ext.define("App.model.patient.CptCodes",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"CPY Code ID"},{name:"eid",type:"int"},{name:"code",type:"string"},{name:"code_text",type:"string"},{name:"code_text_medium",type:"string"},{name:"place_of_service",type:"string"},{name:"emergency",type:"bool"},{name:"charge",type:"string"},{name:"days_of_units",type:"string"},{name:"essdt_plan",type:"string"},{name:"modifiers",type:"string"},{name:"status",type:"int",defaultValue:0}],proxy:{type:"direct",api:{read:"Services.getCptCodes",create:"Services.addCptCode",update:"Services.updateCptCode",destroy:"Services.deleteCptCode"},reader:{root:"rows",totalProperty:"totals"}}}),Ext.define("App.model.patient.Disclosures",{extend:"Ext.data.Model",table:{name:"patient_disclosures",comment:"Disclosures"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"type",type:"string",len:25},{name:"recipient",type:"string",len:25},{name:"status",type:"string",len:25},{name:"description",type:"string",dataType:"text"},{name:"request_date",type:"date",dateFormat:"Y-m-d H:i:s",useNull:!0},{name:"fulfil_date",type:"date",dateFormat:"Y-m-d H:i:s",useNull:!0},{name:"pickup_date",type:"date",dateFormat:"Y-m-d H:i:s",useNull:!0},{name:"pickup_signature",type:"string",dataType:"text"},{name:"active",type:"bool"},{name:"document_inventory",type:"string",store:!1},{name:"document_inventory_ids",type:"string",store:!1},{name:"document_inventory_count",type:"int",store:!1},{name:"document_file_paths",type:"string",store:!1}],proxy:{type:"direct",api:{read:"Disclosure.getDisclosures",create:"Disclosure.addDisclosure",update:"Disclosure.updateDisclosure"}}}),Ext.define("App.model.patient.DismissedAlerts",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Dismissed Alerts ID"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"preventive_care_id",type:"int"},{name:"reason",type:"string"},{name:"observation",type:"string"},{name:"dismiss",type:"bool"},{name:"description",type:"string"}],proxy:{type:"direct",api:{read:"PreventiveCare.getPreventiveCareDismissedAlertsByPid",update:"PreventiveCare.updatePreventiveCareDismissedAlertsByPid"}}}),Ext.define("App.model.patient.CheckoutAlertArea",{extend:"Ext.data.Model",table:{name:"checkoutalertarea",comment:"Checkout Alert Area"},fields:[{name:"id",type:"int",comment:"Checkout Alert ID"},{name:"alert",type:"string"},{name:"alertType",type:"int"}],proxy:{type:"direct",api:{read:"Encounter.checkoutAlerts"}}}),Ext.define("App.model.patient.DoctorsNote",{extend:"Ext.data.Model",table:{name:"patient_doctors_notes"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"template_id",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"order_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"from_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"to_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"restrictions",type:"array"},{name:"string_restrictions",type:"string",store:!1,convert:function(a,b){return b.data.restrictions?b.data.restrictions.join?b.data.restrictions.join(", "):b.data.restrictions:""}},{name:"group_date",type:"date",dateFormat:"Y-m-d",store:!1,convert:function(a,b){return Ext.Date.format(b.data.date,"Y-m-d")}},{name:"comments",type:"string",dataType:"text"}],proxy:{type:"direct",api:{read:"DoctorsNotes.getDoctorsNotes",create:"DoctorsNotes.addDoctorsNote",update:"DoctorsNotes.updateDoctorsNote",destroy:"DoctorsNotes.destroyDoctorsNote"}}}),Ext.define("App.model.patient.EventHistory",{extend:"Ext.data.Model",table:{name:"encounter_history"},fields:[{name:"id",type:"int",comment:"Event History ID"},{name:"eid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"user",type:"string",len:80},{name:"event",type:"string",len:600}]}),Ext.define("App.model.patient.ImmunizationCheck",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Immunization Check ID"},{name:"pid",type:"int"},{name:"code",type:"int"},{name:"vaccine_name",type:"string"},{name:"alert",type:"bool"}],proxy:{type:"direct",api:{read:"Immunizations.getPatientImmunizations"}}}),Ext.define("App.model.patient.CVXCodes",{extend:"Ext.data.Model",table:{name:"cvx_codes",comment:"Immunizations  CVX"},fields:[{name:"id",type:"int",comment:"Immunization ID"},{name:"cvx_code",type:"int",len:10},{name:"name",type:"string"},{name:"description",type:"string",dataType:"text"},{name:"note",type:"string",dataType:"text"},{name:"status",type:"string",len:25},{name:"quick_form",type:"bool",index:!0},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Immunizations.getImmunizationsList"}}}),Ext.define("App.model.patient.Encounter",{extend:"Ext.data.Model",requires:["App.model.patient.PhysicalExam"],table:{name:"encounters",comment:"Encounter Data"},fields:[{name:"eid",type:"int"},{name:"parent_eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"rid",type:"string",len:80,comment:"reference ID"},{name:"open_uid",type:"int",index:!0},{name:"provider_uid",type:"int",index:!0},{name:"supervisor_uid",type:"int",index:!0},{name:"requires_supervisor",type:"bool",index:!0,defaultValue:!1},{name:"technician_uid",type:"int",useNull:!0,index:!0},{name:"specialty_id",type:"int",useNull:!0,index:!0},{name:"is_private",type:"bool",index:!0},{name:"service_date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"close_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"onset_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"priority",type:"string",len:60},{name:"brief_description",type:"string",len:600,comment:"chief complaint"},{name:"visit_category",type:"string",len:80},{name:"visit_category_code",type:"string",len:20},{name:"visit_category_code_type",type:"string",len:10},{name:"facility",type:"int",len:1,index:!0},{name:"facility_name",type:"string",store:!1},{name:"billing_stage",type:"int",len:1,index:!0},{name:"followup_time",type:"string",len:25},{name:"followup_facility",type:"string",len:80},{name:"review_immunizations",type:"bool"},{name:"review_allergies",type:"bool"},{name:"review_active_problems",type:"bool"},{name:"review_alcohol",type:"string",len:40},{name:"review_smoke",type:"bool"},{name:"review_pregnant",type:"string",len:40},{name:"review_surgery",type:"bool"},{name:"review_dental",type:"bool"},{name:"review_medications",type:"bool"},{name:"review_advance_directives",type:"bool"},{name:"review_implantable_devices",type:"bool"},{name:"review_pain_scales",type:"bool"},{name:"message",type:"string",dataType:"text"},{name:"patient_class",type:"string"},{name:"referring_physician",type:"int",useNull:!0},{name:"patient_education_given",type:"bool"},{name:"medication_reconciliations",type:"bool"},{name:"medication_reconciliations_date",type:"date",dateFormat:"Y-m-d"},{name:"summary_care_provided",type:"bool"},{name:"summary_care_requested",type:"bool"},{name:"provider_title",type:"string",store:!1},{name:"provider_fname",type:"string",store:!1},{name:"provider_mname",type:"string",store:!1},{name:"provider_lname",type:"string",store:!1},{name:"provider_npi",type:"string",store:!1},{name:"provider_signature",type:"string",store:!1},{name:"referring_physician_fname",type:"string",store:!1},{name:"referring_physician_mname",type:"string",store:!1},{name:"referring_physician_lname",type:"string",store:!1},{name:"referring_physician_npi",type:"string",store:!1},{name:"referring_physician_phone",type:"string",store:!1}],idProperty:"eid",proxy:{type:"direct",api:{read:"Encounter.getEncounters",create:"Encounter.createEncounter",update:"Encounter.updateEncounter"},reader:{root:"encounter"}},hasMany:[{model:"App.model.patient.ReviewOfSystems",name:"reviewofsystems",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.FamilyHistory",name:"familyhistory",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.SOAP",name:"soap",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.HCFAOptions",name:"hcfaoptions",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.EncounterService",name:"services",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.AppointmentRequest",name:"appointmentrequests",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.EducationResource",name:"educationresources",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.PhysicalExam",name:"physicalexams",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.Dictation",name:"dictation",primaryKey:"eid",foreignKey:"eid"}],isPrivate:function(){return this.get("is_private")},isClose:function(){return"undefined"!=typeof this.data.close_date&&null!=this.data.close_date},isSigned:function(){return"undefined"!=typeof this.data.provider_uid&&null!=this.data.provider_uid&&0!=this.data.provider_uid},isCoSigned:function(){return"undefined"!=typeof this.data.supervisor_uid&&null!=this.data.supervisor_uid&&0!=this.data.supervisor_uid}}),Ext.define("App.model.patient.LaboratoryTypes",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Laboratory Types ID"},{name:"label",type:"string"},{name:"fields"}],proxy:{type:"direct",api:{read:"Laboratories.getActiveLaboratoryTypes"}}}),Ext.define("App.model.patient.MeaningfulUseAlert",{extend:"Ext.data.Model",table:{name:"meaningfulusealert",comment:"Meaningful Use Alert"},fields:[{name:"id",type:"int",comment:"Meaningful Use Alert ID"},{name:"name",type:"string"},{name:"val",type:"bool"}],proxy:{type:"direct",api:{read:"Patient.getMeaningfulUserAlertByPid"}}}),Ext.define("App.model.patient.Notes",{extend:"Ext.data.Model",table:{name:"patient_notes"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"body",type:"string"},{name:"type",type:"string"},{name:"list_key",type:"string"},{name:"user_fname",type:"string",store:!1},{name:"user_mname",type:"string",store:!1},{name:"user_lname",type:"string",store:!1},{name:"update_user_fname",type:"string",store:!1},{name:"update_user_mname",type:"string",store:!1},{name:"update_user_lname",type:"string",store:!1},{name:"user_name",type:"string",convert:function(a,b){return Ext.String.format("{0}, {1} {2}",b.get("user_lname"),b.get("user_fname"),b.get("user_mname"))},store:!1},{name:"update_user_name",type:"string",convert:function(a,b){return Ext.String.format("{0}, {1} {2}",b.get("update_user_lname"),b.get("update_user_fname"),b.get("update_user_mname"))},store:!1},{name:"external_id",type:"string"},{name:"global_id",type:"string"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Notes.getNotes",create:"Notes.addNote",update:"Notes.updateNote",destroy:"Notes.destroyNote"},reader:{root:"data"},writer:{writeAllFields:!0}}}),Ext.define("App.model.patient.PatientContacts",{extend:"Ext.data.Model",table:{name:"patient_contacts",comment:"Patient Contacts"},fields:[{name:"id",type:"int",index:!0},{name:"pid",type:"int"},{name:"uid",type:"int"},{name:"first_name",type:"string",len:100},{name:"middle_name",type:"string",len:100},{name:"last_name",type:"string",len:100},{name:"fullname",type:"string",store:!1,convert:function(a,b){return b.data.first_name+" "+b.data.middle_name+" "+b.data.last_name}},{name:"relationship",type:"string",len:20},{name:"relationship_name",type:"string",len:20,store:!1},{name:"street_mailing_address",type:"string",len:200},{name:"city",type:"string",len:70},{name:"state",type:"string",len:70},{name:"zip",type:"string",len:20},{name:"country",type:"string",len:20},{name:"phone_use_code",type:"string",len:17},{name:"phone_area_code",type:"string",len:17},{name:"phone_local_number",type:"string",len:17},{name:"phone_compiled",type:"string",store:!1,convert:function(a,b){return b.data.phone_use_code+"("+b.data.phone_area_code+")"+b.data.phone_local_number}},{name:"contact_role",type:"string",len:17},{name:"publicity",type:"string",len:3},{name:"active",type:"bool"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"id",proxy:{type:"direct",api:{read:"PatientContacts.getContacts",create:"PatientContacts.addContact",update:"PatientContacts.updateContact"}}}),Ext.define("App.model.patient.Medications",{extend:"Ext.data.Model",table:{name:"patient_medications",comment:"Patient Medications"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"ref_order",type:"string",len:100,comment:"reference order number"},{name:"STR",type:"string",len:180},{name:"CODE",type:"string",len:40},{name:"RXCUI",type:"string",len:40},{name:"GS_CODE",type:"string",len:40,comment:"Gold Standard code"},{name:"NDC",type:"string",len:40},{name:"TTY",type:"string",len:10},{name:"dxs",type:"array"},{name:"dose",type:"string",len:180},{name:"form",type:"string",len:80},{name:"route",type:"string",len:80},{name:"directions",type:"string"},{name:"dispense",type:"string",len:80},{name:"refill",type:"string",len:80},{name:"potency_code",type:"string",len:10},{name:"days_supply",type:"int",useNull:!0},{name:"daw",type:"bool",useNull:!0,comment:"Dispensed As Written"},{name:"notes",type:"string",len:210},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"system_notes",type:"string",len:210},{name:"requires_prescription",type:"bool"},{name:"is_active",type:"bool"},{name:"is_controlled",type:"bool"},{name:"is_compound",type:"bool"},{name:"is_supply",type:"bool"},{name:"prescription_id",type:"int"},{name:"referred_by",type:"string",len:180},{name:"administer_in_house",type:"bool"},{name:"administered_uid",type:"int"},{name:"administered_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"administered_by",type:"string",store:!1,convert:function(a,b){return b.data.title+" "+b.data.fname+" "+b.data.mname+" "+b.data.lname}},{name:"title",type:"string",store:!1},{name:"fname",type:"string",store:!1},{name:"mname",type:"string",store:!1},{name:"lname",type:"string",store:!1},{name:"date_ordered",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"begin_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"reconciled",type:"bool",index:!0},{name:"reconciled_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"active",type:"bool",store:!1,convert:function(a,b){return null===b.data.end_date}},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"overridden",type:"bool",comment:"This is used by the Drug-To-Drug Interactions (MODULE)"},{name:"source",type:"string",store:!1}],proxy:{type:"direct",api:{read:"Medications.getPatientMedications",create:"Medications.addPatientMedication",update:"Medications.updatePatientMedication",destroy:"Medications.destroyPatientMedication"},writer:{writeAllFields:!0},remoteGroup:!1}}),Ext.define("App.model.patient.Insurance",{extend:"Ext.data.Model",table:{name:"patient_insurances",comment:"Patient Insurances"},fields:[{name:"id",type:"int"},{name:"external_id",type:"string",len:80,index:!0},{name:"code",type:"string",len:40,index:!0},{name:"ins_synonym",type:"string",len:15,store:!1},{name:"ins_name",type:"string",store:!1},{name:"pid",type:"int",index:!0},{name:"insurance_id",type:"int",useNull:!0,index:!0},{name:"insurance_type",type:"string",comment:"P = primary S = supplemental C =complementary",len:1,index:!0},{name:"effective_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"expiration_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"group_number",type:"string",comment:"group number",len:40},{name:"policy_number",type:"string",len:40},{name:"rx_member_id",type:"string",len:40},{name:"rx_group",type:"string",len:40},{name:"rx_bin",type:"string",len:40},{name:"rx_pcn",type:"string",len:40},{name:"cover_description",type:"string",len:50},{name:"card_first_name",type:"string",len:35},{name:"card_middle_name",type:"string",len:25},{name:"card_last_name",type:"string",len:80},{name:"subscriber_policy_number",type:"string",len:40},{name:"subscriber_title",type:"string",len:10},{name:"subscriber_given_name",type:"string",len:35},{name:"subscriber_middle_name",type:"string",len:25},{name:"subscriber_surname",type:"string",len:60},{name:"subscriber_relationship",type:"string",len:1},{name:"subscriber_sex",type:"string",len:1},{name:"subscriber_dob",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"subscriber_ss",type:"string",len:10},{name:"subscriber_street",type:"string",len:110},{name:"subscriber_street_cont",type:"string",len:110},{name:"subscriber_city",type:"string",len:30},{name:"subscriber_state",type:"string",len:2},{name:"subscriber_country",type:"string",len:3},{name:"subscriber_postal_code",type:"string",len:15},{name:"subscriber_phone",type:"string",len:25},{name:"subscriber_employer",type:"string",len:60},{name:"display_order",type:"int",len:3},{name:"notes",type:"string",len:320},{name:"cover_exceptions",type:"string"},{name:"deductible",type:"string"},{name:"msp_insurance_type",type:"string"},{name:"image",type:"string",dataType:"mediumtext",comment:"insurance image base64 string"},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Insurance.getInsurances",create:"Insurance.addInsurance",update:"Insurance.updateInsurance"},writer:{writeAllFields:!0}},associations:[{type:"belongsTo",model:"App.model.patient.Patient",associationKey:"pid",foreignKey:"pid"}]}),Ext.define("App.model.patient.PatientArrivalLog",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Patient Arrival Log ID"},{name:"area_id",type:"int"},{name:"pid",type:"int"},{name:"time",type:"string"},{name:"name",type:"string"},{name:"status",type:"string"},{name:"area",type:"string"},{name:"warning",type:"bool"},{name:"warningMsg",type:"string"},{name:"isNew",type:"bool"}],proxy:{type:"direct",api:{read:"PoolArea.getPatientsArrivalLog",create:"PoolArea.addPatientArrivalLog",update:"PoolArea.updatePatientArrivalLog",destroy:"PoolArea.removePatientArrivalLog"},writer:{writeAllFields:!0}}}),Ext.define("App.model.patient.PatientActiveProblem",{extend:"Ext.data.Model",table:{name:"patient_active_problems",comment:"Active Problems"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"code",type:"string",len:80},{name:"code_text",type:"string",len:300},{name:"code_type",type:"string",len:20},{name:"begin_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"occurrence",type:"string"},{name:"referred_by",type:"string"},{name:"status",type:"string",len:20},{name:"status_code",type:"string",len:20},{name:"status_code_type",type:"string",len:20},{name:"problem_type",type:"string",len:20},{name:"problem_type_code",type:"string",len:20},{name:"problem_type_code_type",type:"string",len:20},{name:"note",type:"string",len:300},{name:"reconciled",type:"bool",index:!0},{name:"reconciled_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"active",type:"bool",store:!1,convert:function(a,b){return""==b.data.end_date||null==b.data.end_date}},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"source",type:"string",store:!1}],proxy:{type:"direct",api:{read:"ActiveProblems.getPatientActiveProblems",create:"ActiveProblems.addPatientActiveProblem",update:"ActiveProblems.updatePatientActiveProblem",destroy:"ActiveProblems.destroyPatientActiveProblem"}}}),Ext.define("App.model.patient.PatientDocuments",{extend:"Ext.data.Model",table:{name:"patient_documents",comment:"Patient Documents Storage"},fields:[{name:"id",type:"int"},{name:"global_id",type:"string",len:40,useNull:!0,index:!0},{name:"code",type:"string",len:120,comment:"external reference id",index:!0},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"facility_id",type:"int",index:!0},{name:"docType",type:"string",index:!0},{name:"docTypeCode",type:"string",len:20,index:!0},{name:"filesystem_id",type:"int",index:!0},{name:"path",type:"string"},{name:"name",type:"string"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"note",type:"string",dataType:"MEDIUMTEXT"},{name:"title",type:"string"},{name:"hash",type:"string"},{name:"encrypted",type:"bool",defaultValue:0},{name:"entered_in_error",type:"bool",defaultValue:0},{name:"error_note",type:"string",len:300},{name:"groupDate",type:"string",store:!1,convert:function(a,b){return Ext.util.Format.date(b.get("date"),g("date_display_format"))}},{name:"document_instance",type:"string",len:10},{name:"document_id",type:"int"},{name:"document",type:"string",dataType:"longblob"},{name:"site",type:"string",store:!1,useNull:!0},{name:"pubpid",type:"string",store:!1},{name:"order_number",type:"string",store:!1},{name:"accession_number",type:"string",store:!1},{name:"disabled_selection",type:"bool",persist:!1,defaultValue:!1}],proxy:{type:"direct",api:{read:"DocumentHandler.getPatientDocuments",create:"DocumentHandler.addPatientDocument",update:"DocumentHandler.updatePatientDocument"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.model.patient.PatientLabsResults",{extend:"Ext.data.Model",table:{name:"patientlabsresults",comment:"Patient Labs Results"},fields:[{name:"id",type:"int",comment:"Patient Labs Results ID"},{name:"pid",type:"int"},{name:"uid",type:"int"},{name:"auth_uid",type:"int"},{name:"eid",type:"int"},{name:"document_id",type:"int"},{name:"document_url"},{name:"date",type:"date",dateFormat:"Y-m-d H:s:i"},{name:"data"},{name:"columns"},{name:"parent_id"}],proxy:{type:"direct",api:{read:"Medical.getPatientLabsResults",create:"Medical.addPatientLabsResult",update:"Medical.updatePatientLabsResult",destroy:"Medical.deletePatientLabsResult"}}}),Ext.define("App.model.patient.PatientCalendarEvents",{extend:"Ext.data.Model",table:{name:"patientcalendarevents",comment:"Patient Calendar Events"},fields:[{name:"id",type:"int",comment:"Patient Calendar Event ID"},{name:"user_id",type:"int"},{name:"category",type:"int"},{name:"facility",type:"int"},{name:"billing_facillity",type:"int"},{name:"patient_id",type:"int"},{name:"title",type:"string"},{name:"status",type:"string"},{name:"start",type:"date",dateFormat:"Y-m-d H:s:i"},{name:"end",type:"date",dateFormat:"Y-m-d H:s:i"},{name:"data",type:"string"},{name:"rrule",type:"string"},{name:"loc",type:"string"},{name:"notes",type:"string"},{name:"url",type:"string"},{name:"ad",type:"string"}],proxy:{type:"direct",api:{read:"Calendar.getPatientFutureEvents"}}}),Ext.define("App.model.patient.PatientImmunization",{extend:"Ext.data.Model",table:{name:"patient_immunizations",comment:"Patient Immunization"},fields:[{name:"id",type:"int",comment:"Patient Immunization ID"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"facility_id",type:"int",index:!0},{name:"uid",type:"int"},{name:"ndc",type:"string",len:25},{name:"code",type:"string",len:20},{name:"code_type",type:"string",defaultValue:"CVX",len:15},{name:"vaccine_name",type:"string",len:300},{name:"lot_number",type:"string",len:60},{name:"administer_amount",type:"string",len:40},{name:"administer_units",type:"string",len:40},{name:"administered_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"exp_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"administered_uid",type:"int"},{name:"administered_by",type:"string",store:!1,convert:function(a,b){return b.data.administered_title+" "+b.data.administered_fname+" "+(b.data.administered_mname||"")+" "+b.data.administered_lname}},{name:"administered_title",type:"string",store:!1},{name:"administered_fname",type:"string",store:!1},{name:"administered_mname",type:"string",store:!1},{name:"administered_lname",type:"string",store:!1},{name:"route",type:"string",len:40},{name:"administration_site",type:"string",len:40},{name:"manufacturer",type:"string",len:180},{name:"education_resource_1_id",type:"int"},{name:"education_resource_2_id",type:"int"},{name:"education_resource_3_id",type:"int"},{name:"education_presented_1_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"education_presented_2_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"education_presented_3_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"vfc_code",type:"string",len:40},{name:"information_source_code",type:"string",len:10},{name:"refusal_reason_code",type:"string",len:10},{name:"is_presumed_immunity",type:"bool"},{name:"presumed_immunity_code",type:"string",len:20},{name:"note",type:"string",len:300},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"status",type:"string",len:40},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"is_error",type:"bool"},{name:"error_note",type:"string",len:300}],proxy:{type:"direct",api:{read:"Immunizations.getPatientImmunizations",create:"Immunizations.addPatientImmunization",update:"Immunizations.updatePatientImmunization"}}}),Ext.define("App.model.patient.PatientsPrescriptionMedications",{extend:"Ext.data.Model",table:{name:"patient_medications",comment:"Patient Medications"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"prescription_id",type:"int"},{name:"STR",type:"string",len:180},{name:"CODE",type:"string",len:40},{name:"RXCUI",type:"string",len:40},{name:"NDC",type:"string",len:40},{name:"dxs",type:"string"},{name:"dose",type:"string",len:180},{name:"form",type:"string",len:80},{name:"route",type:"string",len:80},{name:"directions",type:"string"},{name:"dispense",type:"string",len:80},{name:"refill",type:"string",len:80},{name:"daw",type:"bool"},{name:"notes",type:"string",len:300},{name:"referred_by",type:"string",len:180},{name:"date_ordered",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"begin_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"end_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"active",type:"bool",store:!1,convert:function(a,b){return null==b.data.end_date}}]}),Ext.define("App.model.patient.PatientsLabOrderItems",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"loinc",type:"string"},{name:"title",type:"string"}]}),Ext.define("App.model.patient.PatientsOrderObservation",{extend:"Ext.data.TreeModel",table:{name:"patient_order_results_observations",comment:"Order Result Observations OBX"},fields:[{name:"id",type:"int"},{name:"result_id",type:"int",index:!0,comment:"Result ID"},{name:"parent_id",type:"int",index:!0,comment:"Parent ID"},{name:"code",type:"string",comment:"OBX 3",index:!0},{name:"code_text",type:"string",comment:"OBX 3"},{name:"code_type",type:"string",comment:"OBX 3"},{name:"value",type:"string",comment:"OBX 5"},{name:"units",type:"string",comment:"OBX 6"},{name:"reference_rage",type:"string",comment:"OBX 7"},{name:"probability",type:"string",comment:"OBX 9"},{name:"abnormal_flag",type:"string",comment:"OBX 8"},{name:"nature_of_abnormal",type:"string",comment:"OBX 10"},{name:"observation_result_status",type:"string",comment:"OBX 11"},{name:"date_rage_values",type:"date",dateFormat:"Y-m-d H:i:s",comment:"OBX 12 Effective Date of Reference Range Values"},{name:"date_observation",type:"date",dateFormat:"Y-m-d H:i:s",comment:"OBX 14"},{name:"observer",type:"string",comment:"OBX 16"},{name:"performing_org_name",type:"string",comment:"OBX 23"},{name:"performing_org_address",type:"string",comment:"OBX 24"},{name:"observer",type:"string",comment:"OBX 16"},{name:"date_analysis",type:"date",dateFormat:"Y-m-d H:i:s",comment:"OBX 19"},{name:"notes",type:"string",comment:"OBX NTE segments"}],proxy:{type:"direct",api:{read:"Orders.getOrderResultObservations",create:"Orders.addOrderResultObservations",update:"Orders.updateOrderResultObservations",destroy:"Orders.deleteOrderResultObservations"},remoteGroup:!1}}),Ext.define("App.model.patient.PatientSocialHistory",{extend:"Ext.data.Model",table:{name:"patient_social_history",comment:"Patient Social History"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0,comment:"encounter id"},{name:"pid",type:"int",index:!0,comment:"patient ID"},{name:"category_code",type:"string",len:25},{name:"category_code_type",type:"string",defaultValue:"SNOMEDCT",len:20},{name:"category_code_text",len:120,type:"string"},{name:"observation",type:"string",len:400,comment:"clinical observation for this history"},{name:"observation_code",type:"string",len:20},{name:"observation_code_type",type:"string",len:20},{name:"note",type:"string",dataType:"text"},{name:"start_date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"same as CCD low time"},{name:"end_date",type:"date",dateFormat:"Y-m-d H:i:s",comment:"same as CCD high time"},{name:"create_uid",type:"int",comment:"user ID who created the record"},{name:"update_uid",type:"int",comment:"user ID who updated the record"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"SocialHistory.getSocialHistories",create:"SocialHistory.addSocialHistory",update:"SocialHistory.updateSocialHistory",destroy:"SocialHistory.destroySocialHistory"},remoteGroup:!1}}),Ext.define("App.model.patient.PatientsOrderResult",{extend:"Ext.data.Model",requires:["App.model.patient.PatientsOrderObservation"],table:{name:"patient_order_results",comment:"Patients Results OBR"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"study_uid",type:"string",index:!0,len:160,comment:"ID for external integration. Usually used for radilogy studies"},{name:"ordered_uid",type:"int",index:!0},{name:"signed_uid",type:"int",index:!0},{name:"order_id",type:"int",index:!0,comment:"OBR-2"},{name:"code",type:"string",len:40},{name:"code_text",type:"string",len:150},{name:"code_type",type:"string",len:20},{name:"performer_order_id",type:"string",len:50,index:!0,comment:"OBR-3"},{name:"performer_id",type:"int",index:!0},{name:"performer_name",type:"string",len:150},{name:"performer_address",type:"string",len:200},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"result_date",type:"date",dateFormat:"Y-m-d",index:!0},{name:"observation_date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"result_status",type:"string",len:40},{name:"reason_code",type:"string",len:40},{name:"specimen_code",type:"string",len:40},{name:"specimen_text",type:"string",len:180},{name:"specimen_code_type",type:"string",len:40},{name:"report_body",type:"string",dataType:"mediumtext"},{name:"documentId",type:"string",comment:"this is the document or hl7 message id - example -> doc|123 or hl7|123",len:40},{name:"upload",type:"string",store:!1},{name:"void",type:"bool",defaultValue:!1,comment:"VOID the order"},{name:"void_comment",type:"string",comment:"VOID comments",len:100},{name:"specimen_notes",type:"string",len:600},{name:"study_link",type:"string",len:600}],proxy:{type:"direct",api:{read:"Orders.getOrderResults",create:"Orders.addOrderResults",update:"Orders.updateOrderResults",destroy:"Orders.deleteOrderResults"},remoteGroup:!1},associations:[{type:"hasMany",model:"App.model.patient.PatientsOrderObservation",name:"observations",primaryKey:"id",foreignKey:"result_id",storeConfig:{type:"tree",autoLoad:!1,clearOnLoad:!0}},{type:"belongsTo",model:"App.model.patient.PatientsOrders",getterName:"getOrder",setterName:"setOrder",primaryKey:"id",foreignKey:"order_id"}]}),Ext.define("App.model.patient.PatientsOrders",{extend:"Ext.data.Model",requires:["App.model.patient.PatientsOrderResult"],table:{name:"patient_orders",comment:"Patients Orders"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0,comment:"encounter id"},{name:"pid",type:"int",index:!0,comment:"patient ID"},{name:"uid",type:"int",comment:"user ID who created the order"},{name:"hl7_recipient_id",type:"int",comment:"laboratory id if electronic request"},{name:"code",type:"string",len:25,comment:"Order code"},{name:"code_type",type:"string",defaultValue:"LOINC",len:15,comment:"Order code type LOINC"},{name:"description",type:"string",comment:"Order Text Description"},{name:"date_ordered",type:"date",dateFormat:"Y-m-d H:i:s",comment:"when the order was generated",index:!0},{name:"date_collected",type:"date",dateFormat:"Y-m-d H:i:s",comment:"when the results were collected",index:!0},{name:"priority",type:"string",len:25,comment:"order priority",index:!0},{name:"status",type:"string",len:25,comment:"order status",index:!0},{name:"order_type",type:"string",comment:"Order is radiology or laboratory.",index:!0},{name:"type",type:"string",store:!1,convert:function(a,b){switch(b.data.order_type){case"lab":return _("laboratory");
case"rad":return _("radiology")}}},{name:"note",type:"string"},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"void",type:"boolean",defaultValue:!1,comment:"VOID the Order"},{name:"void_comment",type:"string",comment:"VOID Comments",len:100},{name:"is_external_order",type:"boolean",index:!0}],proxy:{type:"direct",api:{read:"Orders.getPatientOrders",create:"Orders.addPatientOrder",update:"Orders.updatePatientOrder",destroy:"Orders.deletePatientOrder"},remoteGroup:!1},associations:[{type:"hasMany",model:"App.model.patient.PatientsOrderResult",name:"results",foreignKey:"order_id"}]}),Ext.define("App.model.patient.PatientsPrescriptions",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Patient Prescription ID"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"uid",type:"int"},{name:"created_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"note",type:"string"},{name:"document_id",type:"int"},{name:"docUrl",type:"string"},{name:"medications"}],proxy:{type:"direct",api:{read:"Prescriptions.getPrescriptions",create:"Prescriptions.addPrescription",update:"Prescriptions.updatePrescription"}}}),Ext.define("App.model.patient.Referral",{extend:"Ext.data.Model",table:{name:"patient_referrals",comment:"Patients Referrals"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0,comment:"encounter id"},{name:"pid",type:"int",index:!0,comment:"patient ID"},{name:"create_uid",type:"int",comment:"user ID who created the referral"},{name:"update_uid",type:"int",comment:"user ID who updated the referral"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"referral_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"service_text",type:"string",len:300},{name:"service_code",type:"string",len:10},{name:"service_code_type",type:"string",comment:"CPT SNOMED",len:10},{name:"referal_reason",type:"string",len:1e3},{name:"diagnosis_text",type:"string",len:300},{name:"diagnosis_code",type:"string",len:10},{name:"diagnosis_code_type",type:"string",len:10},{name:"is_external_referral",type:"bool"},{name:"refer_by",type:"string",len:80},{name:"refer_by_text",type:"string",len:120},{name:"refer_to",type:"string",len:80},{name:"refer_to_text",type:"string",len:120},{name:"risk_level",type:"string",len:20},{name:"send_record",type:"bool"}],proxy:{type:"direct",api:{read:"Referrals.getPatientReferrals",create:"Referrals.addPatientReferral",update:"Referrals.updatePatientReferral",destroy:"Referrals.deletePatientReferral"},remoteGroup:!1}}),Ext.define("App.model.patient.PatientsXrayCtOrders",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Patients XrayCt Orders ID"},{name:"eid",type:"int"},{name:"pid",type:"int"},{name:"uid",type:"int"},{name:"description",type:"string"},{name:"date_created",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"laboratory_id",type:"int"},{name:"document_id",type:"int"},{name:"order_type",type:"string",defaultValue:"rad"},{name:"order_items",type:"string"},{name:"note",type:"string"},{name:"docUrl",type:"string"}],proxy:{type:"direct",api:{read:"Orders.getPatientXrayCtOrders",create:"Orders.addPatientXrayCtOrder",update:"Orders.updatePatientXrayCtOrder"}}}),Ext.define("App.model.patient.PreventiveCare",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Preventive Care ID"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"uid",type:"int"},{name:"description"},{name:"date",dateFormat:"Y-m-d"},{name:"observation"},{name:"type"},{name:"dismiss"},{name:"reason"},{name:"alert",type:"bool"}],proxy:{type:"direct",api:{update:"PreventiveCare.addPreventivePatientDismiss",read:"PreventiveCare.getPreventiveCareCheck"}}}),Ext.define("App.model.patient.QRCptCodes",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"QR CPT Code ID"},{name:"eid",type:"int"},{name:"code",type:"string"},{name:"code_text",type:"string"},{name:"code_text_medium",type:"string"},{name:"place_of_service",type:"string"},{name:"emergency",type:"bool"},{name:"charge",type:"string"},{name:"days_of_units",type:"string"},{name:"essdt_plan",type:"string"},{name:"modifiers",type:"string"},{name:"status",type:"int",defaultValue:0}],proxy:{type:"direct",api:{read:"Services.getCptCodes"},reader:{root:"rows",totalProperty:"totals"}}}),Ext.define("App.model.patient.Reminder",{extend:"Ext.data.Model",table:{name:"patient_reminders"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"reminder_date",type:"date",dataType:"DATE",dateFormat:"Y-m-d"},{name:"reminder_type",type:"string",len:45},{name:"reminder_note",type:"string",dataType:"MEDIUMTEXT"},{name:"create_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Reminders.getReminders",create:"Reminders.addReminder",update:"Reminders.updateReminder"},reader:{root:"data"}}}),Ext.define("App.model.patient.VectorGraph",{extend:"Ext.data.Model",table:{name:"vectorgraph",comment:"Vector Graphics"},fields:[{name:"id",type:"int",comment:"Vector Graphics ID"},{name:"age_mos",type:"float"},{name:"height",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P85",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"}}}),Ext.define("App.model.patient.Surgery",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"Surgery ID"},{name:"eid",type:"int"},{name:"pid",type:"int"},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"surgery",type:"string"},{name:"surgery_id",type:"string"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"referred_by",type:"string"},{name:"outcome",type:"string"},{name:"notes",type:"string"},{name:"alert",type:"bool"}],proxy:{type:"direct",api:{read:"Medical.getPatientSurgery",create:"Medical.addPatientSurgery",update:"Medical.updatePatientSurgery"}}}),Ext.define("App.model.patient.charts.BMIForAge",{extend:"Ext.data.Model",table:{name:"bmiforage",comment:"BMI For Age"},fields:[{name:"id",type:"int",comment:"BMI For Age ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:8}}}),Ext.define("App.model.patient.charts.HeadCircumferenceInf",{extend:"Ext.data.Model",table:{name:"headcircumferenceinf",comment:"Head Circumference Information"},fields:[{name:"id",type:"int",comment:"Head Circumference Information ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:4}}}),Ext.define("App.model.patient.Alert",{extend:"Ext.data.Model",table:{name:"patient_alerts"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s",index:!0},{name:"body",type:"string",len:600},{name:"type",type:"string",len:80,index:!0},{name:"user_name",type:"string",store:!1},{name:"active",type:"bool",defaultValue:!0}],proxy:{type:"direct",api:{read:"Alerts.getAlerts",create:"Alerts.addAlert",update:"Alerts.updateAlert"},reader:{root:"data"}}}),Ext.define("App.model.patient.VisitPayment",{extend:"Ext.data.Model",table:{name:"visitpayment",comment:"Visit Payment"},fields:[{name:"id",type:"int",comment:"Visit Payment ID"},{name:"no",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"facility",type:"string"},{name:"received_from",type:"string"},{name:"amount",type:"string"},{name:"for_payment_of",type:"string"},{name:"paid_by",type:"string"},{name:"description",type:"string"},{name:"next_appointment",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"accounted_amount",type:"string"},{name:"payment_amount",type:"string"},{name:"balance_due",type:"string"}],proxy:{type:"direct",api:{read:"Encounter.Checkout"},reader:{type:"json"}}}),Ext.define("App.model.patient.charts.LengthForAgeInf",{extend:"Ext.data.Model",table:{name:"lengthforageinf",comment:"Length For Age Information"},fields:[{name:"id",type:"int",comment:"Length For Age Information ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:2}}}),Ext.define("App.model.patient.charts.StatureForAge",{extend:"Ext.data.Model",table:{name:"statureforage",comment:"Stature For Age"},fields:[{name:"id",type:"int",comment:"Stature For Age ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:7}}}),Ext.define("App.model.patient.charts.WeightForAge",{extend:"Ext.data.Model",table:{name:"weightforage",comment:"Weight For Age"},fields:[{name:"id",type:"int",comment:"Weight For Age ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:6}}}),Ext.define("App.model.patient.charts.WeightForAgeInf",{extend:"Ext.data.Model",table:{name:"weightforageinf",comment:"Weight For Age Information"},fields:[{name:"id",type:"int",comment:"Weight For Age Information ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:1}}}),Ext.define("App.model.patient.charts.WeightForRecumbentInf",{extend:"Ext.data.Model",table:{name:"weightforrecumbentinf",comment:"Weight For Recumbent Information"},fields:[{name:"id",type:"int",comment:"Weight For Recumbent Information ID"},{name:"age",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:3}}}),Ext.define("App.model.patient.charts.WeightForStature",{extend:"Ext.data.Model",table:{name:"weightforstature",comment:"Weight For Stature"},fields:[{name:"id",type:"int",comment:"Weight For Stature ID"},{name:"height",type:"float"},{name:"PP",type:"float"},{name:"P3",type:"float"},{name:"P5",type:"float"},{name:"P10",type:"float"},{name:"P25",type:"float"},{name:"P50",type:"float"},{name:"P75",type:"float"},{name:"P85",type:"float"},{name:"P90",type:"float"},{name:"P95",type:"float"},{name:"P97",type:"float"}],proxy:{type:"direct",api:{read:"VectorGraph.getGraphData"},reader:{type:"json"},extraParams:{type:5}}}),Ext.define("App.model.areas.PatientArea",{extend:"Ext.data.Model",fields:[{name:"pid",type:"int",comment:"Pool Areas ID"},{name:"eid",type:"int"},{name:"name",type:"string"},{name:"patient"},{name:"shortName",type:"string"},{name:"poolArea",type:"string"},{name:"floorPlanId",type:"int"},{name:"zoneId",type:"int"},{name:"patientZoneId",type:"int"},{name:"priority",type:"string"},{name:"rank",type:"int"}],proxy:{type:"direct",api:{read:"PoolArea.getPatientsByPoolAreaAccess"}}}),Ext.define("App.model.areas.PoolArea",{extend:"Ext.data.Model",table:{name:"pool_areas"},fields:[{name:"id",type:"int"},{name:"title",type:"string",len:80},{name:"concept",type:"string",len:80},{name:"floor_plan_id",type:"int",useNull:!0},{name:"facility_id",type:"int",useNull:!0},{name:"sequence",type:"int"},{name:"active",type:"bool"},{name:"facility_name",type:"string",store:!1},{name:"floor_plan_title",type:"string",store:!1}],proxy:{type:"direct",api:{read:"PoolArea.getPoolAreas",create:"PoolArea.addPoolArea",update:"PoolArea.updatePoolArea",destroy:"PoolArea.destroyPoolArea"},remoteGroup:!1},remoteGroup:!1}),Ext.define("App.model.areas.PoolDropAreas",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"pid",type:"int"},{name:"pubpid",type:"string"},{name:"pic",type:"string"},{name:"appointment_id",type:"int"},{name:"zone",type:"string"},{name:"appointment_time",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"time_in",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"minutes",type:"string",convert:function(a,b){return b.get("time_in")?(app.getDate().getTime()-b.get("time_in").getTime())/1e3/60:0}},{name:"timer",type:"string",convert:function(a,b){var c=b.get("minutes"),d=c/60,e=Math.floor(d),f=60*(d-e),g=Math.round(f);return Ext.String.format("{0}:{1}",Ext.String.leftPad(e,2,"0"),Ext.String.leftPad(g,2,"0"))}},{name:"alert_color",type:"string",convert:function(a,b){var c=b.get("minutes");return c>30?"lightcoral":c>20?"lightpink":c>10?"lightblue":c>5?"lightyellow":""}}]}),Ext.define("App.view.patient.windows.Charts",{extend:"Ext.window.Window",requires:[],title:_("vector_charts"),modal:!0,width:1e3,height:700,layout:"fit",itemId:"PatientChartsWindow",items:[{xtype:"miframe",itemId:"PatientChartsIframe"}],tbar:[{text:"Weight vs Age (0-5)",itemId:"PatientChartWeightVsAgeToFiveBtn"},"-",{text:"Weight vs Age (2-20)",itemId:"PatientChartWeightVsAgeToTwentyBtn"},"-",{text:"Head Circumference vs Age (0-5)",itemId:"PatientChartHeadCircumferenceVsAgeToFiveBtn"},"-",{text:"Length vs Age (0-5)",itemId:"PatientChartLengthVsAgeToFiveBtn"},"-",{text:"BMI (2-20)",itemId:"PatientChartBMIBtn"}]}),Ext.define("App.view.patient.windows.PreventiveCare",{extend:"App.ux.window.Window",title:_("preventive_care_window"),closeAction:"hide",bodyStyle:"background-color:#fff",modal:!0,bodyPadding:5,initComponent:function(){var a=this;a.patientPreventiveCare=Ext.create("App.store.patient.PreventiveCare",{groupField:"type",sorters:["type"],autoSync:!0}),a.grid=Ext.create("Ext.grid.Panel",{store:a.patientPreventiveCare,height:400,width:700,features:Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:_("type")+": {name} ({rows.length} "+_("item")+'{[values.rows.length > 1 ? "s" : ""]})',hideGroupedHeader:!0,startCollapsed:!0}),columns:[{header:_("type"),dataIndex:"type",width:200},{header:_("description"),dataIndex:"description",width:200},{header:_("reason"),dataIndex:"reason",flex:1}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,items:[{title:_("general"),xtype:"container",padding:10,layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",name:"reason",fieldLabel:_("reason"),width:585,labelWidth:70,disabled:!0,allowBlank:!1,action:"reason"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",fieldLabel:_("observation"),name:"observation",width:250,labelWidth:70,disabled:!0,action:"observation"},{fieldLabel:_("date"),xtype:"datefield",disabled:!0,action:"date",width:200,labelWidth:40,format:g("date_display_format"),name:"date"},{xtype:"checkboxfield",name:"dismiss",fieldLabel:_("dismiss_alert"),enableKeyEvents:!0,listeners:{scope:a,change:a.onChangeOption}},{xtype:"textfield",hidden:!0,name:"eid",action:"eid"}]}]}]})}),a.items=[a.grid],this.callParent(arguments)},onChangeOption:function(a,b){var c=a.up("form").query('[action="reason"]')[0],d=a.up("form").query('[action="date"]')[0],e=a.up("form").query('[action="eid"]')[0],f=a.up("form").query('[action="observation"]')[0];e.setValue(app.patient.eid),b?(c.setDisabled(!1),d.setDisabled(!1),f.setDisabled(!1)):b?(c.setDisabled(!0),d.setDisabled(!0),f.setDisabled(!0)):(c.setDisabled(!0),d.setDisabled(!0),f.setDisabled(!0))},loadPatientPreventiveCare:function(){var a=this;this.patientPreventiveCare.load({scope:a,params:{pid:app.patient.pid},callback:function(b){return b.length>0?(a.show(),!0):!1}})}}),Ext.define("App.view.patient.windows.DocumentErrorNote",{extend:"Ext.window.Window",xtype:"patientdocumenterrornotewindow",draggable:!1,modal:!0,autoShow:!0,title:_("error_note"),items:[{xtype:"form",bodyPadding:10,width:400,items:[{xtype:"textareafield",anchor:"100%",labelWidth:70,labelAlign:"top",name:"error_note",allowBlank:!1}]}],buttons:[{text:_("cancel"),itemId:"DocumentErrorNoteCancelBtn",handler:function(a){a.up("window").close()}},{text:_("save"),itemId:"DocumentErrorNoteSaveBtn"}]}),Ext.define("App.view.patient.windows.DocumentViewer",{extend:"Ext.window.Window",xtype:"documentviewerwindow",title:_("documents_viewer_window"),layout:"fit",height:700,width:800,bodyStyle:"background-color:#fff",maximizable:!0,defaults:{margin:5},tbar:["->",{text:_("archive_and_add_to_print_jobs"),itemId:"documentViewerAddToPrintJobBtn",icon:"resources/images/icons/add.png"},{text:_("archive_document"),itemId:"archiveDocumentBtn",icon:"resources/images/icons/save.png"}]}),Ext.define("App.view.patient.windows.ArrivalLog",{extend:"App.ux.window.Window",title:_("patient_arrival_log"),closeAction:"hide",layout:"fit",modal:!0,width:900,height:600,maximizable:!0,initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.PatientArrivalLog",{autoSync:!0}),a.tbar=[{xtype:"patienlivetsearch",fieldLabel:_("look_for_patient"),width:400,hideLabel:!1,enableKeyEvents:!0,listeners:{scope:a,select:a.onPatientSearchSelect,keyup:a.onPatientSearchKeyUp}},"-",{text:_("add_new_patient"),iconCls:"icoAddRecord",action:"newPatientBtn",disabled:!0,scope:a,handler:a.onNewPatient},"->",{xtype:"tool",type:"refresh",scope:a,handler:a.onGridReload}],a.items=[a.ckGrid=Ext.create("Ext.grid.Panel",{store:a.store,margin:5,columns:[{xtype:"actioncolumn",width:25,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onPatientRemove}]},{header:_("time"),dataIndex:"time",width:130},{header:_("record")+" #",dataIndex:"pid"},{header:_("patient_name"),dataIndex:"name",flex:1},{header:_("insurance"),dataIndex:"insurance"},{header:_("area"),dataIndex:"area"},{width:25,dataIndex:"warning",renderer:a.warnRenderer}],listeners:{scope:a,itemdblclick:a.onPatientDlbClick}})],a.listeners={scope:a,show:a.onWinShow},a.callParent(arguments)},onPatientSearchSelect:function(a,b){var c=this,d=c.query("grid")[0].getStore(),e=c.query('button[action="newPatientBtn"]')[0];d.add({pid:b[0].data.pid,name:b[0].data.fullname,time:Ext.Date.format(new Date,"Y-m-d H:i:s"),isNew:!1}),a.reset(),e.setDisabled(!0)},onPatientSearchKeyUp:function(a){this.query('button[action="newPatientBtn"]')[0].setDisabled(null==a.getValue())},onNewPatient:function(a){var b=this,c=b.query("patienlivetsearch")[0],d=c.getValue(),e=b.query("grid")[0].getStore();c.reset(),a.disable(),e.add({name:d,time:Ext.Date.format(new Date,"Y-m-d H:i:s"),isNew:!0})},onPatientRemove:function(a,b){var c=a.getStore(),d=this,e=c.getAt(b);Encounter.checkForAnOpenedEncounterByPid({pid:e.data.pid,date:Ext.Date.format(new Date,"Y-m-d H:i:s")},function(a,b){b.result?d.msg(_("oops"),_("patient_have_a_opened_encounter")):(d.msg(_("sweet"),_("patient_have_been_removed")),c.remove(e))})},onPatientDlbClick:function(a,b){var c=this,d=b.data;app.setPatient(d.pid,d.name,null,function(){app.openPatientSummary()}),c.close()},onGridReload:function(){this.store.load()},onWinShow:function(){var a=this;a.onGridReload(),new Ext.util.DelayedTask(function(){a.query("patienlivetsearch")[0].focus()}).delay(1e3)}}),Ext.define("App.view.patient.windows.NewEncounter",{extend:"Ext.window.Window",requires:["App.ux.LiveReferringPhysicianSearch"],itemId:"EncounterDetailWindow",title:_("encounter"),closeAction:"hide",closable:!1,modal:!0,width:700,layout:"fit",initComponent:function(){var b=this;b.store=Ext.create("App.store.patient.Encounters"),Ext.apply(b,{items:[b.encForm=Ext.create("Ext.form.Panel",{itemId:"EncounterDetailForm",border:!1,bodyPadding:"10 10 0 10",items:[{xtype:"fieldcontainer",layout:"column",items:[{xtype:"fieldcontainer",layout:"anchor",items:[{xtype:"mitos.datetime",fieldLabel:"Date of Service",labelWidth:100,width:300,margin:"0 5 5 0",name:"service_date"},{xtype:"gaiaehr.combo",fieldLabel:"Visit Category",labelWidth:100,width:300,margin:"0 5 5 0",name:"visit_category",listKey:"visit_cat",editable:!1,loadStore:!0,queryMode:"local"},{xtype:"textareafield",fieldLabel:"Chief Complaint",emptyText:"Chief Complaint (Please Type a Brief Description)",hideLabel:!0,enableKeyEvents:!0,width:300,height:157,margin:"0 10 0 0",grow:!1,name:"brief_description"}]},{xtype:"fieldcontainer",layout:"anchor",items:[{xtype:"activeproviderscombo",fieldLabel:"Provider",labelWidth:120,width:350,allowBlank:!1,name:"provider_uid",itemId:"EncounterProviderCmb",editable:!1},{xtype:"activeproviderscombo",fieldLabel:"Technician",labelWidth:120,width:350,name:"technician_uid",editable:!1},{xtype:"activefacilitiescombo",fieldLabel:"Facility",labelWidth:120,width:350,margin:"0 5 5 0",name:"facility",editable:!1},{xtype:"gaiaehr.combo",fieldLabel:"Priority",labelWidth:120,width:350,margin:"0 5 5 0",name:"priority",listKey:"enc_prio",editable:!1,loadStore:!0,queryMode:"local"},{xtype:"gaiaehr.combo",fieldLabel:"Patient Class",labelWidth:120,width:350,name:"patient_class",listKey:"pat_class",editable:!1,loadStore:!0,queryMode:"local"},{xtype:"referringphysicianlivetsearch",fieldLabel:"Ref. Physician",hideLabel:!1,labelWidth:120,width:350,name:"referring_physician"},{xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"checkbox",itemId:"EncounterCcdaAvailableField",fieldLabel:_("ccda_available"),labelWidth:120,name:"summary_care_provided"},{xtype:"checkbox",fieldLabel:_("requested"),labelWidth:80,labelAlign:"right",name:"summary_care_requested"}]},{xtype:"mitos.datetime",fieldLabel:"Onset Hosp. Date",labelWidth:120,width:350,margin:"0 5 5 0",name:"onset_date"},{xtype:"checkbox",fieldLabel:"Is Private",labelWidth:120,name:"is_private",disabled:!a("allow_to_create_private_encounter"),tooltip:"Private encounters can only be access by encounter's provider"}]}]}]})],buttons:[{text:_("delete"),itemId:"EncounterDeletetBtn",cls:"toolWarning",hidden:!0},{text:_("transfer"),itemId:"EncounterTransferBtn",cls:"toolWarning",acl:a("transfer_encounters")},"->",{text:_("save"),action:"encounter",scope:b,disableOnCLick:!0,handler:b.onFormSave},{text:_("cancel"),scope:b,handler:b.cancelNewEnc}],listeners:{show:b.checkValidation,hide:b.resetRecord}},b),b.callParent(arguments)},checkValidation:function(){var b=this,c=b.down("form").getForm(),d=c.getRecord(),e=c.findField("brief_description");app.patient.pid?!d&&a("add_encounters")?(b.loadRecord(Ext.create("App.model.patient.Encounter",{pid:app.patient.pid,service_date:Ext.Date.format(new Date,"Y-m-d H:i:s"),priority:"Minimal",open_uid:app.user.id,facility:app.user.facility,billing_facility:app.user.facility,brief_description:g("default_chief_complaint")})),e&&e.enable(),Encounter.checkOpenEncountersByPid(app.patient.pid,function(a,d){d.result.encounter&&Ext.Msg.show({title:_("oops")+" "+_("open_encounters_found")+"...",msg:_("do_you_want_to")+" <strong>"+_("continue_creating_the_new_encounters")+'</strong><br>"'+_("click_no_to_review_encounter_history")+'"',buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"!=a&&(b.hide(),c.reset())}})})):d&&a("edit_encounters")?e&&e.disable():app.accessDenied():app.currPatientError()},onFormSave:function(b){var c=this,d=c.encForm.getForm(),e=d.getValues(),f=d.getRecord(),g=0===f.data.eid;d.isValid()&&(g&&a("add_encounters")||!g&&a("edit_encounters")?(f.set(e),say(e),f.save({callback:function(a){if(g){var b=a.data;app.patientButtonRemoveCls(),app.patientBtn.addCls(b.priority),app.openEncounter(b.eid)}c.close()}})):(b.up("window").close(),app.accessDenied()))},loadRecord:function(a){this.encForm.getForm().loadRecord(a)},resetRecord:function(){this.down("form").getForm().reset(!0),delete this.down("form").getForm()._record},cancelNewEnc:function(){this.close()}}),Ext.define("App.store.patient.CheckoutAlertArea",{extend:"Ext.data.Store",model:"App.model.patient.CheckoutAlertArea",remoteSort:!1,autoLoad:!1}),Ext.define("App.model.patient.Patient",{extend:"Ext.data.Model",requires:["App.model.patient.Insurance","App.model.patient.Allergies","App.model.patient.Medications","App.model.patient.PatientActiveProblem"],table:{name:"patient"},fields:[{name:"pid",type:"int",comment:"patient ID"},{name:"pubpid",type:"string",index:!0,comment:"record number",len:40},{name:"pubpid_issuer",type:"string",index:!0,comment:"record number issuer ",len:40},{name:"interface_number",type:"string",index:!0,comment:"interface reference number",len:40},{name:"title",type:"string",comment:"Title Mr. Sr.",len:10},{name:"fname",type:"string",comment:"first name",index:!0,len:35},{name:"mname",type:"string",comment:"middle name",index:!0,len:25},{name:"lname",type:"string",comment:"last name",index:!0,len:60},{name:"suffix",type:"string",len:35},{name:"sex",type:"string",comment:"sex",index:!0,len:10},{name:"orientation",type:"string",comment:"sex orientation",index:!0,len:15},{name:"identity",type:"string",comment:"sex identity",index:!0,len:15},{name:"DOB",type:"date",comment:"day of birth",dateFormat:"Y-m-d H:i:s",index:!0,defaultValue:"0000-00-00 00:00:00"},{name:"DOBFormatted",type:"string",persist:!1,convert:function(a,b){return Ext.Date.format(b.get("DOB"),g("date_display_format"))}},{name:"marital_status",type:"string",comment:"marital status",len:40},{name:"SS",type:"string",index:!0,comment:"social security",len:40},{name:"drivers_license",type:"string",index:!0,comment:"driver licence #",len:40},{name:"drivers_license_state",type:"string",len:40},{name:"drivers_license_exp",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"provider",type:"string",len:40},{name:"pharmacy",type:"string",len:40},{name:"hipaa_notice",type:"string",comment:"HIPAA notice status",len:40},{name:"record_number",type:"string",persist:!1},{name:"fulladdress",type:"string",persist:!1,convert:!1},{name:"phones",type:"string",store:!1},{name:"race",type:"string",comment:"race",len:40},{name:"secondary_race",type:"string",comment:"secondary race",len:40},{name:"tertiary_race",type:"string",comment:"tertiary race",len:40},{name:"ethnicity",type:"string",comment:"ethnicity",len:40},{name:"secondary_ethnicity",type:"string",len:40},{name:"language",type:"string",comment:"language",len:10},{name:"birth_fname",type:"string",len:35},{name:"birth_mname",type:"string",len:35},{name:"birth_lname",type:"string",len:60},{name:"allow_leave_msg",type:"bool"},{name:"allow_voice_msg",type:"bool"},{name:"allow_mail_msg",type:"bool"},{name:"allow_sms",type:"bool"},{name:"allow_email",type:"bool"},{name:"allow_immunization_registry",type:"bool"},{name:"allow_immunization_info_sharing",type:"bool"},{name:"allow_health_info_exchange",type:"bool"},{name:"allow_patient_web_portal",type:"bool"},{name:"allow_guardian_web_portal",type:"bool"},{name:"allow_guardian_web_portal_cda",type:"bool"},{name:"allow_emergency_contact_web_portal",type:"bool"},{name:"allow_emergency_contact_web_portal_cda",type:"bool"},{name:"organ_donor_code",type:"string",len:10,defaultValue:"U"},{name:"occupation",type:"string",comment:"patient occupation",len:40},{name:"employer_name",type:"string",len:60},{name:"employer_address",type:"string",len:55},{name:"employer_city",type:"string",len:30},{name:"employer_state",type:"string",len:2},{name:"employer_country",type:"string",len:3},{name:"employer_postal_code",type:"string",len:15},{name:"rating",type:"int",comment:"patient stars rating"},{name:"image",type:"string",dataType:"mediumtext",comment:"patient image base64 string"},{name:"qrcode",type:"string",dataType:"mediumtext",comment:"patient QRCode base64 string"},{name:"pubaccount",type:"string",index:!0,comment:"external reference account",len:40},{name:"birth_place",type:"string",len:150},{name:"birth_multiple",type:"bool",useNull:!0},{name:"birth_order",type:"int",useNull:!0,len:2},{name:"is_veteran",type:"string",len:1},{name:"deceased",type:"string",len:1},{name:"death_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"death_cause",type:"string",len:180},{name:"alias",type:"string",len:80},{name:"citizenship",type:"string",len:80},{name:"primary_facility",type:"int"},{name:"first_visit_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"administrative_status",type:"string",comment:"active | inactive | merged",len:15},{name:"create_uid",type:"int",comment:"create user ID"},{name:"update_uid",type:"int",comment:"update user ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"portal_password",type:"string",dataType:"blob",encrypt:!0},{name:"portal_username",type:"string",len:40},{name:"phone_publicity",type:"string",len:10},{name:"phone_publicity_date",type:"date",dataType:"date"},{name:"phone_home",type:"string",len:25},{name:"phone_mobile",type:"string",len:25},{name:"phone_work",type:"string",len:25},{name:"phone_work_ext",type:"string",len:25},{name:"phone_fax",type:"string",len:25},{name:"email",type:"string",len:80},{name:"postal_address",type:"string",len:55},{name:"postal_address_cont",type:"string",len:55},{name:"postal_city",type:"string",len:30},{name:"postal_state",type:"string",len:2},{name:"postal_zip",type:"string",len:15},{name:"postal_country",type:"string",len:3},{name:"physical_address",type:"string",len:55},{name:"physical_address_cont",type:"string",len:55},{name:"physical_city",type:"string",len:30},{name:"physical_state",type:"string",len:2},{name:"physical_zip",type:"string",len:15},{name:"physical_country",type:"string",len:3},{name:"mother_pid",type:"int",index:!0},{name:"mother_fname",type:"string",len:35},{name:"mother_mname",type:"string",len:25},{name:"mother_lname",type:"string",len:60},{name:"father_pid",type:"int",index:!0},{name:"father_fname",type:"string",len:35},{name:"father_mname",type:"string",len:25},{name:"father_lname",type:"string",len:60},{name:"spouse_pid",type:"int",index:!0},{name:"spouse_fname",type:"string",len:35},{name:"spouse_mname",type:"string",len:25},{name:"spouse_lname",type:"string",len:60},{name:"guardians_pid",type:"int",index:!0},{name:"guardians_relation",type:"string",len:20},{name:"guardians_fname",type:"string",len:35},{name:"guardians_mname",type:"string",len:25},{name:"guardians_lname",type:"string",len:60},{name:"guardians_phone",type:"string",len:25},{name:"guardians_phone_type",type:"string",len:10},{name:"guardians_address",type:"string",len:55},{name:"guardians_address_cont",type:"string",len:55},{name:"guardians_city",type:"string",len:30},{name:"guardians_state",type:"string",len:2},{name:"guardians_country",type:"string",len:3},{name:"guardians_zip",type:"string",len:15},{name:"guardian_portal_password",type:"string",dataType:"blob",encrypt:!0},{name:"guardian_portal_username",type:"string",len:40},{name:"emergency_contact_relation",type:"string",len:20},{name:"emergency_contact_fname",type:"string",len:80},{name:"emergency_contact_mname",type:"string",len:25},{name:"emergency_contact_lname",type:"string",len:60},{name:"emergency_contact_phone",type:"string",len:25},{name:"emergency_contact_phone_type",type:"string",len:10},{name:"emergency_contact_address",type:"string",len:35},{name:"emergency_contact_address_cont",type:"string",len:55},{name:"emergency_contact_city",type:"string",len:55},{name:"emergency_contact_state",type:"string",len:2},{name:"emergency_contact_country",type:"string",len:3},{name:"emergency_contact_zip",type:"string",len:15},{name:"emergency_contact_portal_password",type:"string",dataType:"blob",encrypt:!0},{name:"emergency_contact_portal_username",type:"string",len:40},{name:"religion",type:"string",len:20},{name:"authorized_01_relation",type:"string",len:20},{name:"authorized_01_fname",type:"string",len:35},{name:"authorized_01_mname",type:"string",len:25},{name:"authorized_01_lname",type:"string",len:60},{name:"authorized_01_phone",type:"string",len:25},{name:"authorized_01_phone_type",type:"string",len:10},{name:"authorized_02_relation",type:"string",len:20},{name:"authorized_02_fname",type:"string",len:35},{name:"authorized_02_mname",type:"string",len:25},{name:"authorized_02_lname",type:"string",len:60},{name:"authorized_02_phone",type:"string",len:25},{name:"authorized_02_phone_type",type:"string",len:10},{name:"authorized_03_relation",type:"string",len:20},{name:"authorized_03_fname",type:"string",len:35},{name:"authorized_03_mname",type:"string",len:25},{name:"authorized_03_lname",type:"string",len:60},{name:"authorized_03_phone",type:"string",len:25},{name:"authorized_03_phone_type",type:"string",len:10},{name:"phone_mobile_supplier",type:"string",len:25},{name:"pbm_payer_id",type:"string",len:60},{name:"pbm_payer_name",type:"string",len:45},{name:"pbm_card_fname",type:"string",len:45},{name:"pbm_card_lname",type:"string",len:45},{name:"pbm_member_id",type:"string",len:45},{name:"pbm_group",type:"string",len:45},{name:"pbm_bin",type:"string",len:45},{name:"pbm_pcn",type:"string",len:45},{name:"pbm_consent",type:"string",len:45},{name:"immunization_registry_status",type:"string",len:10},{name:"immunization_registry_status_date",type:"date",dateFormat:"Y-m-d"},{name:"protection_indicator",type:"bool"},{name:"protection_indicator_date",type:"date",dataType:"date"},{name:"authy_id",type:"string",len:45,index:!0},{name:"last_visit_id",type:"string",len:45,index:!0},{name:"name",type:"string",store:!1},{name:"fullname",type:"string",convert:function(a,b){return b.get("lname")+", "+b.get("fname")+" "+b.get("mname")
},store:!1}],idProperty:"pid",proxy:{type:"direct",api:{read:"Patient.getPatients",create:"Patient.savePatient",update:"Patient.savePatient"},writer:{writeAllFields:!0}},hasMany:[{model:"App.model.patient.Insurance",name:"insurance",primaryKey:"pid",foreignKey:"pid"},{model:"App.model.patient.Allergies",name:"allergies",primaryKey:"pid",foreignKey:"pid"},{model:"App.model.patient.Medications",name:"medications",primaryKey:"pid",foreignKey:"pid"},{model:"App.model.patient.PatientActiveProblem",name:"activeproblems",primaryKey:"pid",foreignKey:"pid"},{model:"App.model.patient.PatientContacts",name:"contacts",primaryKey:"pid",foreignKey:"pid"}],indexes:[{name:"live_search_index",choice:"INDEX",type:"BTREE",columns:["pid","pubpid","fname","mname","lname","SS"]}]}),Ext.define("App.model.patient.PatientPossibleDuplicate",{extend:"App.model.patient.Patient",proxy:{type:"direct",api:{read:"Patient.getPossibleDuplicatesByDemographic"},reader:{root:"data"}}}),Ext.define("App.view.dashboard.panel.PortalDropZone",{extend:"Ext.dd.DropTarget",constructor:function(a,b){this.portal=a,Ext.dd.ScrollManager.register(a.body),App.view.dashboard.panel.PortalDropZone.superclass.constructor.call(this,a.body,b),a.body.ddScrollConfig=this.ddScrollConfig},ddScrollConfig:{vthresh:50,hthresh:-1,animate:!0,increment:200},createEvent:function(a,b,c,d,e,f){return{portal:this.portal,panel:c.panel,columnIndex:d,column:e,position:f,data:c,source:a,rawEvent:b,status:this.dropAllowed}},notifyOver:function(a,b,c){var d,e,f,g,h,i,j=b.getXY(),k=this.portal,l=a.proxy;for(this.grid||(this.grid=this.getGrid()),d=k.body.dom.clientWidth,this.lastCW?this.lastCW!=d&&(this.lastCW=d,this.grid=this.getGrid()):this.lastCW=d,e=0,f=0,g=this.grid.columnX,h=g.length,i=!1,h;h>e;e++)if(f=g[e].x+g[e].w,j[0]<f){i=!0;break}i||e--;var m,n=0,o=0,p=!1,q=k.items.getAt(e),r=q.items.items,s=!1;for(h=r.length;h>n;n++)if(m=r[n],o=m.el.getHeight(),0===o)s=!0;else if(m.el.getY()+o/2>j[1]){p=!0;break}n=(p&&m?n:q.items.getCount())+(s?-1:0);var t=this.createEvent(a,b,c,e,q,n);return k.fireEvent("validatedrop",t)!==!1&&k.fireEvent("beforedragover",t)!==!1?(l.getProxy().setWidth("auto"),m?a.panelProxy.moveProxy(m.el.dom.parentNode,p?m.el.dom:null):a.panelProxy.moveProxy(q.el.dom,null),this.lastPos={c:q,col:e,p:s||p&&m?n:!1},this.scrollPos=k.body.getScroll(),k.fireEvent("dragover",t),t.status):t.status},notifyOut:function(){delete this.grid},notifyDrop:function(a,b,c){if(delete this.grid,this.lastPos){var d=this.lastPos.c,e=this.lastPos.col,f=this.lastPos.p,g=a.panel,h=this.createEvent(a,b,c,e,d,f!==!1?f:d.items.getCount());if(this.portal.fireEvent("validatedrop",h)!==!1&&this.portal.fireEvent("beforedrop",h)!==!1){Ext.suspendLayouts(),g.el.dom.style.display="",a.panelProxy.hide(),a.proxy.hide(),f!==!1?d.insert(f,g):d.add(g),Ext.resumeLayouts(!0),this.portal.fireEvent("drop",h);var i=this.scrollPos.top;if(i){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=i},10)}}return delete this.lastPos,!0}},getGrid:function(){var a=this.portal.body.getBox();return a.columnX=[],this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})}),a},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body),App.view.dashboard.panel.PortalDropZone.superclass.unreg.call(this)}}),Ext.define("App.view.dashboard.Dashboard",{extend:"App.ux.RenderPanel",requires:[],pageTitle:_("dashboard"),itemId:"DashboardPanel",initComponent:function(){var a=this;Ext.apply(a,{pageBody:[{xtype:"portalpanel",region:"center",items:[{itemId:"DashboardColumn1"},{itemId:"DashboardColumn2"}]}]}),a.callParent()}}),Ext.define("App.view.dashboard.panel.NotSignedVitals",{extend:"Ext.grid.Panel",itemId:"DashboardNotSignedVitalsGrid",requires:["Ext.ux.SlidingPager"],height:220,selModel:{mode:"MULTI",allowDeselect:!0},initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.Vitals",{remoteFilter:!0,filters:[{property:"auth_uid",value:0}]}),a.bbar={xtype:"pagingtoolbar",pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager"),items:["-",{xtype:"button",text:_("sign"),disabled:!0,itemId:"DashboardNotSignedVitalsSignBtn",icon:"resources/images/icons/pen.png"}]},a.columns=[{xtype:"datecolumn",text:_("date"),dataIndex:"date"},{text:_("patient"),dataIndex:"patient_lname",width:200,renderer:function(a,b,c){return Ext.String.format("{0}, {1} {2} - {3}",c.get("patient_lname")||"",c.get("patient_fname")||"",c.get("patient_mname")||"",c.get("patient_record_number")||c.get("pid"))}},{text:_("values"),dataIndex:"code_text",flex:1,renderer:function(a,b,c){return Ext.String.format("<b>BP:</b> {0}/{1}&nbsp;&nbsp;&nbsp;<b>PULSE:</b> {2}&nbsp;&nbsp;&nbsp;<b>TEMP:</b> {3}",c.get("bp_systolic")||"NONE",c.get("bp_diastolic")||"NONE",c.get("pulse")?c.get("pulse")+" bpm":"NONE",c.get("temp_f")?c.get("temp_f")+"&deg;":"NONE")}},{text:_("administer_by"),dataIndex:"administer_by",width:200}],a.callParent(arguments)},signedRenderer:function(a){return a>0?'<img style="padding-left: 13px" src="resources/images/icons/yes.png" />':'<img style="padding-left: 13px" src="resources/images/icons/no.png" />'}}),Ext.define("App.view.dashboard.panel.DailyVisits",{extend:"Ext.panel.Panel",initComponent:function(){var a=this;Ext.apply(a,{layout:"fit",height:300,items:{xtype:"chart",itemId:"DashboardDailyVisitsChart",animate:!1,shadow:!1,store:a.store=Ext.create("Ext.data.JsonStore",{fields:[{type:"int",name:"total_by_hour"},{type:"date",name:"service_hour",dateFormat:"Y-m-d H:i:s"}]}),axes:[{type:"Numeric",minimum:0,decimals:0,position:"left",fields:["total_by_hour"],title:"Patients Per Hour",majorTickSteps:1,minorTickSteps:0,label:{font:"11px Arial"}},{type:"Time",position:"bottom",fields:["service_hour"],title:"Time",dateFormat:"g:ia",step:[Ext.Date.HOUR,1],constrain:!0}],series:[{type:"column",highlight:!0,axis:"left",smooth:!0,fill:!0,yField:"total_by_hour",xField:"service_hour",tips:{trackMouse:!0,width:140,height:28,renderer:function(a){this.setTitle(a.get("total_by_hour")+" "+_("encounters"))}}}]}}),a.callParent()}}),Ext.define("App.view.dashboard.panel.NewResults",{extend:"Ext.grid.Panel",itemId:"DashboardNewResultsGrid",requires:["Ext.ux.SlidingPager"],height:220,columnLines:!0,disableSelection:!0,initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.PatientsOrderResults"),a.bbar={xtype:"pagingtoolbar",pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager")},a.columns=[{text:_("signed"),dataIndex:"signed_uid",width:60,renderer:function(b){return a.signedRenderer(b)}},{xtype:"datecolumn",text:_("received"),dataIndex:"create_date"},{text:_("description"),dataIndex:"code_text",flex:1},{text:_("status"),renderer:this.pctChange,dataIndex:"result_status"}],a.callParent(arguments)},signedRenderer:function(a){return a>0?'<img style="padding-left: 13px" src="resources/images/icons/yes.png" />':'<img style="padding-left: 13px" src="resources/images/icons/no.png" />'},change:function(a){return a>0?'<span style="color:green;">'+a+"</span>":0>a?'<span style="color:red;">'+a+"</span>":a},pctChange:function(a){return a>0?'<span style="color:green;">'+a+"%</span>":0>a?'<span style="color:red;">'+a+"%</span>":a}}),Ext.define("App.view.dashboard.panel.OpenEncounters",{extend:"Ext.grid.Panel",itemId:"DashboardOpenEncountersGrid",requires:["Ext.ux.SlidingPager"],height:220,initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"service_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"provider",type:"string"},{name:"patient",type:"string"},{name:"pid",type:"int"},{name:"eid",type:"int"}],proxy:{type:"direct",api:{read:"Encounter.getOpenEncounters"},reader:{root:"data"},remoteGroup:!1}}),a.bbar={xtype:"pagingtoolbar",pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager")},a.columns=[{xtype:"datecolumn",text:_("service_date"),dataIndex:"service_date",format:"Y-m-d"},{text:_("patient"),dataIndex:"patient",flex:1},{text:_("provider"),dataIndex:"provider",flex:1}],a.callParent(arguments)}}),Ext.define("App.view.areas.FloorPlan",{extend:"App.ux.RenderPanel",itemId:"FloorPlanPanel",pageTitle:_("area_floor_plan"),pageBody:[{xtype:"panel",title:_("floor_plans"),layout:"absolute",itemId:"FloorPlanPatientZonePanel",tbar:["->",{xtype:"floorplanareascombo",fieldLabel:_("area"),labelWidth:40,itemId:"FloorPlanAreasCombo"}],tools:[{type:"refresh",handler:function(){App.app.getController("areas.FloorPlan").setZones()}}]}]}),Ext.define("App.view.patient.charts.HeightForStature",{extend:"Ext.panel.Panel",layout:"fit",margin:5,title:_("weight_for_age"),initComponent:function(){var a=this;a.items=[{xtype:"chart",store:a.store,animate:!1,shadow:!1,legend:{position:"right"},axes:[{title:_("weight_kg"),type:"Numeric",position:"left",fields:["PP","P3","P5","P10","P25","P50","P75","P85","P90","P95","P97"],grid:{odd:{opacity:1,stroke:"#bbb","stroke-width":.5}},minimum:7,maximum:31},{title:_("length_cm"),type:"Numeric",position:"bottom",fields:["height"],minimum:77,maximum:121.5}],series:[{title:_("weight_kg"),type:"scatter",axis:"left",xField:"height",yField:"PP",smooth:!0,highlight:{size:10,radius:10},markerConfig:{type:"circle",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(a){this.update(_("length_cm")+": "+a.get("height")+"<br>"+_("weightArray")+": "+a.get("PP"))}}},{title:"97%",type:"line",axis:"left",xField:"height",yField:"P97",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"95%",type:"line",axis:"left",xField:"height",yField:"P95",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"85%",type:"line",axis:"left",xField:"height",yField:"P85",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"75%",type:"line",axis:"left",xField:"height",yField:"P75",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"50%",type:"line",axis:"left",xField:"height",yField:"P50",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":3,opacity:.5},highlight:{stroke:"#FF9900",size:4}},{title:"25%",type:"line",axis:"left",xField:"height",yField:"P25",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"10%",type:"line",axis:"left",xField:"height",yField:"P10",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"5%",type:"line",axis:"left",xField:"height",yField:"P5",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"3%",type:"line",axis:"left",xField:"height",yField:"P3",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}}]}],a.callParent(arguments)}}),Ext.define("App.store.patient.AppointmentRequests",{extend:"Ext.data.Store",model:"App.model.patient.AppointmentRequest"}),Ext.define("App.view.patient.encounter.AppointmentRequestGrid",{extend:"Ext.grid.Panel",requires:["App.ux.grid.DeleteColumn"],xtype:"appointmentrequestgrid",itemId:"AppointmentRequestGrid",frame:!0,store:Ext.create("App.store.patient.AppointmentRequests"),initComponent:function(){var a=this;a.columns=[{xtype:"griddeletecolumn",width:25},{xtype:"datecolumn",text:_("requested_date"),dataIndex:"requested_date",width:120,format:g("date_display_format")},{xtype:"datecolumn",text:_("approved_date"),dataIndex:"approved_date",width:150,format:g("date_display_format")},{text:_("notes"),dataIndex:"notes",flex:1}],a.callParent()},tbar:[_("appointment_requests"),"->",{text:_("appointment_request"),itemId:"AppointmentRequestAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}]}),Ext.define("App.view.patient.charts.HeadCircumference",{extend:"Ext.panel.Panel",layout:"fit",margin:5,initComponent:function(){var a=this;a.items=[{xtype:"chart",store:a.store,animate:!1,shadow:!1,legend:{position:"right"},axes:[{title:a.xTitle,type:"Numeric",position:"left",fields:["PP","P3","P5","P10","P25","P50","P75","P90","P95","P97"],grid:{odd:{opacity:1,stroke:"#bbb","stroke-width":.5}},minimum:a.xMinimum,maximum:a.xMaximum},{title:a.yTitle,type:"Numeric",position:"bottom",fields:["age"],minimum:a.yMinimum,maximum:a.yMaximum}],series:[{title:_("circumference_cm"),type:"scatter",axis:"left",xField:"age",yField:"PP",smooth:!0,highlight:{size:10,radius:10},markerConfig:{type:"circle",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(b){this.update(a.yTitle+" : "+b.get("age")+"<br>"+a.xTitle+": "+b.get("PP"))}}},{title:"97%",type:"line",axis:"left",xField:"age",yField:"P97",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"95%",type:"line",axis:"left",xField:"age",yField:"P95",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"75%",type:"line",axis:"left",xField:"age",yField:"P75",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"50%",type:"line",axis:"left",xField:"age",yField:"P50",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":3,opacity:.5},highlight:{stroke:"#FF9900",size:4}},{title:"25%",type:"line",axis:"left",xField:"age",yField:"P25",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"10%",type:"line",axis:"left",xField:"age",yField:"P10",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"5%",type:"line",axis:"left",xField:"age",yField:"P5",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}},{title:"3%",type:"line",axis:"left",xField:"age",yField:"P3",smooth:!0,showMarkers:!1,style:{stroke:"#000000","stroke-width":1,opacity:.3},highlight:{stroke:"#FF9900",size:2}}]}],a.callParent(arguments)}}),Ext.define("App.view.patient.charts.BPPulseTemp",{extend:"Ext.container.Container",layout:{type:"vbox",align:"stretch"},style:"background-color:#fff",defaults:{xtype:"panel",layout:"fit",flex:1},initComponent:function(){var a=this;a.items=[{title:_("blood_pressure"),margin:5,items:[{xtype:"chart",style:"background:#fff",store:a.store,animate:!1,shadow:!0,legend:{position:"right"},axes:[{title:_("blood_pressure"),type:"Numeric",position:"left",fields:["bp_systolic","bp_diastolic","bp_systolic_normal","bp_diastolic_normal"],grid:{odd:{opacity:1,stroke:"#bbb","stroke-width":.5}}},{title:_("date"),type:"Time",dateFormat:"Y-m-d h:i:s a",position:"bottom",fields:["date"]}],series:[{title:_("systolic"),type:"line",axis:"left",xField:"date",yField:"bp_systolic",smooth:!0,highlight:{size:10,radius:10},markerConfig:{type:"circle",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(a){this.update("Date: "+Ext.Date.format(a.get("date"),"Y-m-d h:i:s a")+"<br>Systolic: "+a.get("bp_systolic"))}}},{title:_("diastolic"),type:"line",axis:"left",xField:"date",yField:"bp_diastolic",smooth:!0,highlight:{size:5,radius:5},markerConfig:{type:"cross",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(a){this.update(_("date")+": "+Ext.Date.format(a.get("date"),"Y-m-d h:i:s a")+"<br>"+_("diastolic")+": "+a.get("bp_diastolic"))}}},{type:"line",showMarkers:!1,axis:"left",xField:"date",yField:"bp_diastolic_normal",style:{stroke:"#000000","stroke-width":1}},{type:"line",showMarkers:!1,axis:"left",xField:"date",yField:"bp_systolic_normal",style:{stroke:"#000000","stroke-width":1}}]}]},{title:"Pulse",margin:"0 5 5 5",items:[{xtype:"chart",style:"background:#fff",store:a.store,animate:!1,shadow:!0,legend:{position:"right"},axes:[{title:_("pulse_per_min"),type:"Numeric",position:"left",fields:["pulse"],grid:{odd:{opacity:1,stroke:"#bbb","stroke-width":.5}}},{title:_("date"),type:"Time",dateFormat:"Y-m-d h:i:s a",position:"bottom",fields:["date"]}],series:[{title:_("pulse"),type:"line",axis:"left",xField:"date",yField:"pulse",smooth:!0,highlight:{size:10,radius:10},markerConfig:{type:"circle",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(a){this.update(_("date")+": "+Ext.Date.format(a.get("date"),"Y-m-d h:i:s a")+"<br>"+_("pulse_per_min")+": "+a.get("pulse"))}}}]}]},{title:_("temperature"),margin:"0 5 5 5",items:[{xtype:"chart",store:a.store,animate:!1,shadow:!0,legend:{position:"right"},axes:[{title:_("temp_fahrenheits"),type:"Numeric",position:"left",fields:["temp_f"],grid:{odd:{opacity:1,stroke:"#bbb","stroke-width":.5}}},{title:_("date"),type:"Time",dateFormat:"Y-m-d h:i:s a",position:"bottom",fields:["date"]}],series:[{title:_("temp_fahrenheits"),type:"line",axis:"left",xField:"date",yField:"temp_f",smooth:!0,highlight:{size:10,radius:10},markerConfig:{type:"circle",size:5,radius:5,"stroke-width":0},tips:{trackMouse:!0,renderer:function(a){this.update(_("date")+": "+Ext.Date.format(a.get("date"),"Y-m-d h:i:s a")+"<br>"+_("temp_fahrenheits")+": "+a.get("temp_f"))}}}]}]}],a.callParent(arguments)}}),Ext.define("App.view.patient.windows.PossibleDuplicates",{extend:"App.ux.window.Window",title:_("possible_duplicates"),itemId:"PossiblePatientDuplicatesWindow",closeAction:"hide",bodyStyle:"background-color:#fff",modal:!0,closable:!1,requires:["Ext.toolbar.Paging","Ext.ux.SlidingPager"],initComponent:function(){var a=this;a.items=[{xtype:"grid",store:a.store=Ext.create("App.store.patient.PatientPossibleDuplicates"),width:700,maxHeight:700,frame:!0,margin:5,hideHeaders:!0,columns:[{dataIndex:"image",width:65,renderer:function(a){var b=""!=a?a:app.patientImage;return'<img src="'+b+'" class="icon32Round" />'}},{dataIndex:"fullname",flex:1,renderer:function(a,b,c){return'<table cellpadding="1" cellspacing="0" border="0" width="100%" style="font-size: 12px;"><tbody><tr><td width="20%"><b>'+_("record_number")+":</b></td><td>"+c.get("pubpid")+"</td></tr><tr><td><b>"+_("patient")+":</b></td><td>"+c.get("name")+" ("+c.get("sex")+") "+c.get("DOBFormatted")+"</td></tr></tr><tr><td><b>"+_("address")+":</b></td><td>"+c.get("fulladdress")+"</td></tr><tr><td><b>"+_("phones")+":</b></td><td>"+c.get("phones")+"</td></tr><tr><td><b>"+_("driver_lic")+":</b></td><td>"+c.get("drivers_license")+"</td></tr><tr><td><b>"+_("employer_name")+":</b></td><td>"+c.get("employer_name")+"</td></tr></tbody></table>"}}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager")}}],a.buttons=[{text:_("cancel"),itemId:"PossiblePatientDuplicatesCancelBtn"},"-",{text:_("continue"),itemId:"PossiblePatientDuplicatesContinueBtn"}],a.callParent()}}),Ext.define("App.view.patient.encounter.CurrentProceduralTerminology",{extend:"Ext.panel.Panel",alias:"widget.currentproceduralterminology",autoScroll:!0,border:!1,bodyBorder:!1,bodyPadding:5,bodyStyle:"background-color:#fff",layout:"border",pid:null,eid:null,initComponent:function(){var a=this;a.referenceCptStore=Ext.create("App.store.patient.QRCptCodes"),a.encounterCptStore=Ext.create("App.store.patient.EncounterServices",{autoSync:!0,listeners:{scope:a,beforesync:a.beforesync}}),a.cptFormEdit=Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,enableRemove:!0,items:[{fieldLabel:_("full_description"),xtype:"displayfield",name:"code_text",anchor:"100%"},{xtype:"container",layout:"column",items:[{xtype:"fieldcontainer",layout:"anchor",columnWidth:.5,margin:"0 3 0 0",defaults:{xtype:"textfield"},items:[{fieldLabel:_("place_of_service"),name:"place_of_service",anchor:"100%"},{xtype:"checkbox",labelWidth:105,fieldLabel:_("emergency")+"?",name:"emergency"},{fieldLabel:_("charges"),name:"charge",anchor:"100%"}]},{xtype:"fieldcontainer",layout:"anchor",columnWidth:.5,margin:"0 0 0 3",defaults:{xtype:"textfield",anchor:"100%",labelWidth:110},items:[{fieldLabel:_("days_of_units"),name:"days_of_units"},{fieldLabel:_("essdt_fam_plan"),name:"essdt_plan"},{fieldLabel:_("modifiers"),xtype:"livecptsearch",hideLabel:!1,name:"modifiers"}]}]},{xtype:"liveicdxsearch",fieldLabel:_("diagnosis"),hideLabel:!1,name:"diagnosis"}],listeners:{scope:a,afterremove:a.onCompleteRemove}}),a.items=[{xtype:"panel",title:_("cpt_search"),itemId:"leftCol",region:"west",width:450,hidden:!0,titleCollapse:!0,margin:"0 5 0 0",bodyStyle:"background-color:#fff",layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"fieldset",title:_("cpt_quick_reference_options"),padding:"10 15",margin:"0 0 3 0",layout:"anchor",items:{xtype:"combobox",anchor:"100%",editable:!1,queryMode:"local",valueField:"value",displayField:"name",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:_("show_related_cpt_for_current_diagnostics"),value:0},{name:_("show_cpt_history_for_this_patient"),value:1},{name:_("show_cpt_commonly_used_by_clinic"),value:2}]}),listeners:{scope:a,change:a.onQuickReferenceOption}}},Ext.create("Ext.ux.LiveSearchGridPanel",{margins:0,flex:1,store:a.referenceCptStore,viewConfig:{copy:!0,stripRows:!0,loadMask:!0,plugins:[{ptype:"gridviewdragdrop",dragGroup:"CPTGridDDGroup"}]},columns:[{text:_("code"),width:70,sortable:!0,dataIndex:"code"},{text:_("description"),flex:1,sortable:!0,dataIndex:"code_text_medium"}]})],listeners:{scope:a,collapse:a.onQuickReferenceCollapsed}},{xtype:"panel",title:_("encounter_cpts"),region:"center",itemId:"rightCol",bodyStyle:"background-color:#fff",layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"fieldset",title:_("cpt_live_sarch"),padding:"10 15",margin:"0 0 3 0",layout:"anchor",items:{xtype:"livecptsearch",listeners:{scope:a,select:a.onLiveCptSelect}}},{xtype:"grid",flex:1,margins:0,store:a.encounterCptStore,columns:[{text:_("code"),width:70,sortable:!0,dataIndex:"code"},{text:_("description"),flex:1,sortable:!0,dataIndex:"code_text"},{text:_("status"),width:50,sortable:!0,dataIndex:"status",renderer:a.status}],tbar:[{text:_("quick_reference"),action:"referenceCptBtn",enableToggle:!0,scope:a,toggleHandler:a.onQuickReferenceToggle},"->",{text:_("reload"),handler:function(){a.encounterCptStoreLoad(null)}}],viewConfig:{itemId:"view",plugins:{ptype:"gridviewdragdrop",dropGroup:"CPTGridDDGroup"},listeners:{scope:a,drop:a.onCptDropped}},plugins:a.cptFormEdit}]}],a.callParent(arguments)},status:function(a){return"0"==a?'<img style="padding-left: 10px" src="resources/images/icons/no.png" />':"1"==a?'<img style="padding-left: 10px" src="resources/images/icons/yes.png" />':"2"==a?'<img style="padding-left: 10px" src="resources/images/icons/icohelp.png" />':a},onQuickReferenceCollapsed:function(){var a=this.query('button[action="referenceCptBtn"]');a[0].pressed&&a[0].toggle(!1)},onQuickReferenceToggle:function(a,b){b?this.getComponent("leftCol").show():this.getComponent("leftCol").hide()},onQuickReferenceOption:function(a,b){this.loadCptQuickReferenceGrid(b)},onCompleteRemove:function(){app.msg(_("sweet"),_("cpt_removed_from_this_encounter"))},onLiveCptSelect:function(a,b){var c=this;a.reset(),delete b[0].data.id,b[0].data.eid=c.eid,c.encounterCptStore.add(b[0].data)},loadCptQuickReferenceGrid:function(a){this.referenceCptStore.load({params:{pid:this.pid,eid:this.eid,filter:a}})},beforesync:function(a){a.create&&(a.create[0].data.eid=this.eid)},onCptDropped:function(a,b,c,d){app.msg(_("sweet"),_("cpt_added_to_this_encounter")),this.cptFormEdit.cancelEdit();var e=c.store,f=e.indexOf(c),g="before"==d?f-1:f+1;this.cptFormEdit.startEdit(g,0)},setDefaultQRCptCodes:function(){var a=this.down("combobox");1!=a.getValue()?a.setValue(1):this.loadCptQuickReferenceGrid(1)},encounterCptStoreLoad:function(a,b,c){this.pid=a?a:this.pid,this.eid=b?b:this.eid,this.encounterCptStore.load({filters:[{property:"eid",value:this.eid}],callback:function(){c?c():null}})}}),Ext.define("App.view.patient.encounter.HealthCareFinancingAdministrationOptions",{extend:"Ext.form.Panel",xtype:"hcafaoptions",pid:null,eid:null,initComponent:function(){var a=this;a.callParent(),a.loadHCFAForm()},loadHCFAForm:function(){var a=this;a.getFormItems(this,10,function(){})}}),Ext.define("App.view.patient.encounter.ICDs",{extend:"Ext.form.FieldSet",alias:"widget.icdsfieldset",title:_("dx_codes"),padding:"10 15",layout:{type:"vbox",align:"stretch"},requires:["App.ux.LiveICDXSearch"],autoFormSync:!0,dxGroup:{},initComponent:function(){var a=this;a.items=[{xtype:"container",layout:"hbox",items:[{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:[{name:"option",type:"auto"},{name:"value",type:"int"}],data:[{option:"DX:1",value:1},{option:"DX:2",value:2},{option:"DX:3",value:3},{option:"DX:4",value:4},{option:"DX:5",value:5},{option:"DX:6",value:6},{option:"DX:7",value:7},{option:"DX:8",value:8},{option:"DX:9",value:9}]}),width:55,itemId:this.id+"-group-cmb",queryMode:"local",displayField:"option",valueField:"value",value:1,margin:"0 3 0 0",forceSelection:!0,editable:!1,hide:!0},{xtype:"combobox",store:Ext.create("Ext.data.Store",{fields:[{name:"code",type:"string"},{name:"code_text",type:"string"}],data:[{code:"A",code_text:"Admitting"},{code:"F",code_text:"Final"},{code:"W",code_text:"Working"}]}),width:100,itemId:this.id+"-dx-type-cmb",queryMode:"local",displayField:"code_text",valueField:"code",margin:"0 3 0 0",forceSelection:!0,allowBlank:!1,submitValue:!1,editable:!1,value:"F"},{xtype:"liveicdxsearch",itemId:"liveicdxsearch",emptyText:a.emptyText,name:"dxCodes",flex:1,listeners:{scope:a,select:a.onLiveIcdSelect,blur:function(a){a.reset()}}}]}],a.callParent(arguments)},getGroupContainer:function(a){var b=this;return this.dxGroup[a]||(this.dxGroup[a]=Ext.widget("container",{layout:{type:"table",columns:6},itemId:this.id+"-group-"+a,margin:"5 0 0 0",items:[{xtype:"container",itemId:this.id+"-dx-order-1",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-2",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-3",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-4",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-5",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-6",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-7",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-8",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-9",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-10",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-11",action:"pointer"},{xtype:"container",itemId:this.id+"-dx-order-12",action:"pointer"}],listeners:{afterrender:function(c){for(var d=c.items.items,e=0;e<d.length;e++)new Ext.dd.DropTarget(d[e].el,{ddGroup:"group-"+a+"-dx",dropPos:!1,dxsContainer:c,dxContainer:d[e],notifyOver:function(a,b,d){{var e=d.panel,f=this.dxContainer;a.proxy}if(0==f.items.items.length)return!1;if(f.items.items[0]==e)return!1;var g=c.items.items.indexOf(e.ownerCt),h=c.items.items.indexOf(f);return this.dropBefore=g>h,this.dropPos=c.items.items.indexOf(f),!0},notifyDrop:function(a,d,e){if(a.panelProxy.hide(),a.proxy.hide(),Ext.suspendLayouts(),this.lastPos!==!1){var f=e.panel.ownerCt,g=this.dxsContainer.items.items[this.dropPos],h=this.dxsContainer.items.items[this.dropPos].items.items[0],i=e.panel;f.remove(i,!1),g.remove(h,!1),g.add(i),f.add(h)}return Ext.resumeLayouts(!0),delete this.dropPos,b.onReOrder(c),!0}})}}})),this.add(this.dxGroup[a]),this.dxGroup[a]},onLiveIcdSelect:function(a,b){var c,d=this,e=d.up("form").getForm().getRecord(),f=d.getDxGroupCombo(),g=f.getValue(),h=d.getDxTypeCombo(),i=h.getValue(),j=d.getNextOrder(g);if(f.isValid()||h.isValid()){var k={pid:e.data.pid,eid:e.data.eid,uid:app.user.id,code:b[0].data.code,code_text:b[0].data.code_text,code_type:b[0].data.code_type,dx_group:g,dx_type:i,dx_order:j};d.fireEvent("beforerecordadd",d,k)!==!1&&(c=this.store.add(k),d.fireEvent("recordadd",d,c[0]),d.addIcd(c[0],g,j),a.reset())}},doAddIcd:function(a){var b,c=this,d=c.up("form").getForm().getRecord(),e=c.getDxGroupCombo(),f=e.getValue(),g=c.getDxTypeCombo(),h=g.getValue(),i=c.getNextOrder(f);if((e.isValid()||g.isValid())&&-1===c.store.find("code",a.code)){var j={pid:d.data.pid,eid:d.data.eid,uid:app.user.id,code:a.code,code_text:a.code_text,code_type:a.code_type,dx_group:f,dx_type:h,dx_order:i};b=c.store.add(j),c.addIcd(b[0],f,i)}},removeIcds:function(){Ext.Object.each(this.dxGroup,function(a,b){Ext.destroy(b)}),this.dxGroup={}},loadIcds:function(a){var b=this,c=a.data.items;b.store=a,b.removeIcds(),b.loading=!0;for(var d=0;d<c.length;d++)b.addIcd(c[d],c[d].data.dx_group,c[d].data.dx_order);b.loading=!1,b.getIcdLiveSearch().reset()},addIcd:function(a,b,c){var d=this;d.getDxCell(b,c).add({xtype:"panel",closable:!0,title:a.get("code")+" ("+a.get("dx_type")+")",dxRecord:a,width:120,margin:"0 5 0 0",name:this.name,editable:!1,action:"Dx",draggable:{moveOnDrag:!1,ddGroup:"group-"+b+"-dx"},listeners:{render:function(b){b.el.dom.setAttribute("data-qtip","<b>"+a.get("code")+"</b>: "+a.get("code_text"))},close:function(a){d.store.remove(a.dxRecord)}}})},getDxCell:function(a,b){return this.getGroupContainer(a).getComponent(this.id+"-dx-order-"+b)},getIcdLiveSearch:function(){return this.query("liveicdxsearch")[0]},getDxGroupCombo:function(){return this.query("#"+this.id+"-group-cmb")[0]},getDxTypeCombo:function(){return this.query("#"+this.id+"-dx-type-cmb")[0]},getNextOrder:function(a){var b,c=this.getGroupContainer(a).query("container[action=pointer]"),d=c.length;for(b=0;d>b;b++)if(0==c[b].items.items.length)return b+1;return!1},onReOrder:function(a){var b,c=a.query("container[action=pointer]");b=c.length;for(var d=0;b>d;d++)c[d].items.items.length>0&&"Dx"==c[d].items.items[0].action&&c[d].items.items[0].dxRecord.set({dx_order:d+1})},sync:function(){this.store.sync()}}),Ext.define("App.view.patient.CheckoutAlertsView",{extend:"Ext.view.View",alias:"widget.checkoutalertsview",trackOver:!0,cls:"checkoutalert",itemSelector:"div.alert-div",loadMask:!0,singleSelect:!0,emptyText:'<span style="color: #616161; font-size: 12px;">'+_("sweet")+" "+_("no_alerts_found")+".</span>",initComponent:function(){var a=this;a.tpl='<table><tpl for="."><tr class="alert-div><div class="alert-div"><img class="alert-img" src="{icon}" /><div class="alert-msg">{alert}</div></div></tr></tpl></table>',a.callParent(arguments)}}),Ext.define("App.store.patient.DoctorsNotes",{extend:"Ext.data.Store",model:"App.model.patient.DoctorsNote",autoLoad:!1}),Ext.define("App.view.patient.DoctorsNotes",{extend:"Ext.grid.Panel",requires:["App.store.patient.DoctorsNotes","App.ux.grid.RowFormEditing","App.ux.form.fields.MultiText","App.ux.combo.Templates"],xtype:"patientdoctorsnotepanel",title:_("doc_nt"),itemId:"DoctorsNotes",columnLines:!0,store:Ext.create("App.store.patient.DoctorsNotes",{storeId:"DoctorsNotesStore",groupField:"group_date",remoteFilter:!0,pageSize:200,sorters:[{property:"order_date",direction:"DESC"}]}),selModel:Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:!1}),features:[{ftype:"grouping"}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove")}]},{xtype:"datecolumn",text:_("date"),dataIndex:"order_date",format:g("date_display_format")},{text:_("type"),dataIndex:"template_id",renderer:function(a){return App.Current.getController("patient.DoctorsNotes").templatesRenderer(a)},allowBlank:!1},{xtype:"datecolumn",text:_("from"),dataIndex:"from_date",format:g("date_display_format")},{xtype:"datecolumn",text:_("to"),dataIndex:"to_date",format:g("date_display_format")},{text:_("comments"),dataIndex:"comments",flex:1},{text:_("restrictions"),dataIndex:"string_restrictions",flex:1}],tbar:["->","-",{text:_("new_note"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"newDoctorsNoteBtn"},"-",{text:_("print"),iconCls:"icoPrint",disabled:!0,margin:"0 5 0 0",itemId:"printDoctorsNoteBtn"}]}),Ext.define("App.view.patient.EncounterDocumentsGrid",{extend:"Ext.grid.Panel",requires:["Ext.grid.feature.Grouping"],xtype:"encounterdocumentsgrid",title:_("documents"),split:!0,features:[{ftype:"grouping",collapsible:!1,groupHeaderTpl:"{name}'s"}],selType:"checkboxmodel",store:Ext.create("Ext.data.Store",{fields:["id","record_id","description","document_type","controller","method"],proxy:{type:"memory"},groupField:"document_type",storeId:"EncounterDocumentsGridStore"}),columns:[{header:_("description"),dataIndex:"description",flex:1}],tools:[{xtype:"button",icon:"resources/images/icons/preview.png",tooltip:_("view"),margin:"0 5 0 0",itemId:"EncounterDocumentsViewBtn"},{xtype:"button",icon:"resources/images/icons/printer.png",tooltip:_("print"),itemId:"EncounterDocumentsPrintBtn"}],loadDocs:function(a){App.app.getController("patient.encounter.EncounterDocuments").loadDocumentsByEid(this,a)
}}),Ext.define("App.store.patient.Vitals",{extend:"Ext.data.Store",requires:["App.model.patient.Vitals"],model:"App.model.patient.Vitals",groupField:"group_field"}),Ext.define("App.view.patient.Vitals",{extend:"Ext.panel.Panel",requires:["Ext.grid.plugin.RowEditing","App.ux.form.fields.DateTime"],xtype:"vitalspanel",title:_("vitals"),layout:"border",bodyPadding:5,items:[{xtype:"container",height:100,region:"north",itemId:"vitalsBlocks",layout:{type:"hbox",align:"stretch"},defaults:{xtype:"container",cls:"latest-vitals-items",margin:"0 5 5 5",width:130},items:[{itemId:"pulseBlock",html:'<p class="title">'+_("pulse")+'</p><p class="value">--</p><p class="extra">--</p>'},{itemId:"bpBlock",margin:"0 5 5 0",html:'<p class="title">'+_("bp")+'</p><p class="value">--/--</p><p class="extra">'+_("systolic")+"/"+_("diastolic")+"</p>"},{itemId:"tempBlock",html:'<p class="title">'+_("temp")+'</p><p class="value">--</p><p class="extra">--</p>'},{itemId:"weighBlock",html:'<p class="title">'+_("weight")+'</p><p class="value">--</p>'},{itemId:"heightBlock",html:'<p class="title">'+_("height")+'</p><p class="value">--</p>'},{itemId:"bmiBlock",html:'<p class="title">'+_("bmi")+'</p><p class="value">--</p><p class="extra">--</p>'},{itemId:"notesBlock",margin:"0 5 5 5",html:'<p class="title">'+_("notes")+'</p><p class="value" style="text-align: left"> -- </p><p class="extra">--</p>',flex:1}]},{xtype:"grid",region:"center",flex:1,itemId:"historyGrid",multiSelect:!0,store:Ext.create("App.store.patient.Vitals",{remoteFilter:!0,sorters:[{property:"id",direction:"DESC"}]}),stateId:"VitalsHistoryGrid",stateful:!0,features:[{ftype:"grouping",groupHeaderTpl:"{name}"}],plugins:[{ptype:"rowediting"}],viewConfig:{getRowClass:function(a){return 0===a.data.auth_uid?"unsignedVital":""}},tbar:[{xtype:"button",icon:"resources/images/icons/blueInfo.png",focusCls:"",handler:function(){App.app.getController("InfoButton").doGetInfoByUrl("https://vsearch.nlm.nih.gov/vivisimo/cgi-bin/query-meta?v%3Aproject=medlineplus&query=vitals+signs&x=0&y=0")}},"-",{xtype:"button",text:"Charts",itemId:"vitalChartsBtn"},"-","->","-",{text:_("vitals"),iconCls:"icoAdd",itemId:"vitalAddBtn",action:"encounterRecordAdd"},"-",{text:_("sign"),icon:"resources/images/icons/pen.png",itemId:"vitalSignBtn",action:"encounterRecordAdd"}]},{xtype:"form",title:"Diagnoses",height:100,region:"south",collapsible:!0,stateful:!0,stateId:"VitalsDxFromPanelState",bodyPadding:5,items:[{xtype:"icdsfieldset",margin:"5 0 10 0",itemId:"VitalsDxCodesField"}]}],initComponent:function(){var a=this,b=[{text:"eid",dataIndex:"eid",hidden:!0,width:50},{xtype:"actioncolumn",width:20,stateId:"VitalsHistoryGridActionCol",items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("patient.Vitals").onRxOrdersDeleteActionHandler(a,b,c,d,e,f)}}]},{xtype:"datecolumn",text:_("date"),dataIndex:"date",format:"Y-m-d g:i a",width:180,stateId:"VitalsHistoryGridDateCol",editor:{xtype:"mitos.datetime",timeFormat:"g:i a"}},{text:_("bp"),stateId:"VitalsHistoryGridBpCol",columns:[{text:_("systolic"),dataIndex:"bp_systolic",width:65,stateId:"VitalsHistoryGridBpSystolicCol",editor:{xtype:"textfield",vtype:"numeric"}},{text:_("diastolic"),dataIndex:"bp_diastolic",width:65,stateId:"VitalsHistoryGridBpDiastolicCol",editor:{xtype:"textfield",vtype:"numeric"}}]}];b.push("metric"!=g("units_of_measurement")?{text:_("temp"),dataIndex:"temp_f",width:70,stateId:"VitalsHistoryGridTempFCol",editor:{xtype:"textfield",itemId:"vitalTempFField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+"&deg;F"}}:{text:_("temp"),dataIndex:"temp_c",width:70,stateId:"VitalsHistoryGridTempCCol",editor:{xtype:"textfield",itemId:"vitalTempCField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+"&deg;C"}}),b.push({text:_("temp_location"),dataIndex:"temp_location",stateId:"VitalsHistoryGridTempLocationCol",editor:{xtype:"gaiaehr.combo",list:62}}),"metric"!=g("units_of_measurement")?(b.push({text:_("weight_lbs"),dataIndex:"weight_lbs",width:80,stateId:"VitalsHistoryGridWeightLbsCol",editor:{xtype:"textfield",itemId:"vitalWeightLbsField",vtype:"numericWithSlash",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" lbs/oz"}}),b.push({text:_("height_in"),dataIndex:"height_in",width:70,stateId:"VitalsHistoryGridHeightInCol",editor:{xtype:"textfield",itemId:"vitalHeightInField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" in"}}),b.push({text:_("hc"),dataIndex:"head_circumference_in",width:70,stateId:"VitalsHistoryGridHeadCircumferenceCol",editor:{xtype:"textfield",itemId:"vitalHeadCircumferenceInField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" in"}})):(b.push({text:_("weight"),dataIndex:"weight_kg",width:80,stateId:"VitalsHistoryGridWeightKgCol",editor:{xtype:"textfield",itemId:"vitalWeightKgField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" kg"}}),b.push({text:_("height_cm"),dataIndex:"height_cm",stateId:"VitalsHistoryGridHeightCmCol",width:70,editor:{xtype:"textfield",itemId:"vitalHeightCmField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" cm"}}),b.push({text:_("hc"),dataIndex:"head_circumference_cm",width:70,stateId:"VitalsHistoryGridHeadCircumferenceCol",editor:{xtype:"textfield",itemId:"vitalHeadCircumferenceCmField",vtype:"numericWithDecimal",enableKeyEvents:!0},renderer:function(a){return 0===a||null===a?"":a+" in"}})),b.push({text:_("pulse"),dataIndex:"pulse",width:60,stateId:"VitalsHistoryGridPulseCol",editor:{xtype:"textfield",vtype:"numeric"},renderer:function(a){return 0===a||null===a?"":a}}),b.push({text:_("respiration"),dataIndex:"respiration",stateId:"VitalsHistoryGridRespitarionCol",editor:{xtype:"textfield",vtype:"numeric"},renderer:function(a){return 0===a||null===a?"":a}}),b.push({text:_("bmi"),dataIndex:"bmi",stateId:"VitalsHistoryGridBmiCol",width:50}),b.push({text:_("o2%"),dataIndex:"oxygen_saturation",stateId:"VitalsHistoryGridOxygenSaturationCol",width:50,editor:{xtype:"textfield",vtype:"numericWithDecimal"}}),b.push({text:_("fio2%"),dataIndex:"oxygen_inhaled_concentration",stateId:"VitalsHistoryGridInhaledOxygenConcentrationCol",width:50,editor:{xtype:"textfield",vtype:"numericWithDecimal"}}),b.push({text:_("other_notes"),dataIndex:"other_notes",stateId:"VitalsHistoryGridOtherNotesCol",flex:1,editor:{xtype:"textfield"}}),b.push({text:_("administer_by"),dataIndex:"administer_by",stateId:"VitalsHistoryGridAdministerCol"}),b.push({text:_("authorized_by"),dataIndex:"authorized_by",stateId:"VitalsHistoryGridAuthorizedCol"}),a.items[1].columns=b,a.callParent()}}),Ext.define("App.store.patient.PatientImmunization",{extend:"Ext.data.Store",model:"App.model.patient.PatientImmunization"}),Ext.define("App.store.patient.Allergies",{extend:"Ext.data.Store",model:"App.model.patient.Allergies"}),Ext.define("App.store.patient.PatientActiveProblems",{extend:"Ext.data.Store",requires:["App.model.patient.PatientActiveProblem"],model:"App.model.patient.PatientActiveProblem"}),Ext.define("App.store.patient.Medications",{extend:"Ext.data.Store",storeId:"patientMedicationsStore",model:"App.model.patient.Medications",groupField:"STR",startCollapsed:!0}),Ext.define("App.view.patient.NewPatient",{extend:"App.ux.RenderPanel",pageTitle:_("patient_entry_form"),initComponent:function(){var a=this;a.pageBody=[a.newPatientPanel=Ext.create("App.view.patient.Patient")],a.callParent(arguments)},confirmationWin:function(a){Ext.Msg.show({title:_("please_confirm")+"...",msg:_("do_you_want_to_create_a_new_patient"),icon:Ext.MessageBox.QUESTION,buttons:Ext.Msg.YESNO,scope:this,fn:function(b){a(b)}})},onActive:function(a){var b=this;this.confirmationWin(function(c){"yes"==c?(b.newPatientPanel.loadNew(),app.unsetPatient(null,!0),a(!0)):(app.nav.goBack(),a(!1))})}}),Ext.define("App.view.patient.ProgressNote",{extend:"Ext.panel.Panel",alias:"widget.progressnote",bodyPadding:5,autoScroll:!0,loadMask:!1,initComponent:function(){var a=this;a.tpl=new Ext.XTemplate('<div class="progressNote" style="margin: 5px">   <div class="secession general-data">       <div class="title"> '+_("general")+' </div>       <table width="100%">           <tr>               <td>                   <div class="header row">'+_("name")+': {patient_name} </div>                   <div class="header row">'+_("record")+': #{pid} </div>                   <div class="header row">'+_("provider")+': {open_by} </div>                   <div class="header row">'+_("onset_date")+': {[values.onset_date || "-"]} </div>                   <div class="header row">'+_("referring_provider")+': {[this.getFullName(values.referring_physician_fname,values.referring_physician_mname,values.referring_physician_lname) || "-"]} </div>               </td>               <td>                   <div class="header row">'+_("service_date")+': {service_date} </div>                   <div class="header row">'+_("visit_category")+': {visit_category} </div>                   <div class="header row">'+_("facility")+': {facility} </div>                   <div class="header row">'+_("priority")+': {priority} </div>                   <div class="header row">'+_("signed_on")+': {[values.close_date || "-"]} </div>               </td>           </tr>           <tr>               <td colspan="2">                   <div class="header row" style="white-space: normal;">'+_("chief_complaint")+': {brief_description} </div>               </td>           </tr>       </table>   </div>   <tpl for="soap">       <div class="secession">           <div class="title"> '+_("soap")+" </div>           <p><span>"+_("subjective")+':</span> {[this.doHtmlDecode(values.subjective) || "-"]} </p>           <p><span>'+_("objective")+':</span> {[this.doHtmlDecode(values.objective) || "-"]}</p>           <p><span>'+_("assessment")+':</span> {[this.doHtmlDecode(values.assessment) || "-"]}</p>           <p><span>'+_("plan")+':</span> {[this.doHtmlDecode(values.plan) || "-"]}</p>       </div>   </tpl>   <tpl for="speechdictation">       <div class="secession">           <div class="title"> '+_("speech_dictation")+" </div>           <p><span>"+_("dictation")+":</span> {dictation}</p>           <p><span>"+_("additional_notes")+':</span> {additional_notes}</p>       </div>   </tpl>   <tpl if="addenda != \'NONE\'">       <div class="secession">       	<div class="title"> '+_("addenda")+' </div>           <p>{[this.doHtmlDecode(values.addenda) || "-"]} </p>       </div>   </tpl></div>',{isNotNull:function(a){return"null"!=a&&null!=a},isNotEmpty:function(){},getVitalsValue:function(a){return 0==a||null==a?"-":a},isMetric:function(){return"metric"==g("units_of_measurement")},doHtmlDecode:function(a){return Ext.String.htmlDecode(a)},getFullName:function(a,b,c){return this.capitalizeEveryWord(Ext.String.format("{0}, {1} {2}",c||"",a||"",b||""),!0)},capitalizeEveryWord:function(a,b){return(b?a.toLowerCase():a).replace(/(?:^|\s|["'([{])+\S/g,function(a){return a.toUpperCase()})}}),a.callParent(arguments)}}),Ext.define("App.store.patient.Reminders",{extend:"Ext.data.Store",model:"App.model.patient.Reminder"}),Ext.define("App.view.patient.Reminders",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing"],xtype:"patientreminderspanel",title:_("reminders"),store:Ext.create("App.store.patient.Reminders"),plugins:{ptype:"rowediting",autoCancel:!1,errorSummary:!1,clicksToEdit:2},columns:[{xtype:"datecolumn",text:_("date"),dataIndex:"reminder_date",editor:{xtype:"datefield"}},{text:_("type"),dataIndex:"reminder_type",editor:{xtype:"combobox",queryMode:"local",displayField:"option",valueField:"value",store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"Appointment",value:"appointment"},{option:"Clinical",value:"clinical"}]})}},{text:_("note"),flex:1,dataIndex:"reminder_note",editor:{xtype:"textfield"}}],tbar:["->",{text:_("add_reminder"),iconCls:"icoAdd",itemId:"PatientRemindersAddBtn"}]}),Ext.define("App.store.patient.Alerts",{extend:"Ext.data.Store",model:"App.model.patient.Alert"}),Ext.define("App.view.patient.Alerts",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing"],xtype:"patientalertspanel",title:_("alerts"),store:Ext.create("App.store.patient.Alerts"),plugins:{ptype:"rowediting",autoCancel:!1,errorSummary:!1,clicksToEdit:2},columns:[{xtype:"datecolumn",text:_("date"),format:"Y-m-d",dataIndex:"date"},{header:_("type"),dataIndex:"type",width:200,editor:{xtype:"gaiaehr.combo",list:130}},{text:_("note"),dataIndex:"body",flex:1,editor:{xtype:"textfield"}},{text:_("user"),width:225,dataIndex:"user_name"},{text:_("active"),width:50,dataIndex:"active",renderer:function(a,b,c){return app.boolRenderer(a,b,c)},editor:{xtype:"checkbox"}}],tbar:["->",{text:_("add_alert"),iconCls:"icoAdd",itemId:"AlertsAddBtn"}]}),Ext.define("App.store.patient.PatientsOrders",{extend:"Ext.data.Store",model:"App.model.patient.PatientsOrders",remoteSort:!1,autoLoad:!1}),Ext.define("App.view.patient.Results",{extend:"Ext.panel.Panel",requires:["Ext.grid.plugin.CellEditing","Ext.grid.plugin.RowEditing","Ext.tab.Panel","App.store.patient.PatientsOrders","App.ux.LiveLabsSearch","App.ux.LiveRadsSearch","App.ux.LiveReferringPhysicianSearch","App.ux.window.voidComment","App.ux.form.fields.DateTime"],title:_("res"),xtype:"patientresultspanel",layout:"border",tbar:["->",{text:_("lab_result"),itemId:"ResultsLabOrderNewBtn",iconCls:"icoAdd"},{text:_("rad_result"),itemId:"ResultsRadOrderNewBtn",iconCls:"icoAdd"}],items:[{xtype:"grid",itemId:"ResultsOrdersGrid",action:"orders",region:"center",columnLines:!0,allowDeselect:!0,frame:!0,store:Ext.create("App.store.patient.PatientsOrders",{remoteFilter:!0}),plugins:[{pluginId:"ResultsOrdersGridRowEditor",ptype:"rowediting",errorSummary:!1}],columns:[{xtype:"actioncolumn",width:25,items:[{icon:"resources/images/icons/blueInfo.png",tooltip:"Get Info",handler:function(a,b,c,d,e,f){App.app.getController("InfoButton").doGetInfo(f.data.code,f.data.code_type,f.data.description)}}]},{header:_("void"),width:30,dataIndex:"void",tooltip:_("void"),editor:{xtype:"checkbox",itemid:"ResultsOrdersGridOrderVoidCheckbox"},renderer:function(a){return app.voidRenderer(a)}},{header:_("type"),width:100,dataIndex:"order_type",renderer:function(a,b,c){var d="";return c.get("void")&&(d="text-decoration: line-through;"),"lab"==c.data.order_type?'<span style="'+d+'">'+_("laboratory")+"</span>":"rad"==c.data.order_type?'<span style="'+d+'">'+_("radiology")+"</span>":void 0},editor:{xtype:"combobox",itemId:"ResultsOrdersGridOrderTypeCombo",store:Ext.create("Ext.data.Store",{fields:["type","order_type"],data:[{type:"Laboratory",order_type:"lab"},{type:"Radiology",order_type:"rad"}]}),allowBlank:!1,editable:!1,queryMode:"local",displayField:"type",valueField:"order_type"}},{xtype:"datecolumn",format:"Y-m-d",header:_("date_ordered"),dataIndex:"date_ordered",menuDisabled:!0,resizable:!1,width:100,editor:{xtype:"datefield",allowBlank:!0},renderer:function(a,b,c){var d;return d=a?Ext.util.Format.date(a,this.format):"",c.get("void")?'<span style="text-decoration: line-through;">'+d+"</span>":"<span>"+d+"</span>"}},{header:_("order_description"),dataIndex:"description",menuDisabled:!0,resizable:!1,flex:1,editor:{xtype:"labslivetsearch",itemId:"ResultsLabsLiveSearchField",allowBlank:!1},renderer:function(a,b,c){return c.get("void")?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("status"),dataIndex:"status",menuDisabled:!0,resizable:!1,width:60,renderer:function(a,b,c){return c.get("void")?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}}]},{xtype:"panel",border:!1,region:"south",split:!0,frame:!0,itemId:"ResultsCardPanel",height:400,hidden:!0,layout:"card",activeItem:0,items:[{xtype:"panel",frame:!1,itemId:"ResultsLaboratoryPanel",layout:{type:"border"},tools:[{xtype:"button",text:_("view_document"),icon:"resources/images/icons/icoView.png",itemId:"ResultsLaboratoryPanelDocumentViewBtn"}],items:[{xtype:"form",title:_("report_info"),itemId:"ResultsLaboratoryForm",region:"west",collapsible:!0,autoScroll:!0,width:400,bodyPadding:5,split:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:_("report_info"),defaults:{xtype:"textfield",anchor:"100%"},layout:"anchor",items:[{xtype:"datefield",fieldLabel:_("report_date"),name:"result_date",allowBlank:!1},{fieldLabel:_("report_number"),name:"performer_order_id",allowBlank:!1},{xtype:"combobox",fieldLabel:_("status"),name:"result_status",queryMode:"local",displayField:"option",valueField:"value",store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"Aborted",value:"aborted"},{option:"Active",value:"active"},{option:"Cancelled",value:"cancelled"},{option:"Completed",value:"completed"},{option:"Held",value:"held"},{option:"Suspended",value:"suspended"}]})},{xtype:"mitos.datetime",fieldLabel:_("observation_date"),name:"observation_date",allowBlank:!1},{fieldLabel:_("specimen"),name:"specimen_text"},{xtype:"textareafield",fieldLabel:_("specimen_notes"),name:"specimen_notes",height:50},{xtype:"filefield",labelAlign:"top",fieldLabel:_("upload_document"),action:"ResultsLaboratoryFormUploadField",submitValue:!1}]},{xtype:"fieldset",title:_("performer"),defaults:{anchor:"100%"},layout:"anchor",margin:0,items:[{xtype:"referringphysicianlivetsearch",fieldLabel:_("name"),hideLabel:!1,name:"performer_name"},{xtype:"textareafield",fieldLabel:_("address"),name:"performer_address",height:50}]}]},{xtype:"treepanel",itemId:"ResultsLaboratoryObservationsGrid",action:"observations",animate:!1,rootVisible:!1,flex:1,region:"center",split:!0,border:!1,columnLines:!0,plugins:[{ptype:"cellediting",clicksToEdit:1}],columns:[{xtype:"treecolumn",text:_("name"),menuDisabled:!0,dataIndex:"code_text",width:350,renderer:function(a,b,c){var d=c.get("code");return""!=d&&(a=a+" ("+d+")"),a}},{xtype:"actioncolumn",width:25,items:[{icon:"resources/images/icons/blueInfo.png",tooltip:_("get_info"),handler:function(a,b,c,d,e,f){App.app.getController("InfoButton").doGetInfo(f.data.code,f.data.code_type,f.data.code_text)}}]},{text:_("value"),menuDisabled:!0,dataIndex:"value",width:180,editor:{xtype:"textfield"},renderer:function(a,b,c){var d=["LL","HH",">","<","AA","VS"],e=["L","H","A","W","MS"],f=["B","S","U","D","R","I"],g=["N"];return Ext.Array.contains(g,c.data.abnormal_flag)?'<span style="color:green;">'+a+"</span>":Ext.Array.contains(f,c.data.abnormal_flag)?'<span style="color:blue;">'+a+"</span>":Ext.Array.contains(e,c.data.abnormal_flag)?'<span style="color:orange;">'+a+"</span>":Ext.Array.contains(d,c.data.abnormal_flag)?'<span style="color:red;">'+a+"</span>":a}},{text:_("units"),menuDisabled:!0,dataIndex:"units",width:75,editor:{xtype:"textfield"}},{text:_("abnormal"),menuDisabled:!0,dataIndex:"abnormal_flag",width:75,editor:{xtype:"textfield"},renderer:function(a){var b=["LL","HH",">","<","AA","VS"],c=["L","H","A","W","MS"],d=["B","S","U","D","R","I"],e=["N"];return Ext.Array.contains(e,a)?'<span style="color:green;">'+a+"</span>":Ext.Array.contains(d,a)?'<span style="color:blue;">'+a+"</span>":Ext.Array.contains(c,a)?'<span style="color:orange;">'+a+"</span>":Ext.Array.contains(b,a)?'<span style="color:red;">'+a+"</span>":a}},{text:_("range"),menuDisabled:!0,dataIndex:"reference_rage",width:150,editor:{xtype:"textfield"}},{text:_("notes"),menuDisabled:!0,dataIndex:"notes",width:300,editor:{xtype:"textfield"}},{text:_("status"),menuDisabled:!0,dataIndex:"observation_result_status",width:60,editor:{xtype:"textfield"}}]}]},{xtype:"panel",itemId:"ResultsRadiologyPanel",frame:!0,layout:{type:"border"},items:[{xtype:"form",title:_("report"),itemId:"ResultsRadiologyForm",region:"west",collapsible:!0,autoScroll:!0,width:400,bodyPadding:5,split:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:_("report"),defaults:{xtype:"textfield",anchor:"100%"},layout:"anchor",items:[{xtype:"datefield",fieldLabel:_("report_date"),name:"result_date",format:"Y-m-d",allowBlank:!1},{fieldLabel:_("report_number"),name:"performer_order_id",allowBlank:!1},{xtype:"combobox",fieldLabel:_("status"),name:"result_status",queryMode:"local",displayField:"option",valueField:"value",store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"Aborted",value:"aborted"},{option:"Active",value:"active"},{option:"Cancelled",value:"cancelled"},{option:"Completed",value:"completed"},{option:"Held",value:"held"},{option:"Suspended",value:"suspended"}]})},{xtype:"fileuploadfield",fieldLabel:_("report_document"),itemId:"ResultsRadiologyFormUploadField",submitValue:!1}]},{xtype:"fieldset",title:_("study"),defaults:{xtype:"textfield",anchor:"100%"},layout:"anchor",items:[{xtype:"button",text:_("view"),margin:"0 0 8 0",itemId:"ResultsRadiologyFormViewStudyBtn"}]},{xtype:"fieldset",title:_("performer"),defaults:{xtype:"textfield",anchor:"100%"},layout:"anchor",margin:0,items:[{xtype:"referringphysicianlivetsearch",fieldLabel:_("name"),hideLabel:!1,name:"performer_name"},{xtype:"textareafield",fieldLabel:_("address"),name:"radiologist_address",height:50}]}]},{xtype:"tabpanel",region:"center",items:[{xtype:"panel",title:_("report"),layout:"fit",items:[{xtype:"textareafield",itemId:"ResultsRadiologyReportBody"}]},{xtype:"panel",title:_("document"),layout:"fit",items:[{xtype:"miframe",region:"center",itemId:"ResultsRadiologyDocumentIframe"}]}]}]}],buttons:[{text:_("sign"),iconCls:"icoSing",disabled:!0,itemId:"ResultsOrderSignBtn"},"->",{text:_("reset"),itemId:"ResultsOrderResetBtn"},{text:_("save"),itemId:"ResultsOrderSaveBtn"}]}]}),Ext.define("App.store.patient.PatientSocialHistory",{extend:"Ext.data.Store",requires:["App.model.patient.PatientSocialHistory"],model:"App.model.patient.PatientSocialHistory",groupField:"category_code_text"}),Ext.define("App.view.patient.SocialHistory",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","Ext.grid.feature.Grouping","App.store.patient.PatientSocialHistory","App.ux.combo.Combo","App.ux.grid.DeleteColumn"],xtype:"patientsocialhistorypanel",itemId:"PatientSocialHistoryGrid",columnLines:!0,store:Ext.create("App.store.patient.PatientSocialHistory",{remoteFilter:!0}),plugins:[{ptype:"rowediting",errorSummary:!1}],features:[{ftype:"grouping",groupHeaderTpl:_("type")+": {name}"}],columns:[{xtype:"griddeletecolumn",acl:a("delete_social_history"),width:25},{text:_("type"),dataIndex:"category_code_text",width:250},{text:_("observation"),dataIndex:"observation",flex:1,itemId:"socialhistorypanelobservationcolumn",editor:{xtype:"textfield",allowBlank:!1}},{text:_("note"),dataIndex:"note",flex:1,editor:{xtype:"textfield"}},{xtype:"datecolumn",text:_("start"),dataIndex:"start_date",format:"Y-m-d",width:120,editor:{xtype:"datefield",format:"Y-m-d",allowBlank:!1}},{xtype:"datecolumn",text:_("end"),dataIndex:"end_date",format:"Y-m-d",width:120,editor:{xtype:"datefield",format:"Y-m-d"}}],tbar:[{xtype:"tbtext",text:_("social_history"),width:100},{xtype:"gaiaehr.combo",width:250,list:101,allowBlank:!1,action:"socialHistoryTypeCombo"},{iconCls:"icoAdd",disabled:!0,itemId:"encounterRecordAdd",action:"socialHistoryAddBtn"}]}),Ext.define("App.view.patient.SocialPsychologicalBehavioral",{extend:"Ext.panel.Panel",requires:[],itemId:"SocialPsychologicalBehavioralPanel",xtype:"socialpsychologicalbehavioralpanel",title:_("psychological_behavioral"),layout:"border",tbar:[{text:_("spb"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"SocialPsychologicalBehavioralAddBtn"}],initComponent:function(){var a=this,b=Ext.create("App.store.patient.SocialPsychologicalBehavioral",{remoteFilter:!0});a.items=[{xtype:"grid",store:b,region:"west",width:450,itemId:"SocialPsychologicalBehavioralGrid",columns:[{xtype:"datecolumn",text:_("observation_date"),dataIndex:"create_date",format:"F j, Y",width:110},{text:_("pay_basic_needs"),dataIndex:"pay_basics",width:110,renderer:function(a){var b={0:"Very hard",1:"Hard",2:"Somewhat hard",3:"3rd grade",4:"Not very hard"};return b[a]?b[a]:a}},{text:_("education"),dataIndex:"edu_highest_grade",width:100,renderer:function(a){var b={0:"Never attended/kindergarten only",1:"1st grade",2:"2nd grade",3:"3rd grade",4:"4th grade",5:"5th grade",6:"6th grade",7:"7th grade",8:"8th grade",9:"9th grade",10:"10th grade",11:"11th grade",12:"12th grade, no diploma",13:"High school graduate",14:"GED or equivalent",15:"Some college, no degree",16:"Associate degree: occupational, technical, or vocational program",17:"Associate degree: academic program",18:"Bachelor's degree",19:"Master's degree",20:"Professional school degree",21:"Doctoral degree",77:"Refused",99:"Don't know"};return b[a]?b[a]:a}},{text:_("exercise"),dataIndex:"exercise",flex:1,renderer:function(a,b,c){return Ext.String.format("for {0} min(s) {1} in a week",c.get("exercise_past_days_minutes"),c.get("exercise_past_days_amount"))}}]},{xtype:"panel",layout:"fit",region:"center",items:[{xtype:"chart",itemId:"SocialPsychologicalBehavioralChart",animate:!0,store:b,legend:{position:"top"},axes:[{type:"Numeric",position:"left",fields:["stress_level","patient_health_score","patient_drink_score","patient_isolation_score","patient_humiliation_score"],title:"Scores",grid:!0,minimum:0},{type:"Time",position:"bottom",fields:["create_date"],title:"Date",dateFormat:"M j, Y"}],series:[{type:"line",highlight:{size:7,radius:7},axis:"left",xField:"create_date",yField:["stress_level"],title:"Stress Lvl",showInLegend:!0,markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}},{type:"line",highlight:{size:7,radius:7},axis:"left",xField:"create_date",yField:["patient_health_score"],title:"PHQ-2 Score",showInLegend:!0,markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}},{type:"line",highlight:{size:7,radius:7},axis:"left",xField:"create_date",yField:"patient_drink_score",title:"AUDIT-C Score",showInLegend:!0,markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}},{type:"line",highlight:{size:7,radius:7},axis:"left",xField:"create_date",yField:"patient_isolation_score",title:"NHANES Score",showInLegend:!0,markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}},{type:"line",highlight:{size:7,radius:7},axis:"left",xField:"create_date",yField:"patient_humiliation_score",title:"HARK Score",showInLegend:!0,markerConfig:{type:"circle",size:4,radius:4,"stroke-width":0}}]}]}],a.callParent()}}),Ext.define("App.view.patient.Visits",{extend:"App.ux.RenderPanel",pageTitle:_("visits_history"),uses:["Ext.grid.Panel","Ext.ux.PreviewPlugin","App.view.patient.EncountersGrid"],itemId:"PatientVisitsPanel",showRating:!0,initComponent:function(){var a=this;a.historyGrid=Ext.create("App.view.patient.EncountersGrid"),a.pageBody=[a.historyGrid],a.callParent(arguments)}}),Ext.define("App.view.fees.PaymentEntryWindow",{extend:"Ext.window.Window",title:_("add_new_payment"),closeAction:"hide",modal:!0,initComponent:function(){var a=this;a.items=[{xtype:"form",defaults:{margin:5},border:!1,height:163,width:747,items:[{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("paying_entity"),xtype:"mitos.payingentitycombo",name:"paying_entity",action:"new_payment",labelWidth:98,width:220},{xtype:"patienlivetsearch",fieldLabel:_("from"),hideLabel:!1,name:"payer_id",action:"new_payment",anchor:null,labelWidth:42,width:300,margin:"0 0 0 25"},{xtype:"textfield",fieldLabel:_("no"),action:"new_payment",name:"check_number",labelWidth:47,width:167,margin:"0 0 0 25"}]},{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("payment_method"),xtype:"mitos.paymentmethodcombo",action:"new_payment",labelWidth:98,name:"payment_method",width:220},{xtype:"mitos.billingfacilitiescombo",fieldLabel:_("pay_to"),action:"new_payment",labelWidth:42,name:"pay_to",width:300,margin:"0 0 0 25"},{xtype:"mitos.currency",fieldLabel:_("amount"),action:"new_payment",name:"amount",labelWidth:47,width:167,margin:"0 0 0 25",enableKeyEvents:!0}]},{fieldLabel:_("post_to_date"),xtype:"datefield",name:"post_to_date",action:"new_payment",format:g("date_display_format"),labelWidth:98,width:220},{fieldLabel:_("note"),xtype:"textareafield",grow:!0,action:"new_payment",name:"note",labelWidth:98,anchor:"100%"}]}],a.buttons=[{text:_("save"),scope:a,handler:a.onPaymentSave},"-",{text:_("reset"),scope:a,handler:a.resetNewPayment}],a.callParent(arguments)},onPaymentSave:function(){var a,b,c,d=this;a=d.down("form"),b=a.getForm(),c=b.getFieldValues(),c.date_created=Ext.Date.format(new Date,"Y-m-d H:i:s"),b.isValid()&&Fees.addPayment(c,function(a,c){c.result.success?(b.reset(),d.hide()):app.msg("Oops!",_("payment_entry_error"))})},resetNewPayment:function(){for(var a=this.query('[action="new_payment"]'),b=0;b<a.length;b++)a[b].reset()}}),Ext.define("App.view.patient.VisitCheckout",{extend:"App.ux.RenderPanel",id:"panelVisitCheckout",pageTitle:"Visit Checkout",showRating:!0,initComponent:function(){var a=this;a.VisitVoucherStore=Ext.create("App.store.account.Voucher",{remoteFilter:!0}),a.pageBody=Ext.create("Ext.panel.Panel",{itemId:"visitpayment",defaults:{bodyStyle:"padding:15px",bodyBorder:!0,labelWidth:110},layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[a.invoicePanel=Ext.widget("panel",{title:_("services_charges"),border:!0,frame:!0,bodyBorder:!0,bodyStyle:"background-color:#fff",margin:"5 5 0 5",flex:2,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1,autoScroll:!0,items:[a.invoiceGrid=Ext.widget("grid",{frame:!1,border:!1,enableColumnMove:!1,enableColumnHide:!1,sortableColumns:!1,columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveCharge}]},{header:_("item"),dataIndex:"name",flex:1,editor:{xtype:"livecptsearch",allowBlank:!1}},{header:_("price"),width:80,dataIndex:"amountOriginal",align:"right",renderer:a.currencyRenderer},{header:_("charge"),width:80,dataIndex:"amount",align:"right",editor:{xtype:"textfield",allowBlank:!1},renderer:a.currencyRenderer}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2})]}),{xtype:"container",border:!1,padding:1,height:200,items:[{xtype:"container",style:"float:right",layout:"anchor",width:150,items:[a.total=Ext.widget("mitos.currency",{fieldLabel:_("total"),labelWidth:70,anchor:"100%",labelAlign:"right",cls:"charges_total",margin:"2 0 1 0"}),a.paid=Ext.widget("mitos.currency",{fieldLabel:_("paid"),labelWidth:70,anchor:"100%",labelAlign:"right",margin:"1 0"}),a.balance=Ext.widget("mitos.currency",{fieldLabel:_("balance"),labelWidth:70,anchor:"100%",labelAlign:"right",cls:"charges_balance",margin:"2 0 1 0"})]}]}]},{xtype:"form",height:135,border:!1,items:[{xtype:"fieldset",layout:"column",margin:"5 10",title:_("payment"),items:[a.billingNotes=Ext.widget("textarea",{xtype:"textarea",anchor:"100%",name:"notes",columnWidth:.5,height:85,emptyText:_("additional_billing_notes")}),{xtype:"container",layout:"anchor",columnWidth:.5,margin:"0 0 0 15",items:[a.method=Ext.widget("mitos.paymentmethodcombo",{fieldLabel:_("payment_method"),labelWidth:100,name:"method",anchor:"100%"}),a.ref=Ext.widget("textfield",{fieldLabel:_("reference_#"),labelWidth:100,name:"reference",anchor:"100%"}),a.amount=Ext.widget("mitos.currency",{fieldLabel:_("amount"),xtype:"mitos.currency",labelWidth:100,name:"amount",anchor:"100%"})]}]}]}],buttons:["->",{text:_("save_and_print"),scope:a,action:"saveprint",handler:a.onInvoiceSave},{text:_("save"),scope:a,action:"save",handler:a.onInvoiceSave}],listeners:{scope:a,render:a.onInvoicePanelRender}}),a.docsGrid=Ext.widget("encounterdocumentsgrid",{title:_("documents"),frame:!0,margin:"5 5 0 0",flex:1})]},{xtype:"container",layout:"hbox",defaults:{height:170},items:[a.notesReminders=Ext.widget("form",{title:_("notes_and_reminders"),frame:!0,flex:2,action:"formnotes",bodyPadding:10,margin:"5 5 0 5",bodyBorder:!0,bodyStyle:"background-color:#fff",defaults:{anchor:"100%"},items:[{xtype:"displayfield",fieldLabel:_("message"),name:"message"},{xtype:"textfield",fieldLabel:_("note"),name:"new_note",action:"notes"},{xtype:"textfield",grow:!0,fieldLabel:_("reminders"),name:"new_reminder",action:"notes"}],buttons:[{text:_("reset"),scope:a,handler:a.resetNotes},"-",{text:_("save"),scope:a,handler:a.onCheckoutSaveNotes}]}),a.followUp=Ext.widget("form",{title:_("followup_information"),frame:!0,flex:1,margin:"5 5 5 0",bodyPadding:10,bodyBorder:!0,bodyStyle:"background-color:#fff",defaults:{labelWidth:110,anchor:"100%"},items:[{fieldLabel:_("time"),xtype:"textfield",name:"followup_time"},{fieldLabel:_("facility"),xtype:"activefacilitiescombo",name:"followup_facility"}],buttons:[{text:_("schedule_appointment"),scope:a,handler:a.scheduleAppointment}]})]}]}),a.callParent(arguments)
},onInvoicePanelRender:function(a){var b=this;a.getHeader().add({xtype:"button",text:_("service"),iconCls:"icoAdd",margin:"0 5 0 0",scope:b,handler:b.onNewService},{xtype:"button",text:_("copay"),iconCls:"icoAdd",margin:"0 5 0 0",scope:b,handler:b.onAddCoPay})},onNewService:function(){this.invoiceGrid.getStore().add({code_text:" ",charge:"20.00",ins:!1})},onAddCoPay:function(){this.invoiceGrid.getStore().add({code_text:"Co-Pay",charge:"00.00",ins:!1})},onAddService:function(){this.query('[action="totalField"]')[0]},onRemoveCharge:function(a,b){var c=this,d=a.getStore(),e=d.getAt(b);d.remove(e),c.updateTotalBalance()},onInvoiceSave:function(a){for(var b=this,c={},d=("saveprint"==a.action,b.VisitVoucherStore.data.items),e=[],f=0;f<d.length;f++)e.push(d[f].data);c.pid=b.pid,c.eid=b.eid,c.lines=e,c.payment={amount:b.amount.getValue(),method:b.method.getValue(),notes:b.billingNotes.getValue(),ref:b.ref.getValue()},AccBilling.setVisitVoucher(c,function(){})},cancelPrint:function(a){var b=a.up("window");b.close()},resetReceiptForm:function(){for(var a=this.query('[action="receipt"]'),b=0;b<a.length;b++)a[b].reset()},resetNotes:function(){for(var a=this.query('[action="notes"]'),b=0;b<a.length;b++)a[b].reset()},onAddPaymentClick:function(){app.onPaymentEntryWindow()},currencyRenderer:function(a){return'<span style="float:right; padding-right:17px">'+app.currency+" "+a+"</span>"},onCheckoutSaveNotes:function(){var a,b,c=this,d=c.query('form[action="formnotes"]');a=d[0].getForm(),b=a.getFieldValues(),b.date=Ext.Date.format(new Date,"Y-m-d H:i:s"),b.pid=app.patient.pid,b.eid=c.eid,b.uid=app.user.id,b.type="administrative",a.isValid()&&Patient.addPatientNoteAndReminder(b,function(a,b){b.result.success?app.msg(_("sweet"),_("note_and_reminder")):app.msg(_("oops"),_("note_entry_error"))})},scheduleAppointment:function(a){var b,c=a.up("form").getForm(),d=c.findField("followup_time").getValue(),e=c.findField("followup_facility").getValue(),f=Ext.getCmp("app-calendar");switch(d){case"1 Day":b=Ext.Date.add(new Date,Ext.Date.DAY,1);break;case"2 Days":b=Ext.Date.add(new Date,Ext.Date.DAY,2);break;case"3 Days":b=Ext.Date.add(new Date,Ext.Date.DAY,3);break;case"1 Week":b=Ext.Date.add(new Date,Ext.Date.DAY,7);break;case"2 Weeks":b=Ext.Date.add(new Date,Ext.Date.DAY,14);break;case"3 Weeks":b=Ext.Date.add(new Date,Ext.Date.DAY,21);break;case"1 Month":b=Ext.Date.add(new Date,Ext.Date.MONTH,1);break;case"2 Months":b=Ext.Date.add(new Date,Ext.Date.MONTH,2);break;case"3 Months":b=Ext.Date.add(new Date,Ext.Date.MONTH,3);break;case"4 Months":b=Ext.Date.add(new Date,Ext.Date.MONTH,4);break;case"5 Months":b=Ext.Date.add(new Date,Ext.Date.MONTH,5);break;case"6 Months":b=Ext.Date.add(new Date,Ext.Date.MONTH,6);break;case"1 Year":b=Ext.Date.add(new Date,Ext.Date.YEAR,1);break;case"2 Year":b=Ext.Date.add(new Date,Ext.Date.YEAR,2);break;default:b=new Date}app.navigateTo("panelCalendar"),f.facility=e,f.setStartDate(b)},getVisitOtherInfo:function(){var a,b=this,c=[];a=b.query("form"),Encounter.getEncounterFollowUpInfoByEid(b.eid,function(b,c){a[1].getForm().setValues(c.result)}),Encounter.getEncounterMessageByEid(b.eid,function(b,c){a[0].getForm().setValues(c.result)});for(var d=0;d<a.length;d++)c.push(a[d].getForm().getFields().items)},calculatePercent:function(a,b){return 100*(a/b)},setVoucher:function(){var a=this;a.docsGrid.loadDocs(a.eid),a.getVisitOtherInfo(),a.VisitVoucherStore.load({filters:[{property:"encounterId",value:a.eid},{property:"type",value:"visit"}],callback:function(b){var c=b[0];c?c.voucherlines().load({callback:function(){}}):AccVoucher.getVisitCheckOutCharges({pid:a.pid,eid:a.eid},function(b,c){var d=c.result;if(d.length>0){var e=a.VisitVoucherStore.add({encounterId:a.eid,date:new Date,type:"visit"}),f=e[0].voucherlines();a.invoiceGrid.reconfigure(f);for(var g=0;g<d.length;g++)f.add(d[g]);a.paid.setValue(0),a.updateTotalBalance()}})}})},updateTotalBalance:function(){for(var me=this,amount=me.amount.getValue(),paid=me.paid.getValue(),records=me.invoiceGrid.getStore().data.items,form=me.invoicePanel.down("form"),total=0,balance,i=0;i<records.length;i++)total=eval(total)+eval(records[i].data.amount);me.total.setValue(total),balance=total-paid,me.balance.setValue(balance),me.setPaid(0==balance&&records.length>0)},setPaid:function(a){var b=this.invoicePanel.down("form");a?(b.addBodyCls("paid"),b.down("fieldset").setVisible(!1)):(b.removeBodyCls("paid"),b.down("fieldset").setVisible(!0))},setVisitPanel:function(){this.pid=app.patient.pid,this.eid=app.patient.eid,this.uid=app.user.id,this.updateTitle(app.patient.name+" - #"+app.patient.pid+" ("+_("visit_checkout")+")"),this.setVoucher()},onActive:function(a){var b=this;app.patient.pid&&app.patient.eid?(b.setVisitPanel(),a(!0)):(a(!1),b.currPatientError())}}),Ext.define("App.view.fees.Billing",{extend:"App.ux.RenderPanel",id:"panelBilling",pageTitle:_("billing"),uses:["Ext.grid.Panel"],pageLayout:"card",initComponent:function(){var a=this;a.paymentstatus=1,a.patient=null,a.pastDue=null,a.dateRange={start:null,limit:null},a.patientListStore=Ext.create("App.store.fees.Billing"),a.encountersGrid=Ext.create("Ext.grid.Panel",{store:a.patientListStore,selModel:Ext.create("Ext.selection.CheckboxModel",{listeners:{scope:a,selectionchange:a.onSelectionChanged}}),viewConfig:{stripeRows:!0},columns:[{header:_("service_date"),dataIndex:"service_date",width:200},{header:_("patient"),dataIndex:"patientName",width:200},{header:_("first")+" "+_("visit"),dataIndex:"first_visit_date",width:200},{header:_("encounter_provider"),dataIndex:"encounterProvider",flex:1},{header:_("insurance"),dataIndex:"insurance",width:200},{header:_("billing_stage"),dataIndex:"billing_stage",renderer:a.stage,width:135}],tbar:[{xtype:"fieldcontainer",itemId:"fieldContainerPatientSearch",items:[{xtype:"displayfield",fieldLabel:_("patient_search")},{xtype:"patienlivetsearch",itemId:"patienlivetsearch",width:235,margin:"0 5 0 0"}]},{xtype:"fieldcontainer",itemId:"fieldContainerDateRange",items:[{xtype:"datefield",itemId:"datefrom",fieldLabel:_("from"),labelWidth:35,width:150,format:g("date_display_format")},{xtype:"datefield",itemId:"dateto",fieldLabel:_("to"),labelWidth:35,padding:"0 5 0 0",width:150,format:g("date_display_format")}]},{xtype:"fieldcontainer",itemId:"fieldContainerInsurance",items:[{xtype:"mitos.providerscombo",itemId:"provider",labelWidth:60,typeAhead:!0,padding:"0 5 0 5",fieldLabel:_("provider"),defaultValue:"All"},{xtype:"mitos.insurancepayertypecombo",itemId:"insurance",labelWidth:60,padding:"0 5 0 5",fieldLabel:_("insurance"),defaultValue:"All"}]},"-",{xtype:"fieldcontainer",itemId:"fieldContainerSearch",layout:"vbox",items:[{xtype:"button",width:80,margin:"0 0 3 0",text:_("search"),listeners:{scope:a,click:a.ReloadGrid}}]},"-",{xtype:"fieldcontainer",itemId:"fieldContainerGenerate1500",layout:"vbox",items:[{xtype:"button",width:170,margin:"0 0 3 0",text:_("generate_cms1500_pdf")},{xtype:"button",width:170,margin:"0 0 3 0",text:_("generate_cms1500_text")}]},"-",{xtype:"fieldcontainer",itemId:"fieldContainerGenerateANSI",layout:"vbox",items:[{xtype:"button",text:_("generate_x12")}]},"->",{xtype:"tbtext",text:_("past_due")+":"},{text:_("30+"),enableToggle:!0,action:30,toggleGroup:"pastduedates",enableKeyEvents:!0,scale:"large",listeners:{scope:a,click:a.onBtnClicked}},{text:_("60+"),enableToggle:!0,action:60,scale:"large",toggleGroup:"pastduedates",listeners:{scope:a,click:a.onBtnClicked}},{text:_("120+"),enableToggle:!0,action:120,scale:"large",toggleGroup:"pastduedates",listeners:{scope:a,click:a.onBtnClicked}},{text:_("180+"),enableToggle:!0,action:180,scale:"large",toggleGroup:"pastduedates",listeners:{scope:a,click:a.onBtnClicked}}],listeners:{scope:a,itemdblclick:a.rowDblClicked}}),a.encounterBillingDetails=Ext.create("Ext.panel.Panel",{defaultTitle:_("encounter_billing_details"),title:_("encounter_billing_details"),layout:"border",bodyStyle:"background-color:#fff",items:[Ext.create("Ext.container.Container",{region:"center",layout:"border",style:"background-color:#fff",items:[a.icdForm=Ext.create("Ext.form.Panel",{region:"north",border:!1,items:[{xtype:"fieldset",title:_("encounter_general_info"),margin:"5 5 0 5",items:[{xtype:"fieldcontainer",layout:{type:"hbox"},defaults:{margin:"0 10"},hideLabel:!0,items:[{xtype:"datefield",name:"service_date",fieldLabel:_("service_date"),labelAlign:"right",labelWidth:80,format:g("date_display_format")},{xtype:"activeinsurancescombo",name:"insurance",fieldLabel:_("insurance"),labelAlign:"right"},{xtype:"textfield",name:"facility",fieldLabel:_("facility"),labelAlign:"right",labelWidth:60,flex:1}]},{xtype:"fieldcontainer",layout:{type:"hbox"},defaults:{margin:"0 10"},hideLabel:!0,items:[{xtype:"datefield",name:"hosp_date",fieldLabel:_("hosp_date"),labelAlign:"right",labelWidth:80,format:g("date_display_format")},{xtype:"activeinsurancescombo",name:"sec_insurance",fieldLabel:_("sec_insurance"),labelAlign:"right"},{xtype:"mitos.providerscombo",name:"provider",fieldLabel:_("provider"),labelAlign:"right",labelWidth:60,flex:1}]},{xtype:"fieldcontainer",layout:{type:"hbox"},defaults:{margin:"0 10"},hideLabel:!0,items:[{xtype:"mitos.authorizationscombo",name:"authorization",fieldLabel:_("authorization"),labelAlign:"right",labelWidth:80},{xtype:"textfield",name:"sec_authorization",fieldLabel:_("sec_authorization"),labelAlign:"right"},{xtype:"textfield",name:"referal_by",fieldLabel:_("referal_by"),labelAlign:"right",labelWidth:60,flex:1}]}]},{xtype:"icdsfieldset",title:_("encounter_icd9"),margin:"5 5 0 5"}]}),a.cptPanel=Ext.create("App.view.patient.encounter.CurrentProceduralTerminology",{region:"center"})]}),a.progressNote=Ext.create("App.view.patient.ProgressNote",{title:_("encounter_progress_note"),region:"east",margin:5,bodyStyle:"padding:15px",width:500,autoScroll:!0,collapsible:!0,animCollapse:!0,collapsed:!1})],buttons:[{text:_("encounters"),scope:a,action:"encounters",tooltip:_("back_to_encounter_list"),handler:a.onBtnCancel},"->",{xtype:"tbtext",action:"page",text:"( 1 of 1 )"},{text:_("back"),scope:a,action:"back",iconCls:"icoArrowLeftSmall",tooltip:_("previous_encounter_details"),handler:a.onBtnBack},{text:_("save"),scope:a,action:"save",tooltip:_("save_billing_details"),handler:a.onBtnSave},{text:_("cancel"),scope:a,action:"cancel",tooltip:_("cancel_and_go_back_to_encounter_list"),handler:a.onBtnCancel},{text:_("next"),scope:a,action:"next",iconCls:"icoArrowRightSmall",iconAlign:"right",tooltip:_("next_encounter_details"),handler:a.onBtnNext}]}),a.pageBody=[a.encountersGrid,a.encounterBillingDetails],a.callParent(arguments)},stage:function(a){switch(say(a),a){case 0:return'<img src="resources/images/icons/stage0.png" />';case 1:return'<img src="resources/images/icons/stage1.png" />';case 2:return'<img src="resources/images/icons/stage2.png" />';case 3:return'<img src="resources/images/icons/stage3.png" />';case 4:return'<img src="resources/images/icons/stage4.png" />';default:return a}},onBtnClicked:function(a){var b=this.query('datefield[itemId="datefrom"]'),c=this.query('datefield[itemId="dateto"]');a.pressed?(b[0].reset(),c[0].reset(),this.pastDue=a.action):this.pastDue=0,this.ReloadGrid()},rowDblClicked:function(){this.goToEncounterBillingDetail()},goToEncounterBillingDetail:function(){this.getPageBody().getLayout().setActiveItem(1)},goToEncounterList:function(){this.getPageBody().getLayout().setActiveItem(0)},onSelectionChanged:function(a,b){if(b[0]){var c=this,d=c.encounterBillingDetails.defaultTitle,e=c.encounterBillingDetails.query('button[action="back"]'),f=c.encounterBillingDetails.query('button[action="next"]'),g=c.encounterBillingDetails.query('tbtext[action="page"]'),h=b[0].index;c.pid=b[0].data.pid,c.eid=b[0].data.eid,c.updateProgressNote(c.eid),c.encounterBillingDetails.setTitle(d+" ( "+b[0].data.patientName+" )"),c.getEncounterIcds(),c.cptPanel.encounterCptStoreLoad(c.pid,c.eid,function(){c.cptPanel.setDefaultQRCptCodes()}),g[0].setText("( "+_("page")+" "+(h+1)+" of "+a.store.data.length+" )"),f[0].setDisabled(h==a.store.data.length-1),e[0].setDisabled(0==h)}},onBtnCancel:function(){this.getPageBody().getLayout().setActiveItem(0)},onBtnBack:function(){var a=this.encountersGrid.getSelectionModel(),b=a.getLastSelected().index,c=b-1;a.select(c)},onBtnNext:function(){var a=this.encountersGrid.getSelectionModel(),b=a.getLastSelected().index,c=b+1;a.select(c)},onBtnSave:function(){var a=this,b=a.icdForm.getForm(),c=b.getValues();a.updateEncounterIcds(c),a.msg(_("sweet"),_("encounter_billing_data_updated"))},getEncounterIcds:function(){},updateEncounterIcds:function(a){var b=this;a.eid=b.eid},updateProgressNote:function(a){var b=this;Encounter.getProgressNoteByEid(a,function(a,c){var d=c.result;b.progressNote.tpl.overwrite(b.progressNote.body,d)})},ReloadGrid:function(){var a=this.encountersGrid.getDockedItems('toolbar[dock="top"]')[0],b=a.getComponent("fieldContainerDateRange").getComponent("datefrom").getValue(),c=a.getComponent("fieldContainerDateRange").getComponent("dateto").getValue();(b||c)&&(this.pastDue=0),this.patientListStore.load({params:{datefrom:b,dateto:c,provider:a.getComponent("fieldContainerInsurance").getComponent("provider").getValue(),insurance:a.getComponent("fieldContainerInsurance").getComponent("insurance").getValue(),patient:a.getComponent("fieldContainerPatientSearch").getComponent("patienlivetsearch").getValue(),pastDue:this.pastDue}})},onActive:function(a){this.ReloadGrid(),a(!0)}}),Ext.define("App.view.fees.Payments",{extend:"App.ux.RenderPanel",id:"panelPayments",pageTitle:_("payments"),initComponent:function(){var a=this;a.encountersPaymentsStore=Ext.create("App.store.fees.EncountersPayments"),a.searchPanel=Ext.create("Ext.panel.Panel",{title:_("search"),layout:"border",items:[{xtype:"form",itemId:"searchPanelForm",height:145,region:"north",bodyPadding:10,bodyStyle:"background-color:transparent",margin:"0 0 5 0",items:[{xtype:"fieldcontainer",itemId:"fieldcontainerSearchItems",layout:"hbox",items:[{fieldLabel:_("paying_entity"),itemId:"fieldPayingEntityCombo",xtype:"mitos.payingentitycombo",labelWidth:95,width:230},{xtype:"patienlivetsearch",fieldLabel:_("from"),hideLabel:!1,itemId:"fieldPatient",name:"from",anchor:null,labelWidth:42,width:470,margin:"0 0 0 25"},{xtype:"textfield",fieldLabel:_("no"),itemId:"fieldPatientNo",name:"transaction_number",labelWidth:45,width:230,labelAlign:"right",margin:"0 0 0 25",fieldStyle:"text-align: right;"}]},{xtype:"fieldcontainer",layout:"hbox",itemId:"fieldcontainerFacility",items:[{xtype:"mitos.billingfacilitiescombo",itemId:"fieldFacility",fieldLabel:_("pay_to"),labelWidth:95,width:470}]},{xtype:"fieldcontainer",itemId:"fieldcontainerFromTo",layout:"hbox",items:[{fieldLabel:_("from"),itemId:"fieldFromDate",xtype:"datefield",format:g("date_display_format"),labelWidth:95,width:230},{fieldLabel:_("to"),xtype:"datefield",itemId:"fieldToDate",format:g("date_display_format"),margin:"0 0 0 25",labelWidth:42,width:230}]}],buttons:[{text:_("search"),handler:a.onSearchButton,scope:a},"-",{text:_("reset"),scope:a,handler:a.onFormResetButton}]},{xtype:"grid",region:"center",store:a.encountersPaymentsStore,columns:[{header:_("service_date")},{header:_("patient_name")},{header:_("insurance")},{header:_("billing_notes"),flex:1},{header:_("balance_due")}]}]}),a.detailPanel=Ext.create("Ext.panel.Panel",{title:_("detail"),layout:"border",items:[{xtype:"form",height:145,region:"north",bodyPadding:10,bodyStyle:"background-color:transparent",margin:"0 0 5 0",items:[{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("paying_entity"),xtype:"mitos.payingentitycombo",labelWidth:95,width:230},{xtype:"patienlivetsearch",fieldLabel:_("from"),hideLabel:!1,itemId:"patientFrom",name:"from",anchor:null,labelWidth:42,width:470,margin:"0 0 0 25"},{xtype:"textfield",fieldLabel:_("no"),name:"transaction_number",labelWidth:45,width:230,labelAlign:"right",margin:"0 0 0 25",fieldStyle:"text-align: right;"}]},{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("payment_method"),xtype:"mitos.paymentmethodcombo",labelWidth:95,width:230},{xtype:"mitos.billingfacilitiescombo",fieldLabel:_("pay_to"),labelWidth:42,width:470,margin:"0 0 0 25"},{xtype:"mitos.currency",fieldLabel:_("amount"),name:"amount",labelWidth:45,width:230,labelAlign:"right",margin:"0 0 0 25",enableKeyEvents:!0}]},{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("from"),xtype:"datefield",format:g("date_display_format"),labelWidth:95,width:230},{fieldLabel:_("to"),xtype:"datefield",format:g("date_display_format"),margin:"0 0 0 25",labelWidth:42,width:230}]}],buttons:[{text:_("save")},"-",{text:_("reset")},"->",{text:_("add_payment"),scope:a,handler:a.onAddPaymentClick}]},{xtype:"grid",region:"center",plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,enableRemove:!0,listeners:{scope:a,beforeedit:a.beforeCptEdit}}),columns:[{header:_("service_date")},{header:_("patient_name")},{header:_("insurance")},{header:_("billing_notes"),flex:1},{header:_("balance_due")}]}]}),a.tapPanel=Ext.create("Ext.tab.Panel",{layout:"fit",items:[a.searchPanel,a.detailPanel]}),a.pageBody=[a.tapPanel],a.callParent(arguments)},onAddPaymentClick:function(){app.onPaymentEntryWindow()},beforeCptEdit:function(a,b){this.addCptFields(a.editor,b.record.data)},addCptFields:function(a){a.removeAll();for(var b=this.testData(),c=0;c<b.length;c++)a.add({xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"textfield",width:100,name:"code",readOnly:!0,margin:"0 5 0 10"},{xtype:"textfield",name:"copay",readOnly:!0,width:400,margin:"0 5 0 5"},{xtype:"mitos.currency",name:"remaining",readOnly:!0,width:100,margin:"0 5 0 5"},{xtype:"mitos.currency",name:"allowed",readOnly:!0,width:100,margin:"0 5 0 5"},{xtype:"mitos.currency",name:"payment",readOnly:!0,width:100,margin:"0 5 0 5"},{xtype:"mitos.currency",name:"deductible",readOnly:!0,width:100,margin:"0 5 0 5"},{xtype:"mitos.currency",name:"takeback",readOnly:!0,width:100,margin:"0 5 0 5"},{xtype:"checkbox",name:"takeback",readOnly:!0,width:50,margin:"0 5 0 5"},{xtype:"textfield",name:"takeback",readOnly:!0,width:100,margin:"0 5 0 5"}]})},testData:function(){var a,b=[];for(floor=Math.floor(6*Math.random()+1),a=0;floor>a;a++)b.push({data1:Math.floor(Math.max(100*Math.random(),floor)),data2:Math.floor(Math.max(100*Math.random(),floor)),data3:Math.floor(Math.max(100*Math.random(),floor)),data4:Math.floor(Math.max(100*Math.random(),floor)),data5:Math.floor(Math.max(100*Math.random(),floor)),data6:Math.floor(Math.max(100*Math.random(),floor)),data7:Math.floor(Math.max(100*Math.random(),floor)),data8:Math.floor(Math.max(100*Math.random(),floor)),data9:Math.floor(Math.max(100*Math.random(),floor))});return b},onBtnClick:function(a){var b=this;"search"==a.action?b.forms.getLayout().setActiveItem(0):"details"==a.action?b.forms.getLayout().setActiveItem(1):"new"==a.action&&b.window.show()},onSearchButton:function(){var a=this.searchPanel.getComponent("searchPanelForm"),b=a.getComponent("fieldcontainerFromTo").getComponent("fieldFromDate").getValue(),c=a.getComponent("fieldcontainerFromTo").getComponent("fieldToDate").getValue();this.encountersPaymentsStore.load({params:{datefrom:b,dateto:c,payingEntityCombo:a.getComponent("fieldcontainerSearchItems").getComponent("fieldPayingEntityCombo").getValue(),patientSearch:a.getComponent("fieldcontainerSearchItems").getComponent("fieldPatient").getValue(),patientNo:a.getComponent("fieldcontainerSearchItems").getComponent("fieldPatientNo").getValue(),facility:a.getComponent("fieldcontainerFacility").getComponent("fieldFacility").getValue()}})},onFormResetButton:function(){alert("Hello there")},onActive:function(a){this.encountersPaymentsStore.load(),a(!0)}}),Ext.define("App.model.administration.Department",{extend:"Ext.data.Model",table:{name:"departments"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:5,index:!0},{name:"title",type:"string",len:100},{name:"taxonomy",type:"string",len:15},{name:"external_id",type:"string",len:25},{name:"global_id",type:"string",len:50},{name:"is_specialty_required_for_billing",type:"bool"},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Facilities.getDepartments",create:"Facilities.addDepartment",update:"Facilities.updateDepartment"},reader:{root:"data"}}}),Ext.define("App.store.administration.Departments",{extend:"Ext.data.Store",requires:["App.model.administration.Department"],model:"App.model.administration.Department"}),Ext.define("App.store.administration.Specialties",{model:"App.model.administration.Specialty",extend:"Ext.data.Store"}),Ext.define("App.store.administration.FacilityStructures",{extend:"Ext.data.TreeStore",requires:["App.model.administration.FacilityStructure"],model:"App.model.administration.FacilityStructure"}),Ext.define("App.view.administration.practice.FacilityConfig",{extend:"Ext.panel.Panel",requires:[],xtype:"facilityconfigpanel",title:_("facility_configuration"),itemId:"FacilityStructurePanel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",margin:5,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"grid",title:_("departments"),hideHeaders:!1,frame:!0,margin:"0 0 5 0",store:Ext.create("App.store.administration.Departments",{autoLoad:!0}),viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"facilitygroup1",dropGroup:"facilitygroup2",onViewRender:function(a){var b,c=this;c.enableDrag&&(c.containerScroll&&(b=a.getEl()),c.dragZone=new Ext.view.DragZone({view:a,copy:!0,ddGroup:c.dragGroup||c.ddGroup,dragText:c.dragText,containerScroll:c.containerScroll,scrollEl:b})),c.enableDrop&&(c.dropZone=new Ext.grid.ViewDropZone({view:a,ddGroup:c.dropGroup||c.ddGroup}))}},listeners:{drop:function(a,b,c,d){say(a),say(b),say(c),say(d)}}},columns:[{text:_("taxonomy"),dataIndex:"taxonomy",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"title",dataIndex:"title",flex:2},{text:"code",dataIndex:"code",flex:1},{text:_("specialty_required_for_billing"),sortable:!0,dataIndex:"is_specialty_required_for_billing",renderer:function(a){return app.boolRenderer(a)},editor:{xtype:"checkboxfield"}},{text:_("active"),sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)},editor:{xtype:"checkboxfield"}}]},{xtype:"grid",title:_("specialties"),frame:!0,flex:1,store:this._sepecialtyStore=Ext.create("App.store.administration.Specialties",{autoLoad:!0}),viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"facilitygroup1",dropGroup:"facilitygroup2"},listeners:{drop:function(a,b,c,d){say(a),say(b),say(c),say(d)}}},columns:[{text:_("taxonomy"),sortable:!0,dataIndex:"taxonomy",flex:1,editor:{xtype:"textfield"}},{width:200,text:_("title"),dataIndex:"title",sortable:!0,flex:1,editor:{xtype:"textfield"}},{text:_("modality"),sortable:!0,dataIndex:"modality",flex:1,editor:{xtype:"textfield"}},{text:_("isFda"),sortable:!0,dataIndex:"isFda",flex:1,editor:{xtype:"textfield"}},{text:_("active"),sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)},editor:{xtype:"checkboxfield"}}],plugins:[{ptype:"rowediting",clicksToEdit:2}],tools:[{xtype:"button",text:_("specialty"),iconCls:"icoAdd",itemId:"specialitiesAddBtn"}],bbar:Ext.create("Ext.PagingToolbar",{pageSize:10,store:this._sepecialtyStore,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{})})}]},{xtype:"treepanel",title:_("facility_structure"),itemId:"FacilityStructureTreePanel",store:Ext.create("App.store.administration.FacilityStructures",{autoLoad:!0}),columnLines:!0,rootVisible:!1,hideHeaders:!0,frame:!0,margin:"5 5 5 0",flex:1,viewConfig:{plugins:{ptype:"treeviewdragdrop",dragGroup:"facilitygroup1",dropGroup:"facilitygroup1",expandDelay:0,allowParentInsert:!0,allowContainerDrops:!0,onViewRender:function(a){var b,c=this;c.enableDrag&&(c.containerScroll&&(b=a.getEl()),c.dragZone=new Ext.tree.ViewDragZone({view:a,ddGroup:c.dragGroup||c.ddGroup,dragText:c.dragText,displayField:c.displayField,repairHighlightColor:c.nodeHighlightColor,repairHighlight:c.nodeHighlightOnRepair,scrollEl:b})),c.enableDrop&&(c.dropZone=new Ext.tree.ViewDropZone({view:a,ddGroup:c.dropGroup||c.ddGroup,allowContainerDrops:c.allowContainerDrops,appendOnly:c.appendOnly,allowParentInserts:c.allowParentInserts,expandDelay:c.expandDelay,dropHighlightColor:c.nodeHighlightColor,dropHighlight:c.nodeHighlightOnDrop,sortOnDrop:c.sortOnDrop,containerScroll:c.containerScroll,handleNodeDrop:function(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=l.view,n=b?b.parentNode:m.panel.getRootNode(),o=m.getStore().treeStore.model,p=a.records[0]instanceof App.model.administration.Department,q=a.records[0]instanceof App.model.administration.Specialty,r=[];if(p||q){for(e=0,f=a.records.length;f>e;e++)Ext.Array.push(r,new o({id:"",fid:1,foreign_id:a.records[e].data.id,foreign_type:p?"D":"S",text:a.records[e].data.title,active:!1}));a.records=r}if(a.copy)for(d=a.records,a.records=[],e=0,f=d.length;f>e;e++)g=d[e],a.records.push(g.isNode?g.copy(void 0,!0):new o(g.data,g.getId()));l.cancelExpand(),"before"==c?(h=n.insertBefore,i=[null,b],b=n):"after"==c?(b.nextSibling?(h=n.insertBefore,i=[null,b.nextSibling]):(h=n.appendChild,i=[null]),b=n):(b.isExpanded()||b.isLoading()||(j=!0),h=b.appendChild,i=[null]),k=function(){var c,d;for(Ext.suspendLayouts(),m.getSelectionModel().clearSelections(),e=0,f=a.records.length;f>e;e++)g=a.records[e],g.isNode||(g=g.isModel?new o(g.data,g.getId()):new o(g)),g.save({callback:function(a,b){a.set({id:b.response.result.id}),a.save()}}),a.records[e]=g,i[0]=g,h.apply(b,i);if(l.sortOnDrop&&b.sort(b.getOwnerTree().store.generateComparator()),Ext.resumeLayouts(!0),Ext.enableFx&&l.dropHighlight)for(c=l.dropHighlightColor,e=0;f>e;e++)d=m.getNode(a.records[e]),d&&Ext.fly(d).highlight(c)},j?b.expand(!1,k):b.isLoading()?b.on({expand:k,delay:1,single:!0}):k()}}))}}},columns:[{xtype:"treecolumn",text:"Config",flex:2,sortable:!0,dataIndex:"text"},{xtype:"actioncolumn",width:20,icon:"resources/images/icons/delete.png",tooltip:_("delete"),handler:function(a,b,c,d,e,f){return f.childNodes.length>0?void app.msg(_("oops"),_("please_remove_child_records_first"),!0):void Ext.Msg.show({title:_("wait"),msg:_("delete_this_record"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"==a&&f.destroy()}})},getClass:function(a,b,c){return"f"!=c.data.id[0]?"x-grid-center-icon":"x-hide-display"}}]}]}),Ext.define("App.store.administration.InsuranceCompanies",{extend:"Ext.data.Store",model:"App.model.administration.InsuranceCompany"}),Ext.define("App.ux.form.fields.InputTextMask",{constructor:function(a,b){this.clearWhenInvalid=void 0===b?!0:b,this.rawMask=a,this.viewMask="",this.maskArray=new Array;for(var c=0,d="",e=0;e<a.length;e++)d?("X"==d&&(d=""),"X"==a.charAt(e)?(this.maskArray[c]=d,c++,d=""):d+=a.charAt(e)):"X"==a.charAt(e)?(d+="X",this.viewMask+="_"):"9"==a.charAt(e)||"L"==a.charAt(e)||"l"==a.charAt(e)||"A"==a.charAt(e)?(this.viewMask+="_",this.maskArray[c]=a.charAt(e),c++):(this.viewMask+=a.charAt(e),this.maskArray[c]=RegExp.escape(a.charAt(e)),c++);return this.specialChars=this.viewMask.replace(/(L|l|9|A|_|X)/g,""),this},init:function(a){this.field=a,a.rendered?this.assignEl():a.on("render",this.assignEl,this),a.on("blur",this.removeValueWhenInvalid,this),a.on("focus",this.processMaskFocus,this)},assignEl:function(){this.inputTextElement=this.field.inputEl.dom,this.field.inputEl.on("keypress",this.processKeyPress,this),this.field.inputEl.on("keydown",this.processKeyDown,this),(Ext.isSafari||Ext.isIE)&&(this.field.inputEl.on("paste",this.startTask,this),this.field.inputEl.on("cut",this.startTask,this)),(Ext.isGecko||Ext.isOpera)&&this.field.inputEl.on("mousedown",this.setPreviousValue,this),Ext.isGecko&&this.field.inputEl.on("input",this.onInput,this),Ext.isOpera&&this.field.inputEl.on("input",this.onInputOpera,this)},onInput:function(){this.startTask(!1)},onInputOpera:function(){this.prevValueOpera?this.manageBackspaceAndDeleteOpera():this.startTask(!1)},manageBackspaceAndDeleteOpera:function(){this.inputTextElement.value=this.prevValueOpera.cursorPos.previousValue,this.manageTheText(this.prevValueOpera.keycode,this.prevValueOpera.cursorPos),this.prevValueOpera=null},setPreviousValue:function(){this.oldCursorPos=this.getCursorPosition()},getValidatedKey:function(a,b){var c=this.maskArray[b.start];return"9"==c?a.pressedKey.match(/[0-9]/):"L"==c?a.pressedKey.match(/[A-Za-z]/)?a.pressedKey.toUpperCase():null:"l"==c?a.pressedKey.match(/[A-Za-z]/)?a.pressedKey.toLowerCase():null:"A"==c?a.pressedKey.match(/[A-Za-z0-9]/):c?a.pressedKey.match(new RegExp(c)):null},removeValueWhenInvalid:function(){this.clearWhenInvalid&&this.inputTextElement.value.indexOf("_")>-1&&(this.inputTextElement.value="")},managePaste:function(){if(null!=this.oldCursorPos){var a=this.inputTextElement.value.substring(this.oldCursorPos.start,this.inputTextElement.value.length-(this.oldCursorPos.previousValue.length-this.oldCursorPos.end));this.oldCursorPos.start<this.oldCursorPos.end&&(this.oldCursorPos.previousValue=this.oldCursorPos.previousValue.substring(0,this.oldCursorPos.start)+this.viewMask.substring(this.oldCursorPos.start,this.oldCursorPos.end)+this.oldCursorPos.previousValue.substring(this.oldCursorPos.end,this.oldCursorPos.previousValue.length),a=a.substr(0,this.oldCursorPos.end-this.oldCursorPos.start)),this.inputTextElement.value=this.oldCursorPos.previousValue,keycode={unicode:"",isShiftPressed:!1,isTab:!1,isBackspace:!1,isLeftOrRightArrow:!1,isDelete:!1,pressedKey:""};for(var b=!1,c=0;c<a.length&&(keycode.pressedKey=a.substr(c,1),keycode.unicode=a.charCodeAt(c),this.oldCursorPos=this.skipMaskCharacters(keycode,this.oldCursorPos),this.oldCursorPos!==!1);c++)this.injectValue(keycode,this.oldCursorPos)&&(b=!0,this.moveCursorToPosition(keycode,this.oldCursorPos),this.oldCursorPos.previousValue=this.inputTextElement.value,this.oldCursorPos.start=this.oldCursorPos.start+1);b||this.oldCursorPos===!1||this.moveCursorToPosition(null,this.oldCursorPos),this.oldCursorPos=null}},processKeyDown:function(a){this.processMaskFormatting(a,"keydown")},processKeyPress:function(a){this.processMaskFormatting(a,"keypress")},startTask:function(a){void 0==this.task&&(this.task=new Ext.util.DelayedTask(this.managePaste,this)),a!==!1&&(this.oldCursorPos=this.getCursorPosition()),this.task.delay(0)},skipMaskCharacters:function(a,b){if(b.start!=b.end&&(a.isDelete||a.isBackspace))return b;for(;this.specialChars.match(RegExp.escape(this.viewMask.charAt(a.isBackspace?b.start-1:b.start)));)if(a.isBackspace?b.dec():b.inc(),b.start>=b.previousValue.length||b.start<0)return!1;return b},isManagedByKeyDown:function(a){return a.isDelete||a.isBackspace?!0:!1},processMaskFormatting:function(a,b){this.oldCursorPos=null;var c=this.getCursorPosition(),d=this.getKeyCode(a,b);return 0==d.unicode||(67==d.unicode||99==d.unicode)&&a.ctrlKey?void 0:(88!=d.unicode&&120!=d.unicode||!a.ctrlKey)&&(86!=d.unicode&&118!=d.unicode||!a.ctrlKey)?(d.isBackspace||d.isDelete)&&Ext.isOpera?void(this.prevValueOpera={cursorPos:c,keycode:d}):"keydown"!=b||this.isManagedByKeyDown(d)?"keypress"==b&&this.isManagedByKeyDown(d)?!0:this.handleEventBubble(a,d,b)?!0:this.manageTheText(d,c):!0:void this.startTask()},manageTheText:function(a,b){return 0===this.inputTextElement.value.length&&(this.inputTextElement.value=this.viewMask),b=this.skipMaskCharacters(a,b),b===!1?!1:(this.injectValue(a,b)&&this.moveCursorToPosition(a,b),!1)},processMaskFocus:function(){if(0==this.inputTextElement.value.length){var a=this.getCursorPosition();this.inputTextElement.value=this.viewMask,this.moveCursorToPosition(null,a,25)}},isManagedByBrowser:function(a,b,c){return("keypress"!=c||0!==a.charCode)&&"keydown"!=c||b.unicode!=Ext.EventObject.TAB&&b.unicode!=Ext.EventObject.RETURN&&b.unicode!=Ext.EventObject.ENTER&&b.unicode!=Ext.EventObject.SHIFT&&b.unicode!=Ext.EventObject.CONTROL&&b.unicode!=Ext.EventObject.ESC&&b.unicode!=Ext.EventObject.PAGEUP&&b.unicode!=Ext.EventObject.PAGEDOWN&&b.unicode!=Ext.EventObject.END&&b.unicode!=Ext.EventObject.HOME&&b.unicode!=Ext.EventObject.LEFT&&b.unicode!=Ext.EventObject.UP&&b.unicode!=Ext.EventObject.RIGHT&&b.unicode!=Ext.EventObject.DOWN?!1:!0
},handleEventBubble:function(a,b,c){try{return b&&this.isManagedByBrowser(a,b,c)?!0:(a.stopEvent(),!1)}catch(d){alert(d.message)}},getCursorPosition:function(){var a,b,c;return this.inputTextElement.createTextRange?(c=document.selection.createRange().duplicate(),c.moveEnd("character",this.inputTextElement.value.length),a=""===c.text?this.inputTextElement.value.length:this.inputTextElement.value.lastIndexOf(c.text),c=document.selection.createRange().duplicate(),c.moveStart("character",-this.inputTextElement.value.length),b=c.text.length):(a=this.inputTextElement.selectionStart,b=this.inputTextElement.selectionEnd),this.CursorPosition(a,b,c,this.inputTextElement.value)},moveCursorToPosition:function(a,b,c){var d=!a||a&&a.isBackspace?b.start:b.start+1;this.inputTextElement.createTextRange?c?Ext.Function.defer(function(){b.range.move("character",d),b.range.select()},c,this):(b.range.move("character",d),b.range.select()):c?Ext.Function.defer(function(){this.inputTextElement.selectionStart=d,this.inputTextElement.selectionEnd=d},c,this):(this.inputTextElement.selectionStart=d,this.inputTextElement.selectionEnd=d)},injectValue:function(a,b){if(!a.isDelete&&a.unicode==b.previousValue.charCodeAt(b.start))return!0;var c;return a.isDelete||a.isBackspace?b.start==b.end?(c="_",a.isBackspace&&b.dec()):c=this.viewMask.substring(b.start,b.end):c=this.getValidatedKey(a,b),c?(this.inputTextElement.value=b.previousValue.substring(0,b.start)+c+b.previousValue.substring(b.start+c.length,b.previousValue.length),!0):!1},getKeyCode:function(a,b){var c={};return c.unicode=a.getKey(),c.isShiftPressed=a.shiftKey,c.isDelete=a.getKey()==Ext.EventObject.DELETE&&"keydown"==b||"keypress"==b&&0===a.charCode&&a.keyCode==Ext.EventObject.DELETE?!0:!1,c.isTab=a.getKey()==Ext.EventObject.TAB?!0:!1,c.isBackspace=a.getKey()==Ext.EventObject.BACKSPACE?!0:!1,c.isLeftOrRightArrow=a.getKey()==Ext.EventObject.LEFT||a.getKey()==Ext.EventObject.RIGHT?!0:!1,c.pressedKey=String.fromCharCode(c.unicode),c},CursorPosition:function(a,b,c,d){var e={};return e.start=isNaN(a)?0:a,e.end=isNaN(b)?0:b,e.range=c,e.previousValue=d,e.inc=function(){e.start++,e.end++},e.dec=function(){e.start--,e.end--},e}}),Ext.applyIf(RegExp,{escape:function(a){return new String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}),Ext.define("App.view.administration.practice.Insurance",{extend:"Ext.grid.Panel",requires:["App.ux.combo.Titles","App.ux.grid.RowFormEditing","App.ux.combo.TransmitMethod","App.ux.form.fields.InputTextMask"],xtype:"insurancecompaniespanel",title:_("insurance_companies"),store:this._adminInsuranceCmonpanySotrie=Ext.create("App.store.administration.InsuranceCompanies",{remoteSort:!1,remoteGroup:!1,pageSize:250}),columnLines:!0,plugins:[{ptype:"rowformediting",autoCancel:!1,errorSummary:!1,items:[{xtype:"container",layout:"hbox",itemId:"InsuranceCompanyFormContainer",items:[{xtype:"fieldset",title:_("contact_info"),layout:"hbox",margin:"0 10 0 0",items:[{xtype:"container",margin:"0 10 0 0",layout:"anchor",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",fieldLabel:_("code"),name:"code",allowBlank:!1},{xtype:"textfield",fieldLabel:_("name"),name:"name",allowBlank:!1,width:385},{xtype:"textfield",fieldLabel:_("attn"),name:"attn",width:385},{xtype:"textfield",fieldLabel:_("address"),name:"address1",width:385},{xtype:"textfield",fieldLabel:_("address_cont"),name:"address2",width:385},{xtype:"fieldcontainer",margin:"0 0 10 105",layout:"hbox",items:[{xtype:"textfield",width:150,name:"city"},{xtype:"textfield",width:50,name:"state"},{xtype:"textfield",width:75,name:"zip_code"}]}]},{xtype:"container",width:300,layout:"anchor",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",fieldLabel:_("phone_number"),name:"phone_number",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")]},{xtype:"textfield",fieldLabel:_("fax_number"),name:"fax_number"},{xtype:"checkbox",fieldLabel:_("active"),name:"active"}]}]}]}]}],columns:[{width:50,sortable:!0,dataIndex:"id"},{header:_("code"),width:50,sortable:!0,dataIndex:"code"},{header:_("insurance_name"),width:200,sortable:!0,dataIndex:"name"},{header:_("attn"),width:200,sortable:!0,dataIndex:"attn"},{header:_("address"),flex:1,sortable:!0,dataIndex:"address_full"},{header:_("phone"),width:120,sortable:!0,dataIndex:"phone1"},{header:_("phone"),width:120,sortable:!0,dataIndex:"phone2"},{header:_("fax"),width:120,sortable:!0,dataIndex:"fax"},{header:_("active"),width:55,sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)}}],tbar:Ext.create("Ext.PagingToolbar",{pageSize:30,store:this._adminInsuranceCmonpanySotrie,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{}),items:["-",{text:_("insurance_company"),iconCls:"icoAdd",action:"insurance",itemId:"addBtn"}]})}),Ext.define("App.store.administration.Laboratories",{model:"App.model.administration.Laboratories",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:Practice.getLaboratories,create:Practice.addLaboratory,update:Practice.updateLaboratory}}}),Ext.define("App.view.administration.practice.Laboratories",{extend:"Ext.grid.Panel",requires:["App.ux.combo.Titles","App.ux.grid.RowFormEditing","App.ux.combo.TransmitMethod"],xtype:"laboratoriespanel",title:_("laboratories"),store:Ext.create("App.store.administration.Laboratories"),border:!1,frame:!1,columnLines:!0,plugins:[{ptype:"rowformediting",autoCancel:!1,errorSummary:!1,clicksToEdit:1,items:[{xtype:"container",layout:"hbox",width:900,items:[{xtype:"container",width:450,layout:"anchor",items:[{xtype:"textfield",fieldLabel:_("name"),name:"name",allowBlank:!1,width:385},{xtype:"textfield",fieldLabel:_("address"),name:"line1",width:385},{xtype:"textfield",fieldLabel:_("address_cont"),name:"line2",width:385},{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:105,value:_("city_state_zip")},{xtype:"textfield",width:150,name:"city"},{xtype:"displayfield",width:5,value:","},{xtype:"textfield",width:50,name:"state"},{xtype:"textfield",width:75,name:"zip"}]}]},{xtype:"container",width:300,layout:"anchor",items:[{xtype:"textfield",fieldLabel:_("email"),name:"email",width:275},{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:100,value:_("phone")},{xtype:"textfield",width:40,name:"phone_area_code"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:50,name:"phone_prefix"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:70,name:"phone_number"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:100,value:_("fax")},{xtype:"textfield",width:40,name:"fax_area_code"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:50,name:"fax_prefix"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:70,name:"fax_number"}]},{xtype:"transmitmethodcombo",fieldLabel:_("default_method"),labelWidth:100,width:275}]},{xtype:"checkbox",fieldLabel:_("active"),labelWidth:60,name:"active"}]}]}],columns:[{header:_("pharmacy_name"),width:150,sortable:!0,dataIndex:"name"},{header:_("address"),flex:1,sortable:!0,dataIndex:"address_full"},{header:_("phone"),width:120,sortable:!0,dataIndex:"phone_full"},{header:_("fax"),width:120,sortable:!0,dataIndex:"fax_full"},{header:_("default_method"),flex:1,sortable:!0,dataIndex:"transmit_method",renderer:function(a){return"1"==a?"Print":"2"==a?"Email":"3"==a?"Email":a}},{header:_("active"),width:55,sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)}}],tbar:["->",{text:_("laboratory"),iconCls:"icoAdd",action:"laboratory",itemId:"addBtn"}]}),Ext.define("App.store.administration.Pharmacies",{model:"App.model.administration.Pharmacies",extend:"Ext.data.Store"}),Ext.define("App.view.administration.practice.Pharmacies",{extend:"Ext.grid.Panel",requires:["App.ux.combo.Titles","App.ux.grid.RowFormEditing","App.ux.combo.TransmitMethod"],xtype:"pharmaciespanel",title:_("pharmacies"),store:Ext.create("App.store.administration.Pharmacies"),border:!1,frame:!1,columnLines:!0,plugins:[{ptype:"rowformediting",autoCancel:!1,errorSummary:!1,clicksToEdit:1,items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",width:400,layout:"anchor",items:[{xtype:"textfield",fieldLabel:_("name"),name:"name",allowBlank:!0,width:385},{xtype:"textfield",fieldLabel:_("address"),name:"line1",width:385},{xtype:"textfield",fieldLabel:_("address_cont"),name:"line2",width:385},{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:105,value:_("city_state_zip")},{xtype:"textfield",width:150,name:"city"},{xtype:"displayfield",width:5,value:","},{xtype:"textfield",width:50,name:"state"},{xtype:"textfield",width:75,name:"zip"}]}]},{xtype:"container",width:300,layout:"anchor",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:100,value:_("phone")},{xtype:"textfield",width:20,name:"phone_country_code",maxLength:2},{xtype:"textfield",width:40,name:"phone_area_code"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:40,name:"phone_prefix"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:50,name:"phone_number"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{hideLabel:!0},items:[{xtype:"displayfield",width:100,value:_("fax")},{xtype:"textfield",width:20,name:"fax_country_code",maxLength:2},{xtype:"textfield",width:40,name:"fax_area_code"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:40,name:"fax_prefix"},{xtype:"displayfield",width:10,value:"-"},{xtype:"textfield",width:50,name:"fax_number"}]},{xtype:"textfield",fieldLabel:_("email"),name:"email",width:385},{xtype:"transmitmethodcombo",fieldLabel:_("default_method"),labelWidth:100,width:275}]},{xtype:"checkbox",fieldLabel:_("active"),labelWidth:60,margin:"0 0 0 10",name:"active"}]}]}],columns:[{header:_("pharmacy_name"),width:150,sortable:!0,dataIndex:"name"},{header:_("address"),flex:1,sortable:!0,dataIndex:"address_full"},{header:_("phone"),width:120,sortable:!0,dataIndex:"phone_full"},{header:_("fax"),width:120,sortable:!0,dataIndex:"fax_full"},{header:_("default_method"),flex:1,sortable:!0,dataIndex:"transmit_method",renderer:function(a){return"1"==a?"Print":"2"==a?"Email":"3"==a?"Email":a}},{header:_("active"),width:55,sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)}}],tbar:["->",{text:_("pharmacy"),iconCls:"icoAdd",action:"pharmacy",itemId:"addBtn"}]}),Ext.define("App.view.administration.practice.ProviderNumbers",{extend:"Ext.grid.Panel",requires:["App.ux.combo.Titles","App.ux.grid.RowFormEditing","App.ux.combo.TransmitMethod"],xtype:"providersnumberspanel",title:_("provider_numbers"),border:!1,frame:!1,columnLines:!0,features:[{ftype:"grouping",groupHeaderTpl:"{name}"}],plugins:[{ptype:"rowformediting",autoCancel:!1,errorSummary:!1,clicksToEdit:1,items:[{xtype:"container",layout:"column",items:[{xtype:"container",defaults:{labelWidth:140},margin:"0 10 0 0",items:[{xtype:"textfield",fieldLabel:_("provider"),name:"provider_id"},{xtype:"textfield",fieldLabel:_("provider_number"),name:"provider_number"},{xtype:"textfield",fieldLabel:_("provider_number_type"),name:"provider_number_type"}]},{xtype:"container",defaults:{labelWidth:140},margin:"0 10 0 0",items:[{xtype:"textfield",fieldLabel:_("insurance_company"),name:"insurance_company_id"},{xtype:"textfield",fieldLabel:_("rendering_number"),name:"rendering_provider_number"},{xtype:"textfield",fieldLabel:_("rendering_number_type"),name:"rendering_provider_number_type"}]},{xtype:"container",defaults:{labelWidth:140},items:[{xtype:"textfield",fieldLabel:_("group_number"),name:"group_number"}]}]}]}],columns:[{text:_("provider"),flex:1,sortable:!0,dataIndex:"provider_id_text"},{text:_("insurance"),flex:1,sortable:!0,dataIndex:"insurance_company_id_text"},{text:_("provider_number"),flex:1,sortable:!0,dataIndex:"provider_number"},{text:_("rendering_number"),flex:1,sortable:!0,dataIndex:"rendering_number"},{text:_("group_number"),flex:1,sortable:!0,dataIndex:"phone"}],tbar:[_("group_by"),{text:_("provider"),enableToggle:!0,toggleGroup:"insurance_number_group",action:"provider_id_text"},{text:_("insurance"),enableToggle:!0,toggleGroup:"insurance_number_group",action:"insurance_company_id_text"},"-","->",{text:_("insurance_number"),iconCls:"icoAdd",action:"insurance",itemId:"addBtn"}]}),Ext.define("App.view.administration.practice.Specialties",{extend:"Ext.grid.Panel",xtype:"specialtiespanel",requires:["Ext.grid.plugin.RowEditing","Ext.ux.SlidingPager"],title:_("specialties"),initComponent:function(){var a=this;Ext.apply(a,{store:a.store=Ext.create("App.store.administration.Specialties",{autoSync:!1}),columns:[{text:_("code"),sortable:!0,dataIndex:"code",flex:1,editor:{xtype:"textfield"}},{width:200,text:_("title"),dataIndex:"title",sortable:!0,flex:1,editor:{xtype:"textfield"}},{text:_("taxonomy"),sortable:!0,dataIndex:"taxonomy",flex:1,editor:{xtype:"textfield"}},{text:_("modality"),sortable:!0,dataIndex:"modality",flex:1,editor:{xtype:"textfield"}},{text:_("isFda"),sortable:!0,dataIndex:"isFda",flex:1,editor:{xtype:"textfield"}},{text:_("active"),sortable:!0,dataIndex:"active",renderer:a.boolRenderer,editor:{xtype:"checkboxfield"}}],plugins:[{ptype:"rowediting",clicksToEdit:1}],tbar:["->",{xtype:"button",text:_("specialty"),iconCls:"icoAdd",itemId:"specialitiesAddBtn"}],bbar:Ext.create("Ext.PagingToolbar",{pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{})})}),a.callParent(arguments)}}),Ext.define("App.view.administration.Applications",{extend:"App.ux.RenderPanel",pageTitle:_("applications"),initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.Applications"),a.grid=Ext.create("Ext.grid.Panel",{store:a.store,plugins:[a.edditing=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:2,errorSummary:!1})],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:"Remove",scope:a,handler:a.removeApplication}]},{text:_("name"),flex:1,sortable:!0,dataIndex:"app_name",editor:{xtype:"textfield",allowBlank:!1}},{text:_("private_key"),flex:1,sortable:!0,dataIndex:"pvt_key"},{text:_("active?"),width:50,sortable:!0,renderer:a.boolRenderer,dataIndex:"active",editor:{xtype:"checkbox"}}],tbar:[{text:_("add"),iconCls:"icoAdd",scope:a,handler:a.addApplication}]}),a.pageBody=[a.grid],a.callParent(arguments)},removeApplication:function(a,b){var c=this,d=c.store.getAt(b);Ext.Msg.show({title:"Wait!",msg:'This action is final. Are you sure you want to remove <span style="font-weight: bold">"'+d.data.app_name+'"</span>?',buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(a){"yes"==a&&(c.edditing.cancelEdit(),c.store.remove(d),c.store.sync({callback:function(){c.msg(_("sweet"),_("record_removed"))}}))}})},addApplication:function(){var a=this;a.edditing.cancelEdit(),a.store.insert(0,{active:1}),a.edditing.startEdit(0,0)},onActive:function(a){this.store.load(),a(!0)}}),Ext.define("App.view.administration.IpAccess",{extend:"App.ux.RenderPanel",requires:["Ext.grid.plugin.RowEditing"],xtype:"ipaccesspanel",itemId:"IpAccessPanel",border:!1,pageLayout:{type:"vbox",align:"stretch"},pageTitle:_("network_ip_access"),initComponent:function(){var a=this;a.IpAccessRulesStore=Ext.create("App.store.administration.IpAccessRules",{remoteFilter:!1,autoLoad:!1,autoSync:!1}),a.IpAccessLogStore=Ext.create("App.store.administration.IpAccessLog",{remoteFilter:!0,autoLoad:!1,autoSync:!1}),a.RuleStore=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"ruleName",type:"string"}],data:[{id:"WHT",ruleName:"Allow"},{id:"BLK",ruleName:"Block"}]}),a.pageBody=[{xtype:"grid",flex:1,frame:!0,title:_("network_rules"),itemId:"IpAccessRulesGrid",columnLines:!0,store:a.IpAccessRulesStore,selType:"rowmodel",plugins:{ptype:"rowediting",clicksToEdit:2},columns:[{text:_("ip")+" (CIDR)",dataIndex:"ip",width:150,editor:{xtype:"textfield",vtype:"ipcidr",allowBlank:!1,enableKeyEvents:!0,itemId:"IpAccessRulesIpField"}},{text:_("range"),columns:[{text:_("from"),dataIndex:"ip_from",width:150,renderer:function(a){return app.getController("administration.IpAccess").long2ip(a)}},{text:_("to"),dataIndex:"ip_to",width:150,renderer:function(a){return app.getController("administration.IpAccess").long2ip(a)}}]},{text:_("country_name"),dataIndex:"country",align:"center",width:300},{text:_("rule"),dataIndex:"rule",align:"center",editor:{xtype:"combo",allowBlank:!1,store:a.RuleStore,queryMode:"local",displayField:"ruleName",valueField:"id"}},{text:_("active"),dataIndex:"active",renderer:a.boolRenderer,align:"center",editor:{xtype:"checkboxfield"}}],tbar:["->","-",{xtype:"button",text:_("add_new_ip_rule"),itemId:"addIpRule"},"-",{xtype:"button",text:_("delete_ip_rule"),disabled:!0,itemId:"deleteIpRule"}],bbar:{xtype:"pagingtoolbar",store:a.IpAccessRulesStore,dock:"bottom",displayInfo:!0}},{xtype:"grid",flex:1,frame:!0,title:_("network_log"),itemId:"IpAccessLogGrid",columnLines:!0,store:a.IpAccessLogStore,columns:[{text:_("ip"),dataIndex:"ip",width:400},{text:_("country_code"),dataIndex:"country_code"},{text:_("event"),dataIndex:"event"},{xtype:"datecolumn",text:_("date"),dataIndex:"create_date",format:"Y-m-d H:i:s",width:150}],dockedItems:[{xtype:"pagingtoolbar",store:a.IpAccessLogStore,dock:"bottom",displayInfo:!0}]}],a.callParent(arguments)}}),Ext.define("App.view.administration.Medications",{extend:"App.ux.RenderPanel",id:"panelMedications",pageTitle:_("medications"),initComponent:function(){var a=this;a.query="",a.storeMedications=Ext.create("App.store.administration.Medications"),a.medicationsGrid=Ext.create("Ext.grid.Panel",{region:"center",store:a.storeMedications,columns:[{width:70,header:_("number"),dataIndex:"PRODUCTNDC",sortable:!0},{width:80,header:_("name"),dataIndex:"PROPRIETARYNAME",sortable:!0},{width:200,header:_("active_component"),dataIndex:"NONPROPRIETARYNAME",sortable:!0},{width:175,header:_("dosage"),dataIndex:"DOSAGEFORMNAME",sortable:!0},{width:45,header:_("number"),dataIndex:"ACTIVE_NUMERATOR_STRENGTH",sortable:!0},{flex:1,header:_("unit"),dataIndex:"ACTIVE_INGRED_UNIT",sortable:!0}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,enableRemove:!0,items:[{title:"general",xtype:"container",padding:10,layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",fieldLabel:_("name"),width:150,labelWidth:50,name:"PROPRIETARYNAME"},{xtype:"textfield",fieldLabel:_("active_component"),width:350,labelWidth:125,name:"NONPROPRIETARYNAME"},{xtype:"textfield",fieldLabel:_("dosage"),width:200,labelWidth:50,name:"DOSAGEFORMNAME"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0"},items:[{xtype:"textfield",fieldLabel:_("code"),labelWidth:50,width:150,name:"PRODUCTNDC"},{xtype:"textfield",fieldLabel:_("dose"),margin:"0 0 5 0",value:0,minValue:0,width:275,labelWidth:125,name:"ACTIVE_NUMERATOR_STRENGTH"},{xtype:"textfield",name:"ACTIVE_INGRED_UNIT",width:75}]}]}]}),tbar:Ext.create("Ext.PagingToolbar",{store:a.storeMedications,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager"),items:["-",{text:"Add New",scope:a,handler:a.onAddMedication},"-",{xtype:"textfield",emptyText:_("search"),enableKeyEvents:!0,itemId:"query",listeners:{scope:a,keyup:a.onSearchMedications,buffer:500}},"-",{text:_("reset"),scope:a,handler:a.onFieldReset},{text:"Print",iconCls:"icon-print",handler:function(){}}]})}),a.pageBody=[a.medicationsGrid],a.callParent(arguments)},onFieldReset:function(){},onAddMedication:function(){this.medicationsGrid.editingPlugin.cancelEdit(),this.storeMedications.insert(0,{}),this.medicationsGrid.editingPlugin.startEdit(0,0)},onSearchMedications:function(a){var b=this,c=b.storeMedications;b.query=a.getValue(),c.proxy.extraParams={query:b.query},c.load()},onActive:function(){this.medicationsGrid.down("toolbar").getComponent("query").reset(),this.storeMedications.proxy.extraParams={},this.storeMedications.load()}}),Ext.define("App.view.administration.Globals",{extend:"App.ux.RenderPanel",id:"panelGlobals",pageTitle:"mdTimeLine EHR "+_("global_settings"),uses:["App.ux.form.fields.Checkbox"],initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.Globals",{groupField:"gl_category",remoteSort:!1,autoSync:!0,pageSize:500,sorters:[{sorterFn:function(a,b){var c=function(a){var b=a.get("gl_category");return"General"===b?1:"Locale"===b?2:"Clinical"===b?3:"Email"===b?4:"Audit"===b?5:"Fax/Scanner"===b?6:7},d=c(a),e=c(b);return d===e?0:e>d?-1:1}}]}),a.default_top_pane_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("dashboard"),option_id:"app/dashboard/dashboard.ejs.php"},{title:_("calendar"),option_id:"app/calendar/calendar.ejs.php"},{title:_("messages"),option_id:"app/messages/messages.ejs.php"}]}),a.fullname_store=Ext.create("Ext.data.Store",{fields:["format","option_id"],data:[{format:_("last_first_middle"),option_id:"0"},{format:_("first_middle_last"),option_id:"1"}]}),a.main_navigation_menu_left_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("main_navigation_menu_left"),option_id:"west"},{title:_("main_navigation_menu_right"),option_id:"east"}]}),a.css_header_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("grey_default"),option_id:"ext-all-gray.css"},{title:_("blue"),option_id:"ext-all.css"},{title:_("access"),option_id:"ext-all-access.css"}]}),a.full_new_patient_form_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("oldstyle_static_form_without_search_or_duplication_check"),option_id:"0"},{title:_("all_demographics_fields_with_search_and_duplication_check"),option_id:"1"},{title:_("mandatory_or_specified_fields_only_search_and_dup_check"),option_id:"2"},{title:_("mandatory_or_specified_fields_only_dup_check_no_search"),option_id:"3"}]}),a.patient_search_results_style_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("encounter_statistics"),option_id:"0"},{title:_("mandatory_and_specified_fields"),option_id:"1"}]}),a.units_of_measurement_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("show_both_us_and_metric_main_unit_is_us"),option_id:"1"},{title:_("show_both_us_and_metric_main_unit_is_metric"),option_id:"2"},{title:_("show_us_only"),option_id:"3"},{title:_("show_metric_only"),option_id:"4"}]}),a.date_display_format_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("yyyy_mm_dd"),option_id:"Y-m-d"},{title:_("mm_dd_yyyy"),option_id:"m/d/Y"},{title:_("dd_mm_yyyy"),option_id:"d/m/Y"}]}),a.time_display_format_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("24_hr"),option_id:"H:i"},{title:i18n["12 hr"],option_id:"g:i a"}]}),a.currency_decimals_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("0"),option_id:"0"},{title:_("1"),option_id:"1"},{title:_("2"),option_id:"2"}]}),a.currency_dec_point_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("comma"),option_id:","},{title:_("period"),option_id:"."}]}),a.currency_thousands_sep_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("comma"),option_id:","},{title:_("period"),option_id:"."},{title:_("space"),option_id:" "},{title:_("none"),option_id:""}]}),a.EMAIL_METHOD_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:"PHPMAIL",option_id:"PHPMAIL"},{title:"SENDMAIL",option_id:"SENDMAIL"},{title:"SMTP",option_id:"SMTP"}]}),a.state_country_data_type_store=Ext.create("Ext.data.Store",{fields:["title","option_id"],data:[{title:_("text_field"),option_id:"2"},{title:_("single_selection_list"),option_id:"1"},{title:_("single_selection_list_with_ability_to_add_to_the_list"),option_id:"26"}]}),a.dummyStore=new Ext.data.ArrayStore({fields:["title","option_id"],data:[[_("option_1"),"Option 1"],[_("option_2"),"Option 2"],[_("option_3"),"Option 3"],[_("option_5"),"Option 5"],[_("option_6"),"Option 6"],[_("option_7"),"Option 7"]]}),a.grid=Ext.create("App.ux.grid.LiveSearchGridPanel",{store:a.store,features:[{ftype:"grouping",groupHeaderTpl:_("category")+": {name}"}],plugins:[{ptype:"cellediting"}],columns:[{text:_("title"),dataIndex:"gl_name",flex:1},{text:_("value"),dataIndex:"gl_value",flex:1,editor:{xtype:"textfield"}},{text:_("category"),dataIndex:"gl_category"}]}),a.pageBody=[a.grid],a.callParent(arguments)},onGloblasSave:function(a,b){var c=(a.getRecord(),a.getValues());Globals.updateGlobals(c,function(){b.load()}),this.msg(_("new_global_configuration_saved"),_("refresh_the_application"))},onActive:function(a){this.store.load(),a(!0)}}),Ext.define("App.view.administration.Lists",{extend:"App.ux.RenderPanel",id:"panelLists",pageTitle:_("select_list_options"),pageLayout:"border",uses:["App.ux.form.Panel","Ext.grid.plugin.RowEditing"],initComponent:function(){var a=this;a.listsStore=Ext.create("App.store.administration.Lists"),a.optionsStore=Ext.create("App.store.administration.ListOptions",{remoteFilter:!0}),a.optionsRowEditing=Ext.create("Ext.grid.plugin.RowEditing",{}),a.listsRowEditing=Ext.create("Ext.grid.plugin.RowEditing",{}),a.listsGrid=Ext.create("Ext.grid.Panel",{store:a.listsStore,itemId:"listsGrid",plugins:[a.listsRowEditing],width:450,margin:"0 2 0 0",region:"west",columns:[{text:_("key"),width:120,dataIndex:"list_key",editor:{xtype:"textfield",allowOnlyWhitespace:!1,allowBlank:!1}},{text:_("select_lists"),flex:1,sortable:!1,dataIndex:"title",editor:{xtype:"textfield",allowBlank:!1}},{text:_("active"),width:55,sortable:!1,dataIndex:"active",renderer:a.boolRenderer,editor:{xtype:"checkbox",padding:"0 0 0 18"}}],listeners:{scope:a,select:a.onListsGridClick},dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:_("new_list"),iconCls:"icoAddRecord",scope:a,handler:a.onNewList},"->",{text:_("delete_list"),iconCls:"icoDeleteBlack",itemId:"listDeleteBtn",disabled:!0,scope:a,handler:a.onListDelete,tooltip:_("can_be_disable")}]}]}),a.optionsGrid=Ext.create("Ext.grid.Panel",{store:a.optionsStore,itemId:"optionsGrid",plugins:[a.optionsRowEditing],region:"center",viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:_("drag_and_drop_reorganize")},listeners:{scope:a,drop:a.onDragDrop}},columns:[{xtype:"rownumberer"},{text:_("option_title"),width:200,sortable:!0,dataIndex:"option_name",editor:{allowBlank:!1,enableKeyEvents:!0,listeners:{scope:a,keyup:a.onOptionTitleChange}}},{text:_("option_value"),width:200,sortable:!0,dataIndex:"option_value",editor:{allowBlank:!1,itemId:"optionValueTextField"}},{text:_("code"),sortable:!0,dataIndex:"code",width:120,editor:{allowBlank:!0}},{text:_("code_type"),sortable:!0,dataIndex:"code_type",width:100,editor:{allowBlank:!0}},{text:_("notes"),sortable:!0,dataIndex:"notes",flex:1,width:100,editor:{allowBlank:!0}},{text:_("active"),width:55,sortable:!1,dataIndex:"active",renderer:a.boolRenderer,editor:{xtype:"checkbox",margin:0}}],dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{text:_("add_option"),iconCls:"icoAddRecord",scope:a,handler:a.onNewOption}]}]}),a.pageBody=[a.listsGrid,a.optionsGrid],a.callParent(arguments)},onNewList:function(){var a=this;a.listsRowEditing.cancelEdit(),a.listsStore.insert(0,Ext.create("App.model.administration.Lists")),a.listsRowEditing.startEdit(0,0)},onListsGridClick:function(a,b){var c=this,d=c.listsGrid.down("toolbar").getComponent("listDeleteBtn"),e="1"==!!b.data.in_use,f=b.data.id;c.optionsStore.clearFilter(!0),c.optionsStore.filter([{property:"list_id",value:f}]),e?d.disable():d.enable()},onNewOption:function(){var a,b=this,c=b.getCurrList();c!==!1&&(b.optionsRowEditing.cancelEdit(),a=Ext.create("App.model.administration.ListOptions",{list_id:c.id,list_key:c.list_key}),b.optionsStore.insert(0,a),b.optionsRowEditing.startEdit(0,0))},onOptionTitleChange:function(){},onDragDrop:function(a,b,c){for(var d=this,e=c.stores[0].data.items,f=d.getCurrList(),g=[],h=0;h<e.length;h++)Ext.Array.push(g,e[h].data.id);var i={list_id:b.records[0].data.list_id,fields:g};Lists.sortOptions(i,function(){d.optionsStore.clearFilter(!0),d.optionsStore.filter([{property:"list_key",value:f.list_key}])})},onListDelete:function(a){var b=this,c=a.up("grid"),d=c.getStore(),e=c.getSelectionModel(),f=e.getLastSelected();f.data.in_use?Ext.Msg.alert(_("oops"),_("unable_to_delete")+' "'+f.data.title+'"<br>'+_("list_currently_used_forms")+"."):Ext.Msg.show({title:_("please_confirm")+"...",icon:Ext.MessageBox.QUESTION,msg:_("delete_this_record"),buttons:Ext.Msg.YESNO,scope:b,fn:function(a){"yes"==a&&(d.remove(f),d.sync({success:function(){b.msg(_("sweet"),_("record_deleted")),b.optionsStore.removeAll()},failure:function(){b.msg(_("oops"),_("unable_to_delete")+' "'+f.data.title,!0)}}))}})},getCurrList:function(){var a=this.listsGrid.getSelectionModel().getSelection();return a.length>0?a[0].data:!1},onActive:function(a){var b=this;b.listsStore.load(),a(!0)}}),Ext.define("App.view.administration.Layout",{extend:"App.ux.RenderPanel",id:"panelLayout",pageTitle:_("layout_form_editor"),pageLayout:"border",initComponent:function(){var a=this;a.currForm=null,a.currField=null,a.fieldsGridStore=Ext.create("App.store.administration.LayoutTree"),a.fieldXTypesStore=Ext.create("App.store.administration.XtypesComboModel"),a.formsGridStore=Ext.create("App.store.administration.FormsList"),a.parentFieldsStore=Ext.create("App.store.administration.ParentFields"),a.selectListoptionsStore=Ext.create("App.store.administration.FormListOptions"),a.selectListGrid=Ext.create("Ext.grid.Panel",{store:a.selectListoptionsStore,collapseMode:"mini",height:200,split:!0,border:!1,titleCollapse:!1,hideCollapseTool:!0,collapsible:!0,collapsed:!0,columns:[{text:_("name"),flex:1,sortable:!1,dataIndex:"option_name"},{text:_("value"),flex:1,sortable:!1,dataIndex:"option_value"}]}),a.fieldForm=Ext.create("Ext.form.Panel",{flex:2,border:!1,autoScroll:!0,fieldDefaults:{msgTarget:"side",labelWidth:100},defaults:{anchor:"100%"},items:[{fieldLabel:_("type"),xtype:"combo",name:"xtype",displayField:"name",valueField:"value",allowBlank:!1,editable:!1,store:a.fieldXTypesStore,queryMode:"local",margin:"5 5 5 10",itemId:"xtype",listeners:{scope:a,change:a.onXtypeChange}},{fieldLabel:_("child_of"),xtype:"combo",name:"parentId",displayField:"name",valueField:"value",editable:!1,hideTrigger:!0,allowBlank:!1,store:a.parentFieldsStore,queryMode:"local",margin:"5 5 5 10",emptyText:"None",itemId:"parentFields",listeners:{scope:a,expand:a.onParentFieldsExpand}},{xtype:"fieldset",itemId:"aditionalProperties",title:_("aditional_properties"),margin:"0 5 5 5",defaults:{anchor:"100%"},items:[{fieldLabel:_("title"),xtype:"textfield",name:"title",itemId:"title",allowBlank:!1,hidden:!0},{fieldLabel:_("field_label"),xtype:"textfield",name:"fieldLabel",itemId:"fieldLabel",hidden:!0},{fieldLabel:_("box_label"),xtype:"textfield",name:"boxLabel",itemId:"boxLabel",allowBlank:!1,hidden:!0},{fieldLabel:_("label_width"),xtype:"textfield",name:"labelWidth",itemId:"labelWidth",hidden:!0},{fieldLabel:_("hide_label"),xtype:"checkbox",name:"hideLabel",itemId:"hideLabel",hidden:!0},{fieldLabel:_("empty_text"),xtype:"textfield",name:"emptyText",itemId:"emptyText",hidden:!0},{fieldLabel:_("layout"),xtype:"textfield",name:"layout",itemId:"layout",hidden:!0},{fieldLabel:_("name"),xtype:"textfield",name:"name",itemId:"name",allowBlank:!1,hidden:!0,listeners:{scope:a,change:a.onNameValueChange}},{fieldLabel:_("input_value"),xtype:"textfield",name:"inputValue",itemId:"inputValue",hidden:!0},{fieldLabel:_("width"),xtype:"textfield",name:"width",itemId:"width",emptyText:"ei. 5 for 5px",hidden:!0},{fieldLabel:_("height"),xtype:"textfield",name:"height",itemId:"height",emptyText:"ei. 5 for 5px",hidden:!0},{fieldLabel:_("anchor"),xtype:"textfield",name:"anchor",itemId:"anchor",emptyText:"ei. 100%",hidden:!0},{fieldLabel:_("flex"),xtype:"checkbox",name:"flex",itemId:"flex",hidden:!0},{fieldLabel:_("collapsible"),xtype:"checkbox",name:"collapsible",itemId:"collapsible",hidden:!0},{fieldLabel:_("checkbox_toggle"),xtype:"checkbox",name:"checkboxToggle",itemId:"checkboxToggle",hidden:!0},{fieldLabel:_("collapsed"),xtype:"checkbox",name:"collapsed",itemId:"collapsed",hidden:!0},{fieldLabel:_("margin"),xtype:"textfield",name:"margin",itemId:"margin",emptyText:"ei. 5 5 5 5",hidden:!0},{fieldLabel:_("columns"),xtype:"textfield",name:"columns",itemId:"columns",emptyText:"ei. 2",hidden:!0},{fieldLabel:_("column_width"),xtype:"textfield",name:"columnWidth",itemId:"columnWidth",emptyText:"ei. .5",hidden:!0},{fieldLabel:_("is_required"),xtype:"checkbox",name:"allowBlank",itemId:"allowBlank",hidden:!0},{fieldLabel:_("min_length"),xtype:"numberfield",name:"minLength",itemId:"minLength",minValue:0,hidden:!0},{fieldLabel:_("max_length"),xtype:"numberfield",name:"maxLength",itemId:"maxLength",minValue:0,hidden:!0},{fieldLabel:_("value"),xtype:"textfield",name:"value",itemId:"value",hidden:!0},{fieldLabel:_("max_value"),xtype:"textfield",name:"maxValue",itemId:"maxValue",hidden:!0},{fieldLabel:_("min_value"),xtype:"textfield",name:"minValue",itemId:"minValue",hidden:!0},{fieldLabel:_("max_value"),xtype:"timefield",name:"maxValue",itemId:"timeMaxValue",hidden:!0},{fieldLabel:_("min_value"),xtype:"timefield",name:"minValue",itemId:"timeMinValue",hidden:!0},{fieldLabel:_("grow"),xtype:"checkbox",name:"grow",itemId:"grow",hidden:!0},{fieldLabel:_("grow_min"),xtype:"textfield",name:"growMin",itemId:"growMin",hidden:!0},{fieldLabel:_("grow_max"),xtype:"textfield",name:"growMax",itemId:"growMax",hidden:!0},{fieldLabel:_("increment"),xtype:"textfield",name:"increment",itemId:"increment",hidden:!0},{fieldLabel:_("list_options"),xtype:"mitos.listscombo",name:"list_id",itemId:"list_id",hidden:!0,allowBlank:!1,listeners:{scope:a,change:a.onSelectListSelect}},{fieldLabel:_("code"),xtype:"textfield",name:"code",itemId:"code",emptyText:"ei. SNOMED:254687942 or ICD10:H25.091",hidden:!0},{fieldLabel:_("item_id"),xtype:"textfield",name:"itemId",itemId:"itemId",emptyText:"sencha itemId",hidden:!0},{fieldLabel:_("action"),xtype:"textfield",name:"action",itemId:"action",emptyText:"sencha action",hidden:!0}]}]}),a.formContainer=Ext.create("Ext.panel.Panel",{title:_("field_configuration"),border:!0,split:!0,width:390,region:"east",layout:{type:"vbox",align:"stretch"},bodyStyle:"background-color:#fff!important",items:[a.fieldForm,a.selectListGrid],buttons:[{text:_("delete"),iconCls:"icoDeleteBlack",scope:a,handler:a.onFieldDelete},{text:_("reset"),iconCls:"icoReload",scope:a,handler:a.onFormReset},{text:_("save"),iconCls:"save",scope:a,handler:a.onFieldSave}],dockedItems:[{xtype:"toolbar",items:["->",{text:_("add_new"),iconCls:"icoAddRecord",scope:a,handler:a.onFormReset},"-",{text:_("add_child"),iconCls:"icoAddRecord",itemId:"addChild",disabled:!0,scope:a,handler:a.onAddChild},"-",{text:_("form_preview"),iconCls:"icoPreview",enableToggle:!0,listeners:{scope:a,toggle:a.onFormPreview}}]}]}),a.fieldsGrid=Ext.create("Ext.tree.Panel",{store:a.fieldsGridStore,region:"center",border:!0,sortable:!1,rootVisible:!1,title:_("field_editor_demographics"),viewConfig:{plugins:{ptype:"treeviewdragdrop",expandDelay:0,allowParentInsert:!1},listeners:{scope:a,drop:a.onDragDrop,itemkeydown:a.onFieldKeyDown}},columns:[{xtype:"treecolumn",text:_("field_type"),sortable:!1,dataIndex:"xtype",width:200,align:"left"},{text:_("title"),sortable:!1,dataIndex:"title",width:100,align:"left"},{text:_("label"),sortable:!1,dataIndex:"fieldLabel",flex:1,align:"left"}],listeners:{scope:a,selectionchange:a.onFieldsGridSelectionChange}}),a.formsGrid=Ext.create("Ext.grid.Panel",{title:_("forms"),region:"west",store:a.formsGridStore,width:200,border:!0,split:!0,hideHeaders:!0,plugins:[{ptype:"cellediting"}],tbar:["->",{xtype:"button",text:_("form"),iconCls:"icoAdd",itemId:"LayoutFormsAddFormBtn",scope:a,handler:a.onLayoutFormsAddFormBtnHandler}],columns:[{flex:1,sortable:!0,dataIndex:"name",editor:{xtype:"textfield"}}],listeners:{scope:a,itemclick:a.onFormGridItemClick}}),a.fromPreview=Ext.create("Ext.form.Panel",{region:"south",height:300,collapsible:!0,titleCollapse:!1,hideCollapseTool:!0,collapsed:!0,border:!0,split:!0,collapseMode:"header",bodyStyle:"padding: 5px",layout:"anchor",fieldDefaults:{msgTarget:"side"},tools:[{itemId:"refresh",type:"refresh",scope:a,handler:a.previewFormRender}]}),a.pageBody=[a.fieldsGrid,a.formsGrid,a.formContainer,a.fromPreview],a.callParent(arguments)
},onLayoutFormsAddFormBtnHandler:function(){this.formsGrid.editingPlugin.cancelEdit();var a=this.formsGrid.getStore().insert(0,{name:"New Form",active:1});this.formsGrid.editingPlugin.startEdit(a[0],0)},onFieldSave:function(){var a=this,b=a.fieldForm.getForm(),c=b.getRecord(),d=a.fieldsGridStore,e=d.getNodeById(c.data.parentId)||d.getRootNode(),f=b.getValues();b.isValid()&&(f.form_id=c.data.form_id,f.leaf="fieldcontainer"!=f.xtype&&"fieldset"!=f.xtype,c.set(f),""==c.data.id&&e.appendChild(c),a.fieldsGridStore.sync({success:function(b){a.previewFormRender(),a.loadCurrFormParentField(),""==c.data.id&&(c.set({id:b.proxy.reader.rawData.id}),c.commit()),a.fieldsGrid.getSelectionModel().select(c),a.msg(_("sweet"),_("record_saved"))},failure:function(b){c.remove(),a.msg("Oops!",b.proxy.reader.rawData.message,!0),a.loadFieldsGrid()}}))},deleteField:function(a){var b=this;return a.childNodes.length>0?void b.msg(_("oops"),_("children_fields_must_be_remove_first"),!0):void Ext.Msg.show({title:_("please_confirm")+"...",icon:Ext.MessageBox.QUESTION,msg:_("delete_this_field"),buttons:Ext.Msg.YESNO,scope:this,fn:function(c){"yes"==c&&(a.remove(),b.fieldsGridStore.sync({success:function(){b.previewFormRender(),b.msg(_("sweet"),_("record_removed"))},failure:function(a){b.msg("Oops!",a.proxy.reader.rawData.message,!0),b.loadFieldsGrid()}}))}})},onFieldKeyDown:function(a,b,c,d,e){e.getKey()==e.DELETE&&this.deleteField(b)},onFieldDelete:function(){var a=this,b=a.fieldForm.getForm(),c=b.getRecord();a.deleteField(c)},onDragDrop:function(){var a=this;a.fieldsGridStore.sync({success:function(){a.previewFormRender(),a.msg(_("sweet"),_("field_updated"))},failure:function(b){Ext.Msg.alert(_("oops"),b.proxy.reader.rawData.error),a.loadFieldsGrid()}})},onFormReset:function(){var a=this,b=a.fieldForm,c=b.getForm(),d=a.fieldsGrid.getSelectionModel(),e=Ext.create("App.model.administration.LayoutTree",{form_id:a.currForm,parentId:"root"});d.deselectAll(),c.reset(),c.loadRecord(e)},onNameValueChange:function(a){a.setDisabled(0!=a.up("form").getForm().getRecord().data.id)},onAddChild:function(){var a=this,b=a.fieldForm,c=b.getForm(),d=a.fieldsGrid.getSelectionModel();d.deselectAll(),c.reset(),c.loadRecord(Ext.create("App.model.administration.LayoutTree",{form_id:a.currForm,parentId:a.currField}))},onFieldsGridSelectionChange:function(a,b){var c=this,d=c.fieldForm,e=d.getForm();b.length>0?(e.loadRecord(b[0]),c.currField=b[0].data.id,"fieldset"==b[0].data.xtype||"fieldcontainer"==b[0].data.xtype?c.formContainer.down("toolbar").getComponent("addChild").enable():c.formContainer.down("toolbar").getComponent("addChild").disable(),d.el.unmask()):c.onFormReset()},onFormGridItemClick:function(a,b){var c=this;c.currForm=b.get("id"),c.fieldsGrid.setTitle(_("field_editor")+" ("+b.get("name")+")"),c.loadFieldsGrid(),c.onFormReset()},onSelectListSelect:function(a,b){var c=this;c.selectListoptionsStore.load({params:{list_id:b}})},onParentFieldsExpand:function(a){a.picker.loadMask.destroy()},onXtypeChange:function(a,b){function c(a){for(var b=0;b<g.length;b++)a.find(g[b])?(f.getComponent(g[b]).show(),f.getComponent(g[b]).enable()):(f.getComponent(g[b]).hide(),f.getComponent(g[b]).disable())}var d=this;"combobox"==b?(d.selectListGrid.setTitle(_("select_list_options")),d.selectListGrid.expand(),d.selectListGrid.enable()):(d.selectListGrid.setTitle(""),d.selectListGrid.collapse(),d.selectListGrid.disable()),Array.prototype.find=function(a){for(var b=!1,c=0;c<this.length;c++)"function"==typeof a?a.test(this[c])&&(b||(b=[]),b.push(c)):this[c]===a&&(b||(b=[]),b.push(c));return b};var e,f=d.fieldForm.getComponent("aditionalProperties"),g=f.items.keys;e="fieldset"==b?["itemId","action","title","collapsible","collapsed","checkboxToggle","margin","columnWidth","layout"]:"fieldcontainer"==b?["itemId","action","fieldLabel","labelWidth","hideLabel","width","layout","margin","columnWidth","columns"]:"combobox"==b?["itemId","action","name","width","emptyText","fieldLabel","hideLabel","labelWidth","margin","allowBlank","list_id"]:"checkbox"==b?["itemId","action","name","width","boxLabel","inputValue","fieldLabel","hideLabel","labelWidth","margin"]:"textfield"==b?["itemId","action","name","width","anchor","emptyText","fieldLabel","hideLabel","labelWidth","allowBlank","margin","minLength","maxLength"]:"textareafield"==b?["itemId","action","name","width","anchor","height","emptyText","fieldLabel","hideLabel","labelWidth","allowBlank","grow","growMin","growMax","margin","minLength","maxLength"]:"numberfield"==b?["itemId","action","name","width","value","emptyText","maxValue","minValue","increment","fieldLabel","labelWidth","hideLabel","margin"]:"timefield"==b?["itemId","action","name","width","value","emptyText","timeMaxValue","timeMinValue","increment","fieldLabel","labelWidth","hideLabel","margin"]:"radiofield"==b?["itemId","action","name","width","boxLabel","labelWidth","hideLabel","margin","inputValue"]:"datefield"==b||"mitos.datetime"==b?["itemId","action","name","width","value","layout","emptyText","fieldLabel","labelWidth","hideLabel","allowBlank","margin"]:"checkboxwithfamilyhistory"==b?["itemId","action","name","width","boxLabel","inputValue","fieldLabel","hideLabel","labelWidth","margin","code"]:"physicalexamfield"==b?["itemId","action","name","width","fieldLabel","boxLabel","inputValue","fieldLabel","hideLabel","labelWidth","margin","code"]:["itemId","action","name","width","emptyText","fieldLabel","labelWidth","hideLabel","margin"],c(e)},onFormPreview:function(a,b){var c=this;b===!0?(c.fromPreview.expand(!1),c.previewFormRender()):c.fromPreview.collapse(!1)},previewFormRender:function(){var a=this,b=this.fromPreview;b.collapsed!==!0&&(b.el.mask(),a.getFormItems(b,a.currForm,function(){b.el.unmask()}))},loadFieldsGrid:function(){var a=this;a.fieldsGridStore.load({params:{currForm:a.currForm}}),a.loadCurrFormParentField(),a.previewFormRender(),a.fieldsGrid.doLayout()},loadCurrFormParentField:function(){var a=this;a.parentFieldsStore.load({params:{currForm:a.currForm}})},onActive:function(a){var b=this,c=b.formsGrid.getSelectionModel();null===b.currForm&&b.formsGridStore.load({filters:[{property:"active",value:1}],callback:function(a){c.select(a[0]),b.currForm=a[0].data.id,b.loadFieldsGrid(),b.onFormReset()}}),a(!0)}}),Ext.define("App.view.administration.Modules",{extend:"App.ux.RenderPanel",id:"panelModules",pageTitle:_("modules"),initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.Modules"),a.grid=Ext.create("Ext.grid.Panel",{store:a.store,plugins:[a.edditing=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:2,errorSummary:!1})],columns:[{text:_("title"),width:200,sortable:!0,dataIndex:"title"},{text:_("description"),flex:1,sortable:!0,dataIndex:"description"},{text:_("version"),width:100,sortable:!0,dataIndex:"installed_version"},{text:_("sql_version"),width:100,sortable:!0,dataIndex:"sql_version"},{text:_("req_core_version"),width:150,sortable:!0,dataIndex:"required_core_version"},{text:_("key_if_required"),flex:1,sortable:!0,dataIndex:"licensekey",editor:{xtype:"textfield"}},{text:_("enabled?"),width:60,sortable:!0,renderer:a.boolRenderer,dataIndex:"enable",editor:{xtype:"checkbox"}}]}),a.pageBody=[a.grid],a.callParent(arguments)},onActive:function(a){this.store.load(),a(!0)}}),Ext.define("App.view.administration.PdfForms",{extend:"App.ux.RenderPanel",requires:[],pageTitle:"PDF Forms",pageLayout:"border",itemId:"AdministrationPdfForms",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.DocumentForms",{remoteFilter:!0,remoteSort:!0,autoSync:!1,pageSize:50}),a.pageBody=[{xtype:"grid",store:a.store,region:"center",itemId:"AdministrationPdfFormsGrid",frame:!0,plugins:[{ptype:"rowediting"}],columns:[{text:"Facility",dataIndex:"facility_id",editor:{xtype:"activefacilitiescombo",allowBlank:!1}},{text:"Type",dataIndex:"document_type",editor:{xtype:"textfield",allowBlank:!1}},{text:"Title",dataIndex:"document_title",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:"Path",dataIndex:"document_path",flex:2,editor:{xtype:"textfield",allowBlank:!1}},{text:"SigX",dataIndex:"signature_x",width:40,editor:{xtype:"numberfield"}},{text:"SigY",dataIndex:"signature_y",width:40,editor:{xtype:"numberfield"}},{text:"SigW",dataIndex:"signature_w",width:40,editor:{xtype:"numberfield"}},{text:"SigH",dataIndex:"signature_h",width:40,editor:{xtype:"numberfield"}},{text:"Flatten",dataIndex:"flatten",width:70,renderer:app.boolRenderer,editor:{xtype:"checkboxfield"}},{text:"Active",dataIndex:"is_active",width:70,renderer:app.boolRenderer,editor:{xtype:"checkboxfield"}}],dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{xtype:"button",iconCls:"icoAdd",text:"PDF Form",itemId:"AdministrationPdfFormsAddBtn"}]},{xtype:"pagingtoolbar",pageSize:1e3,store:a.store,displayInfo:!0,dock:"bottom",plugins:new Ext.ux.SlidingPager}]},{xtype:"panel",title:"Tokens",region:"east",width:260,frame:!0,split:!0,bodyStyle:"background-color: white",itemId:"AdministrationPdfFormsTokenPanel"}],a.callParent(arguments)}}),Ext.define("App.view.administration.FloorPlans",{extend:"App.ux.RenderPanel",id:"panelFloorPlans",pageTitle:_("floor_plan_editor"),pageLayout:"border",floorPlanId:null,activeZone:null,initComponent:function(){var a=this;a.floorPlansStore=Ext.create("App.store.administration.FloorPlans"),a.floorZonesStore=Ext.create("App.store.administration.FloorPlanZones"),a.floorPlans=Ext.create("Ext.grid.Panel",{requires:["Ext.grid.plugin.CellEditing"],title:_("floor_plans"),region:"west",width:300,split:!0,hideHeaders:!0,store:a.floorPlansStore,columnsLines:!0,plugins:[{ptype:"rowediting"}],columns:[{dataIndex:"title",sortable:!1,hideable:!1,flex:1,editor:{xtype:"textfield",emptyText:_("new_floor"),allowBlank:!1}},{text:_("facility_id"),dataIndex:"facility_id",editor:{xtype:"mitos.facilitiescombo",allowBlank:!1}}],tbar:[{text:_("add_floor"),action:"newFloorPlan",iconCls:"icoAdd",scope:a,handler:a.onNewFloorPlan},"-",{text:_("remove_floor"),action:"newFloorPlan",iconCls:"icoDelete",scope:a,handler:a.onRemoveFloorPlan}],listeners:{scope:a,select:a.onFloorPlanSelected}}),a.floorPlanZones=Ext.create("Ext.panel.Panel",{title:_("floor_plan"),region:"center",bodyCls:"floorPlan",layout:"absolute",tbar:[{text:_("add_zone"),action:"newZone",iconCls:"icoAdd",scope:a,handler:a.onNewZone}]}),a.floorPlanZoneEditor=Ext.create("Ext.window.Window",{title:_("zone_editor"),closeAction:"hide",closable:!1,resizable:!1,items:[{xtype:"form",border:!1,bodyPadding:"10",defaults:{labelWidth:130,anchor:"100%"},items:[{xtype:"textfield",fieldLabel:_("zone_name"),name:"title"},{xtype:"colorcombo",fieldLabel:_("bg_color"),name:"bg_color"},{xtype:"colorcombo",fieldLabel:_("border_color"),name:"border_color"},{xtype:"numberfield",fieldLabel:_("width"),minValue:30,maxValue:300,name:"width"},{xtype:"numberfield",fieldLabel:_("height"),minValue:30,maxValue:300,name:"height"},{xtype:"checkbox",fieldLabel:_("show_priority_color"),name:"show_priority_color"},{xtype:"checkbox",fieldLabel:_("show_patient_preview"),name:"show_patient_preview"},{xtype:"checkbox",fieldLabel:_("active"),name:"active"}]}],buttons:[{text:_("remove"),xtype:"button",scope:a,handler:a.onZoneRemove},"->",{text:_("cancel"),xtype:"button",scope:a,handler:a.onZoneCancel},"-",{text:_("save"),xtype:"button",scope:a,handler:a.onZoneSave}],listeners:{scope:a,afterrender:function(a){a.alignTo(this.floorPlanZones.getEl(),"tr-tr",[-130,70])}}}),a.listeners={show:function(){a.nav=Ext.create("Ext.util.KeyNav",Ext.getDoc(),{scope:a,left:function(){a.moveZone("left")},up:function(){a.moveZone("up")},right:function(){a.moveZone("right")},down:function(){a.moveZone("down")}})},hide:function(){a.nav&&Ext.destroy(a.nav),a.setEditMode(!1)}},a.pageBody=[a.floorPlans,a.floorPlanZones],a.callParent(arguments)},setEditMode:function(a,b){var c=this,d=c.activeZone?c.activeZone.getEl():null;d?c.setEditor(a,b):c.setEditor(a,b)},setEditor:function(a,b){var c=this;a?(c.activeZone=b,c.getEditor().zone=b,c.floorPlanZones.focus(),c.getEditor().getForm().loadRecord(b.record),c.floorPlanZoneEditor.hidden&&c.floorPlanZoneEditor.show(b.getEl())):(c.floorPlanZoneEditor.hide(),c.getEditor().getForm().reset(),c.activeZone=null)},getEditor:function(){return this.floorPlanZoneEditor.down("form")},onZoneCancel:function(){var a,b=this,c=b.activeZone,d=c.record;d.reject(),a={text:d.data.title,scale:d.data.scale,style:{"border-color":d.data.border_color,"background-color":d.data.bg_color},width:d.data.width,height:d.data.height},b.activeZone.setPosition(d.data.x,d.data.y),b.applyZoneConfig(c,a),b.setEditMode(!1)},onZoneSave:function(){var a,b=this,c=b.getEditor(),d=c.getForm(),e=d.getValues(),f=d.getRecord();f.set(e),a={text:f.data.title,scale:f.data.scale,style:{"border-color":f.data.border_color,"background-color":f.data.bg_color},width:f.data.width,height:f.data.height},f.save({callback:function(){app.fireEvent("floorplanzonesave",b,f)}}),b.applyZoneConfig(c.zone,a),b.setEditMode(!1)},onZoneHandler:function(a){var b=this;b.setEditMode(!0,a)},onZoneRemove:function(){var a=this,b=this.getEditor(),c=b.getForm(),d=c.getRecord(),e=b.zone;Ext.Msg.show({title:"Wait!",msg:_("remove_final_notice")+' <span style="font-weight: bold">"'+d.data.title+'"</span>?',buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(c){"yes"==c&&(a.floorZonesStore.remove(d),a.floorZonesStore.sync({success:function(){a.floorPlanZones.remove(e,!0),b.up("window").hide()}}))}})},onRemoveFloorPlan:function(a){var b=this,c=a.up("grid"),d=c.store,e=c.getSelectionModel(),f=e.getLastSelected();Ext.Msg.show({title:"Wait!",msg:_("remove_final_notice")+' <span style="font-weight: bold">"'+f.data.title+'"</span>?',buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(a){"yes"==a&&(d.remove(f),d.sync({callback:function(){e.deselectAll(),b.floorPlanZones.removeAll(),b.msg(_("sweet"),_("record_removed"))}}))}})},onNewZone:function(){var a=this;a.floorZonesStore.add({floor_plan_id:a.floorPlanId,title:_("new_zone"),x:5,y:5,show_priority_color:1,show_patient_preview:1,active:0}),a.floorZonesStore.sync({callback:function(b){a.createZone(b.operations[0].records[0])}})},createZone:function(a){var b,c=this;b=c.floorPlanZones.add(Ext.create("Ext.button.Split",{text:a.data.title,draggable:{listeners:{scope:c,dragend:c.zoneDragged}},scale:a.data.scale,style:{"border-color":a.data.border_color,"background-color":a.data.bg_color},x:a?a.data.x:5,y:a?a.data.y:5,width:a.data.width,height:a.data.height,scope:c,handler:c.onZoneHandler})),b.record=a},applyZoneConfig:function(a,b){a.setText(b.text),a.getEl().applyStyles(b.style),a.setScale(b.scale),a.setSize(b.width,b.height)},moveZone:function(a){if(app.currCardCmp==this&&null!=this.activeZone){var b=this.activeZone.x,c=this.activeZone.y;"left"==a?b-=1:"right"==a?b+=1:"up"==a?c-=1:"down"==a&&(c+=1),this.activeZone.setPosition(b,c),this.activeZone.record.set({x:b,y:c})}},zoneDragged:function(a){var b=a.comp;b.record.set({x:b.x,y:b.y})},onNewFloorPlan:function(a){var b,c=a.up("grid"),d=c.editingPlugin;d.cancelEdit(),b=this.floorPlansStore.add({}),d.startEdit(b[0],0)},onFloorPlanSelected:function(a,b){this.setEditMode(!1),this.floorPlanId=b.data.id,this.reloadFloorPlanZones()},reloadFloorPlanZones:function(){var a=this;a.floorPlanZones.removeAll(),a.floorZonesStore.load({params:{floor_plan_id:this.floorPlanId},scope:a,callback:function(b){a.setEditMode(!1);for(var c=0;c<b.length;c++)a.createZone(b[c])}})},onActive:function(a){var b=this;b.floorPlansStore.load({callback:function(){b.floorPlans.getSelectionModel().select(0)}}),a(!0)}}),Ext.define("App.view.administration.ExternalDataLoads",{extend:"App.ux.RenderPanel",id:"panelExternalDataLoads",pageTitle:_("external_data_loads"),pageLayout:{type:"accordion",animate:!0,activeOnTop:!0},initComponent:function(){var a=this;a.stores=[],a.stores.push(a.icd9Store=Ext.create("App.store.administration.ExternalDataLoads",{codeType:"ICD9"})),a.stores.push(a.icd10Store=Ext.create("App.store.administration.ExternalDataLoads",{codeType:"ICD10",groupField:"version"})),a.stores.push(a.rxnormStore=Ext.create("App.store.administration.ExternalDataLoads",{codeType:"RXNORM"})),a.stores.push(a.snomedStore=Ext.create("App.store.administration.ExternalDataLoads",{codeType:"SNOMED"})),a.stores.push(a.hcpcsStore=Ext.create("App.store.administration.ExternalDataLoads",{codeType:"HCPCS"})),a.icd9Grid=a.getCodeGrid("Available ICD9 Data",a.icd9Store,!1),a.icd10Grid=a.getCodeGrid("Available ICD10 Data",a.icd10Store,!0),a.rxnormGrid=a.getCodeGrid("Available RxNorm Data",a.rxnormStore,!1),a.snomedGrid=a.getCodeGrid("Available SNOMED Data",a.snomedStore,!1),a.hcpcsGrid=a.getCodeGrid("Available HCPCS Data",a.hcpcsStore,!1),a.icd9Form=a.getCodeForm("ICD9"),a.icd10Form=a.getCodeForm("ICD10"),a.rxnormForm=a.getCodeForm("RXNORM"),a.snomedForm=a.getCodeForm("SNOMED"),a.hcpcsForm=a.getCodeForm("HCPCS"),a.icd9=Ext.create("Ext.form.Panel",{title:_("update_icd9"),layout:"border",items:[a.icd9Grid,a.icd9Form]}),a.icd10=Ext.create("Ext.panel.Panel",{title:_("update_icd10"),layout:"border",items:[a.icd10Grid,a.icd10Form]}),a.rxnorm=Ext.create("Ext.panel.Panel",{title:_("update_rxnorm"),layout:"border",items:[a.rxnormGrid,a.rxnormForm]}),a.snomed=Ext.create("Ext.panel.Panel",{title:_("update_snomed"),layout:"border",items:[a.snomedGrid,a.snomedForm]}),a.hcpcs=Ext.create("Ext.panel.Panel",{title:_("update_hcpcs"),layout:"border",items:[a.hcpcsGrid,a.hcpcsForm]}),a.pageBody=[a.icd9,a.icd10,a.rxnorm,a.snomed,a.hcpcs],a.callParent(arguments)},getCodeForm:function(a){var b=this;return Ext.create("Ext.form.Panel",{bodyPadding:10,region:"center",action:a,frame:!0,bodyStyle:"background-color:white",bodyBorder:!0,margin:"5 0 5 0",items:[{xtype:"fieldset",styleHtmlContent:!0,action:a,title:_("current_version_installed"),html:_("no_data_installed"),tpl:_("revision_name")+":  {revision_name}<br>"+_("revision_number")+":  {revision_number}<br>"+_("revision_version")+": {revision_version}<br>"+_("revision_date")+":    {revision_date}<br>"+_("imported_on")+":      {imported_date}"},{xtype:"fieldset",title:_("installation"),action:"installation",styleHtmlContent:!0,html:b.getInstallationDetails(a)},{xtype:"fieldset",title:_("upload"),action:"upload",items:[{xtype:"filefield",name:"filePath",buttonText:_("upload"),emptyText:_("data_file"),width:350,labelWidth:50,allowBlank:!1}]}],api:{submit:"ExternalDataUpdate.updateCodesWithUploadFile"},buttons:[{text:_("update"),action:a,scope:b,handler:b.uploadFile}]})},getCodeGrid:function(a,b,c){var d=this;return Ext.create("Ext.grid.Panel",{title:a,store:b,region:"west",width:500,margin:"5 0 5 0",padding:0,split:!0,columns:d.getDefaultColumns(),listeners:{scope:d,itemdblclick:d.onCodeDblClick},features:c?[{ftype:"grouping"}]:[]})},getDefaultColumns:function(){return[{xtype:"datecolumn",header:_("date"),dataIndex:"date",format:g("date_display_format")},{header:_("version"),dataIndex:"version"},{header:_("file"),dataIndex:"basename",width:300}]},getInstallationDetails:function(a){return"ICD9"==a?'<p>Steps to install the ICD 9 data:</p><ol><li>The raw data feed release can be obtained from <a href="https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes.html">this location</a></li><li>Upload the downloaded .zip file, or place the downloaded ICD 9 database zip file into the following directory: contrib/icd9</li><li>Double Click the zip file from the "Available ICD9 Data" grid to install</li></ol><p style="color:red">NOTE: Importing external data can take more than an hour depending on your hardware configuration. For example, one of the RxNorm data tables contain in excess of 6 million rows.</p>':"ICD10"==a?'<p>Steps to install the ICD 10 data:</p><ol><li>The raw data feed release can be obtained from <a href="https://www.cms.gov/Medicare/Coding/ICD10">this location</a></li><li>Upload the downloaded .zip file, or place the downloaded ICD 10 database zip files into the following directory: contrib/icd10</li><li>Double Click the zip file from the "Available ICD10 Data" grid to install</li></ol><p>These are the ICD10 2012 links:</p><ol><li><a href="https://www.cms.gov/Medicare/Coding/ICD10/Downloads/DiagnosisGEMs_2012.zip">DiagnosisGEMs_2012</a></li><li><a href="https://www.cms.gov/Medicare/Coding/ICD10/Downloads/ProcedureGEMs_2012.zip">ProcedureGEMs_2012</a></li><li><a href="https://www.cms.gov/Medicare/Coding/ICD10/Downloads/ReimbursementMapping_2012.zip">ReimbursementMapping_2012</a></li><li><a href="https://www.cms.gov/Medicare/Coding/ICD10/Downloads/2012_PCS_long_and_abbreviated_titles.zip">2012_PCS_long_and_abbreviated_titles</a></li><li><a href="https://www.cms.gov/Medicare/Coding/ICD10/Downloads/ICD10OrderFiles_2012.zip">ICD10OrderFiles_2012</a></li></ol><p style="color:red">NOTE: Importing external data can take more than an hour depending on your hardware configuration. For example, one of the RxNorm data tables contain in excess of 6 million rows.</p>':"RXNORM"==a?'<p>Steps to install the RxNorm data:</p><ol><li>The first step is to open an account with the Unified Medical Language System web site <a href="https://utslogin.nlm.nih.gov/cas/login">here</a></li><li>Then the raw data feed release can be obtained from <a href="http://www.nlm.nih.gov/research/umls/rxnorm/docs/rxnormfiles.html">this location</a></li><li>Upload the downloaded .zip file, or place the downloaded RxNorm database zip file into the following directory: contrib/rxnorm.</li><li>Double Click the zip file from the "Available RxNorm Data" grid to install</li></ol><p style="color:red">NOTE: Only the full monthly RxNorm release is currently supported</p>':"SNOMED"==a?"Lorem ipsum dolor sit amet, porta nam suscipit sed id, vestibulum velit tortor velit viverra, non enim justo, purus nec, libero sociis lobortis, eu et leo mauris velit. Magnis tellus blandit fringilla, morbi mauris commodo, nec morbi ac non":"HCPCS"==a?'<p>Steps to install the HCPCS data:</p><ol><li>The raw data feed release can be obtained from <a href="http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets/Alpha-Numeric-HCPCS.html">this location</a></li><li>Upload the downloaded .zip file, or place the downloaded zip files into the following directory: contrib/hcpcs</li><li>Double Click the zip file from the "Available HCPCS Data" grid to install</li></ol><p>These is the HCPCS 2013 direct link:</p><ol><li><a href="http://www.cms.gov/Medicare/Coding/HCPCSReleaseCodeSets/Downloads/13anweb.zip">13anweb</a></li></ol><p style="color:red">NOTE: Importing external data can take more than an hour depending on your hardware configuration.</p>':void 0},uploadFile:function(a){var b=this,c=a.up("form").getForm();c.isValid()&&c.submit({waitMsg:_("uploading_and_updating_code_database")+"...",scope:b,params:{codeType:a.action},success:function(){},failure:function(){}})},onCodeDblClick:function(a,b){var c=this,d=app.log;d.ActivityMonitor(!1),a.el.mask(_("installing_database_please_wait")+"..."),ExternalDataUpdate.updateCodes(b.data,function(b,e){a.el.unmask(),e.result.success?(c.setCurrentCodesInfo(),c.alert(_("new_database_installed"),"info")):c.alert(e.result.error,"error"),d.ActivityMonitor(!0)})},setCurrentCodesInfo:function(){var a,b,c=this;ExternalDataUpdate.getCurrentCodesInfo(function(d,e){a=e.result;for(var f=0;f<a.length;f++)a[f].data!==!1&&(b=c.query('fieldset[action="'+a[f].data.codeType+'"]')[0],b.update(a[f].data))})},loadStores:function(){for(var a=this,b=0;b<a.stores.length;b++)a.stores[b].load({params:{pid:a.pid}})},onActive:function(a){this.loadStores(),this.setCurrentCodesInfo(),a(!0)}}),Ext.define("App.view.administration.PreventiveCare",{extend:"App.ux.RenderPanel",id:"panelPreventiveCare",pageTitle:_("preventive_care"),uses:["Ext.grid.Panel","App.ux.combo.CodesTypes","App.ux.combo.Titles"],initComponent:function(){var a=this;a.active=1,a.dataQuery="",a.category_id="3",a.store=Ext.create("App.store.administration.PreventiveCare"),a.activeProblemsStore=Ext.create("App.store.administration.PreventiveCareActiveProblems"),a.medicationsStore=Ext.create("App.store.administration.PreventiveCareMedications"),a.labsStore=Ext.create("App.store.administration.PreventiveCareLabs"),a.guidelineGrid=Ext.create("Ext.grid.Panel",{region:"center",store:a.store,columns:[{xtype:"actioncolumn",width:30,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b){a.getStore().getAt(b)},getClass:function(){return"x-grid-icon-padding"}}]},{flex:1,header:_("description"),sortable:!0,dataIndex:"description"},{width:100,header:_("age_start"),sortable:!0,dataIndex:"age_start"},{width:100,header:_("age_end"),sortable:!0,dataIndex:"age_end"},{width:100,header:_("sex"),sortable:!0,dataIndex:"sex"},{width:100,header:_("frequency"),sortable:!0,dataIndex:"frequency"}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,listeners:{scope:a,beforeedit:a.beforeServiceEdit,edit:a.onServiceEdit,canceledit:a.onServiceCancelEdit},items:[{xtype:"tabpanel",action:_("immunizations"),layout:"fit",plain:!0,listeners:{scope:a,tabchange:a.onFormTapChange},items:[{title:_("general"),xtype:"container",padding:10,layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0",action:"field"},items:[{xtype:"textfield",fieldLabel:_("description"),name:"description",labelWidth:130,width:703},{xtype:"gaiaehr.sexcombo",fieldLabel:_("sex"),name:"sex",width:100,labelWidth:30},{fieldLabel:_("active"),xtype:"checkboxfield",labelWidth:75,name:"active"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0",action:"field"},items:[{xtype:"mitos.codestypescombo",fieldLabel:_("coding_system"),labelWidth:130,value:"CVX",name:"coding_system",readOnly:!0},{xtype:"numberfield",fieldLabel:_("frequency"),margin:"0 0 5 0",value:0,minValue:0,width:150,name:"frequency"},{xtype:"mitos.timecombo",name:"frequency_time",width:100},{xtype:"numberfield",fieldLabel:_("age_start"),name:"age_start",labelWidth:75,width:140,value:0,minValue:0},{fieldLabel:_("must_be_pregnant"),xtype:"checkboxfield",labelWidth:105,name:"pregnant"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0",action:"field"},items:[{xtype:"textfield",fieldLabel:_("code"),name:"code",labelWidth:130},{xtype:"numberfield",fieldLabel:_("times_to_perform"),name:"times_to_perform",width:250,value:0,minValue:0,tooltip:_("greater_than_1_or_just_check_perform_once")},{xtype:"numberfield",fieldLabel:_("age_end"),name:"age_end",labelWidth:75,width:140,value:0,minValue:0},{fieldLabel:_("perform_only_once"),xtype:"checkboxfield",labelWidth:105,name:"only_once"}]}]},{title:_("active_problems"),action:"problems",xtype:"grid",margin:5,store:a.activeProblemsStore,columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveRelation}]},{header:_("code"),width:100,dataIndex:"code"},{header:_("description"),flex:1,dataIndex:"code_text"}],bbar:{xtype:"liveicdxsearch",margin:5,fieldLabel:_("add_problem"),hideLabel:!1,listeners:{scope:a,select:a.addActiveProblem}}},{title:_("medications"),action:"medications",xtype:"grid",width:300,store:a.medicationsStore,columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveRelation}]},{header:_("code"),width:100,dataIndex:"code"},{header:_("description"),flex:1,dataIndex:"code_text"}],bbar:{xtype:"rxnormlivetsearch",margin:5,fieldLabel:_("add_problem"),hideLabel:!1,listeners:{scope:a,select:a.addMedications}}},{title:_("labs"),action:"labs",xtype:"grid",store:a.labsStore,width:300,columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveRelation}]},{header:_("value_name"),flex:1,dataIndex:"value_name"},{header:_("less_than"),flex:1,dataIndex:"less_than",editor:{xtype:"numberfield"}},{header:_("greater_than"),flex:1,dataIndex:"greater_than",editor:{xtype:"numberfield"}},{header:_("equal_to"),flex:1,dataIndex:"equal_to",editor:{xtype:"numberfield"}}],plugins:Ext.create("Ext.grid.plugin.CellEditing",{autoCancel:!0,errorSummary:!1,clicksToEdit:2,listeners:{scope:a,edit:a.afterLabTimeEdit}}),bbar:{xtype:"labslivetsearch",margin:5,fieldLabel:_("add_labs"),hideLabel:!1,listeners:{scope:a,select:a.addLabs}}}]}]}),tbar:a.PagingToolbar=Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager",{}),items:["-",{xtype:"mitos.preventivecaretypescombo",width:150,listeners:{scope:a,select:a.onCodeTypeSelect}}]})}),a.pageBody=[a.guidelineGrid],a.callParent(arguments)},onServiceEdit:function(){},onServiceCancelEdit:function(){},afterLabTimeEdit:function(){},beforeServiceEdit:function(a,b){for(var c=a.editor,d=c.query("grid"),e=0;e<d.length;e++)d[e].store.load({params:{id:b.record.data.id}})},onFormTapChange:function(){},onCodeTypeSelect:function(a,b){var c=this;c.category_id=b[0].data.option_value,"dismiss"==c.category_id||(c.PagingToolbar.moveFirst(),c.store.proxy.extraParams={category_id:c.category_id},c.store.load())},addActiveProblem:function(a,b){this.activeProblemsStore.add({code:b[0].data.code,code_text:b[0].data.code_text,guideline_id:this.getSelectId()}),a.reset()},addMedications:function(a,b){this.medicationsStore.add({code:b[0].data.id,code_text:b[0].data.PROPRIETARYNAME,guideline_id:this.getSelectId()}),a.reset()},addLabs:function(a,b){this.labsStore.add({code:b[0].data.loinc_number,value_name:b[0].data.loinc_name,less_than:"0",greater_than:"0",equal_to:"0",preventive_care_id:this.getSelectId()}),a.reset()},onRemoveRelation:function(a,b){var c=a.getStore(),d=c.getAt(b);c.remove(d)},getSelectId:function(){var a=this.guidelineGrid.getSelectionModel().getLastSelected();return a.data.id},onActive:function(a){this.guidelineGrid.query("combobox")[0].setValue(this.category_id),this.store.proxy.extraParams={category_id:this.category_id},this.store.load(),a(!0)}}),Ext.define("App.model.administration.AclGroup",{extend:"Ext.data.Model",table:{name:"acl_groups"},fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"ACL.getAclGroups",create:"ACL.addAclGroup",update:"ACL.updateAclGroup"},reader:{root:"data"}}}),Ext.define("App.store.administration.AclGroups",{model:"App.model.administration.AclGroup",extend:"Ext.data.Store"}),Ext.define("App.view.administration.TransactionLog",{extend:"App.ux.RenderPanel",xtype:"TransactionLogPanel",pageLayout:"border",pageTitle:_("transaction_log"),itemId:"TransactionLogPanel",requires:["App.ux.LivePatientSearch","App.ux.LiveUserSearch"],initComponent:function(){var a=this;a.transactionLogStore=Ext.create("App.store.administration.TransactionLog",{remoteFilter:!0,remoteSort:!0}),a.auditLogStore=Ext.create("App.store.administration.AuditLogs",{remoteFilter:!0,remoteSort:!0}),a.pageBody=[{xtype:"form",itemId:"TransactionLogFilterFormPanel",region:"west",width:250,autoScroll:!0,collapsible:!0,split:!0,border:!0,bodyPadding:10,title:_("filters"),items:[{xtype:"fieldcontainer",layout:"column",fieldLabel:_("from_date"),labelAlign:"top",items:[{xtype:"datefield",name:"begin_date",columnWidth:.5,hideLabel:!0,emptyText:_("begin_date"),allowBlank:!0,format:g("date_display_format"),submitFormat:"Y-m-d",value:new Date},{xtype:"timefield",name:"begin_time",hideLabel:!0,emptyText:_("begin_time"),increment:30,columnWidth:.5,format:"H:i:s",submitFormat:"H:i:s",value:"00:00:00"}]},{xtype:"fieldcontainer",layout:"column",fieldLabel:_("to_date"),labelAlign:"top",items:[{xtype:"datefield",name:"end_date",columnWidth:.5,hideLabel:!0,emptyText:_("end_date"),allowBlank:!0,format:g("date_display_format"),submitFormat:"Y-m-d",value:new Date},{xtype:"timefield",name:"end_time",hideLabel:!0,emptyText:_("end_time"),increment:30,columnWidth:.5,format:"H:i:s",submitFormat:"H:i:s",value:"23:00:00"}]},{xtype:"tablelist",fieldLabel:_("table"),name:"table_name",labelAlign:"top",columnWidth:1,anchor:"100%",enableReset:!0},{xtype:"eventlist",fieldLabel:_("event_type"),labelAlign:"top",name:"event_type",columnWidth:1,anchor:"100%",enableReset:!0},{xtype:"userlivetsearch",fieldLabel:_("user"),labelAlign:"top",hideLabel:!1,name:"uid",anchor:"100%"},{xtype:"patienlivetsearch",fieldLabel:_("patient"),labelAlign:"top",hideLabel:!1,name:"pid",anchor:"100%",resetEnabled:!0}],bbar:[{xtype:"button",text:_("search"),flex:1,itemId:"TransactionLogFilterSearchBtn"}]},{xtype:"tabpanel",itemId:"TransactionLogTabPanel",region:"center",items:[{xtype:"grid",itemId:"TransactionLogDataGrid",store:a.transactionLogStore,region:"center",border:!0,title:_("transaction_log"),dockedItems:[{xtype:"pagingtoolbar",store:a.transactionLogStore,dock:"bottom",displayInfo:!0}],columns:[{xtype:"datecolumn",text:"Date",format:"Y-m-d H:i:s",dataIndex:"date",width:250},{text:"Patient",dataIndex:"patient_lname",flex:1,renderer:function(a,b,c){return c.get("patient_name")
}},{text:"User",dataIndex:"user_lname",flex:1,renderer:function(a,b,c){return c.get("user_name")}},{text:"Category",dataIndex:"category",flex:1},{text:"Event",dataIndex:"event",flex:1},{text:"Pk",dataIndex:"pk"},{text:"Table",dataIndex:"table_name",flex:1},{text:"IP",dataIndex:"ip",flex:1}]},{xtype:"grid",itemId:"AuditLogDataGrid",store:a.auditLogStore,region:"center",border:!0,title:_("audit_log"),dockedItems:[{xtype:"pagingtoolbar",store:a.auditLogStore,dock:"bottom",displayInfo:!0}],columns:[{xtype:"datecolumn",text:"Date",format:"Y-m-d H:i:s",dataIndex:"event_date",width:250},{text:"Patient",dataIndex:"patient_lname",flex:1,renderer:function(a,b,c){return c.get("patient_name")}},{text:"User",dataIndex:"user_lname",flex:1,renderer:function(a,b,c){return c.get("user_name")}},{text:"Event",dataIndex:"event",flex:1},{text:"Event Description",dataIndex:"event_description",flex:1},{text:"Foreign Pk",dataIndex:"foreign_id"},{text:"Foreign Table",dataIndex:"foreign_table",flex:1},{text:"IP",dataIndex:"ip",flex:1}]}]}],a.callParent(arguments)}}),Ext.define("App.view.administration.CronJob",{extend:"App.ux.RenderPanel",requires:["Ext.grid.plugin.RowEditing"],xtype:"cronjobpanel",itemId:"CronJobPanel",border:!1,pageLayout:{type:"vbox",align:"stretch"},pageTitle:_("cronjobs"),initComponent:function(){var a=this;a.CronJobStore=Ext.create("App.store.administration.CronJob",{remoteFilter:!1,autoLoad:!1,autoSync:!1,pageSize:100}),a.pageBody=[{xtype:"grid",flex:1,frame:!0,title:_("cronjobs_available"),itemId:"CronJobGrid",columnLines:!0,store:a.CronJobStore,selType:"rowmodel",plugins:{ptype:"rowediting",clicksToEdit:2},columns:[{text:_("name"),dataIndex:"name",flex:1},{text:_("minute"),dataIndex:"minute",align:"center",editor:{xtype:"textfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"',validator:function(a){return 0>a||a>59?"Minute (0 - 59)":!0}}},{text:_("hour"),dataIndex:"hour",align:"center",editor:{xtype:"textfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"',validator:function(a){return 0>a||a>23?"Hour (0 - 23)":!0}}},{text:_("month_day"),dataIndex:"month_day",align:"center",editor:{xtype:"textfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"',validator:function(a){return 1>a||a>31?"Day of month (1 - 31)":!0}}},{text:_("month"),dataIndex:"month",align:"center",editor:{xtype:"textfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"',validator:function(a){return 1>a||a>12?"Month (1 - 12)":!0}}},{text:_("week_day"),dataIndex:"week_day",align:"center",editor:{xtype:"textfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"',validator:function(a){return 0>a||a>7?"Day of week (0 - 7) (Sunday=0 or 7)":!0}}},{text:_("timeout"),dataIndex:"timeout",align:"center",editor:{xtype:"numberfield",allowBlank:!1,inputAttrTpl:'style="text-align:center"'}},{text:_("parameters"),dataIndex:"params",align:"center",editor:{xtype:"textfield",inputAttrTpl:'style="text-align:center"'}},{text:_("elapsed"),dataIndex:"elapsed",align:"center"},{text:_("pid"),dataIndex:"pid",align:"center"},{text:_("running"),dataIndex:"running",renderer:a.boolRenderer,align:"center"},{text:_("active"),dataIndex:"active",renderer:a.boolRenderer,align:"center",editor:{xtype:"checkboxfield"}}],tbar:["->",{xtype:"button",text:_("kill_process"),itemId:"CronJobPanelKillProcessBtn",cls:"btnRedBackground"}],bbar:{xtype:"pagingtoolbar",pageSize:100,store:a.CronJobStore,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}],a.callParent(arguments)}}),Ext.define("App.view.miscellaneous.Amendments",{extend:"App.ux.RenderPanel",requires:["Ext.ux.SlidingPager"],itemId:"AmendmentsPanel",pageTitle:_("amendments"),initComponent:function(){var a=this;a.controller=App.app.getController("miscellaneous.Amendments"),a.pageBody=[{xtype:"grid",itemId:"AmendmentsGrid",store:a.store=Ext.create("App.store.miscellaneous.Amendments",{remoteFilter:!0,remoteSort:!0,sorters:[{property:"cancel_date",direction:"DESC"}]}),columns:[{text:_("type"),width:70,dataIndex:"amendment_type",renderer:function(b,c,d){var e;return e="P"===b?_("patient"):"G"===b?_("guardian"):"E"===b?_("emergency_contact"):"D"===b?_("doctor"):"O"===b?_("organization"):b,a.newRenderer(e,c,d)}},{text:_("dates"),columns:[{text:_("received"),width:140,dataIndex:"create_date",renderer:a.dateNewRenderer},{text:_("appended"),width:140,dataIndex:"create_date",renderer:a.dateNewRenderer},{text:_("responded"),width:140,dataIndex:"response_date",renderer:a.dateNewRenderer}]},{text:_("message"),flex:1,dataIndex:"amendment_message",renderer:a.newRenderer},{text:_("response_message"),flex:1,dataIndex:"response_message",renderer:a.newRenderer},{text:_("status"),width:100,dataIndex:"amendment_status",renderer:function(b,c,d){var e;return e="W"===b?_("waiting_response"):"A"===b?_("approved"):"D"===b?_("denied"):"C"===b?_("canceled"):"E"===b?_("error"):b,a.controller.updateIsViewed(d),a.newRenderer(e,c,d)}},{text:_("approved_denied_by"),width:200,dataIndex:"responded_by",renderer:a.newRenderer}],bbar:{xtype:"pagingtoolbar",pageSize:25,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}],a.callParent()},newRenderer:function(a,b,c){return c.data.is_read||(b.style="font-weight:bold"),a},dateNewRenderer:function(a,b,c){return c.data.is_read||(b.style="font-weight:bold"),Ext.Date.format(a,g("date_time_display_format"))}}),Ext.define("App.view.miscellaneous.OfficeNotes",{extend:"App.ux.RenderPanel",id:"panelOfficeNotes",pageTitle:_("office_notes"),pageLayout:"border",initComponent:function(){var a=this;a.store=Ext.create("App.store.miscellaneous.OfficeNotes"),a.form=Ext.create("Ext.form.FormPanel",{region:"north",frame:!0,height:97,margin:"0 0 3 0",items:[{xtype:"textareafield",allowBlank:!1,grow:!0,margin:0,itemId:"body",name:"body",anchor:"100%",emptyText:_("type_new_note_here")+"...",listeners:{scope:a,validitychange:a.onValidityChange}}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:_("save"),iconCls:"save",itemId:"cmdSave",disabled:!0,scope:a,handler:a.onNoteSave},"-",{text:_("hide_this_note"),iconCls:"save",itemId:"cmdHide",tooltip:_("hide_selected_office_note"),disabled:!0,scope:a,handler:a.onNoteHide},"-",{text:_("reset"),iconCls:"save",itemId:"cmdReset",disabled:!0,scope:a,handler:a.onFormReset}]}]}),a.grid=Ext.create("Ext.grid.Panel",{region:"center",store:a.store,listeners:{scope:a,itemclick:a.onItemClick},columns:[{width:150,header:_("date"),sortable:!0,dataIndex:"date",renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s")},{width:150,header:_("user"),sortable:!0,dataIndex:"user"},{flex:1,header:_("note"),sortable:!0,dataIndex:"body"}],tbar:Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager",{}),items:[{text:_("show_only_active_notes"),iconCls:"save",enableToggle:!0,pressed:!0,handler:function(){a.store.load({params:{show:"active"}})}},"-",{text:_("show_all_notes"),iconCls:"save",enableToggle:!0,handler:function(){a.store.load({params:{show:"all"}})}}]})}),a.pageBody=[a.form,a.grid],a.callParent(arguments)},onNoteSave:function(a){var b=a.up("form").getForm(),c=this.store,d=b.getRecord(),e=b.getValues(),f=c.indexOf(d);-1==f?c.add(e):d.set(e),c.sync()},onNoteHide:function(){},onFormReset:function(){var a=this.form,b=a.getForm(),c=a.down("toolbar"),d=c.getComponent("cmdSave"),e=c.getComponent("cmdHide"),f=c.getComponent("cmdReset");b.reset(),d.disable(),e.disable(),f.disable(),d.setText("Save")},onItemClick:function(a,b){var c=this.form,d=c.getForm(),e=c.down("toolbar"),f=e.getComponent("cmdSave"),g=e.getComponent("cmdHide"),h=e.getComponent("cmdReset");d.reset(),d.loadRecord(b),f.enable(),g.enable(),h.enable(),f.setText("Update")},onValidityChange:function(){var a=this.form,b=a.getComponent("body"),c=a.down("toolbar"),d=c.getComponent("cmdSave"),e=c.getComponent("cmdReset");b.isValid()?(d.enable(),e.enable()):d.disable()},onActive:function(a){this.store.load({params:{show:"active"}}),a(!0)}}),Ext.define("App.view.miscellaneous.Websearch",{extend:"App.ux.RenderPanel",id:"panelWebsearch",pageTitle:_("national_library"),pageLayout:"border",uses:["Ext.grid.Panel"],initComponent:function(){var a,b,c,d=this;Ext.ModelManager.isRegistered("webSearch")||(d.store=Ext.create("App.store.miscellaneous.webSearch"),d.codingStore=Ext.create("Ext.data.Store",{fields:["search","name"],data:[{search:"code",name:"Code"},{search:"term",name:"Term"}]})),d.searchPanel=Ext.create("Ext.panel.Panel",{region:"north",bodyPadding:"8 11 5 11",margin:"0 0 2 0",layout:"anchor",items:[{xtype:"radiogroup",fieldLabel:_("search_by"),items:[{boxLabel:_("heath_topics"),name:"type",inputValue:"health_topics"},{boxLabel:"SNOMED CT",name:"type",inputValue:"snomed"},{boxLabel:"RxCUI",name:"type",inputValue:"rxcui"},{boxLabel:"LOINC",name:"type",inputValue:"loinc"},{boxLabel:"NDC",name:"type",inputValue:"ndc"},{boxLabel:"ICD-9-CM",name:"type",inputValue:"icd9cm"}],listeners:{change:function(){var b=this.getValue();a=b.type,d.searchField.enable(),d.searchField.reset()}}},d.termField=Ext.create("Ext.form.ComboBox",{name:"term",fieldLabel:_("code_term")+":",store:d.codingStore,anchor:"100%",queryMode:"local",displayField:"name",valueField:"search",editable:!1,listeners:{change:function(){b=this.getValue()}}}),d.searchField=Ext.create("Ext.form.field.Text",{emptyText:_("web_search")+"...",enableKeyEvents:!0,hideLabel:!0,anchor:"100%",disabled:!0,listeners:{keyup:function(){var c=this.getValue();c.length>2&&d.store.load({params:{type:a,q:c,term:b}})},buffer:500,focus:function(){d.viewPanel.collapse()}}})]}),d.searchRow=function(a,b,c){return Ext.String.format('<div class="topic"><span class="search_title">{0}</span><br><span class="search_source">{1}</span><br><span class="search_snippet" style="white-space: normal;">{2}</span></div>',a,c.get("source")||"Unknown",c.get("snippet")||"Unknown")},d.onotesGrid=Ext.create("Ext.grid.Panel",{margin:"0 0 2 0",region:"center",store:d.store,viewConfig:{deferEmptyText:!1,emptyText:'<p class="search_nothing_found" style="padding: 10px 0 0 20px; font-size: 24px">'+_("nothing_found")+"!</p>",stripeRows:!0,loadingText:_("searching")+"... "+_("please_wait")},columns:[{flex:1,header:_("search_results"),sortable:!0,dataIndex:"title",renderer:d.searchRow},{hidden:!0,sortable:!0,dataIndex:"source"},{hidden:!0,sortable:!0,dataIndex:"snippet"}],tbar:Ext.create("Ext.PagingToolbar",{store:d.store,displayInfo:!0,emptyMsg:_("nothing_to_display"),plugins:Ext.create("Ext.ux.SlidingPager",{})}),listeners:{itemclick:function(a,b,e,f){c=d.store.getAt(f),d.viewPanel.update(c.data),d.viewPanel.expand()}}}),d.viewPanel=Ext.create("Ext.panel.Panel",{region:"south",height:300,collapsible:!0,collapsed:!0,layout:"fit",frame:!0,bodyBorder:!0,tpl:Ext.create("Ext.XTemplate",'<div class="search_container">','<div class="search_data">','<h3 class="search_title">'+_("title")+": {title}</h3>",'<h4 class="search_source">'+_("source")+": {source}</h4>","</div>",'<div class="search_body">{FullSummary}</div>',"</div>")}),d.pageBody=[d.searchPanel,d.onotesGrid,d.viewPanel],d.callParent(arguments),d.termField.select("code")},onActive:function(a){a(!0)}}),Ext.define("App.view.miscellaneous.MySettings",{extend:"App.ux.RenderPanel",id:"panelMySettings",pageTitle:_("my_settings"),uses:["Ext.grid.Panel"],initComponent:function(){var a=this;a.uSettingsForm=Ext.create("App.ux.form.Panel",{id:"uSettingsForm",bodyStyle:"padding: 10px;",cls:"form-white-bg",frame:!0,hideLabels:!0,items:[{xtype:"textfield",hidden:!0,id:"id",name:"id"},{xtype:"fieldset",title:_("appearance_settings"),collapsible:!0,defaultType:"textfield",layout:"anchor",defaults:{labelWidth:89,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{},{},{}]},{xtype:"fieldset",title:_("locale_settings"),collapsible:!0,defaultType:"textfield",layout:"anchor",defaults:{labelWidth:89,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{},{},{}]},{xtype:"fieldset",title:_("calendar_settings"),collapsible:!0,defaultType:"textfield",layout:"anchor",defaults:{labelWidth:89,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{},{},{}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:_("save"),iconCls:"save",id:"cmdSave",disabled:!0,handler:function(){}}]}]}),a.pageBody=[a.uSettingsForm],a.callParent(arguments)},onActive:function(a){a(!0)}}),Ext.define("App.view.signature.SignatureWindow",{extend:"Ext.window.Window",title:_("please_sign"),closeAction:"hide",height:250,width:500,bodyStyle:"background-color:#fff",modal:!0,layout:"fit",initComponent:function(){var a=this;a.html=a.signature='<iframe id="svgSignature" src="app/view/signature/signature.svg" height="100%" width="100%" scrolling="no" frameborder="0"></iframe>',a.buttons=[{text:_("save"),scope:a,handler:a.signatureSave},{text:_("reset"),scope:a,handler:a.signatureCancel}],this.callParent(arguments)},signatureSave:function(){document.getElementById("svgSignature").contentWindow},signatureCancel:function(){var a=document.getElementById("svgSignature").contentWindow;a.clearSignature()}}),Ext.define("App.store.miscellaneous.AddressBook",{model:"App.model.miscellaneous.AddressBook",extend:"Ext.data.Store"}),Ext.define("App.store.patient.CarePlanGoals",{extend:"Ext.data.Store",requires:["App.model.patient.CarePlanGoal"],model:"App.model.patient.CarePlanGoal"}),Ext.define("App.store.patient.PatientPossibleDuplicates",{extend:"Ext.data.Store",model:"App.model.patient.PatientPossibleDuplicate"}),Ext.define("App.store.patient.SmokeStatus",{extend:"Ext.data.Store",requires:["App.model.patient.SmokeStatus"],model:"App.model.patient.SmokeStatus",remoteFilter:!0}),Ext.define("App.store.patient.CognitiveAndFunctionalStatus",{extend:"Ext.data.Store",requires:["App.model.patient.CognitiveAndFunctionalStatus"],model:"App.model.patient.CognitiveAndFunctionalStatus"}),Ext.define("App.store.administration.Applications",{model:"App.model.administration.Applications",extend:"Ext.data.Store",autoSync:!0,autoLoad:!1}),Ext.define("App.store.administration.DefaultDocuments",{model:"App.model.administration.DefaultDocuments",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:DocumentHandler.getDefaultDocumentsTemplates,create:DocumentHandler.addDocumentsTemplates,update:DocumentHandler.updateDocumentsTemplates}},autoSync:!0,autoLoad:!1}),Ext.define("App.store.administration.ActiveProblems",{model:"App.model.administration.ActiveProblems",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:Services.getActiveProblems,create:Services.addActiveProblems,destroy:Services.removeActiveProblems},reader:{totalProperty:"totals",root:"rows"}},autoLoad:!1}),Ext.define("App.store.administration.Facility",{model:"App.model.administration.Facility",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"Facilities.getFacilities",create:"Facilities.addFacility",update:"Facilities.updateFacility",destroy:"Facilities.deleteFacility"}}}),Ext.define("App.store.administration.ExternalDataLoads",{model:"App.model.administration.ExternalDataLoads",extend:"Ext.data.Store",constructor:function(a){var b=this;b.proxy={type:"direct",api:{read:"ExternalDataUpdate.getCodeFiles"},extraParams:{codeType:a.codeType}},b.callParent(arguments)},remoteSort:!1,autoLoad:!1}),Ext.define("App.store.administration.FloorPlans",{model:"App.model.administration.FloorPlans",extend:"Ext.data.Store",autoSync:!1,autoLoad:!1}),Ext.define("App.store.administration.DocumentsTemplates",{model:"App.model.administration.DocumentsTemplates",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"DocumentHandler.getDocumentsTemplates",create:"DocumentHandler.addDocumentsTemplates",update:"DocumentHandler.updateDocumentsTemplates"}},autoSync:!0,autoLoad:!1}),Ext.define("App.store.administration.DocumentToken",{model:"App.model.administration.DocumentToken",extend:"Ext.data.Store",data:[{title:_("patient_id"),token:"[PATIENT_ID]"},{title:_("patient_record_number"),token:"[PATIENT_RECORD_NUMBER]"},{title:_("patient_name"),token:"[PATIENT_NAME]"},{title:_("patient_full_name"),token:"[PATIENT_FULL_NAME]"},{title:_("patient_mothers_maiden_name"),token:"[PATIENT_MAIDEN_NAME]"},{title:_("patient_last_name"),token:"[PATIENT_LAST_NAME]"},{title:_("patient_birthdate"),token:"[PATIENT_BIRTHDATE]"},{title:_("patient_marital_status"),token:"[PATIENT_MARITAL_STATUS]"},{title:_("patient_home_phone"),token:"[PATIENT_HOME_PHONE]"},{title:_("patient_mobile_phone"),token:"[PATIENT_MOBILE_PHONE]"},{title:_("patient_work_phone"),token:"[PATIENT_WORK_PHONE]"},{title:_("patient_email"),token:"[PATIENT_EMAIL]"},{title:_("patient_social_security"),token:"[PATIENT_SOCIAL_SECURITY]"},{title:_("patient_sex"),token:"[PATIENT_SEX]"},{title:_("patient_age"),token:"[PATIENT_AGE]"},{title:_("PATIENT_PHYSICAL_ADDRESS_LINE_ONE"),token:"[PATIENT_PHYSICAL_ADDRESS_LINE_ONE]"},{title:_("PATIENT_PHYSICAL_ADDRESS_LINE_TWO"),token:"[PATIENT_PHYSICAL_ADDRESS_LINE_TWO]"},{title:_("PATIENT_PHYSICAL_CITY"),token:"[PATIENT_PHYSICAL_CITY]"},{title:_("PATIENT_PHYSICAL_STATE"),token:"[PATIENT_PHYSICAL_STATE]"},{title:_("PATIENT_PHYSICAL_ZIP"),token:"[PATIENT_PHYSICAL_ZIP]"},{title:_("PATIENT_PHYSICAL_COUNTRY"),token:"[PATIENT_PHYSICAL_COUNTRY]"},{title:_("PATIENT_POSTAL_ADDRESS_LINE_ONE"),token:"[PATIENT_POSTAL_ADDRESS_LINE_ONE]"},{title:_("PATIENT_POSTAL_ADDRESS_LINE_TWO"),token:"[PATIENT_POSTAL_ADDRESS_LINE_TWO]"},{title:_("PATIENT_POSTAL_CITY"),token:"[PATIENT_POSTAL_CITY]"},{title:_("PATIENT_POSTAL_STATE"),token:"[PATIENT_POSTAL_STATE]"},{title:_("PATIENT_POSTAL_ZIP"),token:"[PATIENT_POSTAL_ZIP]"},{title:_("PATIENT_POSTAL_COUNTRY"),token:"[PATIENT_POSTAL_COUNTRY]"},{title:_("patient_tabacco"),token:"[PATIENT_TABACCO]"},{title:_("patient_alcohol"),token:"[PATIENT_ALCOHOL]"},{title:_("patient_drivers_license"),token:"[PATIENT_DRIVERS_LICENSE]"},{title:_("patient_employeer"),token:"[PATIENT_EMPLOYEER]"},{title:_("patient_first_emergency_contact"),token:"[PATIENT_FIRST_EMERGENCY_CONTACT]"},{title:_("patient_referral"),token:"[PATIENT_REFERRAL]"},{title:_("patient_date_referred"),token:"[PATIENT_REFERRAL_DATE]"},{title:_("patient_balance"),token:"[PATIENT_BALANCE]"},{title:_("patient_picture"),token:"[PATIENT_PICTURE]"},{title:_("patient_primary_plan"),token:"[PATIENT_PRIMARY_PLAN]"},{title:_("patient_primary_plan_insured_person"),token:"[PATIENT_PRIMARY_INSURED_PERSON]"},{title:_("patient_primary_plan_contract_number"),token:"[PATIENT_PRIMARY_CONTRACT_NUMBER]"},{title:_("patient_primary_plan_expiration_date"),token:"[PATIENT_PRIMARY_EXPIRATION_DATE]"},{title:_("patient_secondary_plan"),token:"[PATIENT_SECONDARY_PLAN]"},{title:_("patient_secondary_insured_person"),token:"[PATIENT_SECONDARY_INSURED_PERSON]"},{title:_("patient_secondary_plan_contract_number"),token:"[PATIENT_SECONDARY_CONTRACT_NUMBER]"},{title:_("patient_secondary_plan_expiration_date"),token:"[PATIENT_SECONDARY_EXPIRATION_DATE]"},{title:_("patient_referral_details"),token:"[PATIENT_REFERRAL_DETAILS]"},{title:_("patient_referral_reason"),token:"[PATIENT_REFERRAL_REASON]"},{title:_("patient_head_circumference"),token:"[PATIENT_HEAD_CIRCUMFERENCE]"},{title:_("patient_height"),token:"[PATIENT_HEIGHT]"},{title:_("patient_pulse"),token:"[PATIENT_PULSE]"},{title:_("patient_respiratory_rate"),token:"[PATIENT_RESPIRATORY_RATE]"},{title:_("patient_temperature"),token:"[PATIENT_TEMPERATURE]"},{title:_("patient_weight"),token:"[PATIENT_WEIGHT]"},{title:_("patient_pulse_oximeter"),token:"[PATIENT_PULSE_OXIMETER]"},{title:_("patient_blood_preasure"),token:"[PATIENT_BLOOD_PREASURE]"},{title:_("patient_body_mass_index"),token:"[PATIENT_BMI]"},{title:_("patient_active_allergies_list"),token:"[PATIENT_ACTIVE_ALLERGIES_LIST]"},{title:_("patient_inactive_allergies_list"),token:"[PATIENT_INACTIVE_ALLERGIES_LIST]"},{title:_("patient_active_medications_list"),token:"[PATIENT_ACTIVE_MEDICATIONS_LIST]"},{title:_("patient_inactive_medications_list"),token:"[PATIENT_INACTIVE_MEDICATIONS_LIST]"},{title:_("patient_active_problems_list"),token:"[PATIENT_ACTIVE_PROBLEMS_LIST]"},{title:_("patient_inactive_problems_list"),token:"[PATIENT_INACTIVE_PROBLEMS_LIST]"},{title:_("patient_active_immunizations_list"),token:"[PATIENT_ACTIVE_IMMUNIZATIONS_LIST]"},{title:_("patient_inactive_immunizations_list"),token:"[PATIENT_INACTIVE_IMMUNIZATIONS_LIST]"},{title:_("patient_active_dental_list"),token:"[PATIENT_ACTIVE_DENTAL_LIST]"},{title:_("patient_inactive_dental_list"),token:"[PATIENT_INACTIVE_DENTAL_LIST]"},{title:_("patient_active_surgery_list"),token:"[PATIENT_ACTIVE_SURGERY_LIST]"},{title:_("patient_inactive_surgery_list"),token:"[PATIENT_INACTIVE_SURGERY_LIST]"},{title:_("provider_id"),token:"[PROVIDER_ID]"},{title:_("provider_title"),token:"[PROVIDER_TITLE]"},{title:_("provider_full_name"),token:"[PROVIDER_FULL_NAME]"},{title:_("provider_first_name"),token:"[PROVIDER_FIRST_NAME]"},{title:_("provider_middle_name"),token:"[PROVIDER_MIDDLE_NAME]"},{title:_("provider_last_name"),token:"[PROVIDER_LAST_NAME]"},{title:_("provider_npi"),token:"[PROVIDER_NPI]"},{title:_("provider_lic"),token:"[PROVIDER_LIC]"},{title:_("provider_dea"),token:"[PROVIDER_DEA]"},{title:_("provider_state_drug_id"),token:"[PROVIDER_SDI]"},{title:_("provider_fed_tax"),token:"[PROVIDER_FED_TAX]"},{title:_("provider_ess"),token:"[PROVIDER_ESS]"},{title:_("provider_taxonomy"),token:"[PROVIDER_TAXONOMY]"},{title:_("provider_email"),token:"[PROVIDER_EMAIL]"},{title:_("provider_direct_address"),token:"[PROVIDER_DIRECT_ADDRESS]"},{title:_("provider_address_one"),token:"[PROVIDER_ADDRESS_LINE_ONE]"},{title:_("provider_address_two"),token:"[PROVIDER_ADDRESS_LINE_TWO]"},{title:_("provider_city"),token:"[PROVIDER_ADDRESS_CITY]"},{title:_("provider_state"),token:"[PROVIDER_ADDRESS_STATE]"},{title:_("provider_zip"),token:"[PROVIDER_ADDRESS_ZIP]"},{title:_("provider_country"),token:"[PROVIDER_ADDRESS_COUNTRY]"},{title:_("provider_phone"),token:"[PROVIDER_PHONE]"},{title:_("provider_mobile"),token:"[PROVIDER_MOBILE]"},{title:_("encounter_date"),token:"[ENCOUNTER_DATE]"},{title:_("encounter_subjective_part"),token:"[ENCOUNTER_SUBJECTIVE]"},{title:_("encounter_subjective_part"),token:"[ENCOUNTER_OBJECTIVE]"},{title:_("encounter_assessment"),token:"[ENCOUNTER_ASSESSMENT]"},{title:_("encounter_assessment_list"),token:"[ENCOUNTER_ASSESSMENT_LIST]"},{title:_("encounter_assessment_code_list"),token:"[ENCOUNTER_ASSESSMENT_CODE_LIST]"},{title:_("encounter_assessment_full_list"),token:"[ENCOUNTER_ASSESSMENT_FULL_LIST]"},{title:_("encounter_plan"),token:"[ENCOUNTER_PLAN]"},{title:_("encounter_medications"),token:"[ENCOUNTER_MEDICATIONS]"},{title:_("encounter_immunizations"),token:"[ENCOUNTER_IMMUNIZATIONS]"},{title:_("encounter_allergies"),token:"[ENCOUNTER_ALLERGIES]"},{title:_("encounter_active_problems"),token:"[ENCOUNTER_ACTIVE_PROBLEMS]"},{title:_("encounter_surgeries"),token:"[ENCOUNTER_SURGERIES]"},{title:_("encounter_dental"),token:"[ENCOUNTER_DENTAL]"},{title:_("encounter_laboratories"),token:"[ENCOUNTER_LABORATORIES]"},{title:_("encounter_procedures_terms"),token:"[ENCOUNTER_PROCEDURES_TERMS]"},{title:_("encounter_cpt_codes_list"),token:"[ENCOUNTER_CPT_CODES]"},{title:_("encounter_signature"),token:"[ENCOUNTER_SIGNATURE]"},{title:_("orders_laboratories"),token:"[ORDERS_LABORATORIES]"},{title:_("orders_x_rays"),token:"[ORDERS_XRAYS]"},{title:_("orders_referral"),token:"[ORDERS_REFERRAL]"},{title:_("orders_other"),token:"[ORDERS_OTHER]"},{title:_("order_date"),token:"[ORDER_DATE]"},{title:_("current_date"),token:"[CURRENT_DATE]"},{title:_("current_time"),token:"[CURRENT_TIME]"},{title:_("current_user_name"),token:"[CURRENT_USER_NAME]"},{title:_("current_user_full_name"),token:"[CURRENT_USER_FULL_NAME]"},{title:_("current_user_license_number"),token:"[CURRENT_USER_LICENSE_NUMBER]"},{title:_("current_user_dea_license_number"),token:"[CURRENT_USER_DEA_LICENSE_NUMBER]"},{title:_("current_user_dm_license_number"),token:"[CURRENT_USER_DM_LICENSE_NUMBER]"},{title:_("current_user_npi_license_number"),token:"[CURRENT_USER_NPI_LICENSE_NUMBER]"},{title:"",token:"[REFERRING_ID]"},{title:"",token:"[REFERRING_TITLE]"},{title:"",token:"[REFERRING_FULL_NAME]"},{title:"",token:"[REFERRING_FIRST_NAME]"},{title:"",token:"[REFERRING_MIDDLE_NAME]"},{title:"",token:"[REFERRING_LAST_NAME]"},{title:"",token:"[REFERRING_NPI]"},{title:"",token:"[REFERRING_LIC]"},{title:"",token:"[REFERRING_FED_TAX]"},{title:"",token:"[REFERRING_TAXONOMY]"},{title:"",token:"[REFERRING_EMAIL]"},{title:"",token:"[REFERRING_DIRECT_ADDRESS]"},{title:"",token:"[REFERRING_PHONE]"},{title:"",token:"[REFERRING_MOBILE]"},{title:"",token:"[REFERRING_FAX]"},{title:_("referral_id"),token:"[REFERRAL_ID]"},{title:_("referral_date"),token:"[REFERRAL_DATE]"},{title:_("referral_reason"),token:"[REFERRAL_REASON]"},{title:_("referral_diagnosis"),token:"[REFERRAL_DIAGNOSIS]"},{title:_("referral_service_request"),token:"[REFERRAL_SERVICE]"},{title:_("referral_risk_level"),token:"[REFERRAL_RISK_LEVEL]"},{title:_("referral_by"),token:"[REFERRAL_BY_TEXT]"},{title:_("referral_to"),token:"[REFERRAL_TO_TEXT]"},{title:_("rad_report_body"),token:"[REPORT_ACCESSIONS]"},{title:_("report_body"),token:"[REPORT_BODY]"},{title:_("report_interpreter"),token:"[REPORT_INTERPRETER]"},{title:_("report_transcriptionist"),token:"[REPORT_TRANSCRIPTIONIST]"},{title:_("report_signature"),token:"[REPORT_SIGNATURE]"},{title:_("line"),token:"[LINE]"},{title:_("time_now"),token:"[TIME_NOW]"}]}),Ext.define("App.store.administration.FloorPlanZones",{extend:"Ext.data.Store",model:"App.model.administration.FloorPlanZones"}),Ext.define("App.store.administration.FormsList",{model:"App.model.administration.FormsList",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"FormLayoutBuilder.getForms",create:"FormLayoutBuilder.addForms",update:"FormLayoutBuilder.updateForms"}},autoSync:!0,remoteSort:!0,autoLoad:!1}),Ext.define("App.store.administration.Globals",{requires:["App.model.administration.Globals"],model:"App.model.administration.Globals",extend:"Ext.data.Store"}),Ext.define("App.store.administration.ImmunizationRelations",{model:"App.model.administration.ImmunizationRelations",extend:"Ext.data.Store",autoLoad:!1,autoSync:!0,remoteSort:!1}),Ext.define("App.store.administration.HeadersAndFooters",{model:"App.model.administration.HeadersAndFooters",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:DocumentHandler.getHeadersAndFootersTemplates,create:DocumentHandler.addDocumentsTemplates,update:DocumentHandler.updateDocumentsTemplates}},autoSync:!0,autoLoad:!1}),Ext.define("App.store.administration.FormListOptions",{model:"App.model.administration.FormListOptions",extend:"Ext.data.Store",autoLoad:!1}),Ext.define("App.store.administration.LayoutTree",{model:"App.model.administration.LayoutTree",extend:"Ext.data.TreeStore",folderSort:!1,autoLoad:!1}),Ext.define("App.store.administration.Lists",{model:"App.model.administration.Lists",extend:"Ext.data.Store",pageSize:500,sorters:[{property:"title",direction:"ASC"}]}),Ext.define("App.store.administration.ListOptions",{model:"App.model.administration.ListOptions",extend:"Ext.data.Store",pageSize:300,remoteSort:!0,sorters:[{property:"seq",direction:"ASC"}]}),Ext.define("App.store.administration.LabObservations",{model:"App.model.administration.LabObservations",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"Laboratories.getLabObservations",create:"Laboratories.addLabObservation",update:"Laboratories.updateLabObservation",destroy:"Laboratories.removeLabObservation"},writer:{writeAllFields:!0}},autoSync:!0,autoLoad:!1}),Ext.define("App.store.administration.Modules",{model:"App.model.administration.Modules",extend:"Ext.data.Store"}),Ext.define("App.store.administration.Medications",{model:"App.model.administration.Medications",extend:"Ext.data.Store",buffered:!0,leadingBufferZone:100,pageSize:50,remoteFilter:!0}),Ext.define("App.store.administration.PreventiveCareActiveProblems",{model:"App.model.administration.PreventiveCareActiveProblems",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"PreventiveCare.getGuideLineActiveProblems",create:"PreventiveCare.addGuideLineActiveProblems",destroy:"PreventiveCare.removeGuideLineActiveProblems"}},remoteSort:!1,autoLoad:!1}),Ext.define("App.store.administration.PreventiveCare",{model:"App.model.administration.PreventiveCare",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"PreventiveCare.getGuideLinesByCategory",create:"PreventiveCare.addGuideLine",update:"PreventiveCare.updateGuideLine"},reader:{totalProperty:"totals",root:"rows"},extraParams:{code_type:this.code_type,query:this.query,active:this.active}},autoSync:!0,remoteSort:!1,autoLoad:!1}),Ext.define("App.store.administration.ParentFields",{model:"App.model.administration.ParentFields",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"FormLayoutBuilder.getParentFields"}},autoLoad:!1}),Ext.define("App.store.administration.TransactionLog",{model:"App.model.administration.TransactionLog",extend:"Ext.data.Store"}),Ext.define("App.store.administration.PreventiveCareMedications",{model:"App.model.administration.PreventiveCareMedications",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"PreventiveCare.getGuideLineMedications",create:"PreventiveCare.addGuideLineMedications",destroy:"PreventiveCare.removeGuideLineMedications"}},remoteSort:!1,autoLoad:!1}),Ext.define("App.store.administration.ProviderCredentializations",{model:"App.model.administration.ProviderCredentialization",extend:"Ext.data.Store"}),Ext.define("App.store.administration.PreventiveCareLabs",{model:"App.model.administration.PreventiveCareLabs",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"PreventiveCare.getGuideLineLabs",create:"PreventiveCare.addGuideLineLabs",destroy:"PreventiveCare.removeGuideLineLabs",update:"PreventiveCare.updateGuideLineLabs"}},remoteSort:!1,autoLoad:!1}),Ext.define("App.store.administration.EncounterEventHistory",{model:"App.model.administration.EncounterEventHistory",extend:"Ext.data.Store",autoLoad:!1}),Ext.define("App.store.administration.Services",{model:"App.model.administration.Services",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"DataManager.getServices",create:"DataManager.addService",update:"DataManager.updateService"},reader:{totalProperty:"totals",root:"rows"},writer:{writeAllFields:!0},extraParams:{code_type:this.code_type,query:this.query,active:this.active}},autoSync:!0,remoteSort:!0,autoLoad:!1}),Ext.define("App.store.administration.IpAccessRules",{storeId:"IpAccessRulesStore",model:"App.model.administration.IpAccessRule",extend:"Ext.data.Store"}),Ext.define("App.store.administration.IpAccessLog",{storeId:"IpAccessLogStore",model:"App.model.administration.IpAccessLog",extend:"Ext.data.Store"}),Ext.define("App.store.miscellaneous.OfficeNotes",{extend:"Ext.data.Store",model:"App.model.miscellaneous.OfficeNotes",autoLoad:!1}),Ext.define("App.store.administration.CronJob",{storeId:"CronJobStore",model:"App.model.administration.CronJob",extend:"Ext.data.Store"}),Ext.define("App.store.administration.XtypesComboModel",{model:"App.model.administration.XtypesComboModel",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:"CombosData.getFiledXtypes"}},autoLoad:!0}),Ext.define("App.store.administration.User",{model:"App.model.administration.User",extend:"Ext.data.Store",autoLoad:!1}),Ext.define("App.store.account.VoucherLine",{extend:"Ext.data.Store",model:"App.model.account.VoucherLine",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.fees.Billing",{extend:"Ext.data.Store",model:"App.model.fees.Billing",autoLoad:!1}),Ext.define("App.store.miscellaneous.Amendments",{model:"App.model.miscellaneous.Amendment",extend:"Ext.data.Store"}),Ext.define("App.store.account.Voucher",{extend:"Ext.data.Store",model:"App.model.account.Voucher",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.fees.Checkout",{extend:"Ext.data.Store",model:"App.model.fees.Checkout",autoLoad:!1}),Ext.define("App.store.fees.EncountersPayments",{extend:"Ext.data.Store",model:"App.model.fees.EncountersPayments",autoLoad:!1}),Ext.define("App.store.documents.AdministrativeDocuments",{extend:"Ext.data.Store",model:"App.model.documents.AdministrativeDocuments",remoteSort:!1,autoLoad:!1,autoSync:!0}),Ext.define("App.store.fees.PaymentTransactions",{extend:"Ext.data.Store",model:"App.model.fees.PaymentTransactions",autoLoad:!1}),Ext.define("App.store.patient.AdvanceDirectives",{extend:"Ext.data.Store",model:"App.model.patient.AdvanceDirective"}),Ext.define("App.store.navigation.Navigation",{extend:"Ext.data.TreeStore",requires:["App.model.navigation.Navigation"],model:"App.model.navigation.Navigation"}),Ext.define("App.store.patient.encounter.Procedures",{model:"App.model.patient.encounter.Procedures",extend:"Ext.data.Store",autoLoad:!1}),Ext.define("App.store.patient.CptCodes",{extend:"Ext.data.Store",model:"App.model.patient.CptCodes",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.Disclosures",{extend:"Ext.data.Store",model:"App.model.patient.Disclosures",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.EncounterServices",{extend:"Ext.data.Store",model:"App.model.patient.EncounterService"}),Ext.define("App.store.patient.Dental",{extend:"Ext.data.Store",model:"App.model.patient.Dental",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.Encounters",{extend:"Ext.data.Store",requires:["App.model.patient.Encounter"],model:"App.model.patient.Encounter",remoteSort:!0}),Ext.define("App.store.patient.CVXCodes",{extend:"Ext.data.Store",requires:["App.model.patient.CVXCodes"],model:"App.model.patient.CVXCodes",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.MeaningfulUseAlert",{extend:"Ext.data.Store",model:"App.model.patient.MeaningfulUseAlert",remoteSort:!0,autoLoad:!1}),Ext.define("App.store.patient.ImmunizationCheck",{extend:"Ext.data.Store",model:"App.model.patient.ImmunizationCheck",remoteSort:!0,autoLoad:!1}),Ext.define("App.store.patient.LaboratoryTypes",{extend:"Ext.data.Store",model:"App.model.patient.LaboratoryTypes",remoteSort:!1}),Ext.define("App.store.patient.RxOrders",{extend:"Ext.data.Store",model:"App.model.patient.Medications",groupField:"date_ordered",startCollapsed:!0,proxy:{type:"direct",api:{read:"Medications.getPatientMedicationsOrders",create:"Medications.addPatientMedication",update:"Medications.updatePatientMedication",destroy:"Medications.destroyPatientMedication"},remoteGroup:!1}}),Ext.define("App.store.patient.Patient",{extend:"Ext.data.Store",model:"App.model.patient.Patient",remoteSort:!0,autoLoad:!1}),Ext.define("App.store.patient.PatientContacts",{extend:"Ext.data.Store",model:"App.model.patient.PatientContacts",remoteSort:!0}),Ext.define("App.store.patient.Notes",{extend:"Ext.data.Store",model:"App.model.patient.Notes"}),Ext.define("App.store.patient.PatientArrivalLog",{extend:"Ext.data.Store",model:"App.model.patient.PatientArrivalLog",remoteSort:!0,autoLoad:!1}),Ext.define("App.store.patient.PatientCalendarEvents",{extend:"Ext.data.Store",model:"App.model.patient.PatientCalendarEvents",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientDocuments",{extend:"Ext.data.Store",model:"App.model.patient.PatientDocuments",remoteSort:!1,autoLoad:!1,autoSync:!0}),Ext.define("App.store.patient.PatientLabsResults",{extend:"Ext.data.Store",model:"App.model.patient.PatientLabsResults",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientsOrderObservations",{extend:"Ext.data.TreeStore",model:"App.model.patient.PatientsOrderObservation",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientsLabOrderItems",{extend:"Ext.data.Store",model:"App.model.patient.PatientsLabOrderItems",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.DismissedAlerts",{extend:"Ext.data.Store",model:"App.model.patient.DismissedAlerts",remoteSort:!1,autoLoad:!1,autoSync:!0}),Ext.define("App.store.patient.PatientsPrescriptions",{extend:"Ext.data.Store",model:"App.model.patient.PatientsPrescriptions",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientsPrescriptionMedications",{extend:"Ext.data.Store",model:"App.model.patient.PatientsPrescriptionMedications",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientsOrderResults",{extend:"Ext.data.Store",model:"App.model.patient.PatientsOrderResult",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.QRCptCodes",{extend:"Ext.data.Store",model:"App.model.patient.QRCptCodes",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PreventiveCare",{extend:"Ext.data.Store",model:"App.model.patient.PreventiveCare",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.PatientsXrayCtOrders",{extend:"Ext.data.Store",model:"App.model.patient.PatientsXrayCtOrders",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.Surgery",{extend:"Ext.data.Store",model:"App.model.patient.Surgery",remoteSort:!1,autoLoad:!1}),Ext.define("App.store.patient.Referrals",{extend:"Ext.data.Store",model:"App.model.patient.Referral",autoLoad:!1}),Ext.define("App.store.patient.VectorGraph",{extend:"Ext.data.Store",requires:["App.model.patient.VectorGraph"],model:"App.model.patient.VectorGraph"}),Ext.define("App.store.patient.VisitPayment",{extend:"Ext.data.Store",requires:["App.model.patient.VisitPayment"],model:"App.model.patient.VisitPayment"}),Ext.define("App.store.patient.charts.StatureForAge",{extend:"Ext.data.Store",requires:["App.model.patient.charts.StatureForAge"],model:"App.model.patient.charts.StatureForAge"}),Ext.define("App.store.patient.charts.HeadCircumferenceInf",{extend:"Ext.data.Store",requires:["App.model.patient.charts.HeadCircumferenceInf"],model:"App.model.patient.charts.HeadCircumferenceInf"}),Ext.define("App.store.patient.charts.LengthForAgeInf",{extend:"Ext.data.Store",requires:["App.model.patient.charts.LengthForAgeInf"],model:"App.model.patient.charts.LengthForAgeInf"}),Ext.define("App.store.patient.charts.WeightForAge",{extend:"Ext.data.Store",requires:["App.model.patient.charts.WeightForAge"],model:"App.model.patient.charts.WeightForAge"}),Ext.define("App.store.patient.charts.WeightForAgeInf",{extend:"Ext.data.Store",requires:["App.model.patient.charts.WeightForAgeInf"],model:"App.model.patient.charts.WeightForAgeInf"}),Ext.define("App.store.patient.charts.BMIForAge",{extend:"Ext.data.Store",requires:["App.model.patient.charts.BMIForAge"],model:"App.model.patient.charts.BMIForAge"}),Ext.define("App.store.patient.charts.WeightForStature",{extend:"Ext.data.Store",requires:["App.model.patient.charts.WeightForStature"],model:"App.model.patient.charts.WeightForStature"}),Ext.define("App.store.patient.charts.WeightForRecumbentInf",{extend:"Ext.data.Store",requires:["App.model.patient.charts.WeightForRecumbentInf"],model:"App.model.patient.charts.WeightForRecumbentInf"}),Ext.define("App.store.areas.PatientAreas",{extend:"Ext.data.Store",requires:["App.model.areas.PatientArea"],model:"App.model.areas.PatientArea",pageSize:10}),Ext.define("App.controller.HelpDocuments",{extend:"Ext.app.Controller",refs:[{ref:"AppHelpDocumentMenu",selector:"#AppHelpDocumentMenu"}],init:function(){var a=this;
a.control({"#AppHelpDocumentMenu > menuitem":{click:a.onAppHelpDocumentMenuClick}})},onAppHelpDocumentMenuClick:function(a){this.showHelpDocumentWindow(a.documentTitle,a.documentUrl)},addDocumentMenuItem:function(a,b){this.getAppHelpDocumentMenu()&&this.getAppHelpDocumentMenu().menu.add({text:a,icon:"resources/images/icons/icohelp.png",documentTitle:a,documentUrl:b})},showHelpDocumentWindow:function(a,b){Ext.create("Ext.window.Window",{title:a,width:900,height:620,layout:"fit",html:'<iframe allowtransparency="true" style="background: #FFFFFF;" width="100%" height="100%" src="'+b+'"></iframe>'}).show()}}),Ext.define("App.store.areas.PoolAreas",{extend:"Ext.data.Store",requires:["App.model.areas.PoolArea"],model:"App.model.areas.PoolArea"}),Ext.define("App.store.areas.PoolDropAreas",{extend:"Ext.data.Store",requires:["App.model.areas.PoolDropAreas"],pageSize:10,model:"App.model.areas.PoolDropAreas"}),Ext.define("App.controller.administration.CPT",{extend:"Ext.app.Controller",refs:[{ref:"CptAdminGrid",selector:"cptadmingrid"},{ref:"AdminCpt4CodeOnlyActiveBtn",selector:"#adminCpt4CodeOnlyActiveBtn"}],init:function(){var a=this;a.control({cptadmingrid:{activate:a.onCptAdminGridActive},"#adminCpt4CodeSearchField":{keyup:a.onAdminCpt4CodeSearchFieldKeyUp}})},onCptAdminGridActive:function(a){a.getStore().load()},onAdminCpt4CodeSearchFieldKeyUp:function(a){var b=this,c=b.getCptAdminGrid().getStore();b.dataQuery=a.getValue(),c.proxy.extraParams={onlyActive:b.getAdminCpt4CodeOnlyActiveBtn().pressed,query:b.dataQuery},c.loadPage(1)}}),Ext.define("App.controller.Network",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AppNetworkStatusBox",selector:"#AppNetworkStatusBox"}],init:function(){},onLatencyCheckEnd:function(a){var b;b=100>a?"green":150>a?"yellow":175>a?"orange":200>a?"violet":"red",this.AppNetworkStatusBox.el.setStyle({backgroundColor:b,backgroundImage:"none"})},startLatencyCheck:function(){performance.clearResourceTimings(),this.Network.latency.start()},onAppBeforeRender:function(){var a=this;a.updateOnlineStatus(),app.startLatencyCheck=function(){a.startLatencyCheck()},app.cron.addCronFn("app.startLatencyCheck()")},onAppNetworkStatusBoxAfterRender:function(a){this.AppNetworkStatusBox=a},updateOnlineStatus:function(){app.fireEvent(navigator.onLine?"apponline":"appoffline",this)}}),Ext.define("App.controller.administration.AuditLog",{extend:"Ext.app.Controller",requires:[],refs:[{selector:"#AuditLogWindow",ref:"AuditLogWindow"},{selector:"#AuditLogWindowGrid",ref:"AuditLogWindowGrid"}],init:function(){var a=this;a.control({"#AuditLogWindowGrid":{close:a.onAuditLogWindowGridClose}})},onAuditLogWindowGridClose:function(){this.getAuditLogWindowGrid().getStore().removeAll()},addLog:function(a,b,c,d,e,f,g){AuditLog.addLog({pid:a,uid:b,eid:c,foreign_id:d,foreign_table:e,event:f,event_description:g})},showLogByRecord:function(a){var b=this,c=(b.showLogWindow(),b.getAuditLogWindowGrid().getStore()),d=a.idProperty||"id";c.clearFilter(!0),c.getProxy().extraParams={},c.filter([{property:"foreign_id",value:a.get(d)},{property:"foreign_table",value:a.table.name}])},showLogByPidEvent:function(a,b){var c=this,d=(c.showLogWindow(),c.getAuditLogWindowGrid().getStore());d.clearFilter(!0),d.getProxy().extraParams={},d.filter([{property:"pid",value:a},{property:"event",value:b}])},showLogWindow:function(){return this.getAuditLogWindow()||Ext.create("App.view.administration.AuditLogWindow"),this.getAuditLogWindow().show()}}),Ext.define("App.controller.administration.BackUp",{extend:"Ext.app.Controller",refs:[{ref:"AdministrationBackupGrid",selector:"#AdministrationBackupGrid"},{ref:"AdministrationBackupRefreshBtn",selector:"#AdministrationBackupRefreshBtn"}],init:function(){var a=this;a.control({viewport:{render:a.onViewportRender},"#AdministrationBackupPanel":{activate:a.onAdministrationBackupPanelActivate},"#AdministrationBackupRefreshBtn":{click:a.onAdministrationBackupRefreshBtnClick},"#AdministrationBackupAsyncBackupBtn":{click:a.onAdministrationBackupAsyncBackupBtnClick}})},onAdministrationBackupPanelActivate:function(){this.getAdministrationBackupGrid().store.load()},onViewportRender:function(){a("access_backup_settings")&&BackUp.doBackupCheck(function(a){a||(app.alert(_("no_backup_found_within_24_hours"),"warning"),Ext.Msg.show({title:_("no_backup_found_within_24_hours"),msg:_("would_you_like_to_create_one"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(a){"yes"===a&&app.nav.navigateTo("App.view.administration.Backup")}}))})},onAdministrationBackupRefreshBtnClick:function(){this.getAdministrationBackupGrid().getStore().load()},onAdministrationBackupAsyncBackupBtnClick:function(){var a=this;Ext.Msg.show({title:_("this_action_may_take_a_long_time"),msg:_("would_you_like_to_continue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(b){"yes"===b&&(Ext.getBody().el.mask(_("creating_backup_be_right_back")),BackUp.doBackUp(function(){a.getAdministrationBackupGrid().store.load(),Ext.getBody().el.unmask(),Ext.Msg.alert(_("sweet"),_("backup_completed"))}))}})}}),Ext.define("App.controller.administration.ContentManagement",{extend:"Ext.app.Controller",refs:[{ref:"ContentManagementGrid",selector:"#ContentManagementGrid"},{ref:"ContentManagementWindow",selector:"#ContentManagementWindow"},{ref:"ContentManagementWindowForm",selector:"#ContentManagementWindowForm"},{ref:"ContentManagementWindowSaveBtn",selector:"#ContentManagementWindowSaveBtn"},{ref:"ContentManagementWindowCancelBtn",selector:"#ContentManagementWindowCancelBtn"},{ref:"ContentManagementWindowTextContentBody",selector:"#ContentManagementWindowTextContentBody"},{ref:"ContentManagementWindowHtmlContentBody",selector:"#ContentManagementWindowHtmlContentBody"},{ref:"ContentManagementWindowTokensTextArea",selector:"#ContentManagementWindowTokensTextArea"},{ref:"ContentManagementWindowIsHtmlCheckbox",selector:"#ContentManagementWindowIsHtmlCheckbox"},{ref:"ContentManagementAddBtn",selector:"#ContentManagementAddBtn"},{ref:"ContentManagementGridContextMenuDelete",selector:"#ContentManagementGridContextMenuDelete"}],init:function(){var a=this;a.control({"#ContentManagementGrid":{beforerender:a.onContentManagementGridBeforeRender,itemdblclick:a.onContentManagementGridItemDblClick},"#ContentManagementWindow":{close:a.onContentManagementWindowClose},"#ContentManagementWindowSaveBtn":{click:a.onContentManagementWindowSaveBtnClick},"#ContentManagementWindowCancelBtn":{click:a.onContentManagementWindowCancelBtnClick},"#ContentManagementWindowIsHtmlCheckbox":{change:a.onContentManagementWindowIsHtmlCheckboxChange},"#ContentManagementAddBtn":{click:a.onContentManagementAddBtnClick},"#ContentManagementGridContextMenuDelete":{click:a.onContentManagementGridContextMenuDeleteClick}})},onContentManagementWindowSaveBtnClick:function(){var a=this,b=a.getContentManagementWindowForm().getForm(),c=b.getRecord(),d=b.getValues();b.isValid()&&(c.set(d),c.store.sync({success:function(){app.msg(_("sweet"),_("record_saved")),c.store.load()},failure:function(){app.msg(_("oops"),_("record_error"),!0)}}),a.getContentManagementWindow().close())},onContentManagementWindowCancelBtnClick:function(){var a=this,b=a.getContentManagementGrid(),c=b.getStore(),d=a.getContentManagementWindowForm().getForm(),e=d.getRecord();""==e.get("content_type")&&""==e.get("content_body")&&c.remove(e),this.getContentManagementWindow().close()},onContentManagementWindowClose:function(){this.getContentManagementWindowForm().getForm().reset()},onContentManagementGridBeforeRender:function(a){a.getStore().load()},onContentManagementGridItemDblClick:function(a,b){this.showContentWindow();var c=this,d=b.get("content_type"),e=c.getContentManagementWindowForm(),f=e.getForm(),g=b.get("is_html"),h=e.down("textareafield[action=content_body]"),i=e.down("htmleditor[action=content_body]");f.reset(),f.loadRecord(b),h.setValue(b.get("content_body")),h.submitValue=!g,h.setDisabled(g),h.setVisible(!g),i.setValue(b.get("content_body")),i.submitValue=g,i.setDisabled(!g),i.setVisible(g),c.setTokensTextAreaFieldByContentType(d)},onContentManagementWindowIsHtmlCheckboxChange:function(a,b){var c=this,d=c.getContentManagementWindowTextContentBody(),e=c.getContentManagementWindowHtmlContentBody(),f=c.getContentManagementWindowForm(),g=f.getForm(),h=g.getRecord();1==b?(d.hide(),d.setDisabled(!0),d.submitValue=!1,e.show(),e.setDisabled(!1),e.setValue(h.get("content_body")),e.submitValue=!0):(d.show(),d.setDisabled(!1),d.setValue(h.get("content_body")),d.submitValue=!0,e.hide(),e.setDisabled(!0),e.submitValue=!1)},onContentManagementAddBtnClick:function(){this.getContentManagementGrid().getSelectionModel().deselectAll();var a=this,b=a.getContentManagementGrid(),c=b.getStore(),d=a.showContentWindow(),e=d.down("form").getForm(),f=c.add({content_type:"",content_lang:"en",content_body:"",is_html:!1,content_version:"1.0"});e.loadRecord(f[0]),a.setTokensTextAreaFieldByContentType(f[0].get("content_type"))},showContentManagementGridContextMenu:function(a,b,c){var d=this;return d.ContentManagementGridContextMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("delete_selected"),icon:"modules/billing/resources/images/cross.png",itemId:"ContentManagementGridContextMenuDelete",acl:!0}]}),d.ContentManagementGridContextMenu.content_management_grid=a,d.ContentManagementGridContextMenu.content_management_record=b,d.ContentManagementGridContextMenu.showAt(c.getXY()),d.ContentManagementGridContextMenu},onContentManagementGridContextMenuDeleteClick:function(){var a=this.getContentManagementGrid(),b=a.getStore(),c=a.getSelectionModel().getSelection();c.length&&(b.remove(c),b.sync({callback:function(){app.msg(_("sweet"),_("records_removed"))}}))},onContentManagementWindowGridContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showContentManagementGridContextMenu(a,b,e)},showContentWindow:function(){return this.getContentManagementWindow()||Ext.create("App.view.administration.ContentManagementWindow"),this.getContentManagementWindow().show()},setTokensTextAreaFieldByContentType:function(a){var b=this,c=[],d=b.getContentManagementWindowTokensTextArea();c=c.concat(this.patientTokens()),"disclosure"===a&&(c=c.concat(this.disclosureTokens(),this.formatTokens())),("reminder_mammography_one_year"===a||"reminder_mammography_six_months"===a||"reminder_mammography_pathology"===a)&&(c=c.concat(this.breastImagingReminderTokens())),"sms_worklist_report_ready"===a&&(c=c.concat(this.smsWorklistReporReadyTokens())),(null==a||""===a||c.length<=0)&&(c=c.concat(this.defaultTokens())),d.setValue(c.join("\r\n"))},patientTokens:function(){return["[PATIENT_NAME]","[PATIENT_ID]","[PATIENT_RECORD_NUMBER]","[PATIENT_FULL_NAME]","[PATIENT_LAST_NAME]","[PATIENT_SEX]","[PATIENT_BIRTHDATE]","[PATIENT_MARITAL_STATUS]","[PATIENT_SOCIAL_SECURITY]","[PATIENT_EXTERNAL_ID]","[PATIENT_DRIVERS_LICENSE]","[PATIENT_POSTAL_ADDRESS_LINE_ONE]","[PATIENT_POSTAL_ADDRESS_LINE_TWO]","[PATIENT_POSTAL_CITY]","[PATIENT_POSTAL_STATE]","[PATIENT_POSTAL_ZIP]","[PATIENT_POSTAL_COUNTRY]","[PATIENT_PHYSICAL_ADDRESS_LINE_ONE]","[PATIENT_PHYSICAL_ADDRESS_LINE_TWO]","[PATIENT_PHYSICAL_CITY]","[PATIENT_PHYSICAL_STATE]","[PATIENT_PHYSICAL_ZIP]","[PATIENT_PHYSICAL_COUNTRY]","[PATIENT_HOME_PHONE]","[PATIENT_MOBILE_PHONE]","[PATIENT_WORK_PHONE]","[PATIENT_EMAIL]","[PATIENT_MOTHERS_NAME]","[PATIENT_GUARDIANS_NAME]","[PATIENT_EMERGENCY_CONTACT]","[PATIENT_EMERGENCY_PHONE]","[PATIENT_PROVIDER]","[PATIENT_PHARMACY]","[PATIENT_AGE]","[PATIENT_OCCUPATION]","[PATIENT_EMPLOYEER]","[PATIENT_RACE]","[PATIENT_ETHNICITY]","[PATIENT_LENGUAGE]","[PATIENT_PICTURE]","[PATIENT_QRCODE]"]},billingTokens:function(){return["[SERVICES_TABLE]","[CLAIM_TABLE]"]},disclosureTokens:function(){return["[DISCLOSURE_DOCUMENTS]","[DISCLOSURE_RECIPIENT]","[DISCLOSURE_DESCRIPTION]","[DISCLOSURE_REQUEST_DATE]","[DISCLOSURE_FULFIL_DATE]","[DISCLOSURE_PICKUP_DATE]","[DISCLOSURE_DOCUMENT_COUNT]"]},breastImagingReminderTokens:function(){return["[PATIENT_NAME]","[PATIENT_ADDRESS]","[PATIENT_ADDRESS_CONT]","[PATIENT_CITY]","[PATIENT_STATE]","[PATIENT_ZIP]","[PATIENT_CITY_STATE_ZIP]","[PATIENT_RECORD_NUMBER]","[FACILITY_NAME]","[FACILITY_ADDRESS]","[FACILITY_ADDRESS_CONT]","[FACILITY_CITY_STATE_ZIP]","[SERVICE_DATE]","[TODAY]","[B]","[/B]","[U]","[/U]","[I]","[/I]","[TAB]"]},smsWorklistReporReadyTokens:function(){return["[FACILITY_NAME]","[SERVICE_DATE]","[ACCESSION_NUMBER]"]},formatTokens:function(){return["[TODAY]","[B]","[/B]","[U]","[/U]","[I]","[/I]","[TAB]"]},defaultTokens:function(){return["[PATIENT_NAME]","[PATIENT_RECORD_NUMBER]","[SERVICE_DATE]","[SIGNED_DATE]","[TITLE]","[RADIOLOGIST_SIGNATURE]","[ORDERING_PHYSICIAN]","[FACILITY_NAME]","[FACILITY_PHONE]","[DENSE_BREST]","[NORMAL_BENIGN]","[PROBABLY_BENIGN]","[ADDITIONAL]","[PREVIOUS]","[ABNORMAL]","[RECOMENDATIONS_LIST]","[B]","[/B]","[U]","[/U]","[I]","[/I]"]}}),Ext.define("App.controller.Main",{extend:"Ext.app.Controller",refs:[{ref:"viewport",selector:"viewport"},{ref:"ApplicationFacilityCombo",selector:"#ApplicationFacilityCombo"}],init:function(){var a=this;a.control({viewport:{usersessionswitch:a.onApplicationUserSessionSwitch},"#ApplicationFacilityCombo":{select:a.onApplicationFacilityComboSelect,beforerender:a.onApplicationFacilityComboBeforeRender},"#AppCleatState":{click:a.onAppCleatStateClick}})},onAppCleatStateClick:function(){Ext.Msg.show({title:"Wait!",msg:"This action will reset the application state and refresh the application",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&AppState.AppStateUnClearByUid(app.user.id,function(){window.document.location.reload()})}})},onApplicationUserSessionSwitch:function(a,b){b.user.acl_roles[0]==app.user.acl_roles[0]?(Ext.Object.each(b.user,function(a,b){app.user[a]=b}),app.user.token=b.token,app.userSplitBtn.setText(app.user.title+" "+app.user.fname[0]+"."+app.user.lname),a.doApplicationUnLock(),app.msg(_("sweet"),Ext.String.format(_("application_successfully_switched_to_x"),"<b>"+(app.user.title+" "+app.user.fname+" "+app.user.lname)+"</b>"))):(window.onbeforeunload=null,window.location.reload())},onApplicationFacilityComboSelect:function(a,b){var c=this;Facilities.setFacility(b[0].data.option_value,function(d,e){b[0].data.option_value==e.result&&(app.user.facility=b[0].data.option_value,app.fireEvent("appfacilitychanged",c,app.user.facility,a),app.msg(_("sweet"),_("facility")+" "+b[0].data.option_name),app.setWindowTitle(b[0].data.option_name),c.getController("areas.PatientPoolAreas").reRenderPoolAreas(),c.getController("areas.FloorPlan").renderZones(),app.getPatientsInPoolArea())})},onApplicationFacilityComboBeforeRender:function(a){a.getStore().on("load",this.onFacilityComboLoad,this)},onFacilityComboLoad:function(a){var b=a.findRecord("option_value",app.user.facility);this.getApplicationFacilityCombo().setValue(b),app.setWindowTitle(b.data.option_name)},getCurrentFacility:function(){return this.getApplicationFacilityCombo().findRecordByValue(app.user.facility)},getCurrentFacilityName:function(){return this.getApplicationFacilityCombo().findRecordByValue(app.user.facility).get("option_name")}}),Ext.define("App.controller.administration.DocumentPdfForms",{extend:"Ext.app.Controller",refs:[{ref:"DocumentPdfFormsWindow",selector:"#DocumentPdfFormsWindow"}],init:function(){var a=this;a.control({"#AdministrationDocuments":{activate:a.onAdministrationDocumentsActive}})},showDocumentPdfFormsWindow:function(){return this.getDocumentPdfFormsWindow()||Ext.create(""),this.getDocumentPdfFormsWindow().show()}}),Ext.define("App.controller.administration.DataPortability",{extend:"Ext.app.Controller",refs:[{ref:"DataPortabilityPanel",selector:"#DataPortabilityPanel"},{ref:"DataPortabilityPanelIFrame",selector:"#DataPortabilityPanelIFrame"},{ref:"ExportFilterForm",selector:"#ExportFilterForm"}],init:function(){var a=this;a.control({"#DataPortabilityExportBtn":{click:a.onDataPortabilityExportBtnClick}})},onDataPortabilityExportBtnClick:function(){{var a=this.getDataPortabilityPanelIFrame(),b=location.origin+location.pathname+"dataProvider/DataPortability.php?token="+app.user.token+"&site="+g("site"),c=this.getExportFilterForm().getForm();c.getValues().getRecord()}a.setSrc(b)}}),Ext.define("App.controller.administration.Documents",{extend:"Ext.app.Controller",refs:[{ref:"AdministrationDocuments",selector:"#AdministrationDocuments"},{ref:"AdministrationDocumentsDefaultsGrid",selector:"#AdministrationDocumentsDefaultsGrid"},{ref:"AdministrationDocumentsTemplatesGrid",selector:"#AdministrationDocumentsTemplatesGrid"},{ref:"AdministrationDocumentsTemplatesEditorForm",selector:"#AdministrationDocumentsTemplatesEditorForm"},{ref:"AdministrationDocumentsTokensGrid",selector:"#AdministrationDocumentsTokensGrid"},{ref:"AdministrationDocumentsTokenTextField",selector:"#AdministrationDocumentsTokenTextField"},{ref:"AdministrationDocumentsNewTemplateBtn",selector:"#AdministrationDocumentsNewTemplateBtn"},{ref:"AdministrationDocumentsPdfTemplatesGrid",selector:"#AdministrationDocumentsPdfTemplatesGrid"},{ref:"AdministrationDocumentsPdfTemplatesAddBtn",selector:"#AdministrationDocumentsPdfTemplatesAddBtn"},{ref:"AdministrationDocumentsPdfTemplateWindow",selector:"#AdministrationDocumentsPdfTemplateWindow"},{ref:"AdministrationDocumentsPdfTemplateWindowForm",selector:"#AdministrationDocumentsPdfTemplateWindowForm"}],init:function(){var a=this;a.control({"#AdministrationDocuments":{activate:a.onAdministrationDocumentsActive},"#AdministrationDocumentsTokensGrid":{afterrender:a.onAdministrationDocumentsTokensGridAfterRender},"#AdministrationDocumentsNewTemplateBtn":{click:a.onAdministrationDocumentsNewTemplateBtnClick},"#AdministrationDocumentsNewDefaulTemplateBtn":{click:a.onAdministrationDocumentsNewDefaulTemplateBtnClick},"#AdministrationDocumentsPdfTemplatesGrid":{render:a.onAdministrationDocumentsPdfTemplatesGridRender,itemdblclick:a.onAdministrationDocumentsPdfTemplatesGridItemDblClick},"#AdministrationDocumentsPdfTemplatesAddBtn":{click:a.onAdministrationDocumentsPdfTemplatesAddBtnClick},"#AdministrationDocumentsPdfTemplateWindowSaveBtn":{click:a.onAdministrationDocumentsPdfTemplateWindowSaveBtnClick},"#AdministrationDocumentsPdfTemplateWindowSaveCloseBtn":{click:a.onAdministrationDocumentsPdfTemplateWindowSaveCloseBtnClick},"#AdministrationDocumentsPdfTemplateWindowCancelBtn":{click:a.onAdministrationDocumentsPdfTemplateWindowCancelBtnClick},"#AdministrationDocumentsPdfTemplateWindowDeleteBtn":{click:a.onAdministrationDocumentsPdfTemplateWindowDeleteBtnClick}})},onAdministrationDocumentsPdfTemplatesGridRender:function(a){a.getStore().load()},onAdministrationDocumentsPdfTemplatesGridItemDblClick:function(a,b){this.doEditAdministrationDocumentsPdfTemplateRecord(b)},onAdministrationDocumentsPdfTemplatesAddBtnClick:function(){var a=this.getAdministrationDocumentsPdfTemplatesGrid(),b=a.getStore(),c=b.add({facility_id:0,concept:"default",template:"",body_margin_left:10,body_margin_top:10,body_margin_right:10,body_margin_bottom:10,body_font_family:"Arial",body_font_style:"",body_font_size:10,footer_margin:0,format:"LETTER",is_interface_tpl:0,active:1});this.doEditAdministrationDocumentsPdfTemplateRecord(c[0])},doEditAdministrationDocumentsPdfTemplateRecord:function(a){this.showAdministrationDocumentsPdfTemplateWindow(),this.getAdministrationDocumentsPdfTemplateWindowForm().getForm().loadRecord(a)},showAdministrationDocumentsPdfTemplateWindow:function(){return this.getAdministrationDocumentsPdfTemplateWindow()||Ext.create("App.view.administration.DocumentsPdfTemplateWindow"),this.getAdministrationDocumentsPdfTemplateWindow().show()},onAdministrationDocumentsPdfTemplateWindowSaveBtnClick:function(a){this.doAdministrationDocumentsPdfTemplateWindowSave(a,!1)},onAdministrationDocumentsPdfTemplateWindowSaveCloseBtnClick:function(a){this.doAdministrationDocumentsPdfTemplateWindowSave(a,!0)},doAdministrationDocumentsPdfTemplateWindowSave:function(a,b){var c=a.up("window"),d=c.down("form").getForm(),e=d.getRecord(),f=d.getValues();d.isValid()&&(e.set(f),e.store.getModifiedRecords().length>0?e.store.sync({callback:function(){b&&c.close()}}):b&&c.close())},onAdministrationDocumentsPdfTemplateWindowCancelBtnClick:function(a){a.up("window").close()},onAdministrationDocumentsPdfTemplateWindowDeleteBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getRecord(),e=d.store;Ext.Msg.show({title:"Wait!",msg:"Would you like to remove this record?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(e.remove(d),e.sync({callback:function(){b.close(),app.msg(_("sweet"),_("record_removed"))}}))}})},onAdministrationDocumentsActive:function(){},onAdministrationDocumentsNewTemplateBtnClick:function(){var a=this,b=a.getAdministrationDocumentsTemplatesGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{title:_("new_document"),template_type:"documenttemplate",date:new Date,type:1}),b.editingPlugin.startEdit(0,0)},onAdministrationDocumentsNewDefaulTemplateBtnClick:function(){var a=this,b=a.getAdministrationDocumentsDefaultsGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{title:_("new_defaults"),template_type:"defaulttemplate",date:new Date,type:1}),b.editingPlugin.startEdit(0,0)},onAdministrationDocumentsTokensGridAfterRender:function(){},doCopy:function(a,b){if(!document.queryCommandSupported("copy"))return void app.msg(_("oops"),_("text_copy_not_supported_by_browser"),!0);var c=this;a.editingPlugin.startEdit(b,0),c.getAdministrationDocumentsTokenTextField().inputEl.dom.select(),document.execCommand("copy"),app.msg(_("sweet"),_("text_copyed"))}}),Ext.define("App.controller.administration.FacilityStructure",{extend:"Ext.app.Controller",refs:[{ref:"FacilityStructurePanel",selector:"#FacilityStructurePanel"},{ref:"FacilityStructureTreePanel",selector:"#FacilityStructureTreePanel"}],init:function(){var a=this;a.control({"#FacilityStructurePanel":{activate:a.onFacilityStructurePanelActivate}})},onFacilityStructurePanelActivate:function(){this.getFacilityStructureTreePanel().getStore().load()}}),Ext.define("App.controller.administration.EncounterSnippets",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"soapPanel",selector:"#soapPanel"},{ref:"SoapForm",selector:"#soapForm"},{ref:"SoapDxCodesField",selector:"#SoapDxCodesField"},{ref:"SnippetsTreePanel",selector:"#SnippetsTreePanel"},{ref:"SnippetWindow",selector:"#SnippetWindow"},{ref:"SnippetForm",selector:"#SnippetForm"},{ref:"SnippetFormCategoryCmb",selector:"#SnippetFormCategoryCmb"},{ref:"SnippetFormTextField",selector:"#SnippetFormTextField"},{ref:"SnippetDeleteBtn",selector:"#SnippetDeleteBtn"},{ref:"SnippetCancelBtn",selector:"#SnippetCancelBtn"},{ref:"SnippetSaveBtn",selector:"#SnippetSaveBtn"},{ref:"SoapTemplateSpecialtiesCombo",selector:"#SoapTemplateSpecialtiesCombo"}],init:function(){var a=this;this.control({viewport:{beforeencounterload:a.onOpenEncounter},"#SnippetsTreePanel":{itemdblclick:a.onSnippetsTreePanelItemDblClick},"#SnippetDeleteBtn":{click:a.onSnippetDeleteBtnClick},"#SnippetSaveBtn":{click:a.onSnippetSaveBtnClick},"#SnippetCancelBtn":{click:a.onSnippetCancelBtnClick},"#SnippetAddBtn":{click:a.onSnippetAddBtnClick},"#soapProcedureWindow > form > textarea":{focus:a.onProcedureTextFieldFocus},"#SoapTemplateSpecialtiesCombo":{select:a.onSoapTemplateSpecialtiesComboChange,change:a.onSoapTemplateSpecialtiesComboChange}})},onOpenEncounter:function(a){this.getSoapTemplateSpecialtiesCombo().setValue(a.data.specialty_id)},onSoapTemplateSpecialtiesComboChange:function(){this.loadSnippets()},loadSnippets:function(){var a=this;if(a.getSnippetsTreePanel().collapsed===!1){var b=a.getSnippetsTreePanel(),c=a.getSoapTemplateSpecialtiesCombo().getValue();b.getStore().load({filters:[{property:"specialty_id",value:c},{property:"uid",value:app.user.id},{property:"uid",value:0},{property:"uid",value:null}]})}},onSnippetsTreePanelItemDblClick:function(a,b){var c=this,d=c.getSoapForm(),e=d.getForm(),f=["subjective","objective","assessment","instructions"];f.forEach(function(a){var d=e.findField(a),f=b.get(a),g=d.inputEl.dom,h=d.getValue(),i=h[0]&&" "!==h[0]?" ":"";""!==f&&(c.setCursorPos(g,h.length),document.execCommand("insertText",!1,i+f))});var g=b.get("diagnoses");if(""!==g){g=g.split(",");var h=c.getSoapPanel().dxField;DiagnosisCodes.getICDDataByCodes(g,function(a){a.forEach(function(a){h.doAddIcd({code:a.code,code_text:a.code_text,code_type:a.code_type})})})}},setCursorPos:function(a,b,c){if(a.focus(),arguments.length<3&&(c=b),"selectionStart"in a)a.selectionStart=b,a.selectionEnd=c;else if(a.createTextRange){var d=a.createTextRange();d.moveStart("character",b),d.collapse(),d.moveEnd("character",c-b),d.select()}},onSnippetDrop:function(a,b,c){say(a),say(b),say(c)},onSnippetDeleteBtnClick:function(){var a=this,b=a.getSnippetForm().getForm(),c=b.getRecord();a.getSnippetsTreePanel().getStore().remove(c),b.reset(!0),a.getSnippetWindow().close()},onSnippetSaveBtnClick:function(){var a=this,b=a.getSnippetWindow(),c=a.getSnippetForm().getForm(),d=c.getValues(),e=c.getRecord();if(c.isValid())return e.set(d),Ext.Object.isEmpty(e.getChanges())?(c.reset(),void b.close()):void e.store.sync({callback:function(){c.reset(),b.close(),app.msg(_("sweet"),_("record_saved"))}})},onSnippetCancelBtnClick:function(){this.getSnippetsTreePanel().getStore().rejectChanges(),this.getSnippetWindow().close()},showSnippetEditWindow:function(){return this.getSnippetWindow()||Ext.create("App.view.patient.encounter.Snippets"),this.getSnippetWindow().show()},onSnippetAddBtnClick:function(){var a=this,b=a.getSnippetsTreePanel().getStore(),c=[];b.groups.items.forEach(function(a){""!==a.key&&(c=Ext.Array.push(c,{text:a.key}))});var d=b.add({uid:app.user.id,specialty_id:a.getSoapTemplateSpecialtiesCombo().getValue()});a.showSnippetEditWindow(),a.getSnippetForm().getForm().loadRecord(d[0]),a.getSnippetFormCategoryCmb().store.loadData(c)},onSnippetBtnEdit:function(a,b,c,d,e,f){this.showSnippetEditWindow(),this.getSnippetForm().getForm().loadRecord(f)}}),Ext.define("App.controller.administration.DecisionSupport",{extend:"Ext.app.Controller",refs:[{ref:"DecisionSupportAdminPanel",selector:"decisionSupportAdminPanel"},{ref:"DecisionSupportAdminGrid",selector:"#decisionSupportAdminGrid"},{ref:"DecisionSupportRuleAddBtn",selector:"#decisionSupportRuleAddBtn"},{ref:"DecisionSupportEditorTabPanel",selector:"#decisionSupportEditorTabPanel"},{ref:"DecisionSupportProcGrid",selector:"grid[action=PROC]"},{ref:"DecisionSupportProBGrid",selector:"grid[action=PROB]"},{ref:"DecisionSupportSociGrid",selector:"grid[action=SOCI]"},{ref:"DecisionSupportMediGrid",selector:"grid[action=MEDI]"},{ref:"DecisionSupportAlleGrid",selector:"grid[action=ALLE]"},{ref:"DecisionSupportLabGrid",selector:"grid[action=LAB]"},{ref:"DecisionSupportVitaGrid",selector:"grid[action=VITA]"},{ref:"DecisionSupportVitalCombo",selector:"#DecisionSupportVitalCombo"},{ref:"DecisionSupportSocialHistoryCombo",selector:"#DecisionSupportSocialHistoryCombo"}],init:function(){var a=this;a.control({"#decisionSupportAdminPanel":{activate:a.onDecisionSupportAdminPanelActive},"#decisionSupportRuleAddBtn":{click:a.onDecisionSupportRuleAddBtnClick},"#decisionSupportAdminGrid":{beforeedit:a.onDecisionSupportAdminGridBeforeEdit,edit:a.onDecisionSupportAdminGridEdit,beforeitemcontextmenu:a.onDecisionSupportAdminGridBeforeContextMenu},"#DecisionSupportAdminGridShowLogMenu":{click:a.onDecisionSupportAdminGridShowLogMenuClick},"#DecisionSupportProcedureCombo":{select:a.onDecisionSupportProcedureComboSelect},"#DecisionSupportProblemCombo":{select:a.onDecisionSupportProblemComboSelect},"#DecisionSupportMedicationCombo":{select:a.onDecisionSupportMedicationComboSelect},"#DecisionSupportMedicationAllergyCombo":{select:a.onDecisionSupportMedicationAllergyComboSelect},"#DecisionSupportLabCombo":{select:a.onDecisionSupportLabComboSelect},"#DecisionSupportVitalAddBtn":{click:a.onDecisionSupportVitalAddBtnClick},"#DecisionSupportSocialHistoryAddBtn":{click:a.onDecisionSupportSocialHistoryAddBtnClick},"#DecisionSupportSocialHistoryCombo":{beforerender:a.onDecisionSupportSocialHistoryComboBeforeRender}}),a.logCtrl=a.getController("App.controller.administration.AuditLog")},onDecisionSupportAdminPanelActive:function(){this.getDecisionSupportAdminGrid().getStore().load()},onDecisionSupportRuleAddBtnClick:function(a){var b=a.up("grid");b.editingPlugin.cancelEdit(),b.getStore().insert(0,{create_date:new Date,update_date:new Date,create_uid:app.user.id,update_uid:app.user.id,active:1}),b.editingPlugin.startEdit(0,0)},onDecisionSupportAdminGridBeforeEdit:function(a,b){var c,d,e,f=a.editor,g=b.record,h=f.query("grid");for(this.getDecisionSupportEditorTabPanel().setActiveTab(0),e=0;e<h.length;e++)c=h[e],d=c.getStore(),d.grid=c,d.load({filters:[{property:"rule_id",value:g.data.id},{property:"concept_type",value:c.action}],callback:function(a){this.grid.setTitle(this.grid.initialConfig.title+" ("+a.length+")")}})},onDecisionSupportAdminGridEdit:function(a,b){var c=b.record.get("description")+" - Updated",d=(b.record.get("active"),b.record.getChanges());Ext.Object.isEmpty(d)||void 0===d.active||(c+=d.active?" - Activated":" - Deactivated"),this.logCtrl.addLog(0,app.user.id,0,b.record.get("id"),b.record.table.name,"UPDATE",c)},onDecisionSupportAdminGridBeforeContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showDecisionSupportAdminGridContextMenu(e)},showDecisionSupportAdminGridContextMenu:function(a){var b=this;return b.gridContextMenu||(b.gridContextMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("show_log"),itemId:"DecisionSupportAdminGridShowLogMenu",icon:"resources/images/icons/icoView.png"}]})),b.gridContextMenu.showAt(a.getXY()),b.gridContextMenu},onDecisionSupportAdminGridShowLogMenuClick:function(){var a=this.getDecisionSupportAdminGrid().getSelectionModel().getLastSelected();this.logCtrl.showLogByRecord(a)},onDecisionSupportProcedureComboSelect:function(a,b){var c,d=a.up("grid"),e=d.getStore();d.editingPlugin.cancelEdit(),c=e.add({rule_id:this.getRuleId(),concept_type:d.action,concept_code:b[0].data.code,concept_text:b[0].data.code_text,concept_code_type:b[0].data.code_type}),d.editingPlugin.startEdit(c[0],2)},onDecisionSupportProblemComboSelect:function(a,b){var c,d=a.up("grid"),e=d.getStore();d.editingPlugin.cancelEdit(),c=e.add({rule_id:this.getRuleId(),concept_type:d.action,concept_code:b[0].data.ConceptId,concept_text:b[0].data.Term,concept_code_type:b[0].data.CodeType}),d.editingPlugin.startEdit(c[0],2)},onDecisionSupportMedicationComboSelect:function(a,b){var c,d=a.up("grid"),e=d.getStore();d.editingPlugin.cancelEdit(),c=e.add({rule_id:this.getRuleId(),concept_type:d.action,concept_code:b[0].data.RXCUI,concept_text:b[0].data.STR,concept_code_type:b[0].data.CodeType}),d.editingPlugin.startEdit(c[0],2)},onDecisionSupportMedicationAllergyComboSelect:function(a,b){var c,d=a.up("grid"),e=d.getStore();d.editingPlugin.cancelEdit(),c=e.add({rule_id:this.getRuleId(),concept_type:d.action,concept_code:b[0].data.RXCUI,concept_text:b[0].data.STR,concept_code_type:b[0].data.CodeType}),d.editingPlugin.startEdit(c[0],2)},onDecisionSupportLabComboSelect:function(a,b){var c,d=a.up("grid"),e=d.getStore();d.editingPlugin.cancelEdit(),c=e.add({rule_id:this.getRuleId(),concept_type:d.action,concept_code:b[0].data.loinc_number,concept_text:b[0].data.loinc_name,concept_code_type:"LOINC"}),d.editingPlugin.startEdit(c[0],2)},onDecisionSupportVitalAddBtnClick:function(){var a,b=this.getDecisionSupportVitalCombo(),c=b.getStore(),d=c.findRecord("option_value",b.getValue()),e=b.up("grid"),f=e.getStore();e.editingPlugin.cancelEdit(),a=f.add({rule_id:this.getRuleId(),concept_type:e.action,concept_code:d.data.code,concept_text:d.data.option_name,concept_code_type:d.data.code_type}),e.editingPlugin.startEdit(a[0],2)},onDecisionSupportSocialHistoryAddBtnClick:function(){var a,b=this.getDecisionSupportSocialHistoryCombo(),c=b.getStore(),d=c.findRecord("option_value",b.getValue()),e=b.up("grid"),f=e.getStore();e.editingPlugin.cancelEdit(),a=f.add({rule_id:this.getRuleId(),concept_type:e.action,concept_code:d.data.code,concept_text:d.data.option_name,concept_code_type:d.data.code_type}),e.editingPlugin.startEdit(a[0],2)
},onDecisionSupportSocialHistoryComboBeforeRender:function(a){a.getStore().on("load",function(a){a.insert(0,{code:"smoking_status",option_name:_("smoking_status"),option_value:"smoking_status",code_type:""})})},getRuleId:function(){return this.getDecisionSupportEditorTabPanel().up("form").getForm().getRecord().data.id},doRemoveRule:function(a){a.store.remove(a)},doRemoveRuleConcept:function(a){a.store.remove(a)}}),Ext.define("App.controller.administration.FileSystems",{extend:"Ext.app.Controller",refs:[{ref:"AdminFileSystemsPanel",selector:"#AdminFileSystemsPanel"},{ref:"FileSystemsGrid",selector:"#FileSystemsGrid"}],init:function(){var a=this;a.control({"#AdminFileSystemsPanel":{activate:a.onAdminFileSystemsPanelActivate},"#FileSystemsAnalyzeBtn":{click:a.onFileSystemsAnalyzeBtnClick},"#FileSystemsAddBtn":{click:a.onFileSystemsAddBtnClick}})},onAdminFileSystemsPanelActivate:function(){this.getFileSystemsGrid().getStore().load()},onFileSystemsAnalyzeBtnClick:function(){var a=this;FileSystem.fileSystemsSpaceAnalyzer(function(){a.getFileSystemsGrid().getStore().load()})},onFileSystemsAddBtnClick:function(){var a=this,b=a.getFileSystemsGrid(),c=b.getStore();b.editingPlugin.cancelEdit();var d=c.add({status:"ONLINE"});b.editingPlugin.startEdit(d[0],0)}}),Ext.define("App.controller.administration.HL7",{extend:"Ext.app.Controller",refs:[{ref:"HL7ServersPanel",selector:"hl7serverspanel"},{ref:"HL7ServersGrid",selector:"#hl7serversgrid"},{ref:"HL7ClientsGrid",selector:"#hl7clientsgrid"},{ref:"HL7MessagesWindow",selector:"#HL7MessagesWindow"},{ref:"HL7MessagesGrid",selector:"#HL7MessagesGrid"},{ref:"HL7MessageViewerWindow",selector:"#HL7MessageViewerWindow"},{ref:"HL7MessageViewerForm",selector:"#HL7MessageViewerForm"},{ref:"HL7MessageViewerRawMessageField",selector:"#HL7MessageViewerRawMessageField"},{ref:"HL7MessageViewerMessageField",selector:"#HL7MessageViewerMessageField"}],init:function(){var a=this;a.control({hl7serverspanel:{activate:a.onHL7ServersPanelActive},"#hl7serversgrid":{beforeedit:a.onHL7ServersGridBeforeEdit,validateedit:a.onHL7ServersGridValidateEdit},"#hl7serversgrid #addHL7ServerBtn":{click:a.onAddHL7ServerBtnClick},"#hl7serversgrid #removeHL7ServerBtn":{click:a.onRemoveHL7ServerBtnClick},"#hl7clientsgrid #addHL7ClientBtn":{click:a.onAddHL7ClientBtnClick},"#hl7clientsgrid #removeHL7ClientBtn":{click:a.onRemoveHL7ClientBtnClick},"#HL7MessagesViewBtn":{click:a.onHL7MessagesViewBtnClick},"#HL7MessagesGrid":{itemdblclick:a.onHL7MessagesGridItemDblClick},"#HL7ServerConfigBtn":{click:a.onHL7ServerConfigBtnClick},"#HL7ClientConfigBtn":{click:a.onHL7ClientConfigBtnClick},"#HL7ConfigEditorCancelBtn":{click:a.onHL7ConfigEditorCancelBtnClick},"#HL7ConfigEditorSaveBtn":{click:a.onHL7ConfigEditorSaveBtnClick},"#HL7MessageViewerWindowResendBtn":{click:a.onHL7MessageViewerWindowResendBtnClick},"#HL7MessageViewerWindowPreviousBtn":{click:a.onHL7MessageViewerWindowPreviousBtnClick},"#HL7MessageViewerWindowNextBtn":{click:a.onHL7MessageViewerWindowNextBtnClick},"#HL7MessageViewerWindowCloseBtn":{click:a.onHL7MessageViewerWindowCloseBtnClick},"#HL7MessageViewerMessageEditBtn":{toggle:a.onHL7MessageViewerMessageEditBtnToggle}})},onHL7ConfigEditorCancelBtnClick:function(a){a.up("window").close()},onHL7ConfigEditorSaveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=c.getRecord();e.set(d),Ext.Object.isEmpty(e.getChanges())?b.close():e.save({callback:function(){b.close(),app.msg(_("sweet"),_("record_saved"))}})},onHL7ServerConfigBtnClick:function(a){var b=a.up("grid"),c=b.getSelectionModel().getSelection();if(0!==c.length){var d=this.showConfigEditorWindow();d.down("form").getForm().loadRecord(c[0])}},onHL7ClientConfigBtnClick:function(a){var b=a.up("grid"),c=b.getSelectionModel().getSelection();if(0!==c.length){var d=this.showConfigEditorWindow();d.down("form").getForm().loadRecord(c[0])}},showConfigEditorWindow:function(){return Ext.create("Ext.window.Window",{title:"Configuration",height:400,width:600,layout:"fit",modal:!0,items:{xtype:"form",layout:"fit",items:[{xtype:"textareafield",name:"config"}]},buttons:[{xtype:"button",text:_("cancel"),itemId:"HL7ConfigEditorCancelBtn"},{xtype:"button",text:_("save"),itemId:"HL7ConfigEditorSaveBtn"}]}).show()},onAddHL7ServerBtnClick:function(){var a=this,b=a.getHL7ServersGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{}),b.editingPlugin.startEdit(0,0)},onAddHL7ClientBtnClick:function(){var a=this,b=a.getHL7ClientsGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{}),b.editingPlugin.startEdit(0,0)},onRemoveHL7ServerBtnClick:function(){},onRemoveHL7ClientBtnClick:function(){},serverStartHandler:function(a){HL7ServerHandler.start({id:a.data.id,ip:a.data.ip,port:a.data.port},function(b,c){a.set({online:c.result.online,token:c.result.token}),a.commit()})},serverStopHandler:function(a){HL7ServerHandler.stop({id:a.data.id,token:a.data.token,ip:a.data.ip,port:a.data.port},function(b,c){a.set({online:c.result.online}),a.commit()})},onHL7ServersPanelActive:function(){this.reloadStore()},reloadStore:function(){this.getHL7ServersGrid().getStore().load(),this.getHL7ClientsGrid().getStore().load()},onHL7ServersGridBeforeEdit:function(a,b){var c=a.editor.query("multitextfield")[0],d=b.record.data.allow_ips;Ext.Function.defer(function(){c.setValue(d)},10)},onHL7ServersGridValidateEdit:function(a,b){var c=a.editor.query("multitextfield")[0],d=c.getValue();b.record.set({allow_ips:d})},onHL7MessagesViewBtnClick:function(){this.showHL7MessagesByReference(void 0)},showHL7MessagesByReference:function(a){this.showHL7MessagesWindow(),a?(this.getHL7MessagesGrid().getStore().clearFilter(!0),this.getHL7MessagesGrid().getStore().filter([{property:"reference",value:a}])):(this.getHL7MessagesGrid().getStore().clearFilter(!0),this.getHL7MessagesGrid().getStore().load())},onHL7MessagesGridItemDblClick:function(a,b){this.viewHL7MessageDetailById(b.get("id"))},viewHL7MessageDetailById:function(a){var b=this,c=b.showHL7MessageDetailWindow(),d=c.down("form").getForm();HL7Messages.getMessageById(a,function(a){a.raw_message=Ext.clone(a.message).split("\r").join("\r\n"),a.message=b.colourizer(a.message),a.response=b.colourizer(a.response),d.setValues(a)})},showHL7MessageDetailWindow:function(){return this.getHL7MessageViewerWindow()||Ext.create("App.view.administration.HL7MessageViewer"),this.getHL7MessageViewerWindow().show()},showHL7MessagesWindow:function(){return this.getHL7MessagesWindow()||Ext.create("App.view.administration.HL7Messages"),this.getHL7MessagesWindow().show()},onHL7MessageViewerWindowResendBtnClick:function(a){var b=a.up("window").down("form").getForm().getValues(),c=b.raw_message,d=b.isOutbound;return d?void HL7Messages.getResendMessage(c,function(a){say(a)}):void app.msg(_("oops"),"Only outbound messages can be resend",!0)},onHL7MessageViewerMessageEditBtnToggle:function(a,b){this.getHL7MessageViewerRawMessageField().setVisible(b),this.getHL7MessageViewerMessageField().setVisible(!b)},onHL7MessageViewerWindowPreviousBtnClick:function(a){var b=this.getHL7MessagesWindow().down("grid"),c=b.getStore(),d=b.getSelectionModel(),e=d.getLastSelected(),f=c.findBy(function(a,b){return e.get("id")===b}),g=f-1,h=c.getAt(g),i=a.up("window").down("form").getForm();return say(f),say(g),say(i),h?(d.select(h),void this.viewHL7MessageDetailById(h.get("id"))):void a.up("window").close()},onHL7MessageViewerWindowNextBtnClick:function(a){var b=this.getHL7MessagesWindow().down("grid"),c=b.getStore(),d=b.getSelectionModel(),e=d.getLastSelected(),f=c.findBy(function(a,b){return e.get("id")===b}),g=f+1,h=c.getAt(g),i=a.up("window").down("form").getForm();return say(f),say(g),say(i),h?(d.select(h),void this.viewHL7MessageDetailById(h.get("id"))):void a.up("window").close()},onHL7MessageViewerWindowCloseBtnClick:function(a){a.up("window").close()},colourizer:function(a){var b=a.split("\r"),c="";for(var d in b){var e=b[d];if(e.length<3)c=c+e+"<br>";else{var f=e.split("|");for(var g in f){var h=f[g];if(0==g)c=c+'<span style="color: #000080;"><b>'+h+"</b></span>";else{var i=h.split("~");for(var j in i){var k=i[j];j>0&&(c+='<span style="color: #808080;">~</span>');var l=k.split("^");for(var m in l){var n=l[m];m>0&&(c+='<span style="color: #808080;">^</span>');var o=n.split("&");for(var p in o){var q=o[p];p>0&&(c+='<span style="color: #808080;">&</span>'),q.match(/^[0-9./]+/)&&(q='<span style="color: #990033;">'+q+"</span>"),c+=q}}}}c+='<span style="color: #808080;"><b>|</b></span>'}c+="<br>"}}return c}}),Ext.define("App.controller.administration.PoolAreas",{extend:"Ext.app.Controller",refs:[{ref:"PoolAreasPanel",selector:"#PoolAreasPanel"},{ref:"PoolAreasGrid",selector:"#PoolAreasGrid"}],init:function(){var a=this;a.control({"#PoolAreasPanel":{activate:a.onPoolAreasPanelActive},"#PoolAreasPanelAddBtn":{click:a.onPoolAreasPanelAddBtnClick}})},onPoolAreasPanelActive:function(){this.getPoolAreasGrid().getStore().load()},onPoolAreasPanelAddBtnClick:function(){var a=this.getPoolAreasGrid(),b=a.getStore();a.editingPlugin.cancelEdit(),b.insert(0,{active:0}),a.editingPlugin.startEdit(0,0)}}),Ext.define("App.controller.administration.Printers",{extend:"Ext.app.Controller",refs:[{ref:"AdministrationPrintersGrid",selector:"#AdministrationPrintersGrid"}],init:function(){var a=this;a.control({"#AdministrationPrintersAddBtn":{click:a.onAdministrationPrintersAddBtnClick},"#AdministrationPrintersRemoveBtn":{click:a.onAdministrationPrintersRemoveBtnClick}})},onAdministrationPrintersAddBtnClick:function(){var a,b=this.getAdministrationPrintersGrid().editingPlugin;b.cancelEdit(),a=this.getAdministrationPrintersGrid().getStore().add({}),b.startEdit(a[0],0)},onAdministrationPrintersRemoveBtnClick:function(){var a=this,b=a.getAdministrationPrintersGrid(),c=b.editingPlugin,d=b.getStore(),e=b.getSelectionModel().getSelection()[0];c.cancelEdit(),d.remove(e),d.sync()}}),Ext.define("App.controller.administration.Practice",{extend:"Ext.app.Controller",refs:[{ref:"PracticePanel",selector:"practicepanel"}],init:function(){var a=this;a.control({"practicepanel grid":{activate:a.onPracticeGridPanelsActive},"practicepanel button[toggleGroup=insurance_number_group]":{toggle:a.onInsuranceNumberGroupToggle},"practicepanel toolbar > #addBtn":{click:a.onAddBtnClick}})},onPracticeGridPanelsActive:function(a){a.getStore().load()},onAddBtnClick:function(a){var b=a.up("grid"),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{active:1}),b.editingPlugin.startEdit(0,0)},onInsuranceNumberGroupToggle:function(a,b){var c=a.up("grid");b?(c.view.features[0].enable(),c.getStore().group(a.action)):c.view.features[0].disable()}}),Ext.define("App.controller.administration.ReferringProviders",{extend:"Ext.app.Controller",refs:[{ref:"ReferringProvidersPanel",selector:"referringproviderspanel"},{ref:"ReferringProviderAddBtn",selector:"#referringProviderAddBtn"},{ref:"ReferringProviderWindow",selector:"#ReferringProviderWindow"},{ref:"ReferringProviderWindowForm",selector:"#ReferringProviderWindowForm"},{ref:"ReferringProviderWindowGrid",selector:"#ReferringProviderWindowGrid"},{ref:"ReferringProviderInsuranceBlacklistGrid",selector:"#ReferringProviderInsuranceBlacklistGrid"}],init:function(){var a=this;a.control({viewport:{referringproviderddbtnclick:a.onReferringProviderSearchAddBtnClick},referringproviderspanel:{itemdblclick:a.onReferringProvidersPanelItemDblClick},"#referringProviderAddBtn":{click:a.onReferringProviderAddBtnClick},"#ReferringProviderWindow":{close:a.onReferringProviderWindowClose},"#ReferringProviderWindowCancelBtn":{click:a.onReferringProviderWindowCancelBtnClick},"#ReferringProviderWindowSaveBtn":{click:a.onReferringProviderWindowSaveBtnClick},"#ReferringProviderFacilityAddBtn":{click:a.onReferringProviderFacilityAddBtnClick},"#ReferringProviderAuthyRegisterBtn":{click:a.onReferringProviderAuthyRegisterBtnClick},"#ReferringProviderWindowFormNpiSearchField":{searchresponse:a.onReferringProviderWindowFormNpiSearchFieldSearchResponse},"#ProceduresHistoryGridPerformerField":{select:a.onProceduresHistoryGridPerformerFieldSelect},"#ProceduresHistoryGridServiceLocationField":{select:a.onProceduresHistoryGridServiceLocationFieldSelect},"#ReferringProviderInsuranceBlacklistGrid":{beforeedit:a.onReferringProviderInsuranceBlacklistGridBeforeEdit,validateedit:a.onReferringProviderInsuranceBlacklistGridValidateEdit},"#ReferringProviderInsuranceBlacklistAddBtn":{click:a.onReferringProviderInsuranceBlacklistAddBtnClick},"#ReferringProviderInsuranceBlacklistInsuranceCmb":{select:a.onReferringProviderInsuranceBlacklistInsuranceCmbSelect},"#ReferringProviderInsuranceBlacklistSpecialtyCmb":{select:a.onReferringProviderInsuranceBlacklistSpecialtyCmbSelect}})},onReferringProviderInsuranceBlacklistGridBeforeEdit:function(){return a("allow_edit_referring_physician_blacklist")},onReferringProviderInsuranceBlacklistGridValidateEdit:function(a,b){var c=a.editor.getForm(),d=c.findField("specialty_id"),e=d.findRecordByValue(d.getValue()),f=c.findField("insurance_id"),g=f.findRecordByValue(f.getValue());b.record.set(e?{specialty_name:e.get("title")}:{specialty_name:""}),b.record.set(g?{insurance_name:g.get("name")}:{insurance_name:""})},onReferringProviderInsuranceBlacklistAddBtnClick:function(a){var b=a.up("window").down("form").getForm(),c=a.up("grid"),d=c.getStore();return b.isValid()?(c.editingPlugin.cancelEdit(),void c.editingPlugin.startEdit(d.add({npi:b.findField("npi").getValue()})[0],1)):void app.msg(_("oops"),_("invalid_values_found"),!0)},onReferringProviderInsuranceBlacklistInsuranceCmbSelect:function(){},onReferringProviderInsuranceBlacklistSpecialtyCmbSelect:function(){},onProceduresHistoryGridPerformerFieldSelect:function(a,b){if(0!==b.length){var c=a.up("form").getForm().getRecord();c.set({performer_id:b[0].get("id")})}},onProceduresHistoryGridServiceLocationFieldSelect:function(a,b){if(0!==b.length){var c=a.up("form").getForm().getRecord();c.set({service_location_id:b[0].get("id")})}},onReferringProviderAuthyRegisterBtnClick:function(){var a=this.getReferringProvidersPanel(),b=(a.getStore(),a.getSelectionModel().getLastSelected());TwoFactorAuthentication.registerUserByIdAndType(b.get("id"),"referring",b.get("email"),b.get("cel_number").replace(/[-() ]/g,""),function(c){say(c),c.success?(b.set({authy_id:c.authy_id}),b.commit(),a.view.refresh()):app.msg(_("oops"),c.errors.replace(/,/g,"<br>"),!0)})},onReferringProviderWindowFormNpiSearchFieldSearchResponse:function(a,b){if(!b.success)return void app.msg(_("oops"),b.error,!0);if(b.data===!1)return void app.msg(_("oops"),_("no_provider_found"),!0);var c={global_id:null,title:b.data.basic.name_prefix,fname:b.data.basic.first_name||"",mname:"",lname:b.data.basic.last_name||"",organization_name:b.data.basic.organization_name||"",active:1,npi:b.data.number,lic:"",taxonomy:"",upin:"",ssn:"",notes:"NPI registry import",username:"",password:"",authorized:0,email:"",phone_number:"",fax_number:"",cel_number:""},d=[];b.data.taxonomies&&b.data.taxonomies.forEach(function(a){a.primary&&(c.taxonomy=a.code||"",c.lic=a.license||"")}),b.data.addresses&&b.data.addresses.forEach(function(a){"LOCATION"===a.address_purpose&&(c.phone_number=a.telephone_number||"",c.fax_number=a.fax_number||"",d=Ext.Array.push(d,{name:c.organization_name,address:a.address_1||"",address_cont:a.address_2||"",city:a.city||"",postal_code:a.postal_code||"",state:a.state||""}))});var e=a.up("form").getForm(),f=this.getReferringProviderWindowGrid().getStore();e.setValues(c),f.add(d)},onReferringProviderSearchAddBtnClick:function(a,b){var c=this;b?App.model.administration.ReferringProvider.load(b.get("id"),{success:function(a){c.doReferringProviderWindow(a)}}):c.doReferringProviderWindow(),c.triggerField=a},onReferringProviderAddBtnClick:function(){this.doReferringProviderWindow(),this.triggerField=void 0},onReferringProvidersPanelItemDblClick:function(a,b){this.doReferringProviderWindow(b),this.triggerField=void 0},doReferringProviderWindowByReferringId:function(a,b){var c=this;App.model.administration.ReferringProvider.load(a,{success:function(a){a.saveCallback=b,c.doReferringProviderWindow(a)}})},doReferringProviderWindow:function(a){a=a||Ext.create("App.model.administration.ReferringProvider",{global_id:null,create_date:new Date,update_date:new Date,create_uid:app.user.id,update_uid:app.user.id,username:null,active:1}),this.showReferringProviderWindow();var b=this.getReferringProviderWindowForm().getForm(),c=this.getReferringProviderWindowGrid(),d=a.facilities(),e=this.getReferringProviderInsuranceBlacklistGrid(),f=a.blacklist();b.loadRecord(a),c.reconfigure(d),d.load(),e.reconfigure(f),f.load()},onReferringProviderWindowClose:function(){this.getReferringProviderWindowForm().getForm().reset(),this.getReferringProviderWindowGrid().getStore().removeAll()},onReferringProviderWindowCancelBtnClick:function(){this.getReferringProviderWindow().close()},onReferringProviderWindowSaveBtnClick:function(){var a=this,b=a.getReferringProviderWindowForm().getForm(),c=a.getReferringProviderWindowGrid().getStore(),d=b.getRecord(),e=b.getValues();if(b.isValid()){if((""!=e.lname.trim()||""!=e.fname.trim())&&""==e.organization_name.trim())return void app.msg(_("oops"),_("referring_name_validation_msg"),!0);e.update_date=new Date,e.update_uid=app.user.id,""===e.username&&(e.username=null),d.set(e),d.save({callback:function(b){var d=Ext.Array.merge(c.getUpdatedRecords(),c.getNewRecords());d.length>0?(d.forEach(function(a){a.set({referring_provider_id:b.get("id")})}),c.sync({callback:function(){a.getReferringProviderWindow().close(),a.recordSaveHandler(b)}})):(a.getReferringProviderWindow().close(),a.recordSaveHandler(b))}})}},recordSaveHandler:function(a){if(this.triggerField){var b=this.triggerField.store.add(a.data);this.triggerField.select(b[0]),this.triggerField.fireEvent("select",this.triggerField,b)}else a.saveCallback&&"function"==typeof a.saveCallback?a.saveCallback():a.store?this.getReferringProvidersPanel().view.refresh():this.getReferringProvidersPanel().getStore().insert(0,a)},onReferringProviderFacilityAddBtnClick:function(){var a=this.getReferringProviderWindowGrid();a.editingPlugin.cancelEdit();var b=a.getStore().add({create_date:new Date,update_date:new Date,create_uid:app.user.id,update_uid:app.user.id});a.editingPlugin.startEdit(b[0],0)},showReferringProviderWindow:function(){return this.getReferringProviderWindow()||Ext.create("App.view.administration.ReferringProviderWindow"),this.getReferringProviderWindow().show()}}),Ext.define("App.controller.administration.Specialties",{extend:"Ext.app.Controller",refs:[{ref:"SpecialtiesPanel",selector:"specialtiespanel"},{ref:"SpecialtiesAddBtn",selector:"#specialtiesAddBtn"}],init:function(){var a=this;a.control({"#specialtiesAddBtn":{click:a.onSpecialtiesAddBtnClick}})},onSpecialtiesAddBtnClick:function(a){var b=a.up("grid");b.editingPlugin.cancelEdit(),b.getStore().insert(0,{create_date:new Date,update_date:new Date,create_uid:app.user.id,update_uid:app.user.id,active:1}),b.editingPlugin.startEdit(0,0)}}),Ext.define("App.controller.administration.EmailTemplates",{extend:"Ext.app.Controller",uses:[],refs:[{ref:"AdministrationEmailTemplates",selector:"#AdministrationEmailTemplates"},{ref:"AdministrationEmailTemplatesGrid",selector:"#AdministrationEmailTemplatesGrid"},{ref:"AdministrationEmailTemplateWindow",selector:"#AdministrationEmailTemplateWindow"},{ref:"AdministrationEmailTemplateForm",selector:"#AdministrationEmailTemplateForm"}],init:function(){var a=this;a.control({"#AdministrationEmailTemplates":{activate:a.onAdministrationEmailTemplatesActivate},"#AdministrationEmailTemplatesGrid":{itemdblclick:a.onAdministrationEmailTemplatesGridItemDblClick},"#AdministrationEmailTemplateCancelBtn":{click:a.onAdministrationEmailTemplateCancelBtnClick},"#AdministrationEmailTemplateSaveBtn":{click:a.onAdministrationEmailTemplateSaveBtnClick},"#AdministrationEmailTemplateBodyField":{push:a.onAdministrationEmailTemplateBodyFieldRender}})},onAdministrationEmailTemplatesActivate:function(){this.getAdministrationEmailTemplatesGrid().getStore().load()},onAdministrationEmailTemplatesGridItemDblClick:function(a,b){this.showAdministrationEmailTemplateWindow(),this.getAdministrationEmailTemplateForm().getForm().loadRecord(b)},onAdministrationEmailTemplateCancelBtnClick:function(){this.getAdministrationEmailTemplateForm().getForm().reset(!0),this.getAdministrationEmailTemplateWindow().close()},onAdministrationEmailTemplateSaveBtnClick:function(){var a=this.getAdministrationEmailTemplateWindow(),b=this.getAdministrationEmailTemplateForm().getForm(),c=b.getRecord(),d=b.getValues();b.isValid()&&(c.set(d),Ext.Object.isEmpty(c.getChanges())?(b.reset(!0),a.close()):c.store.sync({callback:function(){b.reset(!0),a.close()}}))},onAdministrationEmailTemplateBodyFieldRender:function(a){if(say("onAdministrationEmailTemplateBodyFieldRender"),a.iframeEl){var b=a.iframeEl.dom;if(b){var c=b.contentDocument?b.contentDocument:b.contentWindow.document;c&&c.body&&c.body.style&&(c.body.style.color=null,c.body.style["background-color"]=null)}}},showAdministrationEmailTemplateWindow:function(){return this.getAdministrationEmailTemplateWindow()||Ext.create("App.view.administration.EmailTemplateWindow"),this.getAdministrationEmailTemplateWindow().show()}}),Ext.define("App.controller.administration.EncounterTemplatePanels",{extend:"Ext.app.Controller",uses:["App.ux.LiveRadsSearch","App.ux.LiveLabsSearch"],refs:[{ref:"TemplatePanelsWindow",selector:"#TemplatePanelsWindow"},{ref:"TemplatePanelsGrid",selector:"#TemplatePanelsGrid"},{ref:"TemplatePanelsCombo",selector:"#TemplatePanelsCombo"},{ref:"SoapTemplatesBtn",selector:"#SoapTemplatesBtn"},{ref:"encounterPanel",selector:"#encounterPanel"},{ref:"encounterPanel",selector:"#encounterPanel"},{ref:"soapPanel",selector:"#soapPanel"},{ref:"soapForm",selector:"#soapForm"},{ref:"AdministrationEncounterTemplatesPanel",selector:"#AdministrationEncounterTemplatesPanel"},{ref:"AdministrationEncounterTemplatesGrid",selector:"#AdministrationEncounterTemplatesGrid"},{ref:"AdministrationEncounterTemplateWindow",selector:"#AdministrationEncounterTemplateWindow"},{ref:"AdministrationEncounterTemplateForm",selector:"#AdministrationEncounterTemplateForm"},{ref:"AdministrationEncounterTemplateGrid",selector:"#AdministrationEncounterTemplateGrid"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onEncounterLoad},"#encounterPanel":{beforerender:a.onEncounterPanelBeforeRender},"#TemplatePanelsCombo":{select:a.onTemplatePanelsComboSelect},"#SoapTemplatesBtn":{click:a.onSoapTemplatesBtnClick},"#TemplatePanelsAddBtn":{click:a.onTemplatePanelsAddBtnClick},"#TemplatePanelsCancelBtn":{click:a.onTemplatePanelsCancelBtnClick},"#AdministrationEncounterTemplatesPanel":{activate:a.onAdministrationEncounterTemplatesPanelActivate},"#AdministrationEncounterTemplatesGrid":{itemdblclick:a.onAdministrationEncounterTemplatesGridItemDblClick},"#AdministrationEncounterTemplateForm":{loadrecord:a.onAdministrationEncounterTemplateFormLoadRecord},"#EncounterTemplatesAddBtn":{click:a.onEncounterTemplatesAddBtnClick},"#AdministrationEncounterTemplateRadOrderAddBtn":{click:a.onAdministrationEncounterTemplateRadOrderAddBtnClick},"#AdministrationEncounterTemplateLabOrderAddBtn":{click:a.onAdministrationEncounterTemplateLabOrderAddBtnClick},"#AdministrationEncounterTemplateCancelBtn":{click:a.onAdministrationEncounterTemplateCancelBtnClick},"#AdministrationEncounterTemplateSaveBtn":{click:a.onAdministrationEncounterTemplateSaveBtnClick}})},onEncounterLoad:function(a){this.getTemplatePanelsWindow()||Ext.create("App.view.patient.windows.EncounterTemplatePanels");var b=this,c=b.getTemplatePanelsCombo().getStore(),d=b.getSoapTemplatesBtn();c.load({filters:[{property:"specialty_id",value:a.get("specialty_id")},{property:"active",value:1}],callback:function(a){a.length>0?(d.disabled=!1,d.setDisabled(!1),d.setTooltip(_("clinical_templates"))):(d.disabled=!0,d.setDisabled(!0),d.setTooltip(_("no_templates_found")))}})},onEncounterPanelBeforeRender:function(){this.getSoapForm().getDockedItems('toolbar[dock="bottom"]')[0].insert(0,[{xtype:"button",text:_("templates"),itemId:"SoapTemplatesBtn"}])},onSoapTemplatesBtnClick:function(){this.doTemplatePanelsWindowShow()},onTemplatePanelsComboSelect:function(a,b){var c=this,d=c.getTemplatePanelsGrid(),e=d.getSelectionModel(),f=b[0].templates();d.reconfigure(f),f.load({callback:function(){e.selectAll()}})},doTemplatePanelsWindowShow:function(){return this.getTemplatePanelsGrid().getStore().removeAll(),this.getTemplatePanelsCombo().reset(),this.getTemplatePanelsWindow().show()},onTemplatePanelsAddBtnClick:function(){var a=this,b=a.getTemplatePanelsCombo(),c=a.getTemplatePanelsGrid().getSelectionModel().getSelection();if(b.isValid())return 0===c.length?void app.msg(_("oops"),_("no_templates_to_add"),!0):void Ext.Msg.show({title:_("wait"),msg:_("add_templates_message"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"==b&&(a.doAddTemplates(c),a.getTemplatePanelsWindow().close())}})},doAddTemplates:function(templates){app.onMedicalWin(),templates.forEach(function(template){var type=template.get("template_type"),data=eval("("+template.get("template_data")+")");if(!data)return void say("Error: data eval issue -- "+data);switch(data.pid=app.patient.pid,data.eid=app.patient.eid,data.uid=app.user.id,data.date_ordered=new Date,type){case"LAB":App.app.getController("patient.LabOrders").doAddOrderByTemplate(data);break;case"RAD":App.app.getController("patient.RadOrders").doAddOrderByTemplate(data);break;case"RX":App.app.getController("patient.RxOrders").doAddOrderByTemplate(data);break;case"REF":App.app.getController("patient.Referrals").doAddReferralByTemplate(data);break;default:say("Error: no template_type found -- "+type)}}),Ext.Function.defer(function(){app.getActivePanel().getProgressNote()},500)},onTemplatePanelsCancelBtnClick:function(){this.getTemplatePanelsWindow().close()},getLabTemplate:function(a,b){return{pid:0,eid:0,uid:0,code:a,code_type:"LOINC",date_collected:null,date_ordered:"",description:b,hl7_recipient_id:0,note:"",order_type:"lab",priority:"Normal",status:"Pending",type:"Laboratory","void":!1,void_comment:""}},getRadTemplate:function(a,b){return{pid:0,eid:0,uid:0,code:a,code_type:"LOINC",date_collected:null,date_ordered:"",description:b,hl7_recipient_id:0,note:"",order_type:"rad",priority:"Normal",status:"Pending",type:"Radiology","void":!1,void_comment:""}},getRefTemplate:function(a,b,c){return{pid:0,eid:0,refer_by:0,refer_by_text:"",referral_date:"",create_uid:0,update_uid:0,create_date:null,update_date:null,is_external_referral:!0,refer_to:"",refer_to_text:"",send_record:!1,service_code:a||"",service_code_type:"SNOMED-CT",service_text:b||"",risk_level:"low",referal_reason:c||"",diagnosis_code:"",diagnosis_code_type:"",diagnosis_text:""}},onAdministrationEncounterTemplatesPanelActivate:function(){this.getAdministrationEncounterTemplatesGrid().getStore().load()},onEncounterTemplatesAddBtnClick:function(){this.showEncounterTemplateWindow(),this.getAdministrationEncounterTemplateForm().getForm().loadRecord(Ext.create("App.model.administration.EncounterTemplatePanel"))},onAdministrationEncounterTemplatesGridItemDblClick:function(a,b){this.showEncounterTemplateWindow(),this.getAdministrationEncounterTemplateForm().getForm().loadRecord(b)},onAdministrationEncounterTemplateFormLoadRecord:function(a,b){say("onAdministrationEncounterTemplateFormLoadRecord"),say(a),say(b);var c=this.getAdministrationEncounterTemplateGrid().getStore();b.get("id")>0?c.load({filters:[{property:"panel_id",value:b.get("id")}]}):(c.removeAll(),c.commitChanges())},onAdministrationEncounterTemplateRadOrderAddBtnClick:function(){this.getRadOrderWindow()},onAdministrationEncounterTemplateLabOrderAddBtnClick:function(){this.getLadOrderWindow()},onAdministrationEncounterTemplateCancelBtnClick:function(){this.getAdministrationEncounterTemplateForm().getForm().reset(!0),this.getAdministrationEncounterTemplateWindow().close()},onAdministrationEncounterTemplateSaveBtnClick:function(){var a=this,b=this.getAdministrationEncounterTemplateForm().getForm(),c=b.getRecord(),d=b.getValues();if(b.isValid()){c.set(d);var e=c.getChanges();Ext.Object.isEmpty(e)?a.onAdministrationEncounterTemplateItemsSave(c):c.save({callback:function(){a.onAdministrationEncounterTemplateItemsSave(c)}})}},onAdministrationEncounterTemplateItemsSave:function(a){var b=this,c=this.getAdministrationEncounterTemplateGrid().getStore(),d=c.getModifiedRecords();d.forEach(function(b){b.set({panel_id:a.get("id")})}),d.length>0?c.sync({callback:function(){b.getAdministrationEncounterTemplateForm().getForm().reset(!0),b.getAdministrationEncounterTemplateWindow().close()}}):(b.getAdministrationEncounterTemplateForm().getForm().reset(!0),b.getAdministrationEncounterTemplateWindow().close())},showEncounterTemplateWindow:function(){return this.getAdministrationEncounterTemplateWindow()||Ext.create("App.view.administration.EncounterTemplateWindow"),this.getAdministrationEncounterTemplateWindow().show()},addAdministrationEncounterTemplateGridRecord:function(a,b,c){var d=this.getAdministrationEncounterTemplateGrid().getStore();d.add({description:a,template_type:b,template_data:JSON.stringify(c),active:1})},getRadOrderWindow:function(){var a=this;Ext.create("Ext.window.Window",{resizable:!1,items:[{xtype:"form",bodyPadding:10,items:[{xtype:"radslivetsearch",fieldLabel:_("study"),labelAlign:"top",hideLabel:!1,width:300}]}],buttons:[{xtype:"button",text:_("cancel"),handler:function(){this.up("window").close()}},{xtype:"button",text:_("add"),handler:function(){var b=this.up("window").down("radslivetsearch"),c=b.findRecordByValue(b.getValue());if(c){var d=a.getRadTemplate(c.get("loinc_number"),c.get("loinc_name"));a.addAdministrationEncounterTemplateGridRecord(d.description,"RAD",d)}this.up("window").close()}}]}).show()},getLadOrderWindow:function(){var a=this;Ext.create("Ext.window.Window",{resizable:!1,items:[{xtype:"form",bodyPadding:10,items:[{xtype:"labslivetsearch",fieldLabel:_("study"),labelAlign:"top",hideLabel:!1,width:300}]}],buttons:[{xtype:"button",text:_("cancel"),handler:function(){this.up("window").close()}},{xtype:"button",text:_("add"),handler:function(){var b=this.up("window").down("labslivetsearch"),c=b.findRecordByValue(b.getValue());if(c){var d=a.getRadTemplate(c.get("loinc_number"),c.get("loinc_name"));a.addAdministrationEncounterTemplateGridRecord(d.description,"LAB",d)}this.up("window").close()}}]}).show()}}),Ext.define("App.controller.administration.Version",{extend:"Ext.app.Controller",requires:["App.ux.ManagedIframe"],refs:[{ref:"UpdateNotesWindow",selector:"#UpdateNotesWindow"},{ref:"UpdateNotesWindowDontShowAgainBtn",selector:"#UpdateNotesWindowDontShowAgainBtn"},{ref:"UpdateNotesWindowIframe",selector:"#UpdateNotesWindow miframe"}],init:function(){var a=this;a.v_major=null,a.v_minor=null,a.v_patch=null,a.v_notes_url=null,a.version=null,a.control({viewport:{render:a.onViewportRender},"#UpdateNotesWindowDontShowAgainBtn":{click:a.onUpdateNotesWindowDontShowAgainBtn}})},onViewportRender:function(){var a=this;Version.getLatestUpdate(function(b){a.v_major=b.v_major||0,a.v_minor=b.v_minor||0,a.v_patch=b.v_patch||0,a.v_notes_url=b.v_notes_url||null,a.version=a.v_major.toString()+"."+a.v_minor.toString()+"."+a.v_patch.toString(),null!==a.v_major&&null!==a.v_minor&&null!==a.v_patch&&null!==a.v_notes_url&&Version.getUpdateAcknowledge(a.version,app.user.id,function(b){say(b),b||(a.showUpdateNotesWindow(),a.getUpdateNotesWindowIframe().setSrc(a.v_notes_url))})})},showUpdateNotesWindow:function(){var a=this;return a.getUpdateNotesWindow()||Ext.create("App.view.update_notes.UpdateNotesWindow",{title:"Version "+a.version}),a.getUpdateNotesWindow().show()},onUpdateNotesWindowDontShowAgainBtn:function(){var a=this;Version.setUpdateAcknowledge(a.version,app.user.id,function(){a.getUpdateNotesWindow().close()})}}),Ext.define("App.controller.administration.Users",{extend:"Ext.app.Controller",refs:[{ref:"AdminUsersPanel",selector:"#AdminUsersPanel"},{ref:"AdminUserGridPanel",selector:"#AdminUserGridPanel"},{ref:"PasswordExpiredWindow",selector:"#PasswordExpiredWindow"},{ref:"PasswordExpiredWindowForm",selector:"#PasswordExpiredWindowForm"},{ref:"PasswordExpiredWindowPasswordField",selector:"#PasswordExpiredWindowPasswordField"},{ref:"PasswordExpiredWindowConfirmPasswordField",selector:"#PasswordExpiredWindowConfirmPasswordField"}],init:function(){var a=this;
a.control({viewport:{afterrender:a.onApplicationAfterRender},"#AdminUserGridPanel":{beforeedit:a.onAdminUserGridPanelBeforeEdit},"#UserGridEditFormProviderCredentializationActiveBtn":{click:a.onUserGridEditFormProviderCredentializationActiveBtnClick},"#UserGridEditFormProviderCredentializationInactiveBtn":{click:a.onUserGridEditFormProviderCredentializationInactiveBtnClick},"#AdminUserGridPanelPrintBtn":{click:a.onAdminUserGridPanelPrintBtnClick},"#PasswordExpiredWindowUpdateBtn":{click:a.onPasswordExpiredWindowUpdateBtnClick},"#SwitchUserBtn":{click:a.onSwitchUserBtnClick},"#AdminUserGridPanelAuthyRegisterBtn":{click:a.onAdminUserGridPanelAuthyRegisterBtnClick},"#AdminUserGridPanelLDAPSyncBtn":{click:a.onAdminUserGridPanelLDAPSyncBtnClick}})},onAdminUserGridPanelLDAPSyncBtnClick:function(a){LDAP.Sync(function(b){b.success?(app.msg(_("oops"),b.message),a.up("grid").getStore().reload()):app.msg(_("oops"),b.error,!0)})},onAdminUserGridPanelAuthyRegisterBtnClick:function(){var a=this.getAdminUserGridPanel(),b=(a.getStore(),a.getSelectionModel().getLastSelected());say(b),TwoFactorAuthentication.registerUserByIdAndType(b.get("id"),"application",b.get("email"),b.get("mobile").replace(/[-() ]/g,""),function(c){say(c),c.success?(b.set({authy_id:c.authy_id}),b.commit(),a.view.refresh()):app.msg(_("oops"),c.errors.replace(/,/g,"<br>"),!0)})},onAdminUserGridPanelPrintBtnClick:function(){var a=this.getAdminUserGridPanel(),b=a.getStore();b.load({start:0,limit:5e3,callback:function(){App.ux.grid.Printer.mainTitle="User Report",App.ux.grid.Printer.filtersHtml="------------",App.ux.grid.Printer.print(a,null)}})},onApplicationAfterRender:function(a){a.user.password_expired&&this.doPasswordExpiredUpdate()},doPasswordExpiredUpdate:function(){this.showPasswordExpiredWindow()},showPasswordExpiredWindow:function(){return this.getPasswordExpiredWindow()||Ext.create("App.view.administration.PasswordExpiredWindow"),this.getPasswordExpiredWindow().show()},passwordConfirmationValidation:function(a){return this.getPasswordExpiredWindowPasswordField().getValue()===a?!0:_("password_confirmation_error")},onPasswordExpiredWindowUpdateBtnClick:function(){say("onPasswordExpiredWindowUpdateBtnClick");var a=this.getPasswordExpiredWindow(),b=this.getPasswordExpiredWindowForm().getForm(),c=b.getValues();b.isValid()&&""!=c.old_password&&c.new_password==c.confirmation_password&&(c.id=app.user.id,User.updatePassword(c,function(c){return c.success?(app.msg(_("sweet"),_("password_changed")),b.reset(),void a.close()):void app.msg(_("oops"),_(c.message),!0)}))},onAdminUserGridPanelBeforeEdit:function(a,b){var c=a.editor.down("grid"),d=c.getStore(),e=[{property:"provider_id",value:b.record.data.id}],f={};d.clearFilter(!0),b.record.data.id>0&&""!=b.record.data.npi&&(f={providerId:b.record.data.id,fullList:!0},Ext.Array.push(e,{property:"provider_id",value:null})),d.load({filters:e,params:f})},onUserGridEditFormProviderCredentializationActiveBtnClick:function(a){for(var b=a.up("grid").getStore(),c=b.data.items,d=Ext.Date.format(new Date,"Y-m-d"),e=0;e<c.length;e++)c[e].set({start_date:d,end_date:"9999-12-31",active:!0})},onUserGridEditFormProviderCredentializationInactiveBtnClick:function(a){for(var b=a.up("grid").getStore(),c=b.data.items,d=new Date,e=Ext.Date.format(Ext.Date.subtract(d,Ext.Date.DAY,1),"Y-m-d"),f=0;f<c.length;f++)c[f].set({start_date:e,end_date:e,active:!1})},onSwitchUserBtnClick:function(){this.getController("LogOut").doApplicationLock()}}),Ext.define("App.controller.administration.IpAccess",{extend:"Ext.app.Controller",refs:[{ref:"IpAccessPanel",selector:"ipaccesspanel"},{ref:"IpAccessRulesGrid",selector:"ipaccesspanel #IpAccessRulesGrid"},{ref:"IpAccessLogGrid",selector:"ipaccesspanel #IpAccessLogGrid"},{ref:"IpAccessPanelContextMenu",selector:"#IpAccessPanelContextMenu"},{ref:"IpAccessRulesIpField",selector:"#IpAccessRulesIpField"},{ref:"IpAccessRulesIpFormField",selector:"#IpAccessRulesIpFormField"},{ref:"IpAccessRulesIpToField",selector:"#IpAccessRulesIpToField"}],init:function(){var a=this;a.control({ipaccesspanel:{activate:a.onIpAccessPanelActive},"ipaccesspanel #addIpRule":{click:a.onAddIpRuleClick},"ipaccesspanel #IpAccessLogGrid":{beforeitemcontextmenu:a.onIpAccessLogGridBeforeContextMenu},"#IpAccessPanelAddToWhiteListMenu":{click:a.onIpAccessPanelAddToWhiteListMenuClick},"#IpAccessRulesIpField":{keyup:a.onIpAccessRulesIpFieldKeyUp}}),a.clockCtrl=a.getController("Clock")},onAddIpRuleClick:function(){var a=this,b=a.getIpAccessRulesGrid();b.editingPlugin.cancelEdit();var c=b.getStore().add({create_date:this.clockCtrl.getTime(),update_date:this.clockCtrl.getTime(),active:1});b.editingPlugin.startEdit(c[0],0)},onIpAccessPanelActive:function(){var a=this,b=a.getIpAccessRulesGrid(),c=a.getIpAccessLogGrid();b.getStore().load(),c.getStore().load()},onIpAccessPanelAddToWhiteListMenuClick:function(){var a=this.getIpAccessLogGrid().getSelectionModel().getLastSelected(),b=this.getIpAccessRulesGrid().getStore(),c=this.getIpAccessRulesGrid().editingPlugin,d=a.get("ip")+"/32",e=this.cidrToRange(d,!0);c.cancelEdit();var f=b.add({ip:d,ip_from:e[0],ip_to:e[1],rule:"WHT",create_date:this.clockCtrl.getTime(),create_uid:app.user.id,active:1});c.startEdit(f[0],0)},onIpAccessLogGridBeforeContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showNetWorkLogContextMenu(e)},showNetWorkLogContextMenu:function(a){return this.getIpAccessPanelContextMenu()||Ext.widget("menu",{margin:"0 0 10 0",itemId:"IpAccessPanelContextMenu",items:[{text:_("add_to_network_rules"),itemId:"IpAccessPanelAddToWhiteListMenu",icon:"resources/images/icons/add.png"}]}),this.getIpAccessPanelContextMenu().showAt(a.getXY())},onIpAccessRulesIpFieldKeyUp:function(a){if(a.isValid()){var b=a.getValue(),c=this.cidrToRange(b,!0),d=a.up("form").getForm().getRecord();d.set({ip_from:c[0],ip_to:c[1]})}},long2ip:function(a){return isFinite(a)?[a>>>24,a>>>16&255,a>>>8&255,255&a].join("."):!1},ip2long:function(a){var b=0;const c=new RegExp(["^([1-9]\\d*|0[0-7]*|0x[\\da-f]+)","(?:\\.([1-9]\\d*|0[0-7]*|0x[\\da-f]+))?","(?:\\.([1-9]\\d*|0[0-7]*|0x[\\da-f]+))?","(?:\\.([1-9]\\d*|0[0-7]*|0x[\\da-f]+))?$"].join(""),"i");if(a=a.match(c),!a)return!1;for(a[0]=0,b=1;5>b;b+=1)a[0]+=!!(a[b]||"").length,a[b]=parseInt(a[b])||0;return a.push(256,256,256,256),a[4+a[0]]*=Math.pow(256,4-a[0]),a[1]>=a[5]||a[2]>=a[6]||a[3]>=a[7]||a[4]>=a[8]?!1:a[1]*(1===a[0]||16777216)+a[2]*(a[0]<=2||65536)+a[3]*(a[0]<=3||256)+1*a[4]},cidrToRange:function(a,b){var c=[2];a=a.split("/");var d=this.ip2long(a[0]),e=Math.pow(2,32-a[1])+d-1;return c[0]=b?d:this.long2ip(d),c[1]=b?e:this.long2ip(e),c}}),Ext.define("App.controller.administration.PdfForms",{extend:"Ext.app.Controller",refs:[{ref:"AdministrationPdfForms",selector:"#AdministrationPdfForms"},{ref:"AdministrationPdfFormsGrid",selector:"#AdministrationPdfFormsGrid"},{ref:"AdministrationPdfFormsTokenPanel",selector:"#AdministrationPdfFormsTokenPanel"},{ref:"AdministrationPdfFormsAddBtn",selector:"#AdministrationPdfFormsAddBtn"}],init:function(){var a=this;a.control({"#AdministrationPdfForms":{activate:a.onAdministrationPdfFormsActivate},"#AdministrationPdfFormsTokenPanel":{beforerender:a.onAdministrationPdfFormsTokenPanelBeforeRender},"#AdministrationPdfFormsAddBtn":{click:a.onAdministrationPdfFormsAddBtnClick}})},onAdministrationPdfFormsActivate:function(){this.getAdministrationPdfFormsGrid().getStore().load()},onAdministrationPdfFormsAddBtnClick:function(){var a=this.getAdministrationPdfFormsGrid(),b=a.getStore(),c=a.editingPlugin;c.cancelEdit(),c.startEdit(b.add({signature_x:0,signature_y:0,signature_w:0,signature_h:0,flatten:!0})[0],0)},onAdministrationPdfFormsTokenPanelBeforeRender:function(a){a.update(this.patientTokens().join("<br>"))},patientTokens:function(){return["[PATIENT_NAME]","[PATIENT_ID]","[PATIENT_RECORD_NUMBER]","[PATIENT_FULL_NAME]","[PATIENT_LAST_NAME]","[PATIENT_SEX]","[PATIENT_BIRTHDATE]","[PATIENT_MARITAL_STATUS]","[PATIENT_SOCIAL_SECURITY]","[PATIENT_EXTERNAL_ID]","[PATIENT_DRIVERS_LICENSE]","[PATIENT_POSTAL_ADDRESS_LINE_ONE]","[PATIENT_POSTAL_ADDRESS_LINE_TWO]","[PATIENT_POSTAL_CITY]","[PATIENT_POSTAL_STATE]","[PATIENT_POSTAL_ZIP]","[PATIENT_POSTAL_COUNTRY]","[PATIENT_PHYSICAL_ADDRESS_LINE_ONE]","[PATIENT_PHYSICAL_ADDRESS_LINE_TWO]","[PATIENT_PHYSICAL_CITY]","[PATIENT_PHYSICAL_STATE]","[PATIENT_PHYSICAL_ZIP]","[PATIENT_PHYSICAL_COUNTRY]","[PATIENT_HOME_PHONE]","[PATIENT_MOBILE_PHONE]","[PATIENT_WORK_PHONE]","[PATIENT_EMAIL]","[PATIENT_MOTHERS_NAME]","[PATIENT_GUARDIANS_NAME]","[PATIENT_EMERGENCY_CONTACT]","[PATIENT_EMERGENCY_PHONE]","[PATIENT_PROVIDER]","[PATIENT_PHARMACY]","[PATIENT_AGE]","[PATIENT_OCCUPATION]","[PATIENT_EMPLOYER]","[PATIENT_RACE]","[PATIENT_ETHNICITY]","[PATIENT_LANGUAGE]","[PATIENT_PICTURE]","[PATIENT_QRCODE]","[FACILITY_NAME]","[FACILITY_PHONE]","[REFERRING_ID]","[REFERRING_NAME]","[REFERRING_TITLE]","[REFERRING_FIRST_NAME]","[REFERRING_LAST_NAME]","[REFERRING_MIDDLE_NAME]","[REFERRING_NPI]","[REFERRING_LIC]","[REFERRING_EMAIL]","[REFERRING_PHONE_NUMBER]","[REFERRING_FAX_NUMBER]","[REFERRING_CEL_NUMBER]"]}}),Ext.define("App.controller.administration.MeasureCalculation",{extend:"Ext.app.Controller",uses:["App.ux.grid.Printer"],refs:[{selector:"#MeasureCalculation",ref:"MeasureCalculation"},{selector:"#MeaningfulUseGrid",ref:"MeaningfulUseGrid"},{selector:"#MeaningfulUseFromField",ref:"MeaningfulUseFromField"},{selector:"#MeaningfulUseToField",ref:"MeaningfulUseToField"},{selector:"#MeaningfulUseProviderField",ref:"MeaningfulUseProviderField"},{selector:"#MIPSGrid",ref:"MIPSGrid"},{selector:"#MIPSGridFromField",ref:"MIPSGridFromField"},{selector:"#MIPSGridToField",ref:"MIPSGridToField"},{selector:"#MIPSGridProviderField",ref:"MIPSGridProviderField"},{selector:"#MIPSGridInsuranceField",ref:"MIPSGridInsuranceField"},{selector:"#MIPSGridSexField",ref:"MIPSGridSexField"},{selector:"#MIPSGridEthnicityField",ref:"MIPSGridEthnicityField"},{selector:"#MIPSGridRaceField",ref:"MIPSGridRaceField"}],init:function(){var a=this;a.control({"#MeaningfulUseRefreshBtn":{click:a.onMeaningfulUseRefreshBtnClick},"#MeaningfulUseGrid":{celldblclick:a.onMeaningfulUseGridCellDblClick},"#MeaningfulUseGridPrintBtn":{click:a.onMeaningfulUseGridPrintBtnClick},"#MIPSGridRefreshBtn":{click:a.onMIPSGridRefreshBtnClick},"#MIPSGrid":{celldblclick:a.onMIPSGridCellDblClick},"#MIPSGridPrintBtn":{click:a.onMIPSGridPrintBtnClick}}),a.doSortGridStoreBuffer=Ext.Function.createBuffered(a.doSortGridStore,250,a)},onMIPSGridRefreshBtnClick:function(){var a=this.getMIPSGridFromField(),b=this.getMIPSGridToField(),c=this.getMIPSGridProviderField(),d=this.getMIPSGridInsuranceField(),e=this.getMIPSGridSexField(),f=this.getMIPSGridEthnicityField(),g=this.getMIPSGridRaceField(),h=this.getMIPSGrid().getStore();if(h.removeAll(),h.commitChanges(),a.isValid()&&b.isValid()&&c.isValid()){var i=c.getValue(),j=d.getValue(),k=Ext.Date.format(a.getValue(),"Y-m-d"),l=Ext.Date.format(b.getValue(),"Y-m-d"),m=e.getValue(),n=f.getValue(),o=g.getValue();this.doReportMeasureByDates(h,"AdvanceCarePlan",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"ControllingHighBloodPressure",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"HeartFailureARBorARNI",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"CoronaryArteryDiseaseAntiplatelet",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"CoronaryArteryDiseaseBetaBlocker",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"HeartFailureBetaBlocker",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"InfluenzaImmunization",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"PneumococcalImmunization",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"FallsRiskAssessment",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"FallsPlanOfCare",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"SupportElectronicReferralLoops",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"ClosingTheReferralLoopReceipt",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"BreastCancerScreening",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"DocumentationOfCurrentMedications",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"PreventiveCareAndScreeningBMIAndFUP",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"UseOfHighRiskMedicationsInOlderAdults",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"DiabetesMedicalAttentionForNephropathy",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"ChlamydiaScreeningForWomen",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"TobaccoUseScreeningCessationIntervention",i,k,l,j,m,n,o),this.doReportMeasureByDates(h,"HIVScreening",i,k,l,j,m,n,o)}},onMIPSGridCellDblClick:function(a,b,c,d){this.doShowPatientList(a,b,c,d)},onMIPSGridPrintBtnClick:function(){var a=this.getMIPSGridFromField(),b=this.getMIPSGridToField(),c=this.getMIPSGridProviderField(),d=c.findRecordByValue(c.getValue()),e=this.getMIPSGrid();a.isValid()&&b.isValid()&&c.isValid()&&0!==e.store.count()&&(App.ux.grid.Printer.mainTitle="MIPS Calculation",App.ux.grid.Printer.filtersHtml=Ext.String.format("<b>From:</b> {0}<br><b>To:</b> {1}<br><b>Provider:</b> {2}",Ext.Date.format(a.getValue(),"F j, Y"),Ext.Date.format(b.getValue(),"F j, Y"),d.get("fullname")),App.ux.grid.Printer.print(e))},onMeaningfulUseGridPrintBtnClick:function(){var a=this.getMeaningfulUseFromField(),b=this.getMeaningfulUseToField(),c=this.getMeaningfulUseProviderField(),d=c.findRecordByValue(c.getValue()),e=this.getMeaningfulUseGrid();a.isValid()&&b.isValid()&&c.isValid()&&0!==e.store.count()&&(App.ux.grid.Printer.mainTitle="Meaningful Use Calculation",App.ux.grid.Printer.filtersHtml=Ext.String.format("<b>From:</b> {0}<br><b>To:</b> {1}<br><b>Provider:</b> {2}",Ext.Date.format(a.getValue(),"F j, Y"),Ext.Date.format(b.getValue(),"F j, Y"),d.get("fullname")),App.ux.grid.Printer.print(e))},onMeaningfulUseGridCellDblClick:function(a,b,c,d){this.doShowPatientList(a,b,c,d)},onMeaningfulUseRefreshBtnClick:function(){var a=this.getMeaningfulUseFromField(),b=this.getMeaningfulUseToField(),c=this.getMeaningfulUseProviderField(),d=this.getMeaningfulUseGrid().getStore();if(d.removeAll(),d.commitChanges(),a.isValid()&&b.isValid()&&c.isValid()){var e=c.getValue(),f=Ext.Date.format(a.getValue(),"Y-m-d"),g=Ext.Date.format(b.getValue(),"Y-m-d");this.doReportMeasureByDates(d,"ePrescribing",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"PatientEducation",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"ProvidePatientsElectronicAccess",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"ViewDownloadTransmit",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"SecureMessaging",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"PatientGeneratedHealthData",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"SupportElectronicReferralLoopsSending",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"ReceiveAndIncorporate",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"MedicationClinicalInformationReconciliation",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"CPOEMedications",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"CPOELaboratory",e,f,g,null,null,null,null),this.doReportMeasureByDates(d,"CPOERadiology",e,f,g,null,null,null,null)}},doReportMeasureByDates:function(a,b,c,d,e,f,g,h,i){var j=this;MeasureCalculation.getReportMeasureByDates(b,c,d,e,f,g,h,i,function(b){a.loadData(b,!0),j.doSortGridStoreBuffer(a)})},doSortGridStore:function(a){a.sort()},showMeasureCalculationPatientListWindow:function(a,b,c){var d=Ext.create("Ext.data.ArrayStore",{fields:[{name:"pid",type:"string"},{name:"pubpid",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"sex",type:"string"},{name:"DOB",type:"date",dateFormat:"Y-m-d H:i:s"}]});Ext.create("Ext.window.Window",{title:a+" ["+b.length+"]",width:800,height:500,layout:"fit",items:{xtype:"grid",store:d,columns:[{text:"ID",dataIndex:"pid",width:50},{text:"MRN",dataIndex:"pubpid",width:120},{text:"Name",dataIndex:"pubpid",flex:1,renderer:function(a,b,c){return Ext.String.format("{0}, {1} {2}",c.get("lname"),c.get("fname"),c.get("mname"))}},{text:"Sex",dataIndex:"sex",width:50},{xtype:"datecolumn",text:"DOB",format:"Y-m-d",dataIndex:"DOB"},{text:"Action",dataIndex:"pid",renderer:function(a){switch(c[a]){case"CCDA_VDT":return"VDT";case"CCDA_VDT_API":return"API";default:return"N/A"}}}]}}).show(),d.loadData(b)},doShowPatientList:function(a,b,c,d){var e,f=this,g=a.panel.columnManager.getHeaderAtIndex(c);if(("denominator"===g.dataIndex||"numerator"===g.dataIndex)&&(e=d.get(g.dataIndex+"_pids"),""!=e)){var h,i,j,k=d.get("numerator_types"),l={};if(k)for(k=k.split(","),i=k.length,h=0;i>h;h++)j=k[h].split("~"),l[j[0]]=j[1];MeasureCalculation.getPatientList(e,function(a){f.showMeasureCalculationPatientListWindow(Ext.String.capitalize(g.dataIndex)+" Patient List",a,l)})}}}),Ext.define("App.controller.administration.LegalLetters",{extend:"Ext.app.Controller",refs:[{ref:"AdministrationLegalLetters",selector:"#AdministrationLegalLetters"},{ref:"AdministrationLegalLettersGrid",selector:"#AdministrationLegalLettersGrid"},{ref:"AdministrationLegalLetterWindow",selector:"#AdministrationLegalLetterWindow"}],init:function(){var a=this;a.control({"#AdministrationLegalLetters":{activate:a.onAdministrationLegalLettersActivate},"#AdministrationLegalLettersGrid":{itemdblclick:a.onAdministrationLegalLettersGridItemDblClick},"#AdministrationLegalLettersAddBtn":{click:a.onAdministrationLegalLettersAddBtnClick},"#AdministrationLegalLetterCancelBtn":{click:a.onAdministrationLegalLetterCancelBtnClick},"#AdministrationLegalLetterSaveBtn":{click:a.onAdministrationLegalLetterSaveBtnClick}})},onAdministrationLegalLettersGridItemDblClick:function(a,b){var c=this.showAdministrationLegalLetterWindow();c.down("form").getForm().loadRecord(b)},onAdministrationLegalLetterCancelBtnClick:function(a){var b=a.up("window");b.down("form").getForm().reset(!0),this.getAdministrationLegalLettersGrid().getStore().rejectChanges(),b.close()},onAdministrationLegalLetterSaveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getRecord(),e=c.getValues();c.isValid()&&(d.set(e),d.store.getModifiedRecords().length>0?d.store.sync({callback:function(){b.close()}}):b.close())},onAdministrationLegalLettersActivate:function(){this.getAdministrationLegalLettersGrid().getStore().load()},onAdministrationLegalLettersAddBtnClick:function(){var a=this.showAdministrationLegalLetterWindow(),b=this.getAdministrationLegalLettersGrid().getStore().add({workflow:"PRE-REGISTRATION",days_valid_for:365,version:"1.0",active:!1});a.down("form").getForm().loadRecord(b[0])},showAdministrationLegalLetterWindow:function(){return this.getAdministrationLegalLetterWindow()||Ext.create("Ext.window.Window",{title:_("legal_letter"),layout:"fit",bodyPadding:5,width:800,itemId:"AdministrationLegalLetterWindow",items:[{xtype:"form",bodyPadding:10,items:[{xtype:"textfield",fieldLabel:_("title"),name:"title",anchor:"100%",allowBlank:!1},{xtype:"activefacilitiescombo",fieldLabel:_("facility"),name:"facility_id"},{xtype:"combobox",fieldLabel:_("workflow"),name:"workflow",editable:!1,store:["PRE-REGISTRATION"],allowBlank:!1},{xtype:"htmleditor",fieldLabel:_("content"),name:"content",height:400,anchor:"100%",allowBlank:!1},{xtype:"numberfield",fieldLabel:_("days_valid_for"),name:"days_valid_for",allowBlank:!1,minValue:-1,maxValue:9999},{xtype:"textfield",fieldLabel:_("version"),name:"version",allowBlank:!1},{xtype:"checkbox",fieldLabel:_("active"),name:"active"}]}],buttons:[{xtype:"button",text:_("cancel"),itemId:"AdministrationLegalLetterCancelBtn"},{xtype:"button",text:_("save"),itemId:"AdministrationLegalLetterSaveBtn"}]}),this.getAdministrationLegalLetterWindow().show()},patientTokens:function(){return["[PATIENT_NAME]","[PATIENT_ID]","[PATIENT_RECORD_NUMBER]","[PATIENT_FULL_NAME]","[PATIENT_LAST_NAME]","[PATIENT_SEX]","[PATIENT_BIRTHDATE]","[PATIENT_MARITAL_STATUS]","[PATIENT_SOCIAL_SECURITY]","[PATIENT_EXTERNAL_ID]","[PATIENT_DRIVERS_LICENSE]","[PATIENT_POSTAL_ADDRESS_LINE_ONE]","[PATIENT_POSTAL_ADDRESS_LINE_TWO]","[PATIENT_POSTAL_CITY]","[PATIENT_POSTAL_STATE]","[PATIENT_POSTAL_ZIP]","[PATIENT_POSTAL_COUNTRY]","[PATIENT_PHYSICAL_ADDRESS_LINE_ONE]","[PATIENT_PHYSICAL_ADDRESS_LINE_TWO]","[PATIENT_PHYSICAL_CITY]","[PATIENT_PHYSICAL_STATE]","[PATIENT_PHYSICAL_ZIP]","[PATIENT_PHYSICAL_COUNTRY]","[PATIENT_HOME_PHONE]","[PATIENT_MOBILE_PHONE]","[PATIENT_WORK_PHONE]","[PATIENT_EMAIL]","[PATIENT_MOTHERS_NAME]","[PATIENT_GUARDIANS_NAME]","[PATIENT_EMERGENCY_CONTACT]","[PATIENT_EMERGENCY_PHONE]","[PATIENT_PROVIDER]","[PATIENT_PHARMACY]","[PATIENT_AGE]","[PATIENT_OCCUPATION]","[PATIENT_EMPLOYER]","[PATIENT_RACE]","[PATIENT_ETHNICITY]","[PATIENT_LANGUAGE]","[PATIENT_PICTURE]","[PATIENT_QRCODE]","[FACILITY_NAME]","[FACILITY_PHONE]"]}}),Ext.define("App.controller.administration.TransactionLog",{extend:"Ext.app.Controller",refs:[{ref:"TransactionLogPanel",selector:"#TransactionLogPanel"},{ref:"TransactionLogFilterFormPanel",selector:"#TransactionLogFilterFormPanel"},{ref:"TransactionLogDataGrid",selector:"#TransactionLogDataGrid"},{ref:"TransactionLogFilterPanel",selector:"#TransactionLogFilterPanel"},{ref:"TransactionLogWindow",selector:"#TransactionLogWindow"},{ref:"TransactionLogDetailLogGrid",selector:"#TransactionLogDetailLogGrid"},{ref:"TransactionLogTabPanel",selector:"#TransactionLogTabPanel"},{ref:"AuditLogDataGrid",selector:"#AuditLogDataGrid"}],init:function(){var a=this;a.control({"#TransactionLogFilterSearchBtn":{click:a.onTransactionLogFilterSearchBtnClick},"#TransactionLogDataGrid":{itemdblclick:a.onTransactionLogDataGridItemDblClick},"#AuditLogWindowGrid":{itemdblclick:a.onAuditLogWindowGridDblClick}}),a.clockCtrl=a.getController("Clock")},onTransactionLogFilterSearchBtnClick:function(){var a=this.getTransactionLogFilterFormPanel().getForm(),b=this.getTransactionLogTabPanel(),c=b.getActiveTab(),d=c.getStore(),e=a.getValues();a.isValid()&&(d.getProxy().extraParams={filters:e},d.load())},onTransactionLogDataGridItemDblClick:function(a,b){this.doTransactionLogDetailByTableAndPk(b.get("table_name"),b.get("pk"),!1)},onAuditLogWindowGridDblClick:function(a,b){this.doTransactionLogDetailByTableAndPk(b.get("foreign_table"),b.get("foreign_id"),b.get("site"))},doTransactionLogDetailByTableAndPk:function(a,b,c){var d=this;TransactionLog.getTransactionLogDetailByTableAndPk(a,b,c,function(a){return 0==a.total?void app.msg(_("info"),_("no_record_fund")):(d.showTransactionLogWindow(),void d.setTransactionLogDetailGrid(a))})},setTransactionLogDetailGrid:function(response){response.table=response.table||"none",response.columns=response.columns||[],response.data=response.data||[];var me=this,model_name="App.model."+Ext.String.capitalize(response.table)+"_TransactionLogDetailModel",fields=["_id","_event_time","_event_type","_event_uid","_event_ip","_event_user_title","_event_user_fname","_event_user_mname","_event_user_lname",{name:"_event_user",convert:function(a,b){return b.get("_event_user_lname")+", "+b.get("_event_user_fname")+" "+b.get("_event_user_mname")}}],columns=[{text:_("event_info"),locked:!0,columns:[{text:"event_time",dataIndex:"_event_time",width:120},{text:"event_type",dataIndex:"_event_type",width:100},{text:"event_user",dataIndex:"_event_user",width:150},{text:"ip",dataIndex:"_event_ip",width:100}]},{text:_("record"),columns:[]}];fields=Ext.Array.merge(fields,response.columns),response.columns.forEach(function(a){columns[1].columns=Ext.Array.push(columns[1].columns,{text:a,dataIndex:a,width:200})}),eval(model_name)||Ext.define(model_name,{extend:"Ext.data.Model",fields:fields,idProperty:"_id"});var store=Ext.create("Ext.data.Store",{model:model_name,data:{data:response.data},autoLoad:!0,proxy:{type:"memory",reader:{type:"json",root:"data"}}});me.getTransactionLogDetailLogGrid().reconfigure(store,columns)},showTransactionLogWindow:function(){return this.getTransactionLogWindow()||Ext.create("Ext.window.Window",{layout:"fit",title:_("transactions"),itemId:"TransactionLogWindow",maximizable:!0,closeAction:"hide",items:[{xtype:"grid",height:400,width:1200,enableLocking:!0,itemId:"TransactionLogDetailLogGrid",viewConfig:{enableTextSelection:!0},columns:[{text:"",flex:1}]}]}),this.getTransactionLogWindow().show()}}),Ext.define("App.controller.administration.CronJob",{extend:"Ext.app.Controller",refs:[{ref:"CronJobPanel",selector:"cronjobpanel"},{ref:"CronJobGrid",selector:"cronjobpanel #CronJobGrid"}],init:function(){var a=this;a.control({cronjobpanel:{activate:a.onCronJobPanelActive},"#CronJobPanelKillProcessBtn":{click:a.onCronJobPanelKillProcessBtnClick}})},doGridRefresh:function(){this.getCronJobGrid().getStore().load()},onCronJobPanelActive:function(){this.doGridRefresh()},onCronJobPanelKillProcessBtnClick:function(a){var b=this,c=a.up("grid"),d=c.getSelectionModel().getSelection();if(0!==d.length){if(!d[0].get("running"))return void app.msg(_("oops"),"Process is not running",!0);if(""===d[0].get("pid"))return void app.msg(_("oops"),"Process PID missing",!0);var e=d[0].get("pid");Ext.Msg.show({title:"Wait!",msg:Ext.String.format("This action will kill process <b>{0}</b>, would you like to continue?",e),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&CronJob.killCronjob(d[0].data,function(a){a?(app.msg(_("sweet"),Ext.String.format("Process {0} Killed",e),!0),b.doGridRefresh()):app.msg(_("oops"),"Something went wrong killing the process",!0)})}})}}}),Ext.define("App.controller.dashboard.Dashboard",{extend:"Ext.app.Controller",refs:[{ref:"DashboardRenderPanel",selector:"#DashboardPanel"},{ref:"DashboardPanel",selector:"portalpanel"},{ref:"DashboardLeftColumn",selector:"#DashboardColumn1"},{ref:"DashboardRightColumn",selector:"#DashboardColumn2"}],addLeftPanel:function(a,b,c){var d;return d=c?this.getDashboardLeftColumn().insert(c,{xtype:"portlet",title:a,items:[b]}):this.getDashboardLeftColumn().add({xtype:"portlet",title:a,items:[b]})},addRightPanel:function(a,b,c){var d;return d=c?this.getDashboardRightColumn().insert(c,{xtype:"portlet",title:a,items:[b]}):this.getDashboardRightColumn().add({xtype:"portlet",title:a,items:[b]})},getColumns:function(){return this.getDashboardPanel().items}}),Ext.define("App.controller.dashboard.panel.NewResults",{extend:"App.controller.dashboard.Dashboard",init:function(){if(a("view_dashboard_new_results")){var b=this;b.control({portalpanel:{render:b.onDashboardPanelBeforeRender},"#DashboardPanel":{activate:b.onDashboardPanelActivate},"#DashboardNewResultsGrid":{itemdblclick:b.onDashboardNewResultsGridItemDoubleClick}}),b.addRef([{ref:"DashboardRenderPanel",selector:"#DashboardPanel"},{ref:"DashboardNewResultsGrid",selector:"#DashboardNewResultsGrid"}])}},onDashboardNewResultsGridItemDoubleClick:function(a,b){a.el.mask(_("please_wait")),app.setPatient(b.data.pid,null,null,function(){app.openPatientSummary(),app.onMedicalWin("laboratories"),a.el.unmask()})},onDashboardPanelActivate:function(){this.getDashboardNewResultsGrid().getStore().load()},onDashboardPanelBeforeRender:function(){this.addRightPanel(_("new_results"),Ext.create("App.view.dashboard.panel.NewResults"))}}),Ext.define("App.controller.areas.FloorPlan",{extend:"Ext.app.Controller",refs:[{ref:"FloorPlanPanel",selector:"#FloorPlanPanel"},{ref:"FloorPlanPatientZonePanel",selector:"#FloorPlanPatientZonePanel"},{ref:"FloorPlanAreasCombo",selector:"#FloorPlanAreasCombo"},{ref:"FloorPlanPatientZoneDetailWindow",selector:"#FloorPlanPatientZoneDetailWindow"},{ref:"FloorPlanPatientZoneDetailRemovePatientBtn",selector:"#FloorPlanPatientZoneDetailRemovePatientBtn"},{ref:"FloorPlanPatientZoneAssignmentWindow",selector:"#FloorPlanPatientZoneAssignmentWindow"},{ref:"FloorPlanPatientZoneAssignmentCombo",selector:"#FloorPlanPatientZoneAssignmentCombo"},{ref:"FloorPlanPatientProviderAssignmentCombo",selector:"#FloorPlanPatientProviderAssignmentCombo"}],init:function(){var a=this;a.control({"#FloorPlanPanel":{activate:a.onFloorPlanPanelActivate,deactivate:a.onFloorPlanPanelDeactivate},"#FloorPlanPatientZoneDetailRemovePatientBtn":{click:a.onFloorPlanPatientZoneDetailRemovePatientBtnClick},"#FloorPlanAreasCombo":{select:a.onFloorPlanAreasComboSelect},"#FloorPlanPatientZoneAssignmentCancelBtn":{click:a.onFloorPlanPatientZoneAssignmentCancelBtnClick},"#FloorPlanPatientZoneAssignmentSaveBtn":{click:a.onFloorPlanPatientZoneAssignmentSaveBtnClick},"#FloorPlanPatientZoneAssignmentCombo":{beforeselect:a.onFloorPlanPatientZoneAssignmentComboBeforeSelect}}),a.floorPlanZonesStore=Ext.create("App.store.administration.FloorPlanZones")},onFloorPlanPanelActivate:function(){null==this.getFloorPlanAreasCombo().getValue()?this.renderZones():this.setZones()},onFloorPlanPanelDeactivate:function(){this.getFloorPlanPatientZoneDetailWindow()&&this.getFloorPlanPatientZoneDetailWindow().close()},onFloorPlanPatientZoneDetailRemovePatientBtnClick:function(a){var b=this,c=a.up("window");b.unAssignPatient(c.zone,c.zone.data),c.close()},onFloorPlanAreasComboSelect:function(a,b){var c=this;c.loadZones(b[0],function(){c.setZones()})},renderZones:function(){var a=this,b=a.getFloorPlanAreasCombo();b.getStore().load({callback:function(c){c.length>0?(b.setValue(c[0].data.id),a.onFloorPlanAreasComboSelect(b,c)):(b.setValue(""),a.getFloorPlanPatientZonePanel().removeAll())}})},createZone:function(a){var b,c=this;b=c.getFloorPlanPatientZonePanel().add({xtype:"splitbutton",text:a.data.title,scale:a.data.scale,itemId:a.data.id,style:{"border-color":a.data.border_color,"background-color":a.data.bg_color},x:a.data.x,y:a.data.y,width:a.data.width,height:a.data.height,scope:c,handler:c.onZoneClicked,tooltip:_("patient_name")+": [empty]",listeners:{scope:c,render:c.initializeZone,arrowclick:c.onZoneArrowClicked},pid:null,zoneId:a.data.id,priority:null,patientZoneId:null}),b.record=a},loadZones:function(a,b){var c=this;c.getFloorPlanPatientZonePanel().removeAll(),c.floorPlanZonesStore.load({params:{floor_plan_id:a.data.id},scope:c,callback:function(a){for(var d=0;d<a.length;d++)c.createZone(a[d]);b()}})},initializeZone:function(a){var b=this;a.dragZone=Ext.create("Ext.dd.DragZone",a.getEl(),{ddGroup:"patientPoolAreas",getDragData:function(){var b,c=a.btnEl.dom;return c?(b=c.cloneNode(!0),b.id=Ext.id(),a.dragData={sourceEl:c,repairXY:Ext.fly(c).getXY(),ddel:b,patientData:a.data,zone:a}):!1},getRepairXY:function(){return this.dragData.repairXY},b4MouseDown:function(a){this.autoOffset(a.getPageX(),a.getPageY())}}),a.dragZone.lock(),a.dropZone=Ext.create("Ext.dd.DropZone",a.getEl(),{ddGroup:"patientPoolAreas",notifyOver:function(){return null==a.pid?Ext.dd.DropZone.prototype.dropAllowed:Ext.dd.DropZone.prototype.dropNotAllowed},notifyDrop:function(c,d,e){a.data=e.patientData,e.zone&&b.unAssignPatient(e.zone,a.data),b.assignPatient(a,a.data)}})},onZoneClicked:function(a){app.setPatient(a.data.pid,a.data.name,null,function(){a.data.eid?app.openEncounter(a.data.eid):app.openPatientSummary()})},onZoneArrowClicked:function(a){var b=this;if(b.getFloorPlanPatientZoneDetailWindow()||Ext.create("Ext.Window",{width:300,closeAction:"hide",itemId:"FloorPlanPatientZoneDetailWindow",tpl:new Ext.XTemplate('<div class="zoneSummaryContainer">   <div class="zoneSummaryArea">       <tpl if="this.patientImg(image)">','           <img src="{image}" height="96" width="96">       <tpl else>','           <img src="'+app.patientImage+'" height="96" width="96">',"       </tpl>","       <p>Name: {name}</p>       <p>DOB: {DOB}</p>       <p>Age: {age.str}</p>       <p>Sex: {sex}</p>   </div></div>",{patientImg:function(a){return null!=a&&""!=a}}),buttons:[{text:_("remove_patient"),itemId:"FloorPlanPatientZoneDetailRemovePatientBtn"}]}),a.data){var c=b.getFloorPlanPatientZoneDetailWindow();c.zone=a,c.update(a.data.patient),c.show(),c.alignTo(a.getEl(),"tl-tr?"),c.focus()}},assignPatient:function(a,b){var c=this,d={zone_id:a.zoneId,pid:b.pid};PatientZone.addPatientToZone(d,function(d){b.patientZoneId=d.data.id,app.msg("Sweet!",b.name+" "+_("successfully_moved")+"."),c.setZone(a,b)})},unAssignPatient:function(a,b){var c=this;PatientZone.removePatientFromZone({id:b.patientZoneId},function(){c.unSetZone(a)
})},setZone:function(a,b){a.pid=b.pid,a.priority=b.priority,a.patientZoneId=b.patientZoneId,a.dropZone&&a.dropZone.lock(),a.dragZone&&a.dragZone.unlock(),a.setTooltip(_("patient_name")+":"+b.name),a.addCls(b.priority),a.addCls("zone-in-use"),a.data=b},unSetZone:function(a){a.pid=null,a.data=null,a.dropZone&&a.dropZone.unlock(),a.dragZone&&a.dragZone.lock(),a.setTooltip(_("patient_name")+": [empty]"),a.removeCls(a.priority),a.removeCls("zone-in-use"),a.data=null},setZones:function(){var a,b,c=this,d=c.getFloorPlanPatientZonePanel(),e=c.getFloorPlanAreasCombo().getValue(),f=d.items.items;PatientZone.getPatientsZonesByFloorPlanId(e,function(e){f=d.items.items,b=e;for(var g=0;g<f.length;g++)c.unSetZone(f[g]);for(var h=0;h<b.length;h++)a=d.getComponent(b[h].zoneId),a.data=b[h],c.setZone(a,b[h])})},setFloorPlan:function(){},promptPatientZoneAssignment:function(a,b,c,d){var e=this;d||(e.getFloorPlanPatientZoneAssignmentWindow()||Ext.create("Ext.window.Window",{title:_("patient_zone_assignment"),itemId:"FloorPlanPatientZoneAssignmentWindow",items:[{xtype:"combobox",width:300,margin:10,itemId:"FloorPlanPatientZoneAssignmentCombo",queryMode:"local",valueField:"id",displayField:"display",fieldLabel:_("zone"),labelAlign:"top",editable:!1,store:Ext.create("Ext.data.Store",{sorters:[{property:"title"}],fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"display",type:"string",convert:function(a,b){return!b.get("is_multi_patient")&&b.get("in_use")>0?'<span style="text-decoration: line-through; color: #c1c1c1">'+b.data.title+"</span> ("+_("inuse")+")":b.data.title}},{name:"is_multi_patient",type:"bool"},{name:"in_use",type:"int"}]})},{xtype:"activeproviderscombo",margin:"0 10 10 10",width:300,fieldLabel:_("provider"),labelAlign:"top",itemId:"FloorPlanPatientProviderAssignmentCombo"}],buttons:[{text:_("cancel"),itemId:"FloorPlanPatientZoneAssignmentCancelBtn"},{text:_("save"),itemId:"FloorPlanPatientZoneAssignmentSaveBtn"}]}),FloorPlans.getFloorPlanZonesByFloorPlanId(b,function(a){var b=e.getFloorPlanPatientZoneAssignmentCombo();b.reset(),b.getStore().loadData(a)}),e.getFloorPlanPatientZoneAssignmentWindow().pid=a,e.getFloorPlanPatientZoneAssignmentWindow().area_id=c,e.getFloorPlanPatientZoneAssignmentWindow().show())},onFloorPlanPatientZoneAssignmentCancelBtnClick:function(){this.getFloorPlanPatientZoneAssignmentWindow().close()},onFloorPlanPatientZoneAssignmentSaveBtnClick:function(){var a=this.getFloorPlanPatientZoneAssignmentCombo().getValue(),b=this.getFloorPlanPatientProviderAssignmentCombo().getValue(),c=this.getFloorPlanPatientZoneAssignmentWindow();a&&null!=a&&PatientZone.addPatientToZone({zone_id:a,provider_id:b,pid:c.pid},function(){app.msg("Sweet!",_("patient_successfully_assigned_to_zone"))}),c.close()},onFloorPlanPatientZoneAssignmentComboBeforeSelect:function(a,b){return b.get("is_multi_patient")||0===b.get("in_use")}}),Ext.define("App.controller.areas.FloorPlansRules",{extend:"Ext.app.Controller",refs:[{ref:"FloorPlansRulesWindow",selector:"#FloorPlansRulesWindow"},{ref:"FloorPlansRulesGrid",selector:"#FloorPlansRulesGrid"},{ref:"FloorPlansRulesZoneCombo",selector:"#FloorPlansRulesZoneCombo"}],init:function(){var a=this;a.control({viewport:{appfacilitychanged:a.onAppFacilityChanged},"#PatientPoolAreasPanel":{activate:a.onFPatientPoolAreasPanelActivate},"#FloorPlansRulesWindow":{show:a.onFloorPlansRulesWindowShow},"#FloorPlansRulesCancelBtn":{click:a.onFloorPlansRulesCancelBtnClick},"#FloorPlansRulesSaveBtn":{click:a.onFloorPlansRulesSaveBtnClick},"#FloorPlansRulesGrid":{beforeedit:a.onFloorPlansRulesGridBeforeEdit,validateedit:a.onFloorPlansRulesGridEdit},"#PatientPoolAreasRulesBtn":{click:a.onPatientPoolAreasRulesBtnClick}})},onFPatientPoolAreasPanelActivate:function(a){a.reloadStores()},onPatientPoolAreasRulesBtnClick:function(){this.showFloorPlansRulesWindow()},onAppFacilityChanged:function(){this.doLoadRules()},onFloorPlansRulesGridBeforeEdit:function(a,b){var c=this.getFloorPlansRulesZoneCombo();c.store.load({params:{floor_plan_id:b.record.get("floor_plan_id")}})},onFloorPlansRulesGridEdit:function(a,b){var c=this.getFloorPlansRulesZoneCombo(),d=c.findRecordByValue(c.getValue());b.record.set({zone:d.get("title")})},onFloorPlansRulesWindowShow:function(){this.doLoadRules()},doLoadRules:function(){if(this.getFloorPlansRulesGrid()){var a=this.getFloorPlansRulesGrid().getStore();a.load({params:{facility_id:app.user.facility}})}},onFloorPlansRulesCancelBtnClick:function(a){this.getFloorPlansRulesGrid().getStore().rejectChanges(),a.up("window").close()},onFloorPlansRulesSaveBtnClick:function(a){this.getFloorPlansRulesGrid().getStore().sync({callback:function(){a.up("window").close()}})},showFloorPlansRulesWindow:function(){return this.getFloorPlansRulesWindow()||Ext.create("App.view.areas.FloorPlansRulesWindow"),this.getFloorPlansRulesWindow().show()}}),Ext.define("App.controller.areas.PatientPoolAreas",{extend:"Ext.app.Controller",refs:[{ref:"PatientPoolAreasPanel",selector:"#PatientPoolAreasPanel"},{ref:"PatientPoolAreasRemovePatientMenu",selector:"#PatientPoolAreasRemovePatientMenu"},{ref:"PatientToNextAreaWindow",selector:"#PatientToNextAreaWindow"},{ref:"PatientPoolAreasPanel",selector:"#PatientPoolAreasPanel"},{ref:"NavigationPatientPoolAreaDatView",selector:"#NavigationPatientPoolAreaDatView"},{ref:"NavigationPatientPoolAreaFloorPlanZonesCombo",selector:"#NavigationPatientPoolAreaFloorPlanZonesCombo"},{ref:"PatientPoolAreasDisableAlertColorsBtn",selector:"#PatientPoolAreasDisableAlertColorsBtn"}],init:function(){var a=this;a.control({"#PatientPoolAreasPanel grid":{beforeitemcontextmenu:a.onPatientPoolAreasGridBeforeItemContextMenu,beforerender:a.onPatientPoolAreasGridBeforeRender},"#PatientPoolAreasRemovePatientMenu":{click:a.onPatientPoolAreasRemovePatientMenuClick},"#PatientToNextAreaWindow":{render:a.onPatientToNextAreaWindowBeforeRender},"#PatientToNextAreaWindow button[action=poolarea]":{click:a.onPatientToNextAreaWindowPoolAreaBtnClick},"#PatientToNextAreaWindowCancelBtn":{click:a.onPatientToNextAreaWindowCancelBtnClick},"#HeaderSendToPoolAreaBtn":{click:a.onHeaderSendToPoolAreaBtnClick},"#NavigationPatientPoolAreaFloorPlanZonesCombo":{beforerender:a.onNavigationPatientPoolAreaFloorPlanZonesComboBeforeRender},"#PatientPoolAreasDisableAlertColorsBtn":{toggle:a.onPatientPoolAreasDisableAlertColorsBtnToggle}}),a.reloadAreaBuffer=Ext.Function.createBuffered(a.reloadArea,50,a)},onPatientPoolAreasDisableAlertColorsBtnToggle:function(a,b){var c=this.getPatientPoolAreasPanel().query("grid");c.forEach(function(a){a.showAlertColor=!b,a.view.refresh()})},onPatientPoolAreasGridBeforeRender:function(a){a.showAlertColor=!this.getPatientPoolAreasDisableAlertColorsBtn().pressed},getSelectedPoolAreaZones:function(){return this.getNavigationPatientPoolAreaFloorPlanZonesCombo().getValue()},onNavigationPatientPoolAreaFloorPlanZonesComboBeforeRender:function(a){a.store.load()},getPoolAreaIdByConcept:function(a){var b=this.getPatientPoolAreasPanel().getPageBody().down("container"),c=b.child("grid[floorPlanConcept="+a+"]");return c.floorPlanId||!1},onHeaderSendToPoolAreaBtnClick:function(){return app.patient.pid?void this.doSendPatientToNextArea(app.patient.pid,function(){app.openDashboard()}):void app.msg(_("oops"),_("no_patient_selected"),!0)},reRenderPoolAreas:function(){this.getPatientPoolAreasPanel().reRenderPoolAreas()},doSendPatientToNextArea:function(a,b){var c=this.showPatientToNextAreaWindow();c.pid=a,c.callback=b},onPatientToNextAreaWindowPoolAreaBtnClick:function(a){var b=a.up("window"),c=b.pid,d=b.callback,e=a.poolAreaId;b.close(),this.getPatientPoolAreasPanel().doSendPatientToPoolArea(c,e,d),app.patientPoolStore.reload()},onPatientToNextAreaWindowCancelBtnClick:function(a){a.up("window").close()},showPatientToNextAreaWindow:function(){return this.getPatientToNextAreaWindow()||Ext.create("Ext.window.Window",{itemId:"PatientToNextAreaWindow",title:_("send_patient_to_next_area"),layout:"hbox",closeAction:"hide",bodyPadding:"10 0 10 10",buttons:[{text:_("cancel"),itemId:"PatientToNextAreaWindowCancelBtn"}]}),this.getPatientToNextAreaWindow().show()},onPatientToNextAreaWindowBeforeRender:function(a){var b=this,c=b.getPatientPoolAreasPanel().getPoolAreas(),d=[];c.forEach(function(a){d=Ext.Array.push(d,{xtype:"button",text:"-> "+a.title,scale:"medium",width:100,action:"poolarea",poolAreaId:a.action,margin:"0 10 0 0"})}),a.add(d)},onPatientPoolAreasRemovePatientMenuClick:function(a){var b=this,c=a.up("menu").pool_view,d=c.store;Ext.Msg.show({title:_("wait"),msg:_("remove_patient_pool_area_msg"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){if("yes"===a){var e=c.getSelectionModel().getSelection();e.forEach(function(a){b.removePatientFromArea(a,d)})}}})},reloadArea:function(a){a.reload()},sendPatientToPoolArea:function(a,b,c,d){var e=this;PoolArea.sendPatientToPoolArea({pid:a,sendTo:b,appointment_id:c},function(c){return app.fireEvent("sendpatienttoarea",e,a,b,c),null==c.floor_plan_id?(app.unsetPatient(null,!0),app.nav.App_view_areas_PatientPoolAreas.reloadStores(),app.getPatientsInPoolArea(),void(d&&d(c))):(app.getController("areas.FloorPlan").promptPatientZoneAssignment(c.record.pid,c.floor_plan_id,b,c.zone),void(d&&d(c)))})},removePatientFromArea:function(a,b){var c=this,d={area_id:a.get("id")};PoolArea.removePatientArrivalLog(d,function(a){a.success&&c.reloadAreaBuffer(b)})},onPatientPoolAreasGridBeforeItemContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showPatientPoolAreasPanelGridMenu(a,e)},showPatientPoolAreasPanelGridMenu:function(a,b){var c=this;return c.grid_menu||(c.grid_menu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("remove_patient"),itemId:"PatientPoolAreasRemovePatientMenu",icon:"resources/images/icons/delete.png"}]})),c.grid_menu.pool_view=a,c.grid_menu.showAt(b.getXY()),c.grid_menu}}),Ext.define("App.controller.dashboard.panel.NotSignedVitals",{extend:"App.controller.dashboard.Dashboard",init:function(){if(a("view_dashboard_vitals_not_signed")){var b=this;b.control({portalpanel:{render:b.onDashboardPanelBeforeRender},"#DashboardPanel":{activate:b.onDashboardPanelActivate},"#DashboardNotSignedVitalsGrid":{selectionchange:b.onDashboardNotSignedVitalsGridSelectionChange,itemdblclick:b.onDashboardNotSignedVitalsGridClick},"#DashboardNotSignedVitalsSignBtn":{click:b.onDashboardNotSignedVitalsSignBtnClick}}),b.addRef([{ref:"PatientSummaryPanel",selector:"#PatientSummaryPanel"},{ref:"PatientSummaryPanelVitalsPanel",selector:"#PatientSummaryPanel vitalspanel"},{ref:"DashboardRenderPanel",selector:"#DashboardPanel"},{ref:"DashboardNotSignedVitalsGrid",selector:"#DashboardNotSignedVitalsGrid"},{ref:"DashboardNotSignedVitalsSignBtn",selector:"#DashboardNotSignedVitalsSignBtn"}])}},onDashboardNotSignedVitalsGridSelectionChange:function(a,b){this.getDashboardNotSignedVitalsSignBtn().setDisabled(0===b.length)},onDashboardNotSignedVitalsGridClick:function(a,b){var c=this;a.el.mask(_("please_wait")),app.setPatient(b.data.pid,null,null,function(){app.openPatientSummary(),a.el.unmask(),Ext.Function.defer(function(){c.getPatientSummaryPanel().tabPanel.setActiveTab(c.getPatientSummaryPanelVitalsPanel())},500)})},onDashboardPanelActivate:function(){this.getDashboardNotSignedVitalsGrid().getStore().load()},onDashboardPanelBeforeRender:function(){this.addLeftPanel(_("vitals_not_signed"),Ext.create("App.view.dashboard.panel.NotSignedVitals"))},onDashboardNotSignedVitalsSignBtnClick:function(){var a=this,b=this.getDashboardNotSignedVitalsGrid().getStore(),c=this.getDashboardNotSignedVitalsGrid().getSelectionModel().getSelection();0!==c.length&&app.passwordVerificationWin(function(d,e){"ok"===d&&User.verifyUserPass(e,function(d,e){e.result?(c.forEach(function(a){a.set({auth_uid:app.user.id})}),b.sync({callback:function(){b.reload()}})):Ext.Msg.show({title:"Oops!",msg:_("incorrect_password"),buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.ERROR,fn:function(b){"ok"===b&&a.onDashboardNotSignedVitalsSignBtnClick()}})})})}}),Ext.define("App.controller.miscellaneous.Amendments",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AmendmentsPanel",selector:"#AmendmentsPanel"},{ref:"AmendmentsGrid",selector:"#AmendmentsGrid"},{ref:"AmendmentDetailsWindow",selector:"#AmendmentDetailsWindow"},{ref:"AmendmentDetailsForm",selector:"#AmendmentDetailsForm"},{ref:"AmendmentDetailsDataGrid",selector:"#AmendmentDetailsDataGrid"},{ref:"AmendmentDetailsResponseMessageField",selector:"#AmendmentDetailsResponseMessageField"},{ref:"AmendmentDetailsApproveBtn",selector:"#AmendmentDetailsApproveBtn"},{ref:"AmendmentDetailsDenyBtn",selector:"#AmendmentDetailsDenyBtn"},{ref:"AmendmentDetailsResponseText",selector:"#AmendmentDetailsResponseText"},{ref:"AmendmentDetailsUserLiveSearch",selector:"#AmendmentDetailsUserLiveSearch"},{ref:"AmendmentDetailsAssignBtn",selector:"#AmendmentDetailsAssignBtn"}],init:function(){var b=this;if(b.control({"#AmendmentsPanel":{activate:b.onAmendmentsPanelActivate},"#AmendmentsGrid":{itemdblclick:b.onAmendmentsPanelItemDblClick},"#PatientAmendmentsPanel":{itemdblclick:b.onAmendmentsPanelItemDblClick},"#AmendmentDetailsDenyBtn":{click:b.onAmendmentDetailsDenyBtnClick},"#AmendmentDetailsApproveBtn":{click:b.onAmendmentDetailsApproveBtnClick},"#AmendmentDetailsAssignBtn":{click:b.onAmendmentDetailsAssignBtnClick}}),a("amendments_access")){b.cronSkip=2;var c=App.app.getController("Cron"),d=2;c.checkForUnreadAmendments=function(){d++,d&&d%b.cronSkip!==0||Amendments.getUnViewedAmendments(a("amendments_view_unassigned"),function(a){if(a.total>0){for(var b=[],c=0;c<a.data.length;c++)Ext.Array.push(b,a.data[c].id);app.notification.add("new_amendment_notification",_("pending_amendment")+" ("+a.total+")",b,"miscellaneous.Amendments","onNewAmendmentClick")}else app.notification.remove("new_amendment_notification")})},c.addCronFn("me.checkForUnreadAmendments()")}},onAmendmentsPanelActivate:function(){var b=this.getAmendmentsGrid().getStore(),c=[{property:"assigned_to_uid",value:app.user.id}];b.clearFilter(!0),a("amendments_view_unassigned")&&Ext.Array.push(c,{property:"assigned_to_uid",value:"0"}),b.filter(c)},updateIsViewed:function(a){a.data.is_viewed===!1&&Amendments.updateAmendment({id:a.data.id,is_viewed:!0})},updateIsRead:function(a){a.data.is_read===!1&&Amendments.updateAmendment({id:a.data.id,is_read:!0})},onNewAmendmentClick:function(){this.getController("Navigation").goTo("App.view.miscellaneous.Amendments")},onAmendmentsPanelItemDblClick:function(b,c){this.getAmendmentDetailsWindow()||Ext.create("App.view.miscellaneous.AmendmentDetails"),this.getAmendmentDetailsWindow().show();var d=this,e=d.getAmendmentDetailsForm().getForm(),f=d.getAmendmentDetailsDataGrid(),h=f.getStore(),i=[];if(Ext.Object.each(c.data.amendment_data,function(a,b){for(var c=0;c<b.length;c++)b[c].data_key=a,b[c].approved=!0,Ext.Array.push(i,b[c])}),h.removeAll(),i.length>0?(f.show(),h.loadData(i)):f.hide(),d.getAmendmentDetailsUserLiveSearch().reset(),e.reset(!0),e.loadRecord(c),"W"===c.data.amendment_status)d.getAmendmentDetailsUserLiveSearch().setVisible(a("amendments_assign")),d.getAmendmentDetailsAssignBtn().setVisible(a("amendments_assign")),d.getAmendmentDetailsApproveBtn().setDisabled(!0),d.getAmendmentDetailsDenyBtn().setDisabled(!a("amendments_response")),d.getAmendmentDetailsResponseText().hide(),d.getAmendmentDetailsResponseText().setText(""),app.setPatient(c.data.pid,null,null,function(b){return null===b.pid?(app.msg(_("oops"),_("patient_not_found"),!0),void d.getAmendmentDetailsApproveBtn().setDisabled(!a("amendments_response"))):(d.getAmendmentDetailsApproveBtn().setDisabled(!1),void app.openPatientSummary())});else{d.getAmendmentDetailsUserLiveSearch().setVisible(!1),d.getAmendmentDetailsAssignBtn().setVisible(!1),d.getAmendmentDetailsApproveBtn().setDisabled(!0),d.getAmendmentDetailsDenyBtn().setDisabled(!0),d.getAmendmentDetailsResponseText().show();var j="";"A"==c.data.amendment_status?j+=_("approved")+" - "+Ext.Date.format(c.data.response_date,g("date_time_display_format")):"D"==c.data.amendment_status?j+=_("denied")+" - "+Ext.Date.format(c.data.response_date,g("date_time_display_format")):"C"==c.data.amendment_status&&(j+=_("canceled")+" - "+Ext.Date.format(c.data.cancel_date,g("date_time_display_format"))),d.getAmendmentDetailsResponseText().setText(j)}},onAmendmentDetailsDenyBtnClick:function(){var a=this.getAmendmentDetailsForm().getForm(),b=a.getRecord(),c=this.getAmendmentDetailsResponseMessageField(),d=this.getAmendmentDetailsDataGrid().getStore(),e=d.data.items,f={};if(c.allowBlank=!1,c.isValid()){if(e.length>0)for(var g=0;g<e.length;g++){e[g].set({approved:!1});var h=e[g].data.data_key;f[h]||(f[h]=[]),delete e[g].data.data_key,Ext.Array.push(f[h],e[g].data)}b.set({amendment_data:f,is_synced:!1,response_uid:app.user.id,response_date:new Date,update_uid:app.user.id,update_date:new Date,amendment_status:"D",response_message:this.getAmendmentDetailsResponseMessageField().getValue()}),b.save({callback:function(){app.msg(_("sweet"),_("record_saved"))}}),this.getAmendmentDetailsWindow().close()}},onAmendmentDetailsApproveBtnClick:function(){var a=this,b=a.getAmendmentDetailsForm().getForm(),c=b.getRecord(),d=a.getAmendmentDetailsResponseMessageField(),e=a.getAmendmentDetailsDataGrid().getStore(),f=e.data.items,g={};d.allowBlank=!0,Ext.Msg.show({title:_("wait"),msg:_("amendment_approval_confirmation"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){if("yes"==b){if(f.length>0)for(var d=0;d<f.length;d++){var e=f[d].data.data_key;g[e]||(g[e]=[]),delete f[d].data.data_key,Ext.Array.push(g[e],f[d].data)}c.set({amendment_data:g,is_synced:!1,response_uid:app.user.id,response_date:new Date,update_uid:app.user.id,update_date:new Date,amendment_status:"A",response_message:a.getAmendmentDetailsResponseMessageField().getValue()}),a.doUpdatePatientData(g,c.data.pid,c.data.eid),c.save({callback:function(){app.msg(_("sweet"),_("record_saved")),app.setPatient(c.data.pid,null,null,function(){app.openPatientSummary()})}}),a.getAmendmentDetailsWindow().close()}}})},onAmendmentDetailsAssignBtnClick:function(){var a=this,b=a.getAmendmentDetailsForm().getForm().getRecord(),c=a.getAmendmentDetailsUserLiveSearch(),d=c.getValue();c.isValid()&&(a.getAmendmentDetailsWindow().mask(_("saving")),b.set({assigned_date:new Date,assigned_to_uid:d}),b.save({success:function(){app.msg(_("sweet"),_("amendment_assigned")),a.getAmendmentDetailsWindow().unmask(),a.getAmendmentDetailsWindow().close()},failure:function(){app.msg(_("opps"),_("record_error"),!0),a.getAmendmentDetailsWindow().unmask()}}))},doUpdatePatientData:function(a){if(a.demographics){var b=app.getActivePanel();if("PatientSummaryPanel"==b.itemId){for(var c={},d=0;d<a.demographics.length;d++)c[a.demographics[d].field_name]=a.demographics[d].new_value;app.patient.record.set(c),app.patient.record.save()}}}}),Ext.define("App.controller.dashboard.panel.DailyVisits",{extend:"App.controller.dashboard.Dashboard",init:function(){if(a("view_dashboard_daily_visits")){var b=this;b.control({portalpanel:{render:b.onDashboardPanelBeforeRender},"#DashboardPanel":{activate:b.onDashboardPanelActivate}}),b.addRef([{ref:"DashboardRenderPanel",selector:"#DashboardPanel"},{ref:"DashboardDailyVisitsChart",selector:"#DashboardDailyVisitsChart"}])}},onDashboardPanelActivate:function(){this.loadChart()},onDashboardPanelBeforeRender:function(){this.addRightPanel(_("daily_visits"),Ext.create("App.view.dashboard.panel.DailyVisits"))},loadChart:function(){var a=this,b=a.getDashboardDailyVisitsChart().getStore();Encounter.getDashboardTodayEncounters(function(a){b.loadData(a),say(b)})}}),Ext.define("App.controller.dashboard.panel.OpenEncounters",{extend:"App.controller.dashboard.Dashboard",init:function(){if(a("view_dashboard_open_encounters")){var b=this;b.control({portalpanel:{render:b.onDashboardPanelBeforeRender},"#DashboardPanel":{activate:b.onDashboardPanelActivate},"#DashboardOpenEncountersGrid":{itemdblclick:b.onDashboardOpenEncountersGridClick}}),b.addRef([{ref:"PatientSummaryPanel",selector:"#PatientSummaryPanel"},{ref:"DashboardRenderPanel",selector:"#DashboardPanel"},{ref:"DashboardOpenEncountersGrid",selector:"#DashboardOpenEncountersGrid"}])}},onDashboardOpenEncountersGridClick:function(a,b){a.el.mask(_("please_wait")),app.setPatient(b.data.pid,null,null,function(){app.openEncounter(b.data.eid),a.el.unmask()})},onDashboardPanelActivate:function(){this.getDashboardOpenEncountersGrid().getStore().load({params:{provider_uid:app.user.id}})},onDashboardPanelBeforeRender:function(){this.addLeftPanel(_("open_encounters"),Ext.create("App.view.dashboard.panel.OpenEncounters"))}}),Ext.define("App.controller.BarcodeScanner",{extend:"Ext.app.Controller",requires:[],refs:[],socket:void 0,host:"local.tranextgen.com",port:9797,connected:!1,waiting:!1,callback:void 0,reconnect_interval:5e3,connect_delay:1e4,debug:!1,initiated:!1,init:function(){var a=this;Ext.Function.defer(a.connect,a.connect_delay,a)},connect:function(){var a=this;a.socket||(a.socket=new WebSocket("wss://"+a.host+":"+a.port+"/"),a.socket.onopen=function(b){a.onOpen(b.data)},a.socket.onclose=function(b){a.onClose(b.data)},a.socket.onmessage=function(b){a.onMessage(b.data)},a.socket.onerror=function(b){a.onError(b.data)})},reconnect:function(){var a=this;a.initiated&&(this.log("reconnect"),a.connected=!1,delete a.socket,Ext.Function.defer(function(){a.connect()},a.reconnect_interval))},send:function(a,b){this.socket.send(a),this.callback=b},onOpen:function(a){this.log("onOpen"),this.log(a),this.initiated=!0,this.connected=!0,Ext.Function.defer(function(){app.fireEvent("barcodescanneropen",this)},1e3,this)},onClose:function(a){this.log("onClose"),this.log(a),this.reconnect(),Ext.Function.defer(function(){app.fireEvent("barcodescannerclose",this)},1e3,this)},onMessage:function(a){this.log("onMessage"),this.log(a),a=JSON.parse(a),a.action&&"barcode"===a.action?-1!==a.data.search(/ANSI \d/)?app.fireEvent("barcodelicensescanned",a.data):app.fireEvent("barcodescanned",a.data):this.callback&&(this.callback(a),this.callback=void 0)},onError:function(a){this.log("onError"),this.log(a),this.reconnect()},log:function(a){this.debug&&say(a)},sendMessage:function(a,b){this.connected?this.send(JSON.stringify(a),b):app.msg(_("oops"),_("not_conneted"),!0)}}),Ext.define("App.controller.Clock",{extend:"Ext.app.Controller",refs:[{ref:"ApplicationClockContainer",selector:"#ApplicationClockContainer"}],init:function(){var a=this;a.control({"#ApplicationClockContainer":{render:a.initClock}}),a.cronTask={scope:a,run:function(){a.clock.el.dom.firstChild.firstChild.innerHTML=Ext.Date.format(a.date,"F j, Y, g:i:s a"),a.date=Ext.Date.add(a.date,Ext.Date.SECOND,1)},interval:1e3}},initClock:function(a){this.clock=a,this.date=new Date,Ext.TaskManager.start(this.cronTask)},updateClock:function(a){this.date=new Date(a.year,a.mon-1,a.mday,a.hours,a.minutes,a.seconds)},getTime:function(){return Ext.clone(this.date)},getDate:function(){return this.getTime()}}),Ext.define("App.controller.Cron",{extend:"Ext.app.Controller",cronTaskInterval:15,fns:["app.getPatientsInPoolArea()","me.checkSession()","me.getTime()"],init:function(){var me=this,i;me.clock=me.getController("Clock"),me.cronTask={scope:me,run:function(){for(i=0;i<me.fns.length;i++)eval(me.fns[i])},interval:1e3*me.cronTaskInterval}},start:function(){Ext.TaskManager.start(this.cronTask)},stop:function(){Ext.TaskManager.stop(this.cronTask)},addCronFn:function(a){this.fns.push(a)},removeCronFn:function(a){Ext.Array.remove(this.fns,a)},checkSession:function(){authProcedures.ckAuth(function(a){app.setIpAddress(a.ip),a.authorized||window.location.reload()})},getTime:function(){var a=this;AppDate.getDate(function(b){a.clock.updateClock(b)})}}),Ext.define("App.controller.DualScreen",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"DualViewport",selector:"#dualViewport"},{ref:"Header",selector:"#RenderPanel-header"},{ref:"TabPanel",selector:"#dualViewport tabpanel"},{ref:"ApplicationDualScreenBtn",selector:"#ApplicationDualScreenBtn"}],isDual:!1,appMask:null,pid:null,init:function(){var a=this;a._loggedout=!1,a._enable=!1,a._screen=null,a.control({"#ApplicationDualScreenBtn":{toggle:a.onApplicationDualScreenBtnToggle},"#dualViewport":{render:a.onDualViewportRender,beforerender:a.onDualViewportBeforeRender}})},onApplicationDualScreenBtnToggle:function(a){a.pressed?this.startDual():this.stopDual()},startDual:function(){var a=this;a.enable(),(null==a._screen||a._screen.closed)&&(a._screen=window.open("./?site="+app.user.site+"&dual=true","_target","fullscreen=yes,menubar=no",!0))},stopDual:function(){this.disable(),this._screen=null},enable:function(){app._dual_enable=!0,this._enable=!0},disable:function(){app._dual_enable=!1,this._enable=!1},isEnabled:function(){return this._enable},onDualViewportBeforeRender:function(){this.isDual=!0,window.app=window.opener.app},onDualViewportRender:function(){Ext.get("mainapp-loading").remove(),Ext.get("mainapp-loading-mask").fadeOut({remove:!0}),this.onPatientUnset(!1),this.initHandShakeTask()},onPatientSet:function(){var a,b;this.isDual&&!this._loggedout&&(a=app.patient.name+" - #"+app.patient.pid+" - "+app.patient.age.str,b=this.getActiveStore(),this.unmask(),this.getHeader().update(a),b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}]))},onPatientUnset:function(a){var b;this.isDual&&!this._loggedout&&(b=this.getActiveStore(),this.mask(_("no_patient_selected")),this.getHeader().update(""),a!==!1&&(b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])))},getActiveStore:function(){var a=this.getTabPanel().getActiveTab();return a.getStore?a.getStore():"patientdocumentspanel"==a.xtype||"patientimmunizationspanel"==a.xtype||"patientmedicationspanel"==a.xtype||"patientimmunizationspanel"==a.xtype?a.down("grid").getStore():void 0},mask:function(a){var b=this;null==b.appMask?b.appMask=new Ext.LoadMask(b.getDualViewport(),{msg:'<img height="190" width="190" src="resources/images/logo_190_190.jpg"><p>'+a+"</p>",maskCls:"dualAppMask",cls:"dualAppMaskMsg",autoShow:!0}):(b.appMask.show(),b.appMask.msgEl.query("p")[0].innerHTML=a)},unmask:function(){this.appMask&&this.appMask.hide()},initHandShakeTask:function(){var a=this,b={run:function(){null!=window.opener&&window.app._dual_enable?window.opener.app.logged||a._loggedout?null===window.opener.app.patient.pid?(a.pid=null,a.onPatientUnset()):window.opener.app.patient.pid!==a.pid&&(a.pid=Ext.clone(window.opener.app.patient.pid),a.onPatientSet(!0)):(a.pid=null,a.mask(_("logged_out")),a._loggedout=!0):(window.app=null,a.pid=null,window.close())},interval:1e3,scope:a};Ext.TaskManager.start(b)}}),Ext.define("App.controller.AlwaysOnTop",{extend:"Ext.app.Controller",alwaysOnTopManager:null,init:function(){this.control({"component{isFloating()}":{render:function(a,b){this.onComponentRender(a,b)}}})},onComponentRender:function(a){a.alwaysOnTop&&(this.alwaysOnTopManager||(this.alwaysOnTopManager=Ext.create("Ext.ZIndexManager")),this.alwaysOnTopManager.register(a)),this.alwaysOnTopManager&&Ext.ZIndexManager.zBase>this.alwaysOnTopManager.zseed&&(this.alwaysOnTopManager.zseed=this.alwaysOnTopManager.getNextZSeed())}}),Ext.define("App.controller.Navigation",{extend:"Ext.app.Controller",requires:["Ext.util.History"],refs:[{ref:"viewport",selector:"viewport"},{ref:"mainNavPanel",selector:"panel[action=mainNavPanel]"},{ref:"mainNav",selector:"treepanel[action=mainNav]"},{ref:"patientPoolArea",selector:"panel[action=patientPoolArea]"},{ref:"appFooter",selector:"container[action=appFooter]"},{ref:"appFooterDataView",selector:"container[action=appFooter] > dataview"}],navKey:"ALT",navKeysEnabled:!1,init:function(){var a=this;a.navKey=this.setNavKey(this.navKey),a.activePanel=null,a.altIsDown=!1,Ext.util.History.init(),Ext.util.History.on("change",a.urlChange,a),a.navKeysEnabled&&a.enableNavKeys(),a.control({viewport:{patientset:a.onPatientSet,patientunset:a.onPatientUnset},"treepanel[action=mainNav]":{selectionchange:a.onNavigationNodeSelected,beforerender:a.onNavigationBeforeRender},"panel[action=mainNavPanel]":{render:a.onNavRender,beforecollapse:a.onNavCollapsed,beforeexpand:a.onNavExpanded}})},getTopNavigation:function(){return app},onNavigationBeforeRender:function(a){a.getStore().on("load",this.afterNavigationLoad,this)},navigateToDefault:function(){this.navigateTo("App.view.dashboard.Dashboard")},navigateTo:function(a,b,c){var d=c!==!0?this.getUrlParams():[];d[0]=a,this.setUrlParams(d),"function"==typeof b&&b(!0)},goTo:function(a,b,c){this.navigateTo(a,b,c)},onNavigationNodeSelected:function(a,b){0<b.length&&b[0].data.leaf&&this.navigateTo(b[0].data.id)},afterNavigationLoad:function(){var a=this;app.removeAppMask(),a.navigateToDefault(),Ext.Function.defer(function(){a.doSortCategory("administration")},500)},doSortCategory:function(a){var b=this.getMainNav().getStore().getNodeById(a);b&&b.sort(function(a,b){var c=a.get("text"),d=b.get("text");return c>d?1:d>c?-1:0})},setUrlParams:function(a){var b="#!/";a.length>0&&(b+=a.join("/")),window.location=b},getUrlParams:function(){return window.location.hash?window.location.hash.substring(1).replace(/!\//,"").split("/"):[]},getUrlCls:function(){return this.getUrlParams()[0]},urlChange:function(a){var b=this,c=b.getMainNav(),d=c.getStore(),e=b.getUrlCls(),f=b.getNavRefByClass(e),g=b.getViewport().MainPanel.getLayout(),h=c.getSelectionModel(),i=d.getNodeById(e);this.url=a,i?h.select(i):h.deselectAll(),"App.view.login.Login"!=e&&("undefined"==typeof b[f]?b[f]=b.getViewport().MainPanel.add(Ext.create(e)):b[f].isDestroyed&&b[f].render(),b.getViewport().fireEvent("beforenavigation",b[f]),b[f].onActive(function(a){a&&(b.activePanel=g.setActiveItem(b[f]))}),b.getViewport().fireEvent("afternavigation",b[f]),app.doLayout())},goBack:function(){Ext.util.History.back()},getPanelByCls:function(a){var b=this,c=b.getNavRefByClass(a);return"undefined"==typeof b[c]?b[c]=b.getViewport().MainPanel.add(Ext.create(a)):b[c]},getNavRefByClass:function(a){return a.replace(/\./g,"_")},getClassByNavRef:function(a){return a.replace(/_/g,".")},onNavRender:function(a){a.collapsed?this.onNavCollapsed():this.onNavExpanded()},onNavCollapsed:function(){var a=this,b=a.getPatientPoolArea(),c=a.getAppFooter(),d=a.getAppFooterDataView();d&&(c.setHeight(60),d.show()),a.getMainNavPanel().isCollapsed=!0,b.hide()},onNavExpanded:function(){var a=this,b=a.getPatientPoolArea(),c=a.getAppFooter(),d=a.getAppFooterDataView();d&&(c.setHeight(30),d.hide()),a.getMainNavPanel().isCollapsed=!1,b.show()},onPatientSet:function(){},onPatientUnset:function(){},captureDownKey:function(a){return a.getKey()==a.ALT?void(this.altIsDown=!0):void(this.altIsDown&&this.getViewport().fireEvent("navkey",a,a.getKey()))},captureUpKey:function(a){a.getKey()==a.ALT&&(this.altIsDown=!1)},setNavKey:function(a){return this.navKey=Ext.EventObjectImpl[a]},getNavKey:function(){return this.navKey},getExtraParams:function(){for(var params=this.getUrlParams(),i=0;i<params.length;i++)if(params[i].match(/^{.*}$/))return eval("("+params[i]+")");return!1},enableNavKeys:function(){Ext.getBody().on("keydown",this.captureDownKey,this),Ext.getBody().on("keyup",this.captureUpKey,this)},disabledNavKeys:function(){Ext.getBody().un("keydown",this.captureDownKey,this),Ext.getBody().un("keyup",this.captureUpKey,this)},addNavigationNodes:function(a,b,c){var d,e,f,g,h,i=this.getMainNav();if(!i)return void Ext.Function.defer(function(){this.addNavigationNodes(a,b,c)},5e3,this);if(h=i.getStore(),!h)return void Ext.Function.defer(function(){this.addNavigationNodes(a,b,c)},1e4,this);if(d="root"==a||null==a?h.getRootNode():h.getNodeById(a),say("addNavigationNodes"),say(d),d){if(e=d.findChildBy(function(a){return a.hasChildNodes()}),Ext.isArray(b)){for(f=[],g=0;g<b.length;g++)Ext.Array.push(f,d.insertBefore(b[g],e));return f}return c?d.insertChild(c,b):d.insertBefore(b,e)}}}),Ext.define("App.controller.Header",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AppHeaderRight",selector:"#AppHeaderRight"},{ref:"AppHeaderLeft",selector:"#AppHeaderLeft"}],init:function(){},addHeaderBtn:function(a,b,c){a=a||{},b=b||"left",c=c||0;
var d="left"==b?this.getAppHeaderLeft():this.getAppHeaderRight(),e=Ext.apply(a,{xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0});d.insert(c,e)}}),Ext.define("App.controller.KeyCommands",{extend:"Ext.app.Controller",refs:[{ref:"viewport",selector:"viewport"}],enabled:!1,init:function(){this.enableKeyCommands()},enableKeyCommands:function(){this.enabled||(Ext.getBody().on("keyup",this.onKeyUp,this),this.enabled=!0)},disableKeyCommands:function(){Ext.getBody().un("keyup",this.onKeyUp,this),this.enabled=!1},onKeyUp:function(a,b){if(a.getKey()!=a.ALT&&a.getKey()!=a.CTRL&&a.getKey()!=a.SHIFT){if(a.altKey||a.ctrlKey||a.shiftKey){var c="KEY-";a.altKey&&(c+="ALT-"),a.ctrlKey&&(c+="CTRL-"),a.shiftKey&&(c+="SHIFT-"),c+=String.fromCharCode(a.getCharCode()),app.fireEvent(c,a,b)}if(a.altKey&&a.ctrlKey&&a.shiftKey){var d="";if(a.getKey()==a.A)d="allergies";else if(a.getKey()==a.I)d="immunization";else if(a.getKey()==a.M)d="medications";else if(a.getKey()==a.P)d="activeproblems";else if(a.getKey()==a.R)d="laboratories";else if(a.getKey()==a.C)d="social";else if(a.getKey()==a.W){var e=Ext.getCmp(a.getTarget(null,null,!0).id);if("window"==e.xtype)e.close();else{var f=e.up("window");f&&f.close()}return}""!=d&&app.onMedicalWin(d)}}}}),Ext.define("App.controller.InfoButton",{extend:"Ext.app.Controller",requires:[],language:"patient",init:function(){var a=this;a.medline="http://apps2.nlm.nih.gov/medlineplus/services/mpconnect.cfm?",a.codeSytem={ICD10CM:"2.16.840.1.113883.6.90","ICD10-CM":"2.16.840.1.113883.6.90","ICD-10-CM":"2.16.840.1.113883.6.90",ICD9CM:"2.16.840.1.113883.6.103","ICD9-CM":"2.16.840.1.113883.6.103","ICD-9-CM":"2.16.840.1.113883.6.103",SNOMED:"2.16.840.1.113883.6.96",SNOMEDCT:"2.16.840.1.113883.6.96","SNOMED-CT":"2.16.840.1.113883.6.96",RXCUI:"2.16.840.1.113883.6.88",NDC:"2.16.840.1.113883.6.69",LN:"2.16.840.1.113883.6.1",LOINC:"2.16.840.1.113883.6.1"},a.control({})},doGetInfo:function(a,b){var c=this,d=c.medline;d+="mainSearchCriteria.v.c="+a,d+="&mainSearchCriteria.v.cs="+c.codeSytem[b],d+="patient"==c.language&&app.patient.record&&"spa"==app.patient.record.get("language")?"&informationRecipient.languageCode.c=es":"&informationRecipient.languageCode.c=en",window.open(d,"_blank","toolbar=no, scrollbars=yes, resizable=yes, top=10, left=10, width=1000, height=600")},doGetInfoByUrl:function(a){window.open(a,"_blank","toolbar=no, scrollbars=yes, resizable=yes, top=10, left=10, width=1000, height=600")},getInformationWindow:function(a){Ext.widget("window",{title:_("information"),autoShow:!0,width:800,height:600,data:a,autoScroll:!0,tpl:new Ext.XTemplate('<div class="externalinfo-container"><h1>{feed.title._value}</h1><h2>{feed.subtitle._value}</h2><p><span>Author:</span> {feed.author.name._value}</h1><p><span>Updated:</span> {feed.updated._value}</h1><div class="entries">   <tpl for="feed.entry"><div class="externalinfo-entry"><h3><a href="{link.href}">{title._value}</a></h3>{summary._value}</div>   </tpl></div></div>')})}}),Ext.define("App.controller.Labels",{extend:"Ext.app.Controller",requires:[],refs:[],browserHelperCtl:void 0,init:function(){var a=this;a.control({"#PatientSummaryImagesPanel":{beforerender:a.onPatientSummaryImagesPanelBeforeRender}})},onPatientSummaryImagesPanelBeforeRender:function(a){var b=this;a.addDocked({xtype:"toolbar",dock:"bottom",items:[{xtype:"button",text:"Postal Label 1 1/8 x 3 1/2",icon:"modules/worklist/resources/images/barcode.png",action:"1.1250-3.5-1",flex:1,scope:b,handler:b.onLabelBtnHandler}]},0)},onLabelBtnHandler:function(a){var b=a.action.split("-"),c=a.up("form").getForm().getRecord(),d=this.getDemographicsLabelsData(c);return d===!1?void app.msg(_("oops"),_("no_order_selected"),!0):void Labels.CreateLabel("patient",d,b[0],b[1],300,function(a){var b=[],c=0,d=0;0===c&&(c+=a.width/3),d+=a.height/3,b.push({xtype:"image",margin:2,base64data:a.base64data,src:"data:image/jpg;base64,"+a.base64data,width:a.width/3,height:a.height/3}),d+=4,c+=10,d=250>d?d+62:350,Ext.create("Ext.window.Window",{title:_("patient")+" "+_("postal_address"),layout:{type:"vbox",align:"stretch"},items:b,autoScroll:!0,width:c,height:d,buttons:[{xtype:"printerscombo",itemId:"WorkListOrderPrintersCombo"},"->",{text:_("print"),itemId:"WorkListOrderPrintBtn"}]}).show()})},getDemographicsLabelsData:function(a){if(!a)return!1;var b=app.calculateAge(app.getDate(),a.get("DOB"));return say(a),{"[PATIENT_NAME]":Ext.String.format("{0}, {1} {2}",a.get("lname"),a.get("fname"),a.get("mname")).trim(),"[RECORD_NUMBER]":a.get("pubpid"),"[PATIENT_AGE]":b+" yrs","[PATIENT_SEX]":a.get("sex"),"[PATIENT_POSTAL_ADDRESS1]":a.get("postal_address"),"[PATIENT_POSTAL_ADDRESS2]":a.get("postal_address_cont"),"[PATIENT_POSTAL_CITY]":a.get("postal_city"),"[PATIENT_POSTAL_STATE]":a.get("postal_state"),"[PATIENT_POSTAL_ZIP]":a.get("postal_zip")}}}),Ext.define("App.controller.LogOut",{extend:"Ext.app.Controller",requires:["App.ux.ActivityMonitor"],refs:[{ref:"ApplicationLockWindow",selector:"#ApplicationLockWindow"},{ref:"ApplicationLockWindowPingField",selector:"#ApplicationLockWindowPingField"}],lockMask:void 0,init:function(){var me=this;me.activityMonitorInterval=10,me.activityMonitorMaxInactive=eval(g("timeout")),me.activityMonitorMaxLock=eval(g("lockscreen")),me.cron=me.getController("Cron"),me.control({"treepanel[action=mainNav]":{beforerender:me.onNavigationBeforeRender},"menuitem[action=logout]":{click:me.appLogout},"#ApplicationLockWindowPingField":{keyup:me.onApplicationLockWindowPingFieldKeyUp},"#ApplicationLockWindowLogoutBtn":{click:me.onApplicationLockWindowLogoutBtnClick},"#ApplicationLockWindowOkBtn":{click:me.onApplicationLockWindowOkBtnClick}}),window.addEventListener("message",me.receiveMessage,!1)},receiveMessage:function(a){"captureActivity"===a.data&&App.ux.ActivityMonitor.captureActivity()},onNavigationBeforeRender:function(a){a.getStore().on("load",function(){this.ActivityMonitor(!0)},this)},ActivityMonitor:function(a){var b=this;a?(App.ux.ActivityMonitor.init({interval:1e3*b.activityMonitorInterval,maxInactive:6e4*b.activityMonitorMaxInactive,maxLock:6e4*b.activityMonitorMaxLock,verbose:!1,controller:b,isInactive:function(){b.startAutoLogout()},isLock:function(){b.doApplicationLock()}}),b.cron.start(),App.ux.ActivityMonitor.start()):(b.cron.stop(),App.ux.ActivityMonitor.stop())},cancelAutoLogout:function(){var a=this;app.el.unmask(),a.LogoutTask.stop(a.LogoutTaskTimer),a.logoutWarinigWindow.destroy(),delete a.logoutWarinigWindow,App.ux.ActivityMonitor.start()},doApplicationLock:function(){this.appMask(),this.showApplicationLockWindow(),this.getApplicationLockWindowPingField().focus()},doApplicationUnLock:function(){this.appUnMask(),this.hideApplicationLockWindow()},startAutoLogout:function(){var a=this;a.logoutWarinigWindow=Ext.create("Ext.Container",{floating:!0,cls:"logout-warning-window",html:"Logging Out in...",seconds:10}).show(),app.el.mask(),a.LogoutTask||(a.LogoutTask=new Ext.util.TaskRunner),a.LogoutTaskTimer?a.LogoutTask.start(a.LogoutTaskTimer):a.LogoutTaskTimer=a.LogoutTask.start({scope:a,run:a.logoutCounter,interval:1e3})},logoutCounter:function(){var a=this,b=a.logoutWarinigWindow.seconds-1;0>=b?(a.logoutWarinigWindow.update("Logging Out... Bye! Bye!"),a.appLogout(!0)):(a.logoutWarinigWindow.update("Logging Out in "+b+"sec"),a.logoutWarinigWindow.seconds=b)},doLogout:function(){var a=this.getController("Navigation");app.patient.pid&&Patient.unsetPatient(app.patient.pid),app.fireEvent("applogut",this)!==!1&&authProcedures.unAuth(function(){a.navigateTo("App.view.login.Login",null,!0),window.onbeforeunload=null,window.location.reload()})},appLogout:function(a){var b=this;a===!0?(b.ActivityMonitor(!1),b.doLogout()):Ext.Msg.show({title:_("please_confirm")+"...",msg:_("are_you_sure_to_quit")+" mdTimeline?",icon:Ext.MessageBox.QUESTION,buttons:Ext.Msg.YESNO,fn:function(a){"yes"==a&&b.doLogout()}})},showApplicationLockWindow:function(){return this.getApplicationLockWindow()||Ext.create("App.view.administration.ApplicationLockWindow"),this.getApplicationLockWindow().setTitle("LOCKED BY: "+app.user.getFullName()),this.getApplicationLockWindow().show()},hideApplicationLockWindow:function(){this.getApplicationLockWindow()&&this.getApplicationLockWindow().close()},appMask:function(){var a=app.el.mask();a.addCls("app-lock-mask")},appUnMask:function(){app.el.unmask()},onApplicationLockWindowLogoutBtnClick:function(){this.appLogout()},onApplicationLockWindowOkBtnClick:function(){this.doValidate()},onApplicationLockWindowPingFieldKeyUp:function(a,b){b.getKey()===b.RETURN&&this.doValidate(a)},doValidate:function(a){var b=this;a=a||b.getApplicationLockWindowPingField(),a.isValid()&&b.validatePin(a.getValue(),function(c){c?b.doSwitchUser(c):(app.msg(_("oops"),_("wrong_pin"),!0),a.reset())})},doSwitchUser:function(a){var b=this,c={facility:app.user.facility};app.fireEvent("beforeusersessionswitch",a)!==!1&&authProcedures.doAuth(c,a,function(a){a.user.id!=app.user.id?app.fireEvent("usersessionswitch",b,a):b.doApplicationUnLock()})},validatePin:function(b,c){User.getUserByPin(b,function(b){c(b===!1?!1:b.id==app.user.id||a("allow_user_switch")?b:!1)})}}),Ext.define("App.controller.PrintJob",{extend:"Ext.app.Controller",requires:["App.ux.combo.Printers","App.model.administration.PrinterCombo"],refs:[{ref:"UserTransactionWindow",selector:"#UserTransactionWindow"},{selector:"#ApplicationFooterTestDocumentViewerBtn",ref:"ApplicationFooterTestDocumentViewerBtn"},{selector:"#PrintJobsWindow",ref:"PrintJobsWindow"},{selector:"#PrintJobsWindowGird",ref:"PrintJobsWindowGird"},{selector:"#PrintJobsWindowPrintBtn",ref:"PrintJobsWindowPrintBtn"},{selector:"#PrintJobsWindowFromField",ref:"PrintJobsWindowFromField"},{selector:"#PrintJobsWindowToField",ref:"PrintJobsWindowToField"},{selector:"#PrintJobsWindowPriorityChkGroup",ref:"PrintJobsWindowPriorityChkGroup"},{selector:"#PrintJobsWindowStatusChkGroup",ref:"PrintJobsWindowStatusChkGroup"},{selector:"#PrintJobsWindowPrintersCombo",ref:"PrintJobsWindowPrintersCombo"},{selector:"#PrintJobsWindowUserLiveSearch",ref:"PrintJobsWindowUserLiveSearch"},{selector:"#ApplicationFooterDefaultPrinterCmb",ref:"ApplicationFooterDefaultPrinterCmb"},{selector:"#PrintJobsGridContextMenuUsers",ref:"PrintJobsGridContextMenuUsers"},{selector:"#PrintJobsGridContextMenuDetailLog",ref:"PrintJobsGridContextMenuDetailLog"},{selector:"#PrintJobsGridContextMenuDelete",ref:"PrintJobsGridContextMenuDelete"},{selector:"#PrintJobsWindowNumberOfJobCopies",ref:"PrintJobsWindowNumberOfJobCopies"}],init:function(){var a=this;a.auditLogCtrl=a.getController("administration.TransactionLog"),a.usersTransactionWindowCtrl=a.getController("App.controller.administration.UsersTransaction"),a.control({viewport:{printermsg:a.onApplicationPrinterMsg},"#ApplicationFooterPrintJobsBtn":{click:a.onApplicationFooterPrintJobsBtnClick},"#PrintJobsWindowGird":{itemdblclick:a.onPrintJobsWindowGridItemDblClick,beforeitemcontextmenu:a.onPrintJobsWindowGridContextMenu},"#PrintJobsWindowPrintBtn":{click:a.onPrintJobsWindowPrintBtnClick},"#PrintJobsWindowFromField":{change:a.onChangeFilters},"#PrintJobsWindowToField":{change:a.onChangeFilters},"#PrintJobsWindowPriorityChkGroup":{change:a.onChangeFilters},"#PrintJobsWindowStatusChkGroup":{change:a.onChangeFilters},"#ApplicationFooterTestDocumentViewerBtn":{click:a.onApplicationFooterTestDocumentViewerBtnClick},"#PrintJobsWindowUserLiveSearch":{beforerender:a.onPrintJobsWindowUserLiveSearchBeforeRender,change:a.onChangeFilters},"#PrintJobsGridContextMenuUsers":{click:a.onPrintJobsGridContextMenuUsersClick},"#PrintJobsGridContextMenuDetailLog":{click:a.onPrintJobsGridContextMenuDetailLogClick},"#PrintJobsGridContextMenuDelete":{click:a.onPrintJobsGridContextMenuDeleteClick}}),a.print_job_store=Ext.create("App.store.administration.PrintJob",{remoteFilter:!0,remoteSort:!0,sorters:[{property:"priority",direction:"ASC"}],pageSize:50}),a.print_task=setInterval(function(){a.checkJobsToPrint()},6e4)},checkJobsToPrint:function(){var a=this,b=a.getPrintJobsWindow();b?a.print_job_store.reload():(this.print_job_store.each(function(b){"QUEUED"===b.get("print_status")&&a.doPrintJob(b)}),this.print_job_store.clearFilter(!0),this.print_job_store.filter([{property:"uid",value:app.user.id},{property:"print_status",value:"QUEUED"},{property:"print_status",value:"PRINTING"}]))},doPrintJob:function(a){for(var b=app.getController("Print"),c=b.printers,d=a.get("number_of_copies"),e={id:a.get("document_id")},f=0;f<c.length;f++)if(c[f].id==a.get("printer_id")){var g=Ext.create("App.model.administration.PrinterCombo",c[f]);DocumentHandler.getPatientDocument(e,!0,function(c){if(c===!1)return void app.msg(_("error"),_("patient_document_not_found"),!0);a.set({print_status:"PRINTING"}),a.save();for(var e=0;d>e;e++)b.doPrint(g,c.document,a.get("id"),function(b){a.set(b.success?{print_status:"DONE"}:{print_status:"FAILED"}),a.save()})});break}},onChangeFilters:function(){var a=this,b=a.getPrintJobsWindowFromField(),c=a.getPrintJobsWindowToField(),d=a.getPrintJobsWindowStatusChkGroup(),e=a.getPrintJobsWindowPriorityChkGroup(),f=Ext.Date.format(b.getValue(),"Y-m-d")+" 00:00:00",g=Ext.Date.format(c.getValue(),"Y-m-d")+" 23:59:59",h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n=!1,o=!1,p=d.getChecked(),q=e.getChecked(),r=a.getPrintJobsWindowUserLiveSearch().getValue(),s=[];say("user_id"),say(a.getPrintJobsWindowUserLiveSearch()),say(r),p.forEach(function(a){switch(a.getName()){case"status_sended":h=!0;break;case"status_printing":i=!0;break;case"status_waiting":k=!0;break;case"status_done":j=!0;break;case"status_failed":l=!0}}),q.forEach(function(a){switch(a.getName()){case"priority_high":m=!0;break;case"priority_med":n=!0;break;case"priority_low":o=!0}}),s.push({property:"create_date",operator:">=",value:f}),s.push({property:"create_date",operator:"<=",value:g}),s.push(r?{property:"uid",value:r}:{property:"uid",value:app.user.id}),h&&s.push({property:"print_status",value:"QUEUED"}),i&&s.push({property:"print_status",value:"PRINTING"}),k&&s.push({property:"print_status",value:"HOLD"}),l&&s.push({property:"print_status",value:"FAILED"}),j&&s.push({property:"print_status",value:"DONE"}),m&&s.push({property:"priority",value:1}),n&&s.push({property:"priority",value:2}),o&&s.push({property:"priority",value:3}),a.print_job_store.clearFilter(!0),a.print_job_store.filter(s)},onApplicationPrinterMsg:function(a,b){var c=this,d=c.print_job_store.getById(b.job_id);null!==d&&d.set({print_status:b.print_status})},onPrintJobsWindowPrintBtnClick:function(){var a=this,b=a.getPrintJobsWindow(),c=a.getPrintJobsWindowGird(),d=a.getPrintJobsWindowPrintersCombo(),e=d.getValue(),f=d.findRecordByValue(e),g=c.getSelectionModel().getSelection();g.length<=0&&app.msg(_("error"),"No print jobs selected.",!0),f===!1&&app.msg(_("error"),"No printer selected.",!0),app.msg(_("sending")+"...",g.length.toString()+" print jobs sent to print."),g.forEach(function(b){b.set({print_status:"QUEUED",printer_id:f.get("id"),printer_type:f.get("local")?"LOCAL":"REMOTE"}),b.save(),a.doPrintJob(b)}),b.close()},addPrintJob:function(a,b,c,d,e){var f,g,h=this,i=this.getApplicationFooterDefaultPrinterCmb(),j=i.findRecordByValue(i.getValue());if(b=b||j,d=void 0===d||null===d?2:d,null===a||0===a)return void app.msg(_("error"),"Print job could not be added. Document Missing.",!0);if(b?(f=b.get("id"),g=b.get("local")?"LOCAL":"REMOTE"):(f=null,g="REMOTE"),null===d||!Number.isInteger(d))return void app.msg(_("error"),"Print job could not be added. Priority Missing.",!0);c=c&&f,Ext.isNumber(e)||(e=1);var k=h.print_job_store.add({uid:app.user.id,document_id:a,printer_id:f,printer_type:g,print_status:c?"QUEUED":"HOLD",priority:d,number_of_copies:e,create_date:Ext.Date.format(app.getDate(),"Y-m-d H:i:s")})[0];say(e),say(k),k.save(),c&&h.doPrintJob(k)},onApplicationFooterPrintJobsBtnClick:function(){this.showPrintJobsWindow(),this.onChangeFilters()},showPrintJobsWindow:function(){if(this.getPrintJobsWindow())return this.getPrintJobsWindow().show();Ext.create("App.view.administration.PrintJobsWindow");var a=this.getPrintJobsWindow().show();return this.getPrintJobsWindowGird().reconfigure(this.print_job_store),a},onApplicationFooterTestDocumentViewerBtnClick:function(){var a={body:"test"};DocumentHandler.createTempDocument(a,function(a){app.getController("DocumentViewer").doDocumentView(a.id,a.document_name)})},onPrintJobsWindowUserLiveSearchBeforeRender:function(a){var b=!0;b||a.setVisible(!1)},onPrintJobsWindowGridItemDblClick:function(a,b){var c=b.get("document_id");app.getController("DocumentViewer").doDocumentView(c)},onPrintJobsWindowGridContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showPrintJobsWindowGridContextMenu(a,b,e)},showPrintJobsWindowGridContextMenu:function(a,b,c){var d=this;return d.PrintJobsGridContextMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("users"),icon:"modules/billing/resources/images/user_16.png",itemId:"PrintJobsGridContextMenuUsers",acl:!0},{xtype:"menuseparator"},{text:_("transaction_log"),icon:"modules/billing/resources/images/icoList.png",itemId:"PrintJobsGridContextMenuDetailLog",acl:!0},{xtype:"menuseparator"},{text:_("delete_selected"),icon:"modules/billing/resources/images/cross.png",itemId:"PrintJobsGridContextMenuDelete",acl:!0}]}),d.PrintJobsGridContextMenu.print_jobs_grid=a,d.PrintJobsGridContextMenu.print_jobs_record=b,d.PrintJobsGridContextMenu.showAt(c.getXY()),d.PrintJobsGridContextMenu},onPrintJobsGridContextMenuUsersClick:function(a){var b=this,c=a.parentMenu.print_jobs_record,d=c.get("user_username"),e=c.get("create_date"),f=c.get("update_date");b.getUserTransactionWindow()||Ext.create("App.view.administration.UserTransactionWindow"),b.getUserTransactionWindow().user_username=d,b.getUserTransactionWindow().create_date=e,b.getUserTransactionWindow().update_date=f,b.getUserTransactionWindow().show()},onPrintJobsGridContextMenuDetailLogClick:function(a){var b=a.parentMenu.print_jobs_record;this.auditLogCtrl.doTransactionLogDetailByTableAndPk(b.table.name,b.get("id"))},onPrintJobsGridContextMenuDeleteClick:function(){var a=this.getPrintJobsWindowGird(),b=a.getStore(),c=a.getSelectionModel().getSelection();c.length&&(b.remove(c),b.sync({callback:function(){app.msg(_("sweet"),_("records_removed"))}}))}}),Ext.define("App.controller.Print",{extend:"Ext.app.Controller",requires:["App.ux.combo.Printers"],refs:[],printers:[],browserHelperCtl:void 0,init:function(){var a=this;a.control({viewport:{browserhelperopen:a.onBrowserHelperOpen},printerscombo:{render:a.onPrintersComboBeforeRender}}),a.printJobCtl=this.getController("PrintJob"),a.loadRemotePrinters()},doPrint:function(a,b,c,d){var e=this;if(a.get("local")){if(!e.browserHelperCtl)return void app.msg(_("oops"),_("no_browser_helper_found"),!0);c=c||"0",e.browserHelperCtl.send(JSON.stringify({action:"print",printer:a.get("id"),payload:b,job_id:c}),function(a){a.success||app.msg(_("oops"),"Document could not be printed",!0),d&&d(a)})}else Printer.doPrint(a.get("id"),b,c,function(a){d&&d(a)})},addPrintJob:function(a,b,c,d){var e=this;e.printJobCtl.addPrintJob(a,b,c,d)},loadRemotePrinters:function(){var a=this;Printer.getPrinters(function(b){a.printers=Ext.Array.merge(a.printers,b);var c=Ext.ComponentQuery.query("printerscombo[rendered]");c.forEach(function(b){b.store.loadData(a.printers),b.showPrintersByFacility(),b.setValue(b.getValue())})})},onBrowserHelperOpen:function(a){var b=this;b.browserHelperCtl=a,b.browserHelperCtl.send('{"action":"printer/list"}',function(a){for(var c=0;c<a.length;c++)a[c].local=!0;b.printers=Ext.Array.merge(b.printers,a);var d=Ext.ComponentQuery.query("printerscombo[rendered]");d.forEach(function(a){a.store.loadData(b.printers),a.showPrintersByFacility(),a.setValue(a.getValue())})})},onPrintersComboBeforeRender:function(a){say(this.printers),a.store.loadData(this.printers),app.on("appfacilitychanged",function(){a.showPrintersByFacility()}),a.showPrintersByFacility(),a.store.find("id",a.getValue())===a.getValue()},getPrinters:function(){var a=this;return a.printers},promptPrint:function(){}}),Ext.define("App.controller.Support",{extend:"Ext.app.Controller",requires:["App.ux.ManagedIframe"],refs:[{ref:"viewport",selector:"viewport"}],init:function(){var a=this;a.control({"button[action=supportBtn]":{click:a.supportBtnClick}})},supportBtnClick:function(a){window.open(a.src,"_blank")},getSupportWindow:function(){var a=this;a.winSupport?a.winSupport.show():(a.winSupport=Ext.create("Ext.window.Window",{title:_("support"),closeAction:"hide",bodyStyle:"background-color: #ffffff; padding: 5px;",animateTarget:a.Footer,resizable:!1,draggable:!1,maximizable:!1,autoScroll:!0,maximized:!0,dockedItems:{xtype:"toolbar",dock:"top",items:["-",{text:"List issues",iconCls:"list",action:"supportBtn",url:"http://GaiaEHR.org/projects/GaiaEHR001/issues"},"-",{text:"Create an issue",iconCls:"icoAddRecord",action:"supportBtn",url:"http://GaiaEHR.org/projects/GaiaEHR001/issues/new"}]}}),a.winSupport.show())}}),Ext.define("App.controller.ScriptCam",{extend:"Ext.app.Controller",refs:[{ref:"webCamWindow",selector:"scriptcamwindow"},{ref:"ScriptCamCameras",selector:"combobox[action=ScriptCamCameras]"}],init:function(){var a=this;a.userMedia=null,a.control({"button[action=onWebCam]":{click:a.onWebCamClick},"button[action=onCaptureImage]":{click:a.onCapture}})},onWebCamClick:function(a){var b=this;b.action=a.up("panel").action,b.imgPanel=a.up("panel"),navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,b.media=navigator.getMedia({video:!0,audio:!1},b.onConnect,b.onError)},onConnect:function(a){var b=app.getController("ScriptCam");b.win=Ext.create("Ext.window.Window",{title:"...",html:'<video id="WebCamVideo" width="640" height="480"></video>',autoShow:!0,buttons:["->",{text:_("capture_img"),action:"onCaptureImage"}],listeners:{close:function(){a.getTracks().forEach(function(a){"live"==a.readyState&&a.stop()})}}}),b.video=document.getElementById("WebCamVideo");try{b.video.srcObject=a}catch(c){b.video.src=window.URL.createObjectURL(a)}b.video.play()},onError:function(a){say(a)},onCapture:function(){var a,b=this,c=document.createElement("canvas"),d=c.getContext("2d"),e=b.imgPanel.down("image"),f=b.imgPanel.down("textareafield");c.width=b.video.videoWidth/4,c.height=b.video.videoHeight/4,d.drawImage(b.video,0,0,c.width,c.height),a=c.toDataURL(),c.remove(),e.setSrc(a),f.setValue(a),b.win.close()}}),Ext.define("App.controller.Upload",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"UploadDocumentWindow",selector:"#UploadDocumentWindow"}],init:function(){var a=this;a.documents_defautls={},a.control({"#UploadDocumentWindow":{show:a.onUploadDocumentWindowShow,close:a.onUploadDocumentWindowClose},"#UploadCancelBtn":{click:a.onUploadCancelBtnClick},"#UploadSaveBtn":{click:a.onUploadSaveBtnClick}})},onUploadDocumentWindowShow:function(a){a.default_values&&a.down("form").getForm().setValues(a.default_values)},onUploadDocumentWindowClose:function(){},showUploadWindow:function(a){return this.getUploadDocumentWindow()||Ext.create("App.view.upload.UploadDocumentWindow"),this.getUploadDocumentWindow().default_values=a,this.getUploadDocumentWindow().show()},onUploadCancelBtnClick:function(){this.getUploadDocumentWindow().close()},onUploadSaveBtnClick:function(){var a=this,b=a.getUploadDocumentWindow(),c=b.down("form").getForm(),d=Ext.create("App.model.patient.PatientDocuments"),e=c.getValues(),f=new FileReader,g=c.findField("docTypeCode"),h=c.findField("document");if(c.isValid()){e.date=new Date,e.pubpid=app.patient.pubpid,e.pid=app.patient.pid,e.eid=app.patient.eid,e.uid=app.user.id,e.facility_id=app.user.facility,e.global_id=app.uuidv4();var i=g.findRecordByValue(e.docTypeCode);i&&(e.docType=i.get("option_name")),d.set(e),f.onload=function(a){d.set({document:a.target.result}),app.fireEvent("beforeuploaddocumentssave",this,[d])!==!1&&d.save({success:function(){app.fireEvent("uploaddocumentssave",this,[d]),b.close()}})},f.readAsDataURL(h.extractFileInput().files[0])}}}),Ext.define("App.controller.patient.Alerts",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AlertsAddBtn",selector:"#AlertsAddBtn"},{ref:"PatientSummaryAlertsPanel",selector:"#PatientSummaryAlertsPanel"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onEncounterOpen,patientset:a.onPatientSet},"#PatientSummaryAlertsPanel":{activate:a.onPatientSummaryAlertsPanelActivate},"#AlertsAddBtn":{click:a.onAlertsAddBtnClick},"#AlertsAlertOkBtn":{click:a.onAlertsAlertOkBtnClick},"#AlertsAlertCancelBtn":{click:a.onAlertsAlertCancelBtnClick}})},onPatientSummaryAlertsPanelActivate:function(){this.getPatientSummaryAlertsPanel().getStore().load({filters:[{property:"pid",value:app.patient.pid}]})},onAlertsAddBtnClick:function(a){var b=a.up("grid"),c=b.store;b.plugins[0].cancelEdit(),c.insert(0,{date:new Date,pid:app.patient.pid,uid:app.user.id,eid:app.patient.eid}),b.plugins[0].startEdit(0,0)},onAlertsAlertOkBtnClick:function(a){var b=a.up("window"),c=b.down("grid").getStore();c.sync(),b.close()},onAlertsAlertCancelBtnClick:function(a){var b=a.up("window"),c=b.down("grid").getStore();c.rejectChanges(),b.close()},onPatientSet:function(a){this.getPatientAlerts("Administrative",a.pid)},onEncounterOpen:function(a){this.getPatientAlerts("Clinical",a.data.pid)},getPatientAlerts:function(a,b){var c,d,e=this,f="RemindersAlertWindow"+a,g=Ext.ComponentQuery.query("window[action="+f+"]");d=0===g.length?Ext.create("App.view.patient.AlertWindow",{title:_("alerts")+" ("+_(a.toLowerCase())+")",action:f}):g[0],c=d.down("grid").getStore(),d.close(),c.load({filters:[{property:"pid",value:b},{property:"type",value:a},{property:"active",value:!0}],callback:function(a){a.length>0&&(e.playSound(),d.show())}})},playSound:function(){this.alertAudio?(this.alertAudio.dom.firstChild.currentTime=0,this.alertAudio.dom.firstChild.play()):this.alertAudio=Ext.core.DomHelper.append(Ext.getBody(),{html:'<audio autoplay id="reminderAlert" ><source src="resources/audio/sweetalertsound4.wav" type="audio/wav"></audio>'},!0)}}),Ext.define("App.controller.patient.AdvanceDirectives",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AdvanceDirectiveGridPanel",selector:"patientadvancedirectivepanel"},{ref:"AdvanceDirectiveAddBtn",selector:"#AdvanceDirectiveAddBtn"},{ref:"AdvanceDirectiveReviewBtn",selector:"#AdvanceDirectiveReviewBtn"}],init:function(){var a=this;a.control({patientadvancedirectivepanel:{activate:a.onAdvanceDirectiveGridPanelActivate},"#AdvanceDirectiveAddBtn":{click:a.onAdvanceDirectiveAddBtnClick},"#AdvanceDirectiveReviewBtn":{click:a.onAdvanceDirectiveReviewBtnClick}})},onAdvanceDirectiveGridPanelActivate:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},onAdvanceDirectiveAddBtnClick:function(a){var b=a.up("grid"),c=b.getStore();b.editingPlugin.cancelEdit();var d=c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,create_date:new Date,created_uid:app.user.id,start_date:new Date,verified_date:new Date,verified_uid:app.user.id});b.editingPlugin.startEdit(d[0],0)},onAdvanceDirectiveReviewBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_advance_directives:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})}}),Ext.define("App.controller.Theme",{extend:"Ext.app.Controller",refs:[{ref:"viewport",selector:"viewport"}],init:function(){var a=this;a.control({"#AppThemeSwitcher":{click:a.onAppThemeSwitcherClick,beforerender:a.onAppThemeSwitcherBeforeRender}})},onAppThemeSwitcherBeforeRender:function(a){a.action=g("mdtimeline_theme"),a.setText(_("dark"==a.action?"light_theme":"dark_theme"))},onAppThemeSwitcherClick:function(a){var b=this;Ext.Msg.show({title:_("wait"),msg:_("theme_change_warning"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"==c&&("dark"==a.action?b.goLight(a):b.goDark(a))}})},goLight:function(a){a.action="light",Ext.util.Cookies.set("mdtimeline_theme","light",Ext.Date.add(new Date,Ext.Date.YEAR,5)),window.location.reload()},goDark:function(a){a.action="dark",Ext.util.Cookies.set("mdtimeline_theme","dark",Ext.Date.add(new Date,Ext.Date.YEAR,5)),window.location.reload()}}),Ext.define("App.controller.patient.ActiveProblems",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"ActiveProblemsGrid",selector:"patientactiveproblemspanel"},{ref:"ActiveProblemLiveSearch",selector:"#activeProblemLiveSearch"},{ref:"AddActiveProblemBtn",selector:"patientactiveproblemspanel #addActiveProblemBtn"},{ref:"PatientProblemsReconciledBtn",selector:"#PatientProblemsReconciledBtn"},{ref:"PatientProblemsActiveBtn",selector:"#PatientProblemsActiveBtn"},{ref:"EncounterPanel",selector:"#encounterPanel"},{ref:"ActiveProblemsReviewBtn",selector:"#ActiveProblemsReviewBtn"}],init:function(){var a=this;a.control({patientactiveproblemspanel:{activate:a.onActiveProblemsGridActive,beforeitemcontextmenu:a.onActiveProblemsGridBeforeItemContextMenu},"#activeProblemLiveSearch":{select:a.onActiveProblemLiveSearchSelect},"#ActiveProblemStatusCombo":{select:a.onActiveProblemStatusComboSelect},"#ActiveProblemTypeCmb":{select:a.onActiveProblemTypeCmbSelect},"patientactiveproblemspanel #addActiveProblemBtn":{click:a.onAddActiveProblemBtnClick},"#PatientProblemsReconciledBtn":{click:a.onPatientProblemsReconciledBtnClick},"#PatientProblemsActiveBtn":{click:a.onPatientProblemsActiveBtnClick},"#ActiveProblemsGridActivateMenu":{click:a.onActiveProblemsGridActivateMenuClick},"#ActiveProblemsGridInactivateMenu":{click:a.onActiveProblemsGridInactivateMenu},"#ActiveProblemsReviewBtn":{click:a.onActiveProblemsReviewBtnClick}}),a.encController=a.getController("patient.encounter.Encounter")},onActiveProblemsGridBeforeItemContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showContextMenu(a,b,e)},showContextMenu:function(a,b,c){a.context_menu||(a.context_menu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("activate"),itemId:"ActiveProblemsGridActivateMenu"},{text:_("inactivate"),itemId:"ActiveProblemsGridInactivateMenu"}]})),a.context_menu.record=b,a.context_menu.showAt(c.getXY())},onActiveProblemsGridActivateMenuClick:function(a){var b=a.up("menu").record;b.set({status:"Active",status_code:"55561003",status_code_type:"SNOMEDCT",end_date:null}),b.store.sync()},onActiveProblemsGridInactivateMenu:function(a){var b=a.up("menu").record;b.set({status:"Inactive",status_code:"73425007",status_code_type:"SNOMEDCT",end_date:app.getDate()}),b.store.sync()},onAddActiveProblemBtnClick:function(){var a=this,b=a.getActiveProblemsGrid(),c=b.getStore(),d=a.encController.getEncounterRecord(),e=d?d.get("service_date"):app.getDate();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,status:"Active",status_code:"55561003",status_code_type:"SNOMEDCT",created_uid:app.user.id,create_date:app.getDate(),begin_date:e}),b.editingPlugin.startEdit(0,0)},onActiveProblemsReviewBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_active_problems:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})},onPatientProblemsReconciledBtnClick:function(){this.onActiveProblemsGridActive()},onPatientProblemsActiveBtnClick:function(){this.onActiveProblemsGridActive()},onActiveProblemsGridActive:function(){var a=this.getActiveProblemsGrid(),b=a.getStore(),c=this.getPatientProblemsReconciledBtn().pressed,d=this.getPatientProblemsActiveBtn().pressed,e=[{property:"pid",value:app.patient.pid}];d&&Ext.Array.push(e,{property:"status_code",value:"55561003"}),b.clearFilter(!0),b.load({filters:e,params:{reconciled:c}})},onActiveProblemLiveSearchSelect:function(a,b){var c=a.up("form").getForm(),d=c.getRecord();d.set("liveicdxsearch"===a.xtype?{code:b[0].data.code,code_type:b[0].data.code_type}:{code:b[0].data.ConceptId,code_type:b[0].data.CodeType})
},onActiveProblemStatusComboSelect:function(a,b){var c=a.up("form").getForm(),d=c.getRecord();d.set({status:b[0].data.option_name,status_code:b[0].data.code,status_code_type:b[0].data.code_type})},onActiveProblemTypeCmbSelect:function(a,b){var c=a.up("form").getForm(),d=c.getRecord();d.set({problem_type:b[0].data.option_name,problem_type_code:b[0].data.code,problem_type_code_type:b[0].data.code_type})}}),Ext.define("App.controller.patient.Allergies",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AllergiesGrid",selector:"patientallergiespanel"},{ref:"AddAllergyBtn",selector:"patientallergiespanel #addAllergyBtn"},{ref:"ReviewAllergiesBtn",selector:"patientallergiespanel #reviewAllergiesBtn"},{ref:"ActiveAllergyBtn",selector:"patientallergiespanel #activeAllergyBtn"},{ref:"PatientAllergyReconciledBtn",selector:"#PatientAllergyReconciledBtn"},{ref:"AllergyCombo",selector:"#allergyCombo"},{ref:"AllergyTypesCombo",selector:"#allergyTypesCombo"},{ref:"AllergySearchCombo",selector:"#allergySearchCombo"},{ref:"AllergyMedicationCombo",selector:"#allergyMedicationCombo"},{ref:"allergyCvxLiveSearch",selector:"#allergyCvxLiveSearch"},{ref:"AllergyFoodCombo",selector:"#allergyFoodCombo"},{ref:"AllergyMetalCombo",selector:"#allergyMetalCombo"},{ref:"AllergyReactionCombo",selector:"#allergyReactionCombo"},{ref:"AllergySeverityCombo",selector:"#allergySeverityCombo"},{ref:"AllergyLocationCombo",selector:"#allergyLocationCombo"}],init:function(){var a=this;a.control({patientallergiespanel:{activate:a.onAllergiesGridActivate,beforeedit:a.onAllergiesGridBeforeEdit,beforeitemcontextmenu:a.onAllergiesGridBeforeItemContextMenu},"patientallergiespanel #addAllergyBtn":{click:a.onAddAllergyBtnClick},"patientallergiespanel #activeAllergyBtn":{toggle:a.onActiveAllergyBtnToggle},"patientallergiespanel #PatientAllergyReconciledBtn":{toggle:a.onPatientAllergyReconciledBtnToggle},"patientallergiespanel #reviewAllergiesBtn":{click:a.onReviewAllergiesBtnClick},"#allergyTypeCombo":{select:a.onAllergyTypeComboSelect},"#allergyMedicationCombo":{select:a.onAllergyLiveSearchSelect},"#allergyCvxLiveSearch":{select:a.onAllergyCvxLiveSearchSelect},"#allergyMetalCombo":{select:a.onAllergyMetalComboSelect},"#allergyFoodCombo":{select:a.onAllergyFoodComboSelect},"#allergySearchCombo":{select:a.onAllergySearchComboSelect},"#allergyLocationCombo":{change:a.onAllergyLocationComboChange},"#allergyReactionCombo":{select:a.onAllergyReactionComboSelect},"#allergySeverityCombo":{select:a.onAllergySeverityComboSelect},"#allergyStatusCombo":{select:a.onAllergyStatusComboSelect},"#AllergiesGridActivateMenu":{click:a.onAllergiesGridActivateMenuClick},"#AllergiesGridInactivateMenu":{click:a.onAllergiesGridInactivateMenu}})},onAllergySearchComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({allergy_code:b[0].data.allergy_code,allergy_code_type:b[0].data.allergy_code_type})},onAllergyReactionComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({reaction_code:b[0].data.code,reaction_code_type:b[0].data.code_type})},onAllergySeverityComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({severity_code:b[0].data.code,severity_code_type:b[0].data.code_type})},onAllergyStatusComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({status_code:b[0].data.code,status_code_type:b[0].data.code_type})},onAllergyLiveSearchSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({allergy:b[0].data.STR,allergy_code:b[0].data.RXCUI,allergy_code_type:b[0].data.CodeType})},onAllergyCvxLiveSearchSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({allergy:b[0].data.name,allergy_code:b[0].data.cvx_code,allergy_code_type:"CVX"})},onAllergyMetalComboSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({allergy:b[0].get("Term"),allergy_code:b[0].get("ConceptId"),allergy_code_type:b[0].get("CodeType")})},onAllergyFoodComboSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({allergy:b[0].get("option_name"),allergy_code:b[0].get("code"),allergy_code_type:b[0].get("code_type")})},onAllergyTypeComboSelect:function(a,b){var c=this,d=b[0],e=d.data.code,f="419511003"===e||"416098002"===e||"59037007"===e,g="414285001"===e||"235719002"===e||"418471000"===e,h="300915004"===e,i=f&&-1!==d.data.option_value.search(/vaccine/i),j=!f&&!h&&!g;i&&(f=!1),c.getAllergyMedicationCombo().setVisible(f),c.getAllergyMedicationCombo().setDisabled(!f),c.getAllergyCvxLiveSearch().setVisible(i),c.getAllergyCvxLiveSearch().setDisabled(!i),c.getAllergyMetalCombo().setVisible(h),c.getAllergyMetalCombo().setDisabled(!h),c.getAllergyFoodCombo().setVisible(g),c.getAllergyFoodCombo().setDisabled(!g),c.getAllergySearchCombo().setVisible(j),c.getAllergySearchCombo().setDisabled(!j),f?c.getAllergyMedicationCombo().reset():i?c.getAllergyCvxLiveSearch().reset():h?c.getAllergyMedicationCombo().reset():g?c.getAllergyFoodCombo().reset():c.getAllergySearchCombo().store.load(),a.up("form").getForm().getRecord().set({allergy_type_code:d.data.code,allergy_type_code_type:d.data.code_type})},onAllergyLocationComboChange:function(a){var b,c=this,d=a.getValue();"Skin"==d?b=80:"Local"==d?b=81:"Abdominal"==d?b=82:"Systemic / Anaphylactic"==d&&(b=83),c.getAllergyReactionCombo().getStore().load({params:{list_id:b}})},onAllergiesGridBeforeItemContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showContextMenu(a,b,e)},showContextMenu:function(a,b,c){a.context_menu||(a.context_menu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("activate"),itemId:"AllergiesGridActivateMenu"},{text:_("inactivate"),itemId:"AllergiesGridInactivateMenu"}]})),a.context_menu.record=b,a.context_menu.showAt(c.getXY())},onAllergiesGridActivateMenuClick:function(a){var b=a.up("menu").record;b.set({status:"Active",status_code:"55561003",status_code_type:"SNOMEDCT",end_date:null}),b.store.sync()},onAllergiesGridInactivateMenu:function(a){var b=a.up("menu").record;b.set({status:"Inactive",status_code:"73425007",status_code_type:"SNOMEDCT",end_date:app.getDate()}),b.store.sync()},onAllergiesGridBeforeEdit:function(a,b){var c=a.editor.editingPlugin.getEditor(),d=c.query("#allergyMedicationCombo")[0],e=c.query("#allergyMetalCombo")[0],f=c.query("#allergySearchCombo")[0],g=c.query("#allergyFoodCombo")[0],h=c.query("#allergyCvxLiveSearch")[0],i=b.record.get("allergy_type_code"),j=b.record.get("allergy_type"),k="419511003"===i||"416098002"===i||"59037007"===i,l="300915004"===i,m="414285001"===i||"235719002"===i||"418471000"===i,n=k&&-1!==j.search(/vaccine/i),o=!k&&!l&&!m;n&&(k=!1),d.setVisible(k),d.setDisabled(!k),h.setVisible(n),h.setDisabled(!n),e.setVisible(l),e.setDisabled(!l),g.setVisible(m),g.setDisabled(!m),f.setVisible(o),f.setDisabled(!o),k?d.setValue(b.record.get("allergy")):n?h.setValue(b.record.get("allergy")):l?e.setValue(b.record.get("allergy")):m?g.setValue(b.record.get("allergy")):f.setValue(b.record.get("allergy"))},onAllergiesGridActivate:function(){var a=this.getAllergiesGrid().getStore(),b=this.getPatientAllergyReconciledBtn().pressed,c=this.getActiveAllergyBtn().pressed,d=[{property:"pid",value:app.patient.pid}];b&&(d=Ext.Array.push(d,{property:"reconciled",operator:"!=",value:"1"})),c&&(d=Ext.Array.push(d,{property:"status",value:"Active"})),a.clearFilter(!0),a.filter(d)},onAddAllergyBtnClick:function(){var a=this,b=a.getAllergiesGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{created_uid:app.user.id,uid:app.user.id,pid:app.patient.pid,eid:app.patient.eid,allergy_type:"Drug allergy",allergy_type_code:"416098002",allergy_type_code_type:"SNOMEDCT",status:"Active",status_code:"55561003",status_code_type:"SNOMEDCT",create_date:app.getDate(),begin_date:app.getDate()}),b.editingPlugin.startEdit(0,0)},onActiveAllergyBtnToggle:function(){this.onAllergiesGridActivate()},onPatientAllergyReconciledBtnToggle:function(){this.onAllergiesGridActivate()},beforeAllergyEdit:function(a,b){this.allergieMedication.setValue(b.record.data.allergy)},onReviewAllergiesBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_allergies:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})}}),Ext.define("App.controller.patient.AppointmentRequests",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"AppointmentRequestWindow",selector:"#AppointmentRequestWindow"},{ref:"AppointmentRequestGrid",selector:"#AppointmentRequestGrid"},{ref:"AppointmentRequestForm",selector:"#AppointmentRequestForm"},{ref:"AppointmentRequestAddBtn",selector:"#AppointmentRequestAddBtn"},{ref:"AppointmentRequestRequestedField",selector:"#AppointmentRequestRequestedField"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onAppEncounterLoad},"#AppointmentRequestGrid":{itemdblclick:a.onAppointmentRequestGridItemDblClick},"#AppointmentRequestWindow":{close:a.onAppointmentRequestWindowClose},"#AppointmentRequestAddBtn":{click:a.onAppointmentRequestAddBtnClick},"#AppointmentRequestSaveBtn":{click:a.onAppointmentRequestSaveBtnClick},"#AppointmentRequestCancelBtn":{click:a.onAppointmentRequestCancelBtnClick},"#AppointmentRequestDateField > button":{click:a.onAppointmentRequestDateFieldButtonsClick},"#AppointmentRequestProcedureFieldSet > combobox":{select:a.onAppointmentRequestProcedureFieldSetCombosSelect}})},onAppointmentRequestGridItemDblClick:function(a,b){this.getEditWindow(b)},onAppEncounterLoad:function(a){this.getAppointmentRequestGrid().reconfigure(a.appointmentrequests()),a.appointmentrequests().load()},onAppointmentRequestDateFieldButtonsClick:function(a){var b,c=new Date;switch(a.action){case"1D":b=Ext.Date.add(c,Ext.Date.DAY,1);break;case"1W":b=Ext.Date.add(c,Ext.Date.DAY,7);break;case"2W":b=Ext.Date.add(c,Ext.Date.DAY,14);break;case"6W":b=Ext.Date.add(c,Ext.Date.DAY,42);break;case"1M":b=Ext.Date.add(c,Ext.Date.MONTH,1);break;case"2M":b=Ext.Date.add(c,Ext.Date.MONTH,2);break;case"3M":b=Ext.Date.add(c,Ext.Date.MONTH,3);break;case"4M":b=Ext.Date.add(c,Ext.Date.MONTH,4);break;case"5M":b=Ext.Date.add(c,Ext.Date.MONTH,5);break;case"6M":b=Ext.Date.add(c,Ext.Date.MONTH,6);break;case"1Y":b=Ext.Date.add(c,Ext.Date.YEAR,1);break;default:b=c}this.getAppointmentRequestRequestedField().setValue(b)},onAppointmentRequestAddBtnClick:function(){var a=Ext.create("App.model.patient.AppointmentRequest",{pid:app.patient.pid,eid:app.patient.eid,requested_uid:app.user.id,create_uid:app.user.id,create_date:new Date});this.getEditWindow(a)},onAppointmentRequestProcedureFieldSetCombosSelect:function(a,b){var c=this.getAppointmentRequestForm().getForm().getRecord(),d={};d[a.name]=b[0].data.Term,d[a.name+"_code"]=b[0].data.ConceptId,d[a.name+"_code_type"]=b[0].data.CodeType,c.set(d)},onAppointmentRequestSaveBtnClick:function(a){var b=this.getAppointmentRequestForm().getForm(),c=b.getRecord(),d=b.getValues(),e=this.getAppointmentRequestGrid().getStore();b.isValid()&&(c.set(d),c.store||e.add(c),e.sync()),a.up("window").close()},getEditWindow:function(a){this.getAppointmentRequestWindow()||Ext.create("App.view.patient.encounter.AppointmentRequestWindow"),this.getAppointmentRequestWindow().show(),a&&this.getAppointmentRequestForm().getForm().loadRecord(a)},onAppointmentRequestCancelBtnClick:function(a){a.up("window").close()},onAppointmentRequestWindowClose:function(){this.getAppointmentRequestForm().getForm().reset(!0)}}),Ext.define("App.controller.patient.EducationResources",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"EducationResourcesGrid",selector:"#EducationResourcesGrid"},{ref:"EducationResourcesGridAddBtn",selector:"#EducationResourcesGridAddBtn"},{ref:"EducationResourcesGridLanguageField",selector:"#EducationResourcesGridLanguageField"},{ref:"EducationResourcesGridSearchField",selector:"#EducationResourcesGridSearchField"},{ref:"EducationResourcesGridFindEncounterRelatedBtn",selector:"#EducationResourcesGridFindEncounterRelatedBtn"},{ref:"EducationResourcesPreviewWindow",selector:"#EducationResourcesPreviewWindow"},{ref:"EducationResourcesPreviewWindowGrid",selector:"#EducationResourcesPreviewWindowGrid"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onAppEncounterLoad,encountersync:a.onAppEncounterSync},"#EducationResourcesGrid":{itemdblclick:a.onEducationResourcesGridItemDblClick},"#EducationResourcesGridLanguageField":{change:a.onEducationResourcesGridLanguageFieldChange},"#EducationResourcesGridSearchField":{select:a.onEducationResourcesGridSearchFieldSelect},"#EducationResourcesGridFindEncounterRelatedBtn":{click:a.onEducationResourcesGridFindEncounterRelatedBtnClick},"#EducationResourcesPreviewWindowCancelBtn":{click:a.onEducationResourcesPreviewWindowCancelBtnClick},"#EducationResourcesPreviewWindowSelectBtn":{click:a.onEducationResourcesPreviewWindowSelectBtnClick},"#EducationResourcesPreviewWindow":{close:a.onEducationResourcesPreviewWindowClose},"#EducationResourcesPreviewWindowGrid":{itemdblclick:a.onEducationResourcesPreviewWindowGridItemDblClick}})},onEducationResourcesGridFindEncounterRelatedBtnClick:function(){var a=this,b=a.getEducationResourcesGridLanguageField().getValue(),c={eid:app.patient.eid,language:"en"};"patient"==b?app.patient.record&&"spa"==app.patient.record.get("language")&&(c.language="es"):("spa"==b||"es"==b||"esp"==b)&&(c.language="es"),a.getEducationResourcesGrid().el.mask(_("searching")),EducationResources.findEncounterEducationResources(c,function(b){a.getEducationResourcesGrid().el.unmask(),b.length>0?(a.showEducationResourcesFinderPreview(),a.getEducationResourcesPreviewWindowGrid().getStore().loadRawData(b)):app.msg(_("info"),_("no_education_resources_found"))})},onEducationResourcesPreviewWindowClose:function(){this.getEducationResourcesPreviewWindowGrid().getStore().removeAll()},onEducationResourcesPreviewWindowCancelBtnClick:function(){this.getEducationResourcesPreviewWindow().close()},onEducationResourcesPreviewWindowSelectBtnClick:function(){var a=this,b=this.getEducationResourcesPreviewWindowGrid().getSelectionModel().getSelection(),c=this.getEducationResourcesGrid().getStore();b.forEach(function(a){var b=Ext.clone(a.data);b.pid=app.patient.pid,b.eid=app.patient.eid,b.uid=app.user.id,c.add(b)}),a.getEducationResourcesPreviewWindow().close()},onEducationResourcesPreviewWindowGridItemDblClick:function(a,b){window.open(b.get("url"),"_blank")},onEducationResourcesGridItemDblClick:function(a,b){window.open(b.get("url"),"_blank")},onAppEncounterLoad:function(a){this.getEducationResourcesGrid().reconfigure(a.educationresources()),a.educationresources().load()},onAppEncounterSync:function(a){a.encounter.educationresources().sync()},onEducationResourcesGridLanguageFieldChange:function(a,b){this.getEducationResourcesGridSearchField().language=b},onEducationResourcesGridSearchFieldSelect:function(a,b){var c=this.getEducationResourcesGrid().getStore();c.add({pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,title:b[0].get("title"),url:b[0].get("url"),snippet:b[0].get("snippet"),organization_name:b[0].get("organizationName"),provided_date:app.getDate()})},showEducationResourcesFinderPreview:function(){return this.getEducationResourcesPreviewWindow()||Ext.create("Ext.window.Window",{title:_("select_education_resources"),modal:!0,layout:"fit",itemId:"EducationResourcesPreviewWindow",bodyPadding:5,closeAction:"hide",items:[{xtype:"grid",width:700,height:200,selType:"checkboxmodel",itemId:"EducationResourcesPreviewWindowGrid",store:Ext.create("App.store.patient.EducationResources"),columns:[{text:_("title"),dataIndex:"title",flex:1},{text:_("organization"),dataIndex:"organization_name",flex:1}]}],buttons:[{text:_("cancel"),itemId:"EducationResourcesPreviewWindowCancelBtn"},{text:_("select"),itemId:"EducationResourcesPreviewWindowSelectBtn"}]}),this.getEducationResourcesPreviewWindow().show()}}),Ext.define("App.controller.patient.CarePlanGoals",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"CarePlanGoalsGrid",selector:"careplangoalsgrid"},{ref:"CarePlanGoalsNewWindow",selector:"careplangoalsnewwindow"},{ref:"CarePlanGoalsNewForm",selector:"#CarePlanGoalsNewForm"},{ref:"CarePlanGoalPlanDateField",selector:"#CarePlanGoalPlanDateField"},{ref:"NewCarePlanGoalBtn",selector:"#NewCarePlanGoalBtn"},{ref:"SoapPanelForm",selector:"#soapPanel form"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onBeforeOpenEncounter},careplangoalsgrid:{itemdblclick:a.onCarePlanGoalsGridItemDblClick},"#CarePlanGoalSearchField":{select:a.onCarePlanGoalSearchFieldSelect},"#NewCarePlanGoalBtn":{click:a.onNewCarePlanGoalBtnClick},"#CarePlanGoalsNewFormCancelBtn":{click:a.onCarePlanGoalsNewFormCancelBtn},"#CarePlanGoalsNewFormSaveBtn":{click:a.onCarePlanGoalsNewFormSaveBtn},"#CarePlanGoalPlanDateContainer > button":{click:a.onCarePlanGoalPlanDateContainerButtonsClick}})},onCarePlanGoalPlanDateContainerButtonsClick:function(a){var b,c=new Date,d=this.getCarePlanGoalPlanDateField();switch(a.action){case"1D":b=Ext.Date.add(c,Ext.Date.DAY,1);break;case"1W":b=Ext.Date.add(c,Ext.Date.DAY,7);break;case"2W":b=Ext.Date.add(c,Ext.Date.DAY,14);break;case"1M":b=Ext.Date.add(c,Ext.Date.MONTH,1);break;case"3M":b=Ext.Date.add(c,Ext.Date.MONTH,3);break;case"6M":b=Ext.Date.add(c,Ext.Date.MONTH,6);break;case"1Y":b=Ext.Date.add(c,Ext.Date.YEAR,1)}d.setValue(b||c)},onCarePlanGoalsGridItemDblClick:function(a,b){var c=this;c.getCarePlanGoalsNewWindow().setTitle(b.data.goal+" ["+b.data.goal_code+"]"),c.getCarePlanGoalsNewWindow().show(c.getCarePlanGoalsGrid().el),c.getCarePlanGoalsNewForm().getForm().loadRecord(b)},onCarePlanGoalSearchFieldSelect:function(a,b){var c=this,d=c.getCarePlanGoalsNewForm().getForm(),e=d.getRecord();e.set({goal_code:b[0].data.ConceptId,goal_code_type:b[0].data.CodeType})},onBeforeOpenEncounter:function(a){this.getCarePlanGoalsGrid()&&this.getCarePlanGoalsGrid().getStore().load({filters:[{property:"eid",value:a.data.eid}]})},onNewCarePlanGoalBtnClick:function(a){var b,c=this,d=a.up("grid"),e=d.getStore();b=e.add({pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,created_date:new Date}),c.getCarePlanGoalsNewWindow().setTitle(_("new_goal")),c.getCarePlanGoalsNewWindow().setSize(c.getSoapPanelForm().getSize()),c.getCarePlanGoalsNewWindow().show(c.getCarePlanGoalsGrid().el),c.getCarePlanGoalsNewForm().getForm().loadRecord(b[0])},onCarePlanGoalsNewFormSaveBtn:function(){var a=this,b=a.getCarePlanGoalsNewForm().getForm(),c=b.getRecord(),d=b.getValues();b.isValid()&&(c.set(d),c.store.sync({success:function(){app.msg(_("sweet"),_("record_saved"))},failure:function(){app.msg(_("oops"),_("record_error"),!0)}}),a.getCarePlanGoalsNewForm().getForm().reset(),a.getCarePlanGoalsNewWindow().close())},onCarePlanGoalsNewFormCancelBtn:function(){var a=this;a.getCarePlanGoalsGrid().getStore().rejectChanges(),a.getCarePlanGoalsNewForm().getForm().reset(),a.getCarePlanGoalsNewWindow().close()}}),Ext.define("App.controller.patient.CCD",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientCcdPanel",selector:"patientccdpanel"},{ref:"PatientCcdPanelMiFrame",selector:"patientccdpanel > miframe"},{ref:"PatientCcdPanelEncounterCmb",selector:"#PatientCcdPanelEncounterCmb"},{ref:"PatientCcdPanelExcludeCheckBoxGroup",selector:"#PatientCcdPanelExcludeCheckBoxGroup"}],init:function(){var a=this;a.control({patientccdpanel:{activate:a.onPanelActivate},"#viewCcdBtn":{click:a.onViewCcdBtnClick},"#archiveCcdBtn":{click:a.onArchiveCcdBtnClick},"#exportCcdBtn":{click:a.onExportCcdBtnClick},"#importCcdBtn":{click:a.onImportCcdBtnClick},"#printCcdBtn":{click:a.onPrintCcdBtnClick},"#PatientCcdPanelEncounterCmb":{select:a.onPatientCcdPanelEncounterCmbSelect}}),a.importCtrl=this.getController("patient.CCDImport"),a.disclosuresCtrl=this.getController("patient.Disclosures"),a.logCtrl=this.getController("administration.AuditLog")},eid:null,loadPatientEncounters:function(){var a=this,b=a.getPatientCcdPanelEncounterCmb(),c=b.store;null==app.patient.pid?(c.removeAll(),b.reset()):c.load({filters:[{property:"pid",value:app.patient.pid}]})},onPanelActivate:function(a){null===this.eid?(a.down("toolbar").down("#PatientCcdPanelEncounterCmb").setVisible(!0),this.loadPatientEncounters()):a.down("toolbar").down("#PatientCcdPanelEncounterCmb").setVisible(!1),this.onViewCcdBtnClick(a.down("toolbar").down("button"))},onViewCcdBtnClick:function(a){var b=this.getEid(a);a.up("panel").query("miframe")[0].setSrc("dataProvider/CCDDocument.php?action=view&site="+window.site+"&pid="+app.patient.pid+"&eid="+b+"&exclude="+this.getExclusions(a)+"&token="+app.user.token),a.up("panel").query("miframe")[0].el.unmask(),this.logCtrl.addLog(app.patient.pid,app.user.id,b,"encounters","VIEW",null==b?"Patient C-CDA VIEWED":"Encounter C-CDA VIEWED"),TransactionLog.saveExportLog({pid:app.patient.pid,uid:app.user.id,eid:b,event:b?"Patient_CCDA_VIEWED":"Encounter_CCDA_VIEWED"})},onArchiveCcdBtnClick:function(a){var b=this.getEid(a);a.up("panel").query("miframe")[0].setSrc("dataProvider/CCDDocument.php?action=archive&site="+window.site+"&pid="+app.patient.pid+"&eid="+b+"&exclude="+this.getExclusions(a)+"&token="+app.user.token),a.up("panel").query("miframe")[0].el.unmask(),this.logCtrl.addLog(app.patient.pid,app.user.id,b,"encounters","ARCHIVE",null==b?"Patient C-CDA VIEWED":"Encounter C-CDA VIEWED"),TransactionLog.saveExportLog({pid:app.patient.pid,uid:app.user.id,eid:b,event:b?"Patient_CCDA_ARCHIVED":"Encounter_CCDA_ARCHIVED"})},onExportCcdBtnClick:function(a){var b=this.getEid(a);a.up("panel").query("miframe")[0].setSrc("dataProvider/CCDDocument.php?action=export&site="+window.site+"&pid="+app.patient.pid+"&eid="+b+"&exclude="+this.getExclusions(a)+"&token="+app.user.token),a.up("panel").query("miframe")[0].el.unmask(),this.logCtrl.addLog(app.patient.pid,app.user.id,b,"encounters","EXPORT",null==b?"Patient C-CDA VIEWED":"Encounter C-CDA VIEWED"),TransactionLog.saveExportLog({pid:app.patient.pid,uid:app.user.id,eid:b,event:b?"Patient_CCDA_Exported":"Encounter_CCDA_Exported"}),this.disclosuresCtrl.addRawDisclosure({pid:app.patient.pid,eid:b,uid:app.user.id,date:Ext.Date.format(new Date,"Y-m-d H:i:s"),type:"Health care operations",recipient:"patient",description:"Clinical Summary Provided (Exported)",active:1})},onPrintCcdBtnClick:function(a){var b=a.up("panel").query("miframe")[0].frameElement.dom.contentWindow;b.focus(),b.print();var c=this.getEid(a);this.logCtrl.addLog(app.patient.pid,app.user.id,c,"encounters","PRINT",null==c?"Patient C-CDA VIEWED":"Encounter C-CDA VIEWED"),TransactionLog.saveExportLog({pid:app.patient.pid,uid:app.user.id,eid:c,event:c?"Patient_CCDA_PRINTED":"Encounter_CCDA_PRINTED"}),this.disclosuresCtrl.addRawDisclosure({pid:app.patient.pid,eid:c,uid:app.user.id,date:Ext.Date.format(new Date,"Y-m-d H:i:s"),type:"Health care operations",recipient:"patient",description:"Clinical Summary Provided (PRINTED)",active:1})},onPatientCcdPanelEncounterCmbSelect:function(a,b){var c=this.getEid(a);a.selectedRecord=b[0],a.up("panel").query("miframe")[0].setSrc("dataProvider/CCDDocument.php?action=view&site="+window.site+"&pid="+app.patient.pid+"&eid="+c+"&exclude="+this.getExclusions(a)+"&token="+app.user.token),a.up("panel").query("miframe")[0].el.unmask(),this.logCtrl.addLog(app.patient.pid,app.user.id,c,"encounters","VIEW",null==c?"Patient C-CDA VIEWED":"Encounter C-CDA VIEWED"),TransactionLog.saveExportLog({pid:app.patient.pid,uid:app.user.id,eid:c,event:c?"Patient_CCDA_VIEWED":"Encounter_CCDA_VIEWED"})},getEid:function(a){var b=a.up("toolbar").query("#PatientCcdPanelEncounterCmb")[0];return b.selectedRecord?b.selectedRecord.data.eid:this.eid},cmbReset:function(a){var b=a.up("toolbar").query("#PatientCcdPanelEncounterCmb")[0];b.reset(),delete b.selectedRecord},getExclusions:function(a){var b=a.up("toolbar").query("#PatientCcdPanelExcludeCheckBoxGroup")[0].getValue(),c=b.exclude||[];return c.join?c.join(","):c},onImportCcdBtnClick:function(){var a=this,b=Ext.create("App.ux.form.fields.UploadString");b.allowExtensions=["xml","ccd","cda","ccda"],b.on("uploadready",function(b,c){a.getDocumentData(c)}),b.show()},getDocumentData:function(a){var b=this;CDA_Parser.parseDocument(a,function(c){b.importCtrl.validatePosibleDuplicates=!1,b.importCtrl.CcdImport(c,app.patient.pid,a),b.importCtrl.validatePosibleDuplicates=!0,b.promptCcdScore(a,c)})},promptCcdScore:function(a,b){var c=this;Ext.Msg.show({title:"C-CDA Score",msg:"Would you like to see this C-CDA score?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"===d&&c.doCcdScore(a,b)}})},doCcdScore:function(a,b){CDA_ScoreCard.getScoreDocument(a,Ext.String.format("{0}, {1} {3} (C-CDA)",b.patient.lname,b.patient.fname,b.patient.title),function(a){a&&app.getController("DocumentViewer").doDocumentView(a.id,"temp")})}}),Ext.define("App.controller.patient.CareTeam",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientSummaryCareTeamGrid",selector:"#PatientSummaryCareTeamGrid"},{ref:"CareTeamGridReferringPhysicianSearch",selector:"#CareTeamGridReferringPhysicianSearch"}],init:function(){var a=this;a.control({viewport:{patientsummaryload:a.onPatientSummaryLoad},"#CareTeamGridReferringPhysicianSearch":{select:a.onCareTeamGridReferringPhysicianSearchSelect},"#CareTeamGridIdPrimaryCheckColumn":{beforecheckchange:a.onCareTeamGridIdPrimaryCheckColumnBeforeCheckChange,checkchange:a.onCareTeamGridIdPrimaryCheckColumnCheckChange}})},onCareTeamGridIdPrimaryCheckColumnCheckChange:function(a){a.up("grid").getStore().sort("is_primary","DESC")},onCareTeamGridIdPrimaryCheckColumnBeforeCheckChange:function(a,b,c){if(c)for(var d=a.up("grid").getStore(),e=d.data.items,f=0;f<e.length;f++)f!==b&&e[f].set({is_primary:!1})},onCareTeamGridReferringPhysicianSearchSelect:function(a,b){var c=a.up("grid").getStore();c.add({pid:app.patient.pid,npi:b[0].get("npi"),fname:b[0].get("fname"),mname:b[0].get("mname"),lname:b[0].get("lname"),create_uid:app.user.id,create_date:app.getDate()}),a.reset()},onPatientSummaryLoad:function(a,b){var c=this;c.getPatientSummaryCareTeamGrid()&&Ext.Function.defer(function(){var a=c.getPatientSummaryCareTeamGrid().getStore();a.clearFilter(!0),a.filter([{property:"pid",value:b.pid}]),a.load()},250)}}),Ext.define("App.controller.patient.CCDImport",{extend:"Ext.app.Controller",requires:["App.view.patient.windows.PossibleDuplicates"],refs:[{ref:"CcdImportWindow",selector:"ccdimportwindow"},{ref:"CcdImportPreviewWindow",selector:"ccdimportpreviewwindow"},{ref:"CcdImportPatientForm",selector:"#CcdImportPatientForm"},{ref:"CcdImportActiveProblemsGrid",selector:"#CcdImportActiveProblemsGrid"},{ref:"CcdImportMedicationsGrid",selector:"#CcdImportMedicationsGrid"},{ref:"CcdImportAllergiesGrid",selector:"#CcdImportAllergiesGrid"},{ref:"CcdImportPatient",selector:"#CcdImportPatient"},{ref:"CcdPatientPatientForm",selector:"#CcdPatientPatientForm"},{ref:"CcdPatientActiveProblemsGrid",selector:"#CcdPatientActiveProblemsGrid"},{ref:"CcdPatientMedicationsGrid",selector:"#CcdPatientMedicationsGrid"},{ref:"CcdPatientAllergiesGrid",selector:"#CcdPatientAllergiesGrid"},{ref:"CDAViewer",selector:"#CDAViewer"},{ref:"CDAViewerImportBtn",selector:"#CDAViewerImportBtn"},{ref:"CcdImportPreviewPatientForm",selector:"#CcdImportPreviewPatientForm"},{ref:"CcdImportPreviewActiveProblemsGrid",selector:"#CcdImportPreviewActiveProblemsGrid"},{ref:"CcdImportPreviewMedicationsGrid",selector:"#CcdImportPreviewMedicationsGrid"},{ref:"CcdImportPreviewAllergiesGrid",selector:"#CcdImportPreviewAllergiesGrid"},{ref:"CcdImportWindowPreviewBtn",selector:"#CcdImportWindowPreviewBtn"},{ref:"CcdImportWindowImportBtn",selector:"#CcdImportWindowImportBtn"},{ref:"CcdImportWindowCloseBtn",selector:"#CcdImportWindowCloseBtn"},{ref:"CcdImportWindowPatientSearchField",selector:"#CcdImportWindowPatientSearchField"}],init:function(){var a=this;a.control({ccdimportwindow:{show:a.onCcdImportWindowShow},"#CcdImportPreviewWindowImportBtn":{click:a.onCcdImportPreviewWindowImportBtnClick},"#CcdImportWindowPreviewBtn":{click:a.onCcdImportWindowPreviewBtnClick},"#CcdImportWindowCloseBtn":{click:a.onCcdImportWindowCloseBtnClick},"#CcdImportWindowPatientSearchField":{select:a.onCcdImportWindowPatientSearchFieldSelect},"#CcdImportWindowSelectAllField":{change:a.onCcdImportWindowSelectAllFieldChange},"#CcdImportWindowViewRawCcdBtn":{click:a.onCcdImportWindowViewRawCcdBtnClick},"#CcdImportWindowSaveCcdaBtn":{click:a.onCcdImportWindowSaveCcdaBtnClick},"#PossiblePatientDuplicatesWindow > grid":{itemdblclick:a.onPossiblePatientDuplicatesGridItemDblClick},"#PossiblePatientDuplicatesContinueBtn":{click:a.onPossiblePatientDuplicatesContinueBtnClick},"#CcdImportPreviewWindowCancelBtn":{click:a.onCcdImportPreviewWindowCancelBtnClick},"#CDAViewerImportBtn":{click:a.onCDAViewerImportBtnClick}}),a.validatePosibleDuplicates=!0,a.on("importcomplete",a.doPatientSectionsImportComplete,a)},isSystemReconciliation:function(){return this.getCcdImportWindow().enableSystemReconciliation},CcdImport:function(a,b,c){this.getCcdImportWindow()||Ext.create("App.view.patient.windows.CCDImport"),this.getCcdImportWindow().ccd=c,this.getCcdImportWindow().ccdData=a,this.getCcdImportWindow().ccdDataImported=!1,this.getCcdImportWindow().show(),b&&this.doLoadsystemPatientData(b)},onCcdImportWindowShow:function(a){this.doLoadCcdData(a.ccdData)},doLoadCcdData:function(a){var b=this,c=b.getCcdImportPatientForm().getForm(),d=Ext.create("App.model.patient.Patient",a.patient);if(c.loadRecord(d),b.validatePosibleDuplicates&&App.app.getController("patient.Patient").lookForPossibleDuplicates({fname:d.data.fname,lname:d.data.lname,sex:d.data.sex,DOB:d.data.DOB},"ccdImportDuplicateAction"),a.patient.race&&""!==a.patient.race&&CombosData.getRaceByCode(a.patient.race,function(a){c.findField("race_text").setValue(a.code_description)}),a.patient.ethnicity&&""!==a.patient.ethnicity&&CombosData.getEthnicityByCode(a.patient.ethnicity,function(a){c.findField("ethnicity_text").setValue(a.code_description)}),a.patient.pid&&""!==a.patient.pid&&c.findField("phones").setValue(d.get("home_phone")),a&&(a.allergies&&a.allergies.length>0&&b.reconfigureGrid("getCcdImportAllergiesGrid",a.allergies),a.medications&&a.medications.length>0&&b.reconfigureGrid("getCcdImportMedicationsGrid",a.medications),a.problems&&a.problems.length>0&&b.reconfigureGrid("getCcdImportActiveProblemsGrid",a.problems),a.author)){var e="Import Data - From: ";a.author.fname&&(e+=" "+a.author.fname),a.author.lname&&(e+=", "+a.author.lname),a.author.address&&(e+=" - "+a.author.address),a.author.city&&(e+=" "+a.author.city),a.author.state&&(e+=", "+a.author.state),b.getCcdImportPatient().setTitle(e)}},onPossiblePatientDuplicatesGridItemDblClick:function(a,b){if(this.getCcdPatientPatientForm()){var c=this,d=c.getCcdImportWindowPatientSearchField(),e=(c.getCcdPatientPatientForm().getForm(),d.getStore()),f=a.up("window");"ccdImportDuplicateAction"==f.action&&(e.removeAll(),c.doLoadsystemPatientData(b.data.pid),d.select(b),f.close())}},reconfigureGrid:function(a,b){var c=this,d=c[a]();d.getStore().loadRawData(b)},onCcdImportWindowPatientSearchFieldSelect:function(a,b){var c=this,d=c.getCcdImportPatientForm().getForm().getRecord();d.data.sex!=b[0].data.sex&&app.msg(_("warning"),_("records_sex_are_not_equal"),!0),d.data.DOB.getFullYear()!=b[0].data.DOB.getFullYear()&&d.data.DOB.getMonth()!=b[0].data.DOB.getMonth()&&d.data.DOB.getDate()!=b[0].data.DOB.getDate()&&app.msg(_("warning"),_("records_date_of_birth_are_not_equal"),!0),c.doLoadsystemPatientData(b[0].data.pid)},doLoadsystemPatientData:function(a){var b=this,c=b.getCcdPatientPatientForm().getForm();App.model.patient.Patient.load(a,{success:function(a){c.loadRecord(a),a.data.race&&""!==a.data.race&&CombosData.getRaceByCode(a.data.race,function(a){c.findField("race_text").setValue(a.code_description)}),a.data.ethnicity&&""!==a.data.ethnicity&&CombosData.getEthnicityByCode(a.data.ethnicity,function(a){c.findField("ethnicity_text").setValue(a.code_description)}),c.findField("phones").setValue(a.get("home_phone")),b.getCcdPatientMedicationsGrid().reconfigure(a.medications()),a.medications().load({params:{reconciled:!0}}),b.getCcdPatientAllergiesGrid().reconfigure(a.allergies()),a.allergies().load(),b.getCcdPatientActiveProblemsGrid().reconfigure(a.activeproblems()),a.activeproblems().load()
}})},onCcdImportWindowCloseBtnClick:function(){this.getCcdImportWindow().close()},onCcdImportWindowPreviewBtnClick:function(){var a,b,c,d,e=this,f=!0,g=e.getCcdImportPatientForm().getForm().getRecord(),h=e.getCcdImportActiveProblemsGrid().getSelectionModel().getSelection(),i=e.getCcdImportMedicationsGrid().getSelectionModel().getSelection(),j=e.getCcdImportAllergiesGrid().getSelectionModel().getSelection(),k=e.getCcdPatientPatientForm().getForm().getRecord(),l=e.getCcdPatientActiveProblemsGrid().getStore().data.items,m=e.getCcdPatientMedicationsGrid().getStore().data.items,n=e.getCcdPatientAllergiesGrid().getStore().data.items,o=e.getCcdPatientActiveProblemsGrid().getSelectionModel().getSelection(),p=e.getCcdPatientMedicationsGrid().getSelectionModel().getSelection(),q=e.getCcdPatientAllergiesGrid().getSelectionModel().getSelection(),r=[],s=[],t=[],u=void 0!==k,v=e.isSystemReconciliation();if(u&&0===h.length&&0===i.length&&0===j.length)return void app.msg(_("oops"),_("nothing_to_merge"),!0);if(say("import"),say(h),say(i),say(j),say("system"),say(l),say(m),say(n),e.getCcdImportPreviewWindow()||Ext.create("App.view.patient.windows.CCDImportPreview"),e.getCcdImportPreviewWindow().show(),a=e.getCcdImportPreviewPatientForm().getForm(),u?(e.getCcdImportPreviewPatientForm().getForm().loadRecord(k),k.data.race&&""!==k.data.race&&CombosData.getDisplayValueByListIdAndOptionValue(14,k.data.race,function(b){a.findField("race_text").setValue(b)}),k.data.ethnicity&&""!==k.data.ethnicity&&CombosData.getDisplayValueByListIdAndOptionValue(59,k.data.ethnicity,function(b){a.findField("ethnicity_text").setValue(b)}),a.findField("phones").setValue(g.get("home_phone"))):(e.getCcdImportPreviewPatientForm().getForm().loadRecord(g),g.data.race&&""!==g.data.race&&CombosData.getDisplayValueByListIdAndOptionValue(14,g.data.race,function(b){a.findField("race_text").setValue(b)}),g.data.ethnicity&&""!==g.data.ethnicity&&CombosData.getDisplayValueByListIdAndOptionCode(59,g.data.ethnicity,function(b){a.findField("ethnicity_text").setValue(b)}),a.findField("phones").setValue(g.get("home_phone"))),f){for(d=Ext.clone(v?o:l),c=e.getCcdPatientActiveProblemsGrid().getStore(),b=0;b<h.length;b++)-1===c.find("code",h[b].data.code)&&Ext.Array.insert(d,0,[h[b]]);if(e.getCcdImportPreviewActiveProblemsGrid().getStore().loadRecords(d),v)for(r=Ext.clone(l),b=0;b<o.length;b++)r=Ext.Array.remove(r,o[b]);for(d=Ext.clone(v?p:m),c=e.getCcdPatientMedicationsGrid().getStore(),b=0;b<i.length;b++)-1===c.find("RXCUI",i[b].data.RXCUI)&&Ext.Array.insert(d,0,[i[b]]);if(e.getCcdImportPreviewMedicationsGrid().getStore().loadRecords(d),v)for(s=Ext.clone(m),b=0;b<p.length;b++)s=Ext.Array.remove(s,p[b]);for(d=Ext.clone(v?q:n),c=e.getCcdPatientAllergiesGrid().getStore(),b=0;b<j.length;b++)-1===c.find("allergy_code",j[b].data.allergy_code)&&Ext.Array.insert(d,0,[j[b]]);if(e.getCcdImportPreviewAllergiesGrid().getStore().loadRecords(d),v)for(t=Ext.clone(n),b=0;b<q.length;b++)t=Ext.Array.remove(t,q[b]);say("reconcile"),say(r),say(s),say(t);var w=!1;v&&(w=[],w=Ext.Array.merge(w,r),w=Ext.Array.merge(w,s),w=Ext.Array.merge(w,t)),e.getCcdImportPreviewWindow().system_reconcile_records=w}else e.getCcdImportPreviewActiveProblemsGrid().getStore().loadRecords(Ext.Array.merge(h,l)),e.getCcdImportPreviewMedicationsGrid().getStore().loadRecords(Ext.Array.merge(i,m)),e.getCcdImportPreviewAllergiesGrid().getStore().loadRecords(Ext.Array.merge(j,n))},onCcdImportPreviewWindowImportBtnClick:function(){var a=this,b=a.getCcdImportPreviewPatientForm().getForm().getRecord();b.data.pid?a.promptVerifyPatientImport(b):App.app.getController("patient.Patient").lookForPossibleDuplicates({fname:b.data.fname,lname:b.data.lname,sex:b.data.sex,DOB:b.data.DOB},"ccdImportDuplicateAction",function(c,d){d===!0&&a.promptVerifyPatientImport(b)})},promptVerifyPatientImport:function(a){var b=this;Ext.Msg.show({title:_("wait"),msg:_(a.data.pid?"patient_merge_verification":"patient_import_verification"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"==c&&(a.data.pid?b.doPatientSectionsImport(a):b.doPatientImport(a))}})},doPatientImport:function(a){var b=this;a.set({create_uid:app.user.id,create_date:new Date}),a.save({callback:function(a,c,d){d?b.doPatientSectionsImport(a):app.msg(_("oops"),_("record_error"),!0)}})},onCcdImportPreviewWindowCancelBtnClick:function(a){a.up("window").close()},doPatientSectionsImport:function(a){var b=this,c=b.getCcdImportPreviewWindow().system_reconcile_records;c!==!1?Ext.Msg.show({title:_("wait"),msg:"This action will import and reconcile patient record.<br><br>Would like to continue?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"==d&&b.doPatientSectionsImportCont(a,c)}}):b.doPatientSectionsImportCont(a,c)},doPatientSectionsImportCont:function(a,b){var c,d,e=this,f=new Date,g=a.data.pid,h=e.getCcdImportPreviewActiveProblemsGrid().getStore().data.items,i=e.getCcdImportPreviewMedicationsGrid().getStore().data.items,j=e.getCcdImportPreviewAllergiesGrid().getStore().data.items;for(say("doPatientSectionsImport"),say(h),say(i),say(j),say("system_reconcile_records"),say(b),e.importing=!0,b!==!1&&b.forEach(function(a){a.set({reconciled:!0,reconciled_date:f}),a.save()}),c=0;c<j.length;c++)j[c].data.id&&j[c].data.id>0||(j[c].set({pid:g,created_uid:app.user.id,create_date:f}),j[c].setDirty(),j[c].save({callback:function(){e.fireEvent("importcomplete",g)}}));for(j.length>=1&&(d=b!==!1?"RECONCILE":"IMPORT",AuditLog.addLog({pid:g,eid:g==app.patient.pid?app.patient.eid:"0",uid:app.user.id,foreign_table:"patient_allergies",event:d,event_description:"Patient CDA: Allergies"})),c=0;c<i.length;c++)i[c].data.id&&i[c].data.id>0||(i[c].set({pid:g,created_uid:app.user.id,create_date:f}),i[c].setDirty(),i[c].save({callback:function(){e.fireEvent("importcomplete",g)}}));for(i.length>=1&&(d=b!==!1?"RECONCILE":"IMPORT",AuditLog.addLog({pid:g,eid:g==app.patient.pid?app.patient.eid:"0",uid:app.user.id,foreign_table:"patient_medications",event:d,event_description:"Patient CDA: Medications"})),c=0;c<h.length;c++)h[c].data.id&&h[c].data.id>0||(h[c].set({pid:g,created_uid:app.user.id,create_date:f}),h[c].setDirty(),h[c].save({callback:function(){e.fireEvent("importcomplete",g)}}));h.length>=1&&(d=b!==!1?"RECONCILE":"IMPORT",AuditLog.addLog({pid:g,eid:g==app.patient.pid?app.patient.eid:"0",uid:app.user.id,foreign_table:"patient_active_problems",event:d,event_description:"Patient CDA: Problems"})),AuditLog.addLog({pid:g,eid:g==app.patient.pid?app.patient.eid:"0",uid:app.user.id,foreign_table:"patient",event:"CCDA_IMPORT",event_description:"Patient C-CDA IMPORT"})},addCdaToPatientDocument:function(a){var b=this,c=b.getCcdImportWindow();c.ccdDataImported||Ext.Msg.show({title:"Save/Archive",msg:"Would you like to save/archive this C-CDA?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"===c&&b.addCdaToPatientDocumentHandler(a)}})},addCdaToPatientDocumentHandler:function(a){var b=this,c=b.getCcdImportWindow();if(!c.ccdDataImported){var d=Ext.create("App.model.patient.PatientDocuments",{code:"",pid:a,eid:a==app.patient.pid?app.patient.eid:"0",uid:app.user.id,facility_id:app.user.facility,docType:"C-CDA",docTypeCode:"CD",date:app.getDate(),name:"imported_ccd.xml",note:"",title:"C-CDA Imported",encrypted:!1,error_note:"",site:app.user.site,document:c.ccd});d.save({callback:function(){say(_("sweet"),"C-CDA Imported"),c.ccdDataImported=!0,AuditLog.addLog({pid:a,eid:a==app.patient.pid?app.patient.eid:"0",uid:app.user.id,foreign_table:"patient",event:"CCDA_ARCHIVED",event_description:"Patient C-CDA Archived"})}})}},doPatientSectionsImportComplete:function(a){var b=this;if(b.importing){b.importing=!1;var c=app.getActivePanel().$className;b.addCdaToPatientDocument(a),b.getCcdImportWindow().close(),b.getCcdImportPreviewWindow().close(),"App.view.patient.Encounter"==c?app.setPatient(app.patient.pid,app.patient.eid,null,function(){app.getActivePanel().openEncounter(app.patient.eid)}):"App.view.patient.Summary"==c&&app.setPatient(a,null,null,function(){app.openPatientSummary()}),app.msg(_("sweet"),_("patient_data_imported"))}},onPossiblePatientDuplicatesContinueBtnClick:function(a){"ccdImportDuplicateAction"==a.up("window").action&&this.getCcdImportPreviewPatientForm()&&this.promptVerifyPatientImport(this.getCcdImportPreviewPatientForm().getForm().getRecord())},onCcdImportWindowSelectAllFieldChange:function(a,b){for(var c=this,d=c.getCcdImportWindow().query("grid"),e=0;e<d.length;e++){var f=d[e].getSelectionModel();b?f.selectAll():f.deselectAll()}},onCcdImportWindowViewRawCcdBtnClick:function(){var a=this,b=Ext.create("App.model.patient.PatientDocumentsTemp",{create_date:new Date,document_name:"temp_ccd.xml",document:a.getCcdImportWindow().ccd||a.getCcdImportWindow().ccr});b.save({callback:function(a){app.onDocumentView(a.data.id,"ccd")}})},onCcdImportWindowSaveCcdaBtnClick:function(){return app.patient.pid?void this.addCdaToPatientDocument(app.patient.pid):void app.msg(_("oops"),_("no_patient_selected"),!0)},CcdImportFromXml:function(a,b,c){var d=this;CDA_Parser.parseDocument(a,function(e){d.validatePosibleDuplicates=c,d.CcdImport(e,b,a),d.validatePosibleDuplicates=!0,d.promptCcdScore(a,e)})},viewCDAByXml:function(a){this.showCDAViewer();var b=this.getCDAViewer().down("miframe");Ext.Function.defer(function(){b.frameElement.dom.contentWindow.postMessage(a,document.origin),b.cdaXmlString=a},1e3)},onCDAViewerImportBtnClick:function(a){var b=a.up("window").down("miframe");this.CcdImportFromXml(b.cdaXmlString,app.patient.pid,!1)},showCDAViewer:function(){return this.getCDAViewer()||Ext.create("App.view.patient.windows.CDAViewer"),this.getCDAViewer().show()},promptCcdScore:function(a,b){var c=this;Ext.Msg.show({title:"C-CDA Score",msg:"Would you like to see this C-CDA score?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"===d&&c.doCcdScore(a,b)}})},doCcdScore:function(a,b){CDA_ScoreCard.getScoreDocument(a,Ext.String.format("{0}, {1} {3} (C-CDA)",b.patient.lname,b.patient.fname,b.patient.title),function(a){a&&app.getController("DocumentViewer").doDocumentView(a.id,"temp")})}}),Ext.define("App.controller.patient.DecisionSupport",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"DecisionSupportWarningPanel",selector:"#DecisionSupportWarningPanel"},{ref:"MedicalDecisionSupportWarningPanel",selector:"#MedicalDecisionSupportWarningPanel"},{ref:"MedicalDecisioMedicalWindownSupportWarningPanel",selector:"#MedicalWindow"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onBeforeEncounterLoad},"#MedicalWindow":{show:a.onMedicalWindowShow},"#DecisionSupportWarningPanelCloseBtn":{click:a.DecisionSupportWarningPanelCloseBtnClick}})},DecisionSupportWarningPanelCloseBtnClick:function(a){var b=a.up("decisionsupportwarningpanel");b.collapse(),b.hide(),b.removeAll()},onBeforeEncounterLoad:function(){this.getDecisionSupportAlerts()},onMedicalWindowShow:function(){this.getDecisionSupportAlerts()},getDecisionSupportAlerts:function(){var a,b,c,d;b=this.getDecisionSupportWarningPanel(),c=this.getMedicalDecisionSupportWarningPanel(),(b||c)&&(b&&(b.hide(),b.removeAll()),c&&(c.hide(),c.removeAll()),DecisionSupport.getAlerts({pid:app.patient.pid,alertType:"P"},function(e){for(d=0;d<e.length;d++){var f="decision-support-btn",g=e[d].reference_type,h=""!=e[d].reference?"resources/images/icons/icohelp.png":null,i=null;h&&("D"==g?(h="resources/images/icons/icohelpYellow.png",i="Diagnostic and Therapeutic Reference"):"E"==g&&(h="resources/images/icons/icohelpPurple.png",i="Evidence-Based CDS Intervention")),a={xtype:"button",margin:"2 5",icon:h,text:e[d].description,result:e[d],cls:f,tooltip:i,handler:function(a){""!=a.result.reference?window.open(a.result.reference,"_blank","toolbar=no, scrollbars=yes, resizable=yes, top=10, left=10, width=1000, height=600"):app.msg(_("oops"),_("no_reference_provided"),!0)}},b&&b.add(a),c&&c.add(a)}e.length>0&&(b&&b.show(),c&&c.show())}))}}),Ext.define("App.controller.patient.Dictation",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"DictationPanel",selector:"#DictationPanel"},{ref:"DictationPanelSaveBtn",selector:"#DictationPanelSaveBtn"}],encounter:null,dictationStore:null,init:function(){var a=this;a.control({viewport:{encounterload:a.onViewportEncounterLoad},"#DictationPanel":{activate:a.onDictationPanelActivate},"#DictationPanelSaveBtn":{click:a.onDictationPanelSaveBtnClick}})},onViewportEncounterLoad:function(a){this.encounter=a},onDictationPanelActivate:function(){var a=this,b=a.getDictationPanel().getForm();a.encounter.dictation().load({callback:function(c){return c.length>0?void b.loadRecord(c[0]):void b.loadRecord(Ext.create("App.model.patient.Dictation",{pid:a.encounter.get("pid"),eid:a.encounter.get("eid"),date:new Date,uid:app.user.id}))}})},onDictationPanelSaveBtnClick:function(){var a=this,b=a.getDictationPanel().getForm(),c=b.getRecord(),d=b.getValues();b.isValid()&&(c.set(d),c.save({callback:function(){app.msg(_("sweet"),_("record_saved"))}}))}}),Ext.define("App.controller.patient.CognitiveAndFunctionalStatus",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"CognitiveAndFunctionalStatusPanel",selector:"patientcognitiveandfunctionalstatuspanel"},{ref:"NewFunctionalStatusBtn",selector:"#newFunctionalStatusBtn"}],init:function(){var a=this;a.control({patientcognitiveandfunctionalstatuspanel:{activate:a.onCognitiveAndFunctionalStatusPanelActive},"#newFunctionalStatusBtn":{click:a.onNewFunctionalStatusBtnClick},"#functionalStatusCategoryCombo":{select:a.onFunctionalStatusCategoryComboSelect},"#functionalStatusSatausCombo":{select:a.onFunctionalStatusStatusComboSelect},"#functionalStatusCodeCombo":{select:a.onFunctionalStatusCodeComboSelect}})},onCognitiveAndFunctionalStatusPanelActive:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},onNewFunctionalStatusBtnClick:function(a){var b,c=a.up("grid"),d=c.getStore();c.editingPlugin.cancelEdit(),b=d.add({pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,begin_date:new Date,created_date:new Date}),c.editingPlugin.startEdit(b[0],0)},onFunctionalStatusCategoryComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({category_code:b[0].data.code,category_code_type:b[0].data.code_type})},onFunctionalStatusStatusComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({status_code:b[0].data.code,status_code_type:b[0].data.code_type})},onFunctionalStatusCodeComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({code:b[0].data.ConceptId,code_type:b[0].data.CodeType})}}),Ext.define("App.controller.patient.DoctorsNotes",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"DoctorsNotesGrid",selector:"patientdoctorsnotepanel"},{ref:"DoctorsNoteWindow",selector:"#DoctorsNoteWindow"},{ref:"PatientNoteForm",selector:"#PatientNoteForm"},{ref:"PrintDoctorsNoteBtn",selector:"#printDoctorsNoteBtn"},{ref:"NewDoctorsNoteBtn",selector:"#newDoctorsNoteBtn"}],init:function(){var a=this;a.control({patientdoctorsnotepanel:{activate:a.onDoctorsNotesGridActive,selectionchange:a.onDoctorsNotesGridSelectionChange,beforerender:a.onDoctorsNotesGridBeforeRender,itemdblclick:a.onDoctorsNotesGridItemDblClick},"#printDoctorsNoteBtn":{click:a.onPrintDoctorsNoteBtn},"#newDoctorsNoteBtn":{click:a.onNewDoctorsNoteBtn},"#DoctorsNoteWindowCancelBtn":{click:a.onDoctorsNoteWindowCancelBtnClick},"#DoctorsNoteWindowSaveBtn":{click:a.onDoctorsNoteWindowSaveBtnClick}}),a.docTemplates={},CombosData.getTemplatesTypes(function(b,c){for(var d=0;d<c.result.length;d++)c.result[d].id&&(a.docTemplates[c.result[d].id]=c.result[d].title)})},onDoctorsNotesGridBeforeRender:function(a){app.on("patientunset",function(){a.getStore().removeAll()})},onDoctorsNotesGridSelectionChange:function(a,b){this.getPrintDoctorsNoteBtn().setDisabled(0===b.length)},onNewDoctorsNoteBtn:function(a){this.showDoctorsNoteWindow();var b=a.up("grid"),c=this.getPatientNoteForm().getForm(),d=b.getStore().insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,refill:0,order_date:new Date,from_date:new Date});c.loadRecord(d[0])},onPrintDoctorsNoteBtn:function(a){var b=this,c=b.getDoctorsNotesGrid(),d=a.isModel?a:c.getSelectionModel().getSelection()[0],e={};e.pid=d.data.pid,e.eid=d.data.eid,e.docType="Doctors Note",e.templateId=d.data.template_id,e.docNoteid=d.data.id,DocumentHandler.createTempDocument(e,function(a,b){window.dual?dual.onDocumentView(b.result.id,"Doctors Note"):app.onDocumentView(b.result.id,"Doctors Note")})},onDoctorsNotesGridActive:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},templatesRenderer:function(a){return this.docTemplates[a]},onDoctorsNotesGridItemDblClick:function(a,b){this.showDoctorsNoteWindow();var c=this,d=c.getPatientNoteForm(),e=d.getForm(),f=d.query("multitextfield")[0],g=b.get("restrictions");e.loadRecord(b),f.setValue(g)},onDoctorsNoteWindowCancelBtnClick:function(){this.getDoctorsNotesGrid().getStore().rejectChanges(),this.getPatientNoteForm().getForm().reset(!0),this.getDoctorsNoteWindow().close()},onDoctorsNoteWindowSaveBtnClick:function(){var a=this,b=a.getPatientNoteForm(),c=b.getForm(),d=c.getValues(),e=c.getRecord(),f=e.store,g=b.query("multitextfield")[0],h=g.getValue();c.isValid()&&(d.restrictions=h,e.set(d),Ext.isEmpty(f.getModifiedRecords())?(a.getPatientNoteForm().getForm().reset(!0),a.getDoctorsNoteWindow().close()):f.sync({callback:function(){a.getPatientNoteForm().getForm().reset(!0),a.getDoctorsNoteWindow().close()}}))},showDoctorsNoteWindow:function(){return this.getDoctorsNoteWindow()||Ext.create("App.view.patient.windows.DoctorsNoteWindow"),this.getDoctorsNoteWindow().show()}}),Ext.define("App.controller.patient.DriverLicence",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"HeaderPatientLiveSearchField",selector:"#HeaderPatientLiveSearchField"}],fieldMap:{DBA:"drivers_license_exp",DAB:"lname",DBO:"lname",DCS:"lname",DAC:"fname",DBP:"fname",DCT:"fname",DAD:"mname",DBQ:"mname",DBB:"DOB",DBL:"DOB",DBC:"sex",DAG:"postal_address",DAH:"postal_address_cont",DAI:"postal_city",DAJ:"postal_state",DAK:"postal_code",DAQ:"drivers_license",DCG:"postal_country"},init:function(){var a=this;a.control({viewport:{barcodelicensescanned:a.onBarcodeLicenseScanned},"#DriverLicenceSearchBtn":{click:a.onDriverLicenceSearchBtnClick},"#DriverLicenceCreateBtn":{click:a.onDriverLicenceCreateBtnClick},"#DriverLicenceCancelBtn":{click:a.onDriverLicenceCancelBtnClick}})},onDriverLicenceSearchBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=this.getHeaderPatientLiveSearchField(),f=d.lname+", "+d.fname;say(e),e.setValue(f),e.doQuery(f)},onDriverLicenceCreateBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=app.getController("patient.Patient");e.lookForPossibleDuplicates(d,null,function(a,c){c===!0?(b.el.mask(_("please_wait")),Patient.createNewPatient(d,function(a){app.setPatient(a.pid,null,null,function(){b.el.unmask(),b.close(),b.newPatientCallback&&b.newPatientCallback(a)},!0)})):c.isModel===!0&&(b.el.mask(_("please_wait")),app.setPatient(c.get("pid"),null,null,function(){a.close(),b.el.unmask(),b.close(),b.newPatientCallback&&b.newPatientCallback(c)},!0))})},onDriverLicenceCancelBtnClick:function(a){a.up("window").close()},onBarcodeLicenseScanned:function(a){var b=this,c=b.parseDriverLic(a);return c.drivers_license&&""!==c.drivers_license?(say(c),void Patient.getPatients({filter:[{property:"drivers_license",value:c.drivers_license}]},function(a){0===a.length?b.patientNotFoundHandler(c):1===a.length?b.patientFoundHandler(c,a[0]):b.showMultiplePatientsFound(c,a)})):void app.msg(_("oops"),"Unable to parse driver license")},patientFoundHandler:function(a,b){app.setPatient(b.pid,null,app.user.site,function(){app.msg(_("sweet"),"Patient License Found"),app.openPatientSummary()},!0)},patientNotFoundHandler:function(a){Ext.create("Ext.window.Window",{title:"No License Found For:",width:450,layout:"fit",bodyPadding:5,items:{xtype:"form",bodyPadding:5,defaults:{anchor:"100%"},items:[{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"fname",fieldLabel:_("fname"),value:a.fname,labelAlign:"top",margin:"0 5 0 0",flex:2},{xtype:"textfield",name:"mname",fieldLabel:_("mname"),value:a.mname,labelAlign:"top",margin:"0 5 0 0",flex:1},{xtype:"textfield",name:"lname",fieldLabel:_("lname"),value:a.lname,labelAlign:"top",margin:"0 5 0 0",flex:3},{xtype:"textfield",name:"sex",fieldLabel:_("sex"),value:a.sex,labelAlign:"top",flex:2}]},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"drivers_license",fieldLabel:_("license_no"),value:a.drivers_license,labelAlign:"top",margin:"0 5 0 0",flex:1},{xtype:"datefield",name:"drivers_license_exp",fieldLabel:_("exp_date"),value:new Date(a.drivers_license_exp),labelAlign:"top",margin:"0 5 0 0",flex:1}]},{xtype:"textfield",name:"postal_address",fieldLabel:_("address"),value:a.postal_address,labelAlign:"top"},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"postal_city",fieldLabel:_("city"),value:a.postal_city,labelAlign:"top",margin:"0 5 0 0",flex:2},{xtype:"textfield",name:"postal_state",fieldLabel:_("state"),value:a.postal_state,labelAlign:"top",margin:"0 5 0 0",flex:1},{xtype:"textfield",name:"postal_code",fieldLabel:_("postal_code"),value:a.postal_code,labelAlign:"top",margin:"0 5 0 0",flex:1},{xtype:"textfield",name:"postal_country",fieldLabel:_("country"),value:a.postal_country,labelAlign:"top",flex:1}]}],buttons:[{text:_("search"),itemId:"DriverLicenceSearchBtn"},{text:_("create"),itemId:"DriverLicenceCreateBtn"},{text:_("cancel"),itemId:"DriverLicenceCancelBtn"}]}}).show()},showMultiplePatientsFound:function(a){var b=this.getHeaderPatientLiveSearchField();b.setValue(a.drivers_license),b.doQuery(a.drivers_license),app.msg(_("oops"),"Multiple Patient Licenses Found",!0)},parseDriverLic:function(a){var b=this,c=a.split("\n"),d={};return c.forEach(function(a){var c=a.substr(0,3),e=a.substr(3,100);b.fieldMap[c]&&(d[b.fieldMap[c]]=e.trim())}),d.sex&&(d.sex="1"===d.sex?"M":"F"),d.drivers_license_exp&&(d.drivers_license_exp=d.drivers_license_exp.replace(/(\d{2})(\d{2})(\d{4})/,"$1-$2-$3")),d.DOB&&(d.DOB=d.DOB.replace(/(\d{2})(\d{2})(\d{4})/,"$1-$2-$3")+" 00:00:00"),d}}),Ext.define("App.controller.patient.DocumentArchiveLocation",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientDocumentArchiveLocation",selector:"#PatientDocumentArchiveLocation"},{ref:"PatientDocumentArchiveLocationDocumentsGrid",selector:"#PatientDocumentArchiveLocationDocumentsGrid"},{ref:"PatientDocumentArchiveLocationDocumentsLocationGrid",selector:"#PatientDocumentArchiveLocationDocumentsLocationGrid"},{ref:"DocumentLocationWindow",selector:"#DocumentLocationWindow"},{ref:"DocumentLocationWindowForm",selector:"#DocumentLocationWindowForm"},{ref:"PatientDocumentArchiveLocationDocumentsLocationSearch",selector:"#PatientDocumentArchiveLocationDocumentsLocationSearch"},{ref:"PatientDocumentArchiveLocationDocumentArchivedBtn",selector:"#PatientDocumentArchiveLocationDocumentArchivedBtn"},{ref:"PatientDocumentArchiveLocationFromDate",selector:"#PatientDocumentArchiveLocationFromDate"},{ref:"PatientDocumentArchiveLocationToDate",selector:"#PatientDocumentArchiveLocationToDate"},{ref:"PatientDocumentArchiveLocationPatientSearch",selector:"#PatientDocumentArchiveLocationPatientSearch"},{ref:"PatientDocumentArchiveLocationDocumentsLocationNewEditBtn",selector:"#PatientDocumentArchiveLocationDocumentsLocationNewEditBtn"},{ref:"PatientDocumentArchiveLocationScannedBySearch",selector:"#PatientDocumentArchiveLocationScannedBySearch"},{ref:"PatientDocumentLocationDepartmentSearch",selector:"#PatientDocumentLocationDepartmentSearch"},{ref:"PatientDocumentArchiveLocationFacilitySearch",selector:"#PatientDocumentArchiveLocationFacilitySearch"},{ref:"PatientDocumentArchiveLocationDocumentPreview",selector:"#PatientDocumentArchiveLocationDocumentPreview"},{ref:"PatientDocumentArchiveLocationDocumentPreviewFrame",selector:"#PatientDocumentArchiveLocationDocumentPreviewFrame"},{ref:"PatientDocumentArchiveLocationDocumentsEntryAddBtn",selector:"#PatientDocumentArchiveLocationDocumentsEntryAddBtn"},{ref:"PatientDocumentArchiveLocationEntryWindow",selector:"#PatientDocumentArchiveLocationEntryWindow"},{ref:"PatientDocumentArchiveLocationEntryForm",selector:"#PatientDocumentArchiveLocationEntryForm"}],init:function(){var a=this;a.control({viewport:{beforerender:a.onAppBeforeRender},"#PatientDocumentArchiveLocationDocumentsGrid":{beforerender:a.onPatientDocumentLocationDocumentsGridBeforeRender,itemdblclick:a.onPatientDocumentLocationDocumentsGridItemDblClick},"#PatientDocumentArchiveLocationDocumentsGrid gridview":{drop:a.onPatientDocumentLocationDocumentsGridDrop},"#PatientDocumentArchiveLocationDocumentsLocationGrid":{beforerender:a.onPatientDocumentLocationDocumentsLocationGridBeforeRender,itemdblclick:a.onPatientDocumentLocationDocumentsLocationGridItemDblClick},"#PatientDocumentArchiveLocationDocumentsLocationGrid gridview":{drop:a.onPatientDocumentLocationDocumentsLocationGridDrop,beforedrop:a.onPatientDocumentLocationDocumentsLocationGridBeforeDrop},"#PatientDocumentArchiveLocationDocumentArchivedBtn":{toggle:a.onPatientDocumentLocationDocumentArchivedBtnToggle},"#PatientDocumentArchiveLocationFromDate":{change:a.onPatientDocumentLocationFromDateChange},"#PatientDocumentArchiveLocationToDate":{change:a.onPatientDocumentLocationToDateChange},"#PatientDocumentArchiveLocationPatientSearch":{select:a.onPatientDocumentLocationPatientSearchSelect,reset:a.onPatientDocumentLocationPatientSearchSelect},"#PatientDocumentArchiveLocationScannedBySearch":{change:a.onPatientDocumentLocationScannedBySearchChange},"#PatientDocumentLocationDepartmentSearch":{change:a.onPatientDocumentLocationDepartmentSearchChange},"#PatientDocumentArchiveLocationFacilitySearch":{change:a.onPatientDocumentLocationFacilitySearchChange},"#PatientDocumentArchiveLocationDocumentsLocationSearch":{select:a.onPatientDocumentLocationDocumentsLocationSearchSelect},"#PatientDocumentArchiveLocationDocumentsLocationNewEditBtn":{click:a.onPatientDocumentLocationDocumentsLocationNewEditBtnClick},"#PatientDocumentArchiveLocationDocumentsEntryAddBtn":{click:a.onPatientDocumentArchiveLocationDocumentsEntryAddBtnClick},"#DocumentLocationWindowCancelBtn":{click:a.onDocumentLocationWindowCancelBtnClick},"#DocumentLocationWindowSaveBtn":{click:a.onDocumentLocationWindowSaveBtnClick},"#PatientDocumentArchiveLocationDocumentPreview":{collapse:a.onPatientDocumentLocationDocumentPreviewCollapse},"#PatientDocumentArchiveLocationEntryCancelBtn":{click:a.onPatientDocumentArchiveLocationEntryCancelBtnClick},"#PatientDocumentArchiveLocationEntrySaveBtn":{click:a.onPatientDocumentArchiveLocationEntrySaveBtnClick}}),a.doDocumentsSearchBuffer=Ext.Function.createBuffered(a.doDocumentsSearch,1e3,a),a.docExtraParams={},a.locExtraParams={}},onPatientDocumentLocationDocumentsGridDrop:function(a,b){b.records.forEach(function(a){DocumentArchiveLocation.destroyPatientDocumentLocation(a.data,function(){a.set({id:0,location_id:0,archive_reference_number:"",archive_description:"",archived_by_fname:"",archived_by_mname:"",archived_by_lname:"",create_uid:0,create_date:null,update_uid:0,update_date:null}),a.commit()})})},onPatientDocumentLocationDocumentsLocationGridDrop:function(a,b){for(var c=b.records,d=this.getPatientDocumentArchiveLocationDocumentsLocationSearch(),e=d.findRecordByValue(d.getValue()),f=0;f<c.length;f++)c[f].set({location_id:e.get("id"),archive_reference_number:e.get("reference_number"),archive_description:e.get("description"),archived_by_fname:app.user.fname,archived_by_mname:app.user.mname,archived_by_lname:app.user.lname,create_uid:app.user.id,create_date:app.getDate(),update_uid:app.user.id,update_date:app.getDate()}),c[f].save({callback:function(a){a.commit()}})},onPatientDocumentLocationDocumentsLocationGridBeforeDrop:function(){var a=this.getPatientDocumentArchiveLocationDocumentsLocationSearch(),b=a.getValue(),c=a.findRecordByValue(a.getValue());return b&&c?void 0:!1},onAppBeforeRender:function(){a("access_documents_archive_panel")&&app.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,icon:"resources/images/icons/archive.png",handler:function(){app.nav.navigateTo("App.view.patient.DocumentArchiveLocation")},tooltip:_("document_archive")})},onPatientDocumentLocationDocumentsGridItemDblClick:function(a,b){this.doDocumentPreview(b)},onPatientDocumentLocationDocumentsLocationGridItemDblClick:function(a,b){this.doDocumentPreview(b)},doDocumentPreview:function(a){var b=this,c=b.getPatientDocumentArchiveLocationDocumentPreview(),d=b.getPatientDocumentArchiveLocationDocumentPreviewFrame(),e=Ext.String.format("dataProvider/DocumentViewer.php?site={0}&id={1}&token={2}",app.user.site,a.get("document_id"),app.user.token);c.expand(),d.setSrc(e)},onPatientDocumentLocationDocumentPreviewCollapse:function(){this.getPatientDocumentArchiveLocationDocumentPreviewFrame().setSrc("about:blank")},onPatientDocumentLocationDocumentsGridBeforeRender:function(a){var b=this;a.store.on("beforeload",function(a){a.getProxy().extraParams=b.docExtraParams})},onPatientDocumentLocationDocumentsLocationGridBeforeRender:function(a){var b=this;a.store.on("beforeload",function(a){a.getProxy().extraParams=b.locExtraParams})},doDocumentsSearch:function(){var a=this,b=a.getPatientDocumentArchiveLocationFromDate(),c=a.getPatientDocumentArchiveLocationToDate(),d=a.getPatientDocumentArchiveLocationPatientSearch(),e=a.getPatientDocumentArchiveLocationScannedBySearch(),f=a.getPatientDocumentArchiveLocationFacilitySearch(),g=(a.getPatientDocumentLocationDepartmentSearch(),a.getPatientDocumentArchiveLocationDocumentArchivedBtn()),h=a.getPatientDocumentArchiveLocationDocumentsGrid().getStore(),i={};b.isValid()&&c.isValid()&&(i.date_from=Ext.Date.format(b.getValue(),"Y-m-d 00:00:00"),i.date_to=Ext.Date.format(c.getValue(),"Y-m-d 23:59:59"),i.archived=g.pressed,i.is_worklist=!0,Ext.isNumber(d.getValue())&&(i.pid=d.getValue()),e.getValue()&&(i.uid=e.getValue()),f.getValue()&&(i.facility_id=f.getValue()),a.docExtraParams=i,h.loadPage(1))},showDocumentLocationWindow:function(){return this.getDocumentLocationWindow()||Ext.create("App.view.administration.DocumentLocationWindow"),this.getDocumentLocationWindow().show()},onPatientDocumentLocationDocumentArchivedBtnToggle:function(){this.doDocumentsSearchBuffer()},onPatientDocumentLocationFromDateChange:function(a,b){this.getPatientDocumentArchiveLocationToDate().setMinValue(b),this.doDocumentsSearchBuffer()},onPatientDocumentLocationToDateChange:function(a,b){this.getPatientDocumentArchiveLocationFromDate().setMaxValue(b),this.doDocumentsSearchBuffer()},onPatientDocumentLocationPatientSearchSelect:function(){this.doDocumentsSearchBuffer()},onPatientDocumentLocationScannedBySearchChange:function(){this.doDocumentsSearchBuffer()},onPatientDocumentLocationDepartmentSearchChange:function(){this.doDocumentsSearchBuffer()},onPatientDocumentLocationFacilitySearchChange:function(){this.doDocumentsSearchBuffer()},onPatientDocumentLocationDocumentsLocationSearchSelect:function(a,b){var c=this.getPatientDocumentArchiveLocationDocumentsLocationGrid(),d=c.getStore();0===b.length?(d.removeAll(),d.commitChanges()):(this.locExtraParams={is_worklist:!1,location_id:b[0].get("id")},d.loadPage(1))},onDocumentLocationWindowCancelBtnClick:function(){this.getDocumentLocationWindow().close()},onDocumentLocationWindowSaveBtnClick:function(){var a=this,b=a.getPatientDocumentArchiveLocationDocumentsLocationSearch(),c=a.getDocumentLocationWindowForm().getForm(),d=c.getValues(),e=c.getRecord();c.isValid()&&(e.set(d),e.save({callback:function(){a.getDocumentLocationWindow().close(),b.store.add(e),b.setValue(e.get("id")),a.onPatientDocumentLocationDocumentsLocationSearchSelect(b,[e])}}))},onPatientDocumentArchiveLocationDocumentsEntryAddBtnClick:function(){var a=this.getPatientDocumentArchiveLocationDocumentsLocationSearch().getValue();
return a?(this.showPatientDocumentArchiveLocationEntryWindow(),void this.getPatientDocumentArchiveLocationEntryForm().getForm().loadRecord(Ext.create("App.model.patient.PatientDocumentArchiveLocation",{location_id:a,document_id:0}))):void app.msg(_("oops"),_("document_location_required"),!0)},onPatientDocumentArchiveLocationEntryCancelBtnClick:function(){this.getPatientDocumentArchiveLocationEntryForm().getForm().reset(!0),this.getPatientDocumentArchiveLocationEntryWindow().close()},onPatientDocumentArchiveLocationEntrySaveBtnClick:function(){var a=this,b=a.getPatientDocumentArchiveLocationDocumentsLocationGrid().getStore(),c=a.getPatientDocumentArchiveLocationEntryForm().getForm(),d=c.getRecord(),e=c.getValues();return d.set(e),!d.phantom&&Ext.Object.isEmpty(d.getChanges())?void a.getPatientDocumentArchiveLocationEntryWindow().close():(d.set(d.phantom?{create_date:app.getDate(),update_date:app.getDate(),create_uid:app.user.id,update_uid:app.user.id,archived_by_fname:app.user.fname,archived_by_mname:app.user.mname,archived_by_lname:app.user.lname}:{update_date:app.getDate(),update_uid:app.user.id}),d.store||b.add(d),void b.sync({callback:function(){a.getPatientDocumentArchiveLocationEntryWindow().close()}}))},showPatientDocumentArchiveLocationEntryWindow:function(){return this.getPatientDocumentArchiveLocationEntryWindow()||Ext.create("Ext.window.Window",{title:_("entry"),height:200,width:400,layout:"fit",closeAction:"hide",itemId:"PatientDocumentArchiveLocationEntryWindow",items:{xtype:"form",itemId:"PatientDocumentArchiveLocationEntryForm",layout:"fit",items:[{xtype:"textarea",name:"notes"}]},buttons:[{text:_("cancel"),itemId:"PatientDocumentArchiveLocationEntryCancelBtn"},{text:_("save"),itemId:"PatientDocumentArchiveLocationEntrySaveBtn"}]}),this.getPatientDocumentArchiveLocationEntryWindow().show()},onPatientDocumentLocationDocumentsLocationNewEditBtnClick:function(){var a=this.getPatientDocumentArchiveLocationDocumentsLocationSearch(),b=a.getValue(),c=a.findRecordByValue(b);c||(c=Ext.create("App.model.patient.DocumentArchiveLocation",{reference_number:b})),this.showDocumentLocationWindow(),this.getDocumentLocationWindowForm().getForm().loadRecord(c)}}),Ext.define("App.controller.patient.FamilyHistory",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"FamilyHistoryWindow",selector:"familyhistorywindow"},{ref:"FamilyHistoryGrid",selector:"patientfamilyhistorypanel"},{ref:"FamilyHistoryForm",selector:"#FamilyHistoryForm"},{ref:"FamilyHistorySaveBtn",selector:"#familyHistorySaveBtn"},{ref:"FamilyHistoryOtherConditionField",selector:"#FamilyHistoryOtherConditionField"},{ref:"FamilyHistoryOtherReletionField",selector:"#FamilyHistoryOtherReletionField"},{ref:"FamilyHistoryOtherNoteField",selector:"#FamilyHistoryOtherNoteField"}],init:function(){var a=this;a.control({patientfamilyhistorypanel:{activate:a.onFamilyHistoryGridActivate},"#FamilyHistoryForm":{formitemsadded:a.onFamilyHistoryFormItemsAdded,beforerender:a.onFamilyHistoryFormBeforeRneder},"#FamilyHistoryGridAddBtn":{click:a.onFamilyHistoryGridAddBtnClick},"#FamilyHistoryWindowSaveBtn":{click:a.onFamilyHistoryWindowSaveBtnClick},"#FamilyHistoryWindowCancelBtn":{click:a.onFamilyHistoryWindowCancelBtnClick},"#FamilyHistoryGridRelationField":{select:a.onFamilyHistoryGridRelationFieldSelect}})},onFamilyHistoryGridRelationFieldSelect:function(a){var b=a.findRecordByValue(a.getValue()),c=a.up("form").getForm().getRecord();c.set({relation:b.get("option_name"),relation_code:b.get("option_value")})},onFamilyHistoryFormItemsAdded:function(a){a.insert(0,{xtype:"fieldset",title:_("other"),items:[{xtype:"snomedlivesearch",itemId:"FamilyHistoryOtherConditionField",fieldLabel:_("contition"),name:"other_contition",hideLabel:!1,anchor:"100%"},{xtype:"gaiaehr.combo",itemId:"FamilyHistoryOtherReletionField",fieldLabel:_("relation"),name:"other_relation",action:"relationcmb",width:300,list:109,allowBlank:!1,loadStore:!0,editable:!1,resetable:!0,value:""},{xtype:"textfield",itemId:"FamilyHistoryOtherNoteField",fieldLabel:_("note"),name:"other_note",anchor:"100%"}]})},onFamilyHistoryFormBeforeRneder:function(){},onDeactivateRecord:function(a,b){var c,d={id:b.data.id,pid:b.data.pid,eid:b.data.eid};Ext.Msg.show({title:_("removal"),msg:_("sure_for_removal"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"===b&&(c=a.getStore(),FamilyHistory.deleteFamilyHistory(d,function(){c.load({filters:[{property:"pid",value:app.patient.pid}]})}))}})},onFamilyHistoryGridActivate:function(a){var b=a.getStore();b.clearFilter(!0),b.load({filters:[{property:"pid",value:app.patient.pid}]})},onFamilyHistoryGridAddBtnClick:function(){this.showFamilyHistoryWindow(),this.getFamilyHistoryForm().getForm().reset()},showFamilyHistoryWindow:function(){this.getFamilyHistoryWindow()||Ext.create("App.view.patient.windows.FamilyHistory"),this.getFamilyHistoryWindow().show(),this.getFamilyHistoryWindow().setAutoScroll(!0)},onFamilyHistoryWindowSaveBtnClick:function(){var a,b,c,d=this.getFamilyHistoryGrid(),e=this.getFamilyHistoryForm().getForm(),f=d.getStore(),g=e.getValues(),h=[],i=!0,j=this.getFamilyHistoryOtherConditionField(),k=this.getFamilyHistoryOtherReletionField(),l=this.getFamilyHistoryOtherNoteField();if(j.getValue()&&k.getValue()){var m=j.findRecordByValue(j.getValue()),n=k.findRecordByValue(k.getValue());Ext.Array.push(h,{pid:app.patient.pid,eid:app.patient.eid,relation:n.get("option_name"),relation_code:n.get("code"),relation_code_type:n.get("code_type"),condition:m.get("Term"),condition_code:m.get("ConceptId"),condition_code_type:m.get("CodeType"),notes:l.getValue(),create_uid:app.user.id,create_date:new Date})}return Ext.Object.each(g,function(d,e){"0~0"!==e&&"0~0~"!==e&&(a=e.split("~"),1!==a.length&&(b=a[0].split(":"),c=a[1].split(","),i&&0===c.length&&(i=!1),c.forEach(function(a){a=a.split(":"),Ext.Array.push(h,{pid:app.patient.pid,eid:app.patient.eid,relation:a[2],relation_code:a[1],relation_code_type:a[0],condition:b[2],condition_code:b[1],condition_code_type:b[0],notes:a[3]||"",create_uid:app.user.id,create_date:new Date})})))}),0===h.length?void app.msg(_("oops"),_("no_history_selected"),!0):i?(f.add(h),f.sync(),void this.getFamilyHistoryWindow().close()):void app.msg(_("oops"),_("missing_required_information"),!0)},onFamilyHistoryWindowCancelBtnClick:function(){this.getFamilyHistoryWindow().close()}}),Ext.define("App.controller.patient.HealthConcerns",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"HealthConcernGrid",selector:"healthconcerngird"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onBeforeOpenEncounter},"#HealthConcernGridAddBtn":{click:a.onHealthConcernGridAddBtnClick}})},onBeforeOpenEncounter:function(a){this.getHealthConcernGrid()&&this.getHealthConcernGrid().getStore().load({filters:[{property:"eid",value:a.data.eid}]})},onHealthConcernGridAddBtnClick:function(a){var b,c=a.up("grid"),d=c.getStore();b=d.add({pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,create_date:app.getDate(),update_uid:app.user.id,update_date:app.getDate()}),c.editingPlugin.cancelEdit(),c.editingPlugin.startEdit(b[0],0)}}),Ext.define("App.controller.patient.EncounterGrid",{extend:"Ext.app.Controller",refs:[{ref:"EncountersGrid",selector:"#EncountersGrid"},{ref:"EncountersGridNewEncounterBtn",selector:"#EncountersGridNewEncounterBtn"},{ref:"EncountersGridNewProgressReportsBtn",selector:"#EncountersGridNewProgressReportsBtn"}],init:function(){var a=this;a.control({"#EncountersGrid":{activate:a.onEncountersGridActivate,itemdblclick:a.onEncountersGridItemDblClick,selectionchange:a.onEncountersGridSelectionChange},"#EncountersGridNewEncounterBtn":{click:a.onEncountersGridNewEncounterBtnClick},"#EncountersGridNewProgressReportsBtn":{click:a.onEncountersGridNewProgressReportsBtnClick}})},onEncountersGridActivate:function(a){a.store.clearFilter(!0),a.store.filter([{property:"pid",value:app.patient.pid}])},onEncountersGridNewProgressReportsBtnClick:function(a){var b=a.up("grid").getSelectionModel().getLastSelected();this.showProgressByEncounterRecord(b)},showProgressByEncounterRecord:function(a){this.showProgressByPidAndEidAndProviderId(a.get("pid"),a.get("eid"),a.get("provider_uid"))},showProgressByPidAndEidAndProviderId:function(a,b,c){var d={pid:a,eid:b,provider_uid:c,docType:"EncProgress",templateId:"11"};DocumentHandler.createTempDocument(d,function(a,b){say(b),app.onDocumentView(b.result.id,"EncProgress")})},onEncountersGridSelectionChange:function(a,b){a.view.panel.down("#EncountersGridNewProgressReportsBtn").setDisabled(0===b.length)},onEncountersGridItemDblClick:function(a,b){app.openEncounter(b.data.eid)},onEncountersGridNewEncounterBtnClick:function(){app.createNewEncounter()}}),Ext.define("App.controller.patient.Immunizations",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"SubmitImmunizationWindow",selector:"#SubmitImmunizationWindow"},{ref:"SubmitImmunizationGrid",selector:"#SubmitImmunizationGrid"},{ref:"ImmunizationPanel",selector:"patientimmunizationspanel"},{ref:"ImmunizationsGrid",selector:"patientimmunizationspanel #patientImmunizationsGrid"},{ref:"CvxGrid",selector:"patientimmunizationspanel #cvxGrid"},{ref:"CvxMvxCombo",selector:"cvxmanufacturersforcvxcombo"},{ref:"AddImmunizationBtn",selector:"patientimmunizationspanel #addImmunizationBtn"},{ref:"ReviewImmunizationsBtn",selector:"patientimmunizationspanel #reviewImmunizationsBtn"},{ref:"SubmitVxuBtn",selector:"patientimmunizationspanel #submitVxuBtn"},{ref:"ImmunizationsPresumedImmunityCheckbox",selector:"#ImmunizationsPresumedImmunityCheckbox"},{ref:"ImmunizationsImmunizationSearch",selector:"#ImmunizationsImmunizationSearch"},{ref:"ImmunizationsImmunizationNdcSearch",selector:"#ImmunizationsImmunizationNdcSearch"},{ref:"ImmunizationsDisorderCombo",selector:"#ImmunizationsDisorderCombo"},{ref:"ImmunizationsPresumedImmunityCheckbox",selector:"#ImmunizationsPresumedImmunityCheckbox"},{ref:"ImmunizationsQuickFormWindow",selector:"#ImmunizationsQuickFormWindow"}],init:function(){var a=this;a.control({patientimmunizationspanel:{activate:a.onPatientImmunizationsPanelActive},"patientimmunizationspanel #patientImmunizationsGrid":{selectionchange:a.onPatientImmunizationsGridSelectionChange,beforeedit:a.onPatientImmunizationsGridBeforeEdit,edit:a.onPatientImmunizationsGridEdit},"patientimmunizationspanel #cvxGrid":{expand:a.onCvxGridExpand},"patientimmunizationspanel #submitVxuBtn":{click:a.onSubmitVxuBtnClick},"patientimmunizationspanel #reviewImmunizationsBtn":{click:a.onReviewImmunizationsBtnClick},"patientimmunizationspanel #addImmunizationBtn":{click:a.onAddImmunizationBtnClick},"#ImmunizationsInformationSourceCombo":{change:a.onInformationSourceComboChange},"#ImmunizationsImmunizationSearch":{select:a.onImmunizationSearchSelect},"#ImmunizationsImmunizationNdcSearch":{select:a.onImmunizationNdcSearchSelect},"#patientImmunizationsEditFormAdministeredByField":{select:a.onPatientImmunizationsEditFormAdministeredByFieldSelect},"#SubmitImmunizationWindow #ActiveFacilitiesCombo":{change:a.onActiveFacilitiesChange},"#SubmitImmunizationWindow #ApplicationCombo":{change:a.onApplicationChange},"#ImmunizationsPresumedImmunityCheckbox":{afterrender:a.onImmunizationsPresumedImmunityCheckboxAfterRender},"#ImmunizationsUnableToPerformField":{select:a.onImmunizationsUnableToPerformFieldSelect},"#ImmunizationHistorySearchBtn":{click:a.onImmunizationHistorySearchBtnClick},"#ImmunizationsQuickFormWindowCancelBtn":{click:a.onImmunizationsQuickFormWindowCancelBtnClick},"#ImmunizationsQuickFormWindowAddBtn":{click:a.onImmunizationsQuickFormWindowAddBtnClick},"#PatientSummaryImmunizationPanelQuickAddBtn":{click:a.onPatientSummaryImmunizationPanelQuickAddBtnClick},"#ImmunizationPanelQuickAddBtn":{click:a.onImmunizationPanelQuickAddBtnClick}}),a.immunizations_quick_form_items=[],a.getImmunizationsQuickFormWindowFromItems()},onPatientImmunizationsGridEdit:function(a,b){app.fireEvent("immunizationedit",this,b.record);{var c=b.record.get("pid");b.record.get("id")}b.record.new_immunization===!0||(b.record.get("is_error")?this.onImmunizationRecordEdit(c,b.record.data,"DELETE"):this.onImmunizationRecordEdit(c,b.record.data,"UPDATE"))},onImmunizationHistorySearchBtnClick:function(){var a=this;ImmunizationRegistry.getImmunizationHxByPid(app.patient.pid,function(b){return b.success===!1||void 0===!b.messages?void app.msg(_("oops"),"Immunization Search Failed",!0):void b.messages.forEach(function(b){a.showImmunizationRegistryResponse(b)})})},showImmunizationRegistryResponse:function(a){return a.response.success===!1?void app.msg(_("oops"),a.response.message,!0):void Ext.create("App.view.patient.windows.ImmunizationRegisterResponseWindow",{hl7Message:a.response.message,hl7Printed:a.response.print}).show()},onImmunizationRecordEdit:function(a,b,c){var d=this,e={};e.pid=a,e.facility_id=app.user.facility,e.immunizations=[b],e.action=c,ImmunizationRegistry.sendImmunization(e,function(a){return a.success===!1||void 0===!a.messages?void app.msg(_("oops"),"Immunization Search Failed",!0):void a.messages.forEach(function(a){d.showImmunizationRegistryResponse(a)})})},doImmunizationVxuSubmit:function(a){var b=this,c=a.up("window"),d=c.down("grid").getStore().data.items,e={pid:app.patient.pid,eid:app.patient.eid,facility_id:app.user.facility,action:"NEW",immunizations:[]};d.forEach(function(a){e.immunizations.push(a.data)}),ImmunizationRegistry.sendImmunization(e,function(a){a.success?(c.close(),a.messages.forEach(function(a){b.showImmunizationRegistryResponse(a)})):app.msg(_("oops"),"Registry Message Error",!0)})},onImmunizationsUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onImmunizationsPresumedImmunityCheckboxAfterRender:function(a){var b=this;a.el.on("click",function(){Ext.Function.defer(function(){b.onImmunizationsPresumedImmunityCheckboxClick(a)},100)})},onImmunizationsPresumedImmunityCheckboxClick:function(a){var b=a.up("form").getForm().getRecord(),c=a.getValue(),d="NDC"===b.get("code_type");this.setImmunizationFields(c,d),this.getImmunizationsImmunizationSearch().reset(),this.getImmunizationsDisorderCombo().reset(),b.set(c?{presumed_immunity_code:"",code:"998",code_type:"CVX",vaccine_name:"no vaccine administered"}:{code:"",code_type:"",vaccine_name:""})},setImmunizationFields:function(a,b){this.getImmunizationsDisorderCombo().setVisible(a),this.getImmunizationsDisorderCombo().setDisabled(!a),this.getImmunizationsImmunizationSearch().setVisible(!a),this.getImmunizationsImmunizationSearch().setDisabled(a),this.getImmunizationsImmunizationSearch().setVisible(!b),this.getImmunizationsImmunizationSearch().setDisabled(b),this.getImmunizationsImmunizationNdcSearch().setVisible(b),this.getImmunizationsImmunizationNdcSearch().setDisabled(!b)},onPatientImmunizationsEditFormAdministeredByFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({administered_uid:b[0].data.id,administered_title:b[0].data.title,administered_fname:b[0].data.fname,administered_mname:b[0].data.mname,administered_lname:b[0].data.lname})},onInformationSourceComboChange:function(a,b){var c=this.getImmunizationsImmunizationSearch(),d=this.getImmunizationsImmunizationNdcSearch();"00"===b?(c.hide(),c.disable(),d.show(),d.enable()):(c.show(),c.enable(),d.hide(),d.disable())},onImmunizationSearchSelect:function(a,b){var c=a.up("form").getForm();this.getCvxMvxCombo().getStore().load({params:{cvx_code:b[0].get("cvx_code")}}),c.getRecord().set({code:b[0].get("cvx_code"),code_type:"CVX"})},onImmunizationNdcSearchSelect:function(a,b){var c=a.up("form").getForm();this.getCvxMvxCombo().getStore().load({params:{cvx_code:b[0].get("CVXCode")}}),c.getRecord().set({code:b[0].get("CVXCode"),code_type:"CVX",ndc:b[0].get("NDC11")})},onCvxGridExpand:function(a){a.getStore().load()},onPatientImmunizationsGridSelectionChange:function(a,b){this.getSubmitVxuBtn().setDisabled(0===b.length)},onPatientImmunizationsGridBeforeEdit:function(a,b){var c=b.record,d="NDC"===c.get("code_type"),e=a.editor.getForm().findField("administered_by"),f=this.getImmunizationsImmunizationSearch(),g=this.getImmunizationsImmunizationNdcSearch();this.setImmunizationFields(b.record.get("is_presumed_immunity"),d),e.forceSelection=!1,Ext.Function.defer(function(){e.setValue(b.record.data.administered_by),e.forceSelection=!0,d?g.setValue(b.record.get("vaccine_name")):f.setValue(b.record.get("vaccine_name"))},200)},onPatientImmunizationsPanelActive:function(){this.loadPatientImmunizations()},onSubmitVxuBtnClick:function(){var a=this,b=a.getImmunizationsGrid().getSelectionModel().getSelection();a.vxuWindow=a.getVxuWindow(),a.vxuWindow.down("grid").getStore().loadData(b)},onReviewImmunizationsBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_immunizations:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})},onAddImmunizationBtnClick:function(){var a=this.getImmunizationsGrid(),b=a.getStore();a.editingPlugin.cancelEdit();var c=b.insert(0,{created_uid:app.user.id,uid:app.user.id,pid:app.patient.pid,eid:app.patient.eid,facility_id:app.user.facility,create_date:new Date,begin_date:new Date});c[0].new_immunization=!0,a.editingPlugin.startEdit(c[0],0)},loadPatientImmunizations:function(){var a=this.getImmunizationsGrid().getStore();a.clearFilter(!0),a.filter([{property:"pid",value:app.patient.pid}])},getVxuWindow:function(){var a=this;return this.getSubmitImmunizationWindow()?this.getSubmitImmunizationWindow().show():Ext.widget("window",{title:"Immunization Registry Submission",closable:!1,itemId:"SubmitImmunizationWindow",modal:!0,bodyStyle:"background-color:white",layout:"fit",items:[{xtype:"grid",title:_("please_verify_the_information"),store:Ext.create("App.store.patient.PatientImmunization"),width:800,minHeight:200,maxHeight:500,itemId:"SubmitImmunizationGrid",viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize"}},columns:[{text:_("code"),dataIndex:"code",width:75},{text:_("vaccine_name"),dataIndex:"vaccine_name",flex:1},{text:_("administer_amount"),dataIndex:"administer_amount",width:130,renderer:function(a,b,c){return a+" "+c.get("administer_units")}},{text:_("date_administered"),dataIndex:"date_administered",flex:1}]},{xtype:"uxiframe",itemId:"downloadHL7",hidden:!0}],buttons:[{text:_("send"),scope:a,itemId:"send",handler:a.doImmunizationVxuSubmit,action:"send"},{text:_("cancel"),handler:function(a){a.up("window").close()}}]}).show()},onActiveFacilitiesChange:function(){Ext.ComponentQuery.query("#ApplicationCombo")[0].getValue()&&(Ext.ComponentQuery.query("#SubmitImmunizationWindow #send")[0].setDisabled(!1),Ext.ComponentQuery.query("#SubmitImmunizationWindow #download")[0].setDisabled(!1))},onApplicationChange:function(){Ext.ComponentQuery.query("#ActiveFacilitiesCombo")[0].getValue()&&(Ext.ComponentQuery.query("#SubmitImmunizationWindow #send")[0].setDisabled(!1),Ext.ComponentQuery.query("#SubmitImmunizationWindow #download")[0].setDisabled(!1))},showImmunizationsQuickFormWindow:function(){return this.getImmunizationsQuickFormWindow()||Ext.create("Ext.window.Window",{title:"Immunizations Quick Form",width:700,layout:"fit",itemId:"ImmunizationsQuickFormWindow",closeAction:"hide",items:{xtype:"form",bodyPadding:10,frame:!0,autoScroll:!0,maxHeight:650,items:this.immunizations_quick_form_items},buttons:[{text:_("cancel"),itemId:"ImmunizationsQuickFormWindowCancelBtn"},{text:_("add"),itemId:"ImmunizationsQuickFormWindowAddBtn"}]}),this.getImmunizationsQuickFormWindow().show()},getImmunizationsQuickFormWindowFromItems:function(){var a=this;a.immunizations_quick_form_items=[],Immunizations.getImmunizationQuickCodes(function(b){b.data.forEach(function(b){var c=JSON.parse(b.manufacturers),d=[{xtype:"container",layout:"hbox",anchor:"100%",items:[{xtype:"datefield",labelAlign:"top",fieldLabel:_("administered_date"),name:Ext.String.format("{0}~administered_date",b.cvx_code)},{xtype:"combobox",labelAlign:"top",fieldLabel:_("manufacturer"),flex:1,margin:"0 5 0 5",queryMode:"local",valueField:"mvx_code",displayField:"manufacturer",editable:!1,value:c[0]?c[0].mvx_code:"",store:Ext.create("Ext.data.Store",{fields:["id","mvx_code","manufacturer"],data:c}),name:Ext.String.format("{0}~manufacturers",b.cvx_code)},{xtype:"gaiaehr.combo",listKey:"immu_refusal",flex:1,labelAlign:"top",fieldLabel:_("refusal_reason"),margin:"0 0 5 0",loadStore:!0,editable:!1,queryMode:"local",value:"",name:Ext.String.format("{0}~refusal_reason_code",b.cvx_code)}]},{xtype:"gaiaehr.combo",itemId:"ImmunizationsInformationSourceCombo",listKey:"immu_info_source",anchor:"100%",labelAlign:"top",fieldLabel:_("source"),loadStore:!0,editable:!1,value:"",queryMode:"local",name:Ext.String.format("{0}~information_source_code",b.cvx_code)},{xtype:"textfield",labelAlign:"top",fieldLabel:_("note"),anchor:"100%",name:Ext.String.format("{0}~note",b.cvx_code)},{xtype:"displayfield",anchor:"100%",submitValue:!1,value:b.note}];a.immunizations_quick_form_items.push({xtype:"fieldset",title:Ext.String.format('<span style="font-weight: bold; font-size: 15px;">{0}</span>',b.name),style:"background-color: white;",labelAlign:"top",layout:{type:"vbox",align:"stretch"},margin:"5 0 25 0",items:d})})})},doCloseWindow:function(a){a.down("form").getForm().reset(),a.close()},onImmunizationsQuickFormWindowCancelBtnClick:function(a){this.doCloseWindow(a.up("window"))},onImmunizationsQuickFormWindowAddBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("form").getForm(),e=d.getValues(),f=b.getImmunizationsGrid(),g={};return null===app.patient.pid?void app.msg(_("info"),"No Patient Set",!0):(Ext.Object.each(e,function(a,b){var c=a.split("~"),d=c[0],e=c[1];void 0===g[d]&&(g[d]={}),g[d][e]=b}),Ext.Object.each(g,function(a,b){""===b.administered_date&&""===b.refusal_reason_code?delete g[a]:(g[a].cvx_code=a,g[a].pid=app.patient.pid,g[a].eid=app.patient.eid,g[a].facility_id=app.user.facility,g[a].uid=app.user.id,g[a].create_uid=app.user.id,g[a].create_date=Ext.util.Format.date(app.getDate(),"Y-m-d H:i:s"))}),g=Ext.Object.getValues(g),0===g.length?void app.msg(_("info"),"No Immunization Recorded","yellow"):void Immunizations.addQuickImmunization(g,function(){b.doCloseWindow(c),app.msg(_("sweet"),"Immunizations Added"),f&&f.isVisible(!0)&&f.getStore().reload()}))},onPatientSummaryImmunizationPanelQuickAddBtnClick:function(){app.getController("patient.Immunizations").showImmunizationsQuickFormWindow()},onImmunizationPanelQuickAddBtnClick:function(){app.getController("patient.Immunizations").showImmunizationsQuickFormWindow()}}),Ext.define("App.controller.patient.HL7",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"SyndromicSurveillanceBtn",selector:"#SyndromicSurveillanceBtn"}],init:function(){var a=this;a.control({"#soapForm":{render:a.onSoapFormRender},"#SyndromicSurveillanceBtn":{click:a.onAdt04MessageBtnClick}})},onSoapFormRender:function(b){a("hl7_send_adt04")&&b.getDockedItems()[0].insert(0,{xtype:"button",text:_("syndromic_surveillance"),tooltip:_("report_syndromic_surveillance"),itemId:"SyndromicSurveillanceBtn"})},onAdt04MessageBtnClick:function(){HL7Messages.broadcastADT({pid:app.patient.pid,eid:app.patient.eid,fid:app.user.facility,event:app.patient.encounterIsClose?"A03":"A04",anonymous:!0,map_codes_types:{ethnicity:"CDCREC"}},function(){})}}),Ext.define("App.controller.patient.ItemsToReview",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"ItemsToReviewPanel",selector:"#ItemsToReviewPanel"},{ref:"ItemsToReviewImmuGrid",selector:"#ItemsToReviewPanel #ItemsToReviewImmuGrid"},{ref:"ItemsToReviewAllergiesGrid",selector:"#ItemsToReviewPanel #ItemsToReviewAllergiesGrid"},{ref:"ItemsToReviewActiveProblemsGrid",selector:"#ItemsToReviewPanel #ItemsToReviewActiveProblemsGrid"},{ref:"ItemsToReviewMedicationsGrid",selector:"#ItemsToReviewPanel #ItemsToReviewMedicationsGrid"},{ref:"ReviewSmokingStatusCombo",selector:"#ItemsToReviewPanel #reviewsmokingstatuscombo"},{ref:"ItemsToReviewEducationGivenField",selector:"#ItemsToReviewPanel #ItemsToReviewEducationGivenField"},{ref:"EncounterMedicationReconciliations",selector:"#ItemsToReviewPanel #EncounterMedicationReconciliations"},{ref:"EncounterMedicationReconciliationsDateField",selector:"#ItemsToReviewPanel #EncounterMedicationReconciliationsDateField"},{ref:"EncounterSummaryCareProvided",selector:"#ItemsToReviewPanel #EncounterSummaryCareProvided"},{ref:"ItemsToReviewActivePainScaleGrid",selector:"#ItemsToReviewPanel #ItemsToReviewActivePainScaleGrid"}],init:function(){var a=this;a.control({"#ItemsToReviewPanel":{activate:a.storesLoad},"#encounterRecordAdd":{click:a.onReviewAll},"#ItemsToReviewPanel #ItemsToReviewEducationGivenField":{change:a.onItemsToReviewEducationGivenFieldChange},"#ItemsToReviewPanel #EncounterMedicationReconciliations":{change:a.onEncounterMedicationReconciliationsChange},"#ItemsToReviewPanel #EncounterMedicationReconciliationsDateField":{change:a.onEncounterMedicationReconciliationsDateFieldChange},"#ItemsToReviewPanel #EncounterSummaryCareProvided":{change:a.onEncounterSummaryCareProvidedChange}})},storesLoad:function(){var a=this,b={filters:[{property:"pid",value:app.patient.pid}]};a.getReviewSmokingStatusCombo().reset(),a.getItemsToReviewImmuGrid().getStore().load(b),a.getItemsToReviewAllergiesGrid().getStore().load(b),a.getItemsToReviewActiveProblemsGrid().getStore().load(b),a.getItemsToReviewMedicationsGrid().getStore().load(b),a.getItemsToReviewActivePainScaleGrid().getStore().load(b),a.smokeStatusStore=app.getController("patient.Social").smokeStatusStore,b.callback=function(){this.last()&&a.getReviewSmokingStatusCombo().setValue(this.last().data.status)},a.smokeStatusStore.load(b);var c=this.getController("patient.encounter.Encounter").getEncounterRecord();a.getEncounterSummaryCareProvided().suspendEvents(!1),a.getEncounterSummaryCareProvided().setValue(c.get("summary_care_provided")),a.getEncounterSummaryCareProvided().resumeEvents()},onReviewAll:function(){if(this.getReviewSmokingStatusCombo().isValid()){var a=this.getController("patient.encounter.Encounter"),b=a.getEncounterRecord();b.set({review_active_problems:!0,review_allergies:!0,review_dental:!0,review_immunizations:!0,review_medications:!0,review_smoke:!0,review_surgery:!0,review_pain_scales:!0}),b.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review")),a.getProgressNote()},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})}},onItemsToReviewEducationGivenFieldChange:function(a,b){var c=this.getController("patient.encounter.Encounter").getEncounterRecord();c.set({patient_education_given:b}),this.saveEncounterChanges(c)},onEncounterMedicationReconciliationsChange:function(a,b){var c=this.getController("patient.encounter.Encounter").getEncounterRecord();c.set({medication_reconciliations:b}),this.saveEncounterChanges(c)},onEncounterMedicationReconciliationsDateFieldChange:function(a,b){var c=this.getController("patient.encounter.Encounter").getEncounterRecord();a.isValid()&&(c.set({medication_reconciliations_date:b}),this.saveEncounterChanges(c))},onEncounterSummaryCareProvidedChange:function(a,b){var c=this.getController("patient.encounter.Encounter").getEncounterRecord();c.set({summary_care_provided:b}),this.saveEncounterChanges(c)},saveEncounterChanges:function(a){a.setDirty(),Ext.Object.isEmpty(a.getChanges())||a.save({success:function(){app.msg(_("sweet"),_("record_saved"))},failure:function(){app.msg(_("oops"),_("record_error"))}})}}),Ext.define("App.controller.patient.ImplantableDevice",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"ImplantableDeviceGrid",selector:"#ImplantableDeviceGrid"},{ref:"ImplantableDeviceDetailsWindow",selector:"#ImplantableDeviceDetailsWindow"},{ref:"ImplantableDeviceDetailsForm",selector:"#ImplantableDeviceDetailsForm"},{ref:"ImplantableDeviceDetailsUDIField",selector:"#ImplantableDeviceDetailsUDIField"},{ref:"ImplantableDeviceDetailsSaveBtn",selector:"#ImplantableDeviceDetailsSaveBtn"},{ref:"ImplantableDeviceGridAddBtn",selector:"#ImplantableDeviceGridAddBtn"},{ref:"ImplantableDeviceGridActiveBtn",selector:"#ImplantableDeviceGridActiveBtn"},{ref:"ImplantableDeviceReviewBtn",selector:"#ImplantableDeviceReviewBtn"}],init:function(){var a=this;a.control({"#ImplantableDeviceGrid":{activate:a.onImplantableDeviceGridActivate},"#ImplantableDeviceDetailsCancelBtn":{click:a.onImplantableDeviceDetailsCancelBtnClick},"#ImplantableDeviceDetailsSaveBtn":{click:a.onImplantableDeviceDetailsSaveBtnClick},"#ImplantableDeviceGridAddBtn":{click:a.onImplantableDeviceGridAddBtnClick},"#ImplantableDeviceDetailsParseBtn":{click:a.onImplantableDeviceDetailsParseBtnClick},"#ImplantableDeviceGridActiveBtn":{toggle:a.onImplantableDeviceGridActiveBtnToggle},"#ImplantableDeviceReviewBtn":{click:a.onImplantableDeviceReviewBtnBtnClick}})},onImplantableDeviceGridActivate:function(a){var b=a.getStore(),c=[{property:"pid",value:app.patient.pid}];this.getImplantableDeviceGridActiveBtn().pressed&&(c=Ext.Array.push(c,{property:"status",value:"Active"})),b.clearFilter(!0),b.filter(c)},onImplantableDeviceGridActionClick:function(a,b){this.showImplantableDeviceDetailsWindow(),this.getImplantableDeviceDetailsForm().getForm().reset(),this.getImplantableDeviceDetailsForm().getForm().setValues(b.data),this.getImplantableDeviceDetailsSaveBtn().hide()},onImplantableDeviceGridAddBtnClick:function(){this.showImplantableDeviceDetailsWindow()},onImplantableDeviceDetailsParseBtnClick:function(){var a=this,b=a.getImplantableDeviceDetailsUDIField().getValue();ImplantableDevice.getUidData({udi:b},function(b){if(b.parse.data.error)return void app.msg(_("oops"),b.parse.data.error,!0);var c=b.lookup.data.gudid.device,d=b.parse.data,e=b.snomed.data.concepts[0]?b.snomed.data.concepts[0]:{},f=c.gmdnTerms.gmdn[0]?c.gmdnTerms.gmdn[0]:{},g={udi:d.udi,di:d.di,description:e.snomedCTName,description_code:e.snomedIdentifier,description_code_type:"SNOMEDCT",gmdnpt_name:f.gmdnPTName||"",lot_number:d.lotNumber||"",serial_number:d.serialNumber||"",exp_date:d.expirationDate||null,mfg_date:d.manufacturingDateOriginal||null,donation_id:c.donationIdNumber||"",brand_name:c.brandName||"",version_model:c.versionModelNumber||"",company_name:c.companyName||"",mri_safety_info:c.MRISafetyStatus||"",required_lnr:c.labeledContainsNRL||!1};a.getImplantableDeviceDetailsForm().getForm().setValues(g),a.getImplantableDeviceDetailsSaveBtn().show()})},onImplantableDeviceGridActiveBtnToggle:function(){this.onImplantableDeviceGridActivate(this.getImplantableDeviceGrid())},onImplantableDeviceDetailsCancelBtnClick:function(){this.getImplantableDeviceDetailsForm().getForm().reset(),this.getImplantableDeviceDetailsWindow().close()},onImplantableDeviceDetailsSaveBtnClick:function(){var a=this,b=this.getImplantableDeviceGrid(),c=this.getImplantableDeviceDetailsForm().getForm(),d=Ext.create("App.model.patient.ImplantableDevice",c.getValues());say(c.getValues()),d.set({pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,update_uid:app.user.id,create_date:new Date,update_date:new Date}),b.getStore().add(d),b.getStore().sync({callback:function(){a.getImplantableDeviceDetailsForm().getForm().reset(),a.getImplantableDeviceDetailsWindow().close()}})},showImplantableDeviceDetailsWindow:function(){return this.getImplantableDeviceDetailsWindow()||Ext.create("App.view.patient.windows.ImplantableDeviceDetails"),this.getImplantableDeviceDetailsWindow().show()},onImplantableDeviceReviewBtnBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_implantable_devices:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})}}),Ext.define("App.controller.patient.Interventions",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"InterventionsGrid",selector:"interventionsgrid"},{ref:"InterventionWindow",selector:"#InterventionWindow"},{ref:"InterventionForm",selector:"#InterventionForm"},{ref:"InterventionGridAddBtn",selector:"#InterventionGridAddBtn"},{ref:"SoapPanelForm",selector:"#soapPanel form"}],bmi_underweight_intervention:{description:"Underweight Diet Education Plan Intervention",reason:"BMI below 18.5 OR above > 25 kg/m2",code:"370847001",code_text:"Provides instruction regarding dietary needs",code_type:"SNOMEDCT",dx_code:"248342006",dx_code_text:"Underweight (finding)",dx_code_type:"SNOMEDCT",threshold_in_months:-3},bmi_overweight_intervention:{description:"Overweight Diet Education Plan Intervention",reason:"BMI below 18.5 OR above > 25 kg/m2",code:"370847001",code_text:"Provides instruction regarding dietary needs",code_type:"SNOMEDCT",dx_code:"238131007",dx_code_text:"Overweight (finding)",dx_code_type:"SNOMEDCT",threshold_in_months:-3},init:function(){var a=this;
a.control({viewport:{beforeencounterload:a.onBeforeOpenEncounter,patientvitalsload:a.onPatientVitalsLoad},"#InterventionsGrid":{itemdblclick:a.onInterventionsGridItemDblClick},"#InterventionGridAddBtn":{click:a.onInterventionGridAddBtnClick},"#InterventionSearchField":{select:a.onInterventionSearchFieldSelect},"#InterventionFormCancelBtn":{click:a.onInterventionFormCancelBtnClick},"#InterventionFormSaveBtn":{click:a.onInterventionFormSaveBtnClick},"#InterventionUnableToPerformField":{select:a.onInterventionUnableToPerformFieldSelect}})},onInterventionUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onBeforeOpenEncounter:function(b){a("add_patient_interventions")&&this.getInterventionsGrid()&&this.getInterventionsGrid().getStore().load({filters:[{property:"eid",value:b.data.eid}]})},onInterventionsGridItemDblClick:function(a,b){this.showInterventionsGrid(),this.getInterventionForm().getForm().loadRecord(b)},onInterventionGridAddBtnClick:function(a){var b,c=a.up("grid"),d=c.getStore();b=d.add({pid:app.patient.pid,eid:app.patient.eid,intervention_type:"RecommendedNutrition",create_uid:app.user.id,create_date:app.getDate(),update_uid:app.user.id,update_date:app.getDate()}),this.showInterventionsGrid(),this.getInterventionForm().getForm().loadRecord(b[0])},onInterventionSearchFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({code:b[0].get("ConceptId"),code_text:b[0].get("Term"),code_type:b[0].get("CodeType")})},onInterventionFormCancelBtnClick:function(){this.getInterventionsGrid().getStore().rejectChanges(),this.getInterventionForm().getForm().reset(),this.getInterventionWindow().close()},onInterventionFormSaveBtnClick:function(){var a=this,b=a.getInterventionForm().getForm(),c=b.getRecord(),d=b.getValues();if(b.isValid()){if(c.set(d),Ext.Object.isEmpty(c.getChanges())&&!c.phantom)return b.reset(),void a.getInterventionWindow().close();c.set({update_uid:app.user.id,update_date:app.getDate()}),c.store.sync({success:function(){app.msg(_("sweet"),_("record_saved")),b.reset(),a.getInterventionWindow().close()},failure:function(){app.msg(_("oops"),_("record_error"),!0),b.reset(),a.getInterventionWindow().close()}})}},showInterventionsGrid:function(){return this.getInterventionWindow()||Ext.create("App.view.patient.encounter.InterventionWindow"),this.getInterventionWindow().show()},onCarePlanGoalSearchFieldSelect:function(a,b){var c=this,d=c.getCarePlanGoalsNewForm().getForm(),e=d.getRecord();e.set({goal_code:b[0].data.ConceptId,goal_code_type:b[0].data.CodeType})},onPatientVitalsLoad:function(b,c,d,e){if(a("add_patient_interventions")){var f,g,h=this,i=c.get("eid"),j=(app.patient.age.DMY.years,-1!==e.findBy(function(a){var b=a.get("bmi");return i===a.get("eid")&&b>1&&18.5>=b})),k=-1!==e.findBy(function(a){var b=a.get("bmi");return i===a.get("eid")&&b>=25});if(k)f=h.bmi_overweight_intervention;else{if(!j)return;f=h.bmi_underweight_intervention}g={filter:[{property:"pid",value:c.get("pid")},{property:"code",value:f.code},{property:"dx_code",value:f.dx_code},{property:"create_date",operator:">=",value:Ext.Date.format(Ext.Date.add(new Date,Ext.Date.MONTH,f.threshold_in_months),"Y-m-d 00:00:00")}]},Interventions.getPatientIntervention(g,function(a){a.data===!1&&h.promptIntervention(f)})}},promptIntervention:function(a){var b=this;Ext.Msg.show({title:a.description+" Required",msg:"Would you like to record this Intervention?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){"yes"===c&&b.addAutoIntervention(a)}})},addAutoIntervention:function(a){var b,c=this.getInterventionsGrid(),d=c.getStore();b=d.add({pid:app.patient.pid,eid:app.patient.eid,intervention_type:"RecommendedNutrition",code:a.code,code_text:a.code_text,code_type:a.code_type,dx_code:a.dx_code,dx_code_text:a.dx_code_text,dx_code_type:a.dx_code_type,create_uid:app.user.id,create_date:app.getDate(),update_uid:app.user.id,update_date:app.getDate()}),this.showInterventionsGrid(),this.getInterventionForm().getForm().loadRecord(b[0])}}),Ext.define("App.controller.patient.Insurance",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientDemographicsPanel",selector:"#PatientDemographicsPanel"},{ref:"PatientInsuranceFormSubscribeRelationshipCmb",selector:"#PatientInsuranceFormSubscribeRelationshipCmb"},{ref:"PatientInsurancesPanel",selector:"#PatientInsurancesPanel"},{ref:"PatientInsurancesForm",selector:"#PatientInsurancesForm"},{ref:"PatientInsurancesPanelSaveBtn",selector:"#PatientInsurancesPanelSaveBtn"},{ref:"PatientInsurancesPanelCancelBtn",selector:"#PatientInsurancesPanelCancelBtn"},{ref:"InsuranceCardFirstNameField",selector:"#InsuranceCardFirstNameField"},{ref:"InsuranceCardMiddleNameField",selector:"#InsuranceCardMiddleNameField"},{ref:"InsuranceCardLastNameField",selector:"#InsuranceCardLastNameField"},{ref:"InsuranceAddressSameAsPatientBtn",selector:"#InsuranceAddressSameAsPatientBtn"},{ref:"BillingPatientInsuranceCoverInformationCoverGrid",selector:"#BillingPatientInsuranceCoverInformationCoverGrid"},{ref:"BillingPatientInsuranceCoverInformationCoverGridUpdateDateField",selector:"#BillingPatientInsuranceCoverInformationCoverGridUpdateDateField"},{ref:"BillingPatientInsuranceCoverInformationCoverExceptionSearchField",selector:"#BillingPatientInsuranceCoverInformationCoverExceptionSearchField"},{ref:"BillingPatientInsuranceCoverInformationMspInsuranceTypeField",selector:"#BillingPatientInsuranceCoverInformationMspInsuranceTypeField"},{ref:"BillingPatientInsuranceCoverInformationDeductibleField",selector:"#BillingPatientInsuranceCoverInformationDeductibleField"},{ref:"PatientInsurancesFormIsActiveBtn",selector:"#PatientInsurancesFormIsActiveBtn"},{ref:"PatientInsurancesWindow",selector:"#PatientInsurancesWindow"}],init:function(){var a=this;a.control({viewport:{demographicsrecordload:a.onDemographicsRecordLoad},"#PatientInsurancesPanel":{beforeadd:a.onPatientInsurancesPanelBeforeAdd,newtabclick:a.onPatientInsurancesPanelNewTabClick},patientinsuranceform:{loadrecord:a.onPatientInsurancesFormLoadRecord},"#PatientInsuranceFormSubscribeRelationshipCmb":{select:a.onPatientInsuranceFormSubscribeRelationshipCmbSelect},"#InsuranceAddressSameAsPatientBtn":{click:a.onInsuranceAddressSameAsPatientBtnClick},"#PatientInsurancesPanelSaveBtn":{click:a.onPatientInsurancesPanelSaveBtnClick},"#PatientInsurancesPanelCancelBtn":{click:a.onPatientInsurancesPanelCancelBtnClick},"#BillingPatientInsuranceCoverInformationCoverGrid":{edit:a.onBillingPatientInsuranceCoverInformationCoverGridEdit,validateedit:a.onBillingPatientInsuranceCoverInformationCoverGridValidateEdit},"#BillingPatientInsuranceCoverInformationCoverExceptionSearchField":{select:a.onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldSelect,change:a.onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldchange,render:a.onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldRender},"#BillingPatientInsuranceCoverInformationMspInsuranceTypeField":{select:a.onBillingPatientInsuranceCoverInformationMspInsuranceTypeFieldSelect},"#PatientInsurancesWindow":{show:a.onPatientInsurancesWindowShow},"#PatientInsurancesWindowSaveBtn":{click:a.onPatientInsurancesWindowSaveBtnClick},"#PatientInsurancesWindowCancelBtn":{click:a.onPatientInsurancesWindowCancelBtnClick},"#InsuranceSubscriberAddressCopyBtn":{click:a.onInsuranceSubscriberAddressCopyBtnClick},"#PatientInsurancesFormIsActiveCkBox":{change:a.onPatientInsurancesFormIsActiveCkBoxChange},"#PatientInsuranceFormScannerBtn":{click:a.onPatientInsuranceFormScannerBtnClick},"#PatientInsuranceFormScannerOcrBtn":{click:a.onPatientInsuranceFormScannerOcrBtnClick}}),a.scannerCtrl=a.getController("Scanner"),a.doPatientInsurancesWindowCloseBuffered=Ext.Function.createBuffered(a.doPatientInsurancesWindowClose,250,a)},onPatientInsuranceFormScannerBtnClick:function(a){var b=this,c=a.up("#PatientInsuranceFormCardContainer"),d=c.down("image"),e=c.down("textareafield");b.scannerCtrl.showBasicScanWindow([],function(a){var f=new Image;f.crossOrigin="Anonymous",f.onload=function(){var a=b.trimImage(f);d.setSrc(a),c.doLayout()},f.src="data:image/jpeg;base64,"+a[0],e.setValue("data:image/jpeg;base64,"+a[0])})},onPatientInsuranceFormScannerOcrBtnClick:function(a){var b=this,c=a.up("#PatientInsuranceFormCardContainer"),d=c.down("image"),e=new Ext.LoadMask({msg:"Progress... 0%",target:d});e.show(),Tesseract.recognize(d.src,"eng",{logger:function(a){say(a),"recognizing text"===a.status&&e.msgTextEl.update(Ext.String.format("Progress... {0}%",Math.floor(100*a.progress)))}}).then(function(a){e.hide(),e.destroy(),b.onOcrComplete(a,d)})},onOcrComplete:function(a,b){say("onOcrComplete"),say(a),say(b)},trimImage:function(a){var b=255,c=a.width,d=a.height,e=document.createElement("canvas");e.setAttribute("width",c),e.setAttribute("height",d);var f=e.getContext("2d");f.drawImage(a,0,0);var g=f.getImageData(0,0,c,d),h=g.data,i=function(a,b){var d=c*b+a;return{red:h[4*d],green:h[4*d+1],blue:h[4*d+2],opacity:h[4*d+3]}},j=function(a){return a.red>b&&a.green>b&&a.blue>b},k=function(a){for(var b=a?1:-1,e=a?0:d-1;a?d>e:e>-1;e+=b)for(var f=0;c>f;f++){var g=i(f,e);if(!j(g))return a?e:Math.min(e+1,d)}return null},l=function(a){for(var b=a?1:-1,e=a?0:c-1;a?c>e:e>-1;e+=b)for(var f=0;d>f;f++){var g=i(e,f);if(!j(g))return a?e:Math.min(e+1,c)}return null},m=k(!0),n=k(!1),o=l(!0),p=l(!1),q=p-o,r=n-m;return e.setAttribute("width",q),e.setAttribute("height",r),f.drawImage(a,o,m,q,r,0,0,q,r),e.toDataURL()},onPatientInsurancesFormIsActiveCkBoxChange:function(a){{var b=a.up("form").getForm();b.getValues()}},onInsuranceSubscriberAddressCopyBtnClick:function(a){var b=a.up("form").getForm(),c=b.getValues();b.setValues({physical_address:c.postal_address,physical_address_cont:c.postal_address_cont,physical_city:c.postal_city,physical_state:c.postal_state,physical_zip:c.postal_zip,physical_country:c.postal_country}),app.msg(_("info"),_("postal_address_copied"),"blue")},onPatientInsurancesWindowSaveBtnClick:function(a){var b=this,c=a.up("window"),d=a.up("insurancestabpanel"),e=d.items;e.each(function(a){var d=a.getForm(),e=d.getValues(),f=d.getRecord();d.isValid()&&(f.set(e),f.save({callback:function(d){app.msg(_("sweet"),_("record_saved"));for(var e=a.down("grid").getStore(),g=e.getRange(),h=0;h<g.length;h++)g[h].set({patient_insurance_id:f.get("id")});Ext.Object.isEmpty(e.getModifiedRecords())?(b.updatePatientInsuranceForm(d),b.doPatientInsurancesWindowCloseBuffered(c)):e.sync({success:function(){b.updatePatientInsuranceForm(d),b.doPatientInsurancesWindowCloseBuffered(c)}})}}))})},updatePatientInsuranceForm:function(){say("updatePatientInsuranceForm"),this.patientInsurancePanelHandler(app.patient.record.insurance(),this.getPatientInsurancesPanel())},doPatientInsurancesWindowClose:function(a){a.close()},onPatientInsurancesWindowCancelBtnClick:function(a){a.up("window").close()},onPatientInsurancesWindowShow:function(a){var b=this,c=app.patient.record.insurance(),d=a.down("insurancestabpanel");c.count()>0?b.patientInsurancePanelHandler(c,d):c.load({filters:[{property:"pid",value:app.patient.record.get("pid")}],callback:function(){b.patientInsurancePanelHandler(c,d)}})},showPatientInsurancesWindow:function(){return this.getPatientInsurancesWindow()||Ext.create("App.view.patient.windows.PatientInsurancesWindow"),this.getPatientInsurancesWindow().show()},getActiveInsuranceFormPanel:function(){return this.getPatientInsurancesPanel().getActiveTab()},patientInsurancePanelHandler:function(a,b){say("patientInsurancePanelHandler"),a.sort([{sorterFn:function(a,b){var c=function(a){var b=a.get("insurance_type"),c=a.get("active");return"P"===b&&c?1:"C"===b&&c?2:"S"===b&&c?3:"T"===b&&c?4:5},d=c(a),e=c(b);return d===e?0:e>d?-1:1}}]),b.removeAll(!0);var c,d=a.data.items,e=[];for(c=0;c<d.length;c++)e.push({xtype:"patientinsuranceform",closable:!1,insurance:d[c],action:d[c].get("insurance_type")});b.add(e),say(b),b.items.length>0&&b.setActiveTab(0)},onDemographicsRecordLoad:function(a,b){var c=this,d=app.patient.record.insurance(),e=b.ownerCt.down("insurancestabpanel");d.load({filters:[{property:"pid",value:a.get("pid")}],callback:function(){c.patientInsurancePanelHandler(d,e)}})},insuranceFormLoadRecord:function(a,b){a.getForm().loadRecord(b),app.fireEvent("insurancerecordload",a,b)},onPatientInsurancesFormLoadRecord:function(a,b){var c=a.owner.down("grid"),d=b.get("pid"),e=b.get("id");c&&c.getStore().load({filters:[{property:"patient_id",value:d},{property:"patient_insurance_id",value:e}]})},getPatientInsurancesByType:function(a){for(var b=this,c=b.getPatientInsurancesPanel(),d=c.query(Ext.String.format("panel[action={0}]",a)),e=[],f=0;f<d.length;f++)e.push(d[0].insurance);return e},onPatientInsurancesPanelBeforeAdd:function(a,b){var c=this,d=(b.getForm(),b.insurance||Ext.create("App.model.patient.Insurance",{pid:c.pid}));c.insuranceFormLoadRecord(b,d),""!==d.get("image")&&b.down("image").setSrc(d.get("image")),b.setIcon(d.get("active")?"modules/billing/resources/images/icoDotGreen.png":"modules/billing/resources/images/icoDotRed.png"),b.title=d.get("ins_synonym")+" ("+(d.get("insurance_type")?d.get("insurance_type"):_("new"))+")",b.header.hide(!0)},onPatientInsurancesPanelNewTabClick:function(a){var b=this,c=b.getPatientInsurancesPanel(),d=c.items.length,e=Ext.create("App.model.patient.Insurance",{code:d+"~"+app.patient.pubpid,pid:app.patient.pid,card_name_same_as_patient:!0,card_first_name:app.patient.record.get("fname"),card_middle_name:app.patient.record.get("mname"),card_last_name:app.patient.record.get("lname"),subscriber_relationship:"01",subscriber_title:app.patient.record.get("title"),subscriber_given_name:app.patient.record.get("fname"),subscriber_middle_name:app.patient.record.get("mname"),subscriber_surname:app.patient.record.get("lname"),subscriber_dob:app.patient.record.get("DOB"),subscriber_sex:app.patient.record.get("sex"),subscriber_phone:app.patient.record.get("phone_mobile")||app.patient.record.get("phone_home"),subscriber_employer:app.patient.record.get("employer_name"),subscriber_street:app.patient.record.get("postal_address")+", "+app.patient.record.get("postal_address_cont"),subscriber_city:app.patient.record.get("postal_city"),subscriber_state:app.patient.record.get("postal_state"),subscriber_country:app.patient.record.get("postal_country"),subscriber_postal_code:app.patient.record.get("postal_zip"),active:!0,create_uid:app.user.id,update_uid:app.user.id,create_date:new Date,update_date:new Date});this.insuranceFormLoadRecord(a,e)},onInsuranceAddressSameAsPatientBtnClick:function(a){var b=a.up("form").getForm(),c=this.getPatientDemographicsPanel(),d=c.down("form").getForm(),e=d.getValues();b.setValues({subscriber_street:Ext.String.format("{0} {1}",e.postal_address,e.postal_address_cont).trim(),subscriber_city:e.postal_city,subscriber_state:e.postal_state,subscriber_postal_code:e.postal_zip,subscriber_country:e.postal_country}),app.msg(_("info"),_("postal_address_copied"),"blue")},onPatientInsuranceFormSubscribeRelationshipCmbSelect:function(a,b){{var c=a.up("form").getForm();c.getRecord()}c.findField("subscriber_relationship").setValue(b[0].get("option_value")),"01"===b[0].get("option_value")&&(c.findField("subscriber_title").setValue(app.patient.record.get("title")),c.findField("subscriber_given_name").setValue(app.patient.record.get("fname")),c.findField("subscriber_middle_name").setValue(app.patient.record.get("mname")),c.findField("subscriber_surname").setValue(app.patient.record.get("lname")),c.findField("subscriber_dob").setValue(app.patient.record.get("DOB")),c.findField("subscriber_sex").setValue(app.patient.record.get("sex")),c.findField("subscriber_phone").setValue(app.patient.record.get("phone_mobile")||app.patient.record.get("phone_home")),c.findField("subscriber_employer").setValue(app.patient.record.get("employer_name")))},onPatientInsurancesPanelCancelBtnClick:function(){var a=this.getActiveInsuranceFormPanel();if(a){var b=a.getForm(),c=b.getRecord();return c.get("id")>0?(b.reset(),void b.loadRecord(c)):void this.getPatientInsurancesPanel().remove(a)}},onBillingPatientInsuranceCoverInformationCoverGridEdit:function(){},onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldchange:function(a,b){if(!b)for(var c=a.up("fieldset").down("grid"),d=c.getStore(),e=d.getRange(),f=0;f<e.length;f++)e[f].set({exception_copay:0,exception_isDollar:!0,exception:!1})},onBillingPatientInsuranceCoverInformationMspInsuranceTypeFieldSelect:function(a,b){if(0!==a.value.length){var c=a.up("form"),d=c.getForm(),e=d.getRecord();e.set({msp_insurance_type:b[0].get("code")})}},onBillingPatientInsuranceCoverInformationCoverGridValidateEdit:function(a,b){if("copay"===b.field){var c=b.record,d=(c.get("copay"),b.value);c.set({copay:d,exception_copay:0,exception_isDollar:!1,exception:!1,update_date:new Date,update_uid:app.user.id})}if("exception_copay"===b.field){var c=b.record,e=(c.get("exception_copay"),b.value);c.set({copay:0,exception_copay:e,exception_isDollar:!0,exception:!0,update_date:new Date,update_uid:app.user.id})}},onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldRender:function(a){a.store.on("beforeload",function(b){var c=a.up("form").getForm().findField("insurance_id").getValue();b.getProxy().extraParams={insurance_id:c}},this)},onBillingPatientInsuranceCoverInformationCoverExceptionSearchFieldSelect:function(a,b){if(0!==a.value.length){{var c=this,d=a.up("form"),e=d.getForm();e.getRecord()}c.getBillingPatientInsuranceCoverInformationDeductibleField().setValue(b[0].get("deductible")),c.getBillingPatientInsuranceCoverInformationCoverExceptionSearchField().setValue(b[0].get("cover"));var f=a.up("fieldset").down("grid"),g=f.getStore(),h=g.getRange();BillingCover.getBillingCoverExceptionByCoverId(b[0].get("id"),function(a){for(var b=0;b<h.length;b++)h[b].set({exception_copay:0,exception_isDollar:!0,exception:!1});for(var c=0;c<a.length;c++)for(var d=0;d<h.length;d++)h[d].get("service_type_id")===a[c].service_type_id&&h[d].set({exception_copay:a[c].copay,exception_isDollar:a[c].isDollar,exception:!0,update_date:new Date,update_uid:app.user.id})})}},onPatientInsurancesPanelSaveBtnClick:function(a){var b=a.up("insurancestabpanel"),c=b.items;c.each(function(a){var b=a.getForm(),c=b.getValues(),d=b.getRecord();b.isValid()&&(d.set(c),d.save({callback:function(){app.msg(_("sweet"),_("record_saved"));for(var b=a.down("grid").getStore(),c=b.getRange(),e=0;e<c.length;e++)c[e].set({patient_insurance_id:d.get("id")});b.sync({success:function(){}})}}))})}}),Ext.define("App.controller.patient.LegalLetterSignatures",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientLegalLettersGrid",selector:"#PatientLegalLettersGrid"},{ref:"PatientLegalLettersSignDocumentBtn",selector:"#PatientLegalLettersSignDocumentBtn"}],init:function(){var a=this;a.control({"#PatientLegalLettersGrid":{activate:a.onPatientLegalLettersGridActive,selectionchange:a.onPatientLegalLettersGridSelectionChange,itemdblclick:a.onPatientLegalLettersGridItemDblClick},"#PatientLegalLettersSignDocumentBtn":{click:a.onPatientLegalLettersSignDocumentBtnClick},"#PatientLegalLettersSignDocumentSaveBtn":{click:a.onPatientLegalLettersSignDocumentSaveBtnClick},"#PatientLegalLettersPreviewDocumentBtn":{click:a.onPatientLegalLettersPreviewDocumentBtnClick}})},onPatientLegalLettersSignDocumentBtnClick:function(){say("onPatientLegalLettersSignDocumentBtnClick");var a=this.getPatientLegalLettersGrid().getSelectionModel().getSelection(),b=[];if(a.forEach(function(a){""===a.get("signature")&&b.push({pid:app.patient.pid,id:a.get("letter_id"),version:a.get("letter_version"),content:a.get("letter_content"),document_code:a.get("document_code")})}),0!==b.length){var c=Ext.create("Ext.window.Window",{title:"Capture Signature",layout:"fit",items:[{xtype:"topazsignature",firstName:app.patient.fname,lastName:app.patient.lname,eMail:app.patient.email,height:120,width:400}],letters_to_sign:b,buttons:[{xtype:"button",text:"Topaz Download",href:"http://www.topazsystems.com/Software/SigPlusExtLite.exe"},{xtype:"button",text:"Chrome Extension",href:"https://chrome.google.com/webstore/detail/Topaz-SigPlusExtLiteback/dhcpobccjkdnmibckgpejmbpmpembgco"},"->",{text:_("save"),itemId:"PatientLegalLettersSignDocumentSaveBtn"}]});c.show(),c.StartSignature()}},onPatientLegalLettersSignDocumentSaveBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("topazsignature").signatureObj;if(!d)return void app.msg(_("oops"),"No signature found",!0);var e="data:image/png;base64,"+d.imageData;LegalLetters.doSignDocuments(c.letters_to_sign,e,function(){c.close(),b.getPatientLegalLettersGrid().getStore().reload()})},onPatientLegalLettersPreviewDocumentBtnClick:function(){var a=this.getPatientLegalLettersGrid().getSelectionModel().getSelection(),b=[],c="data:image/jpeg;base64,/9j/4QVRRXhpZgAATU0AKgAAAAgABwESAAMAAAABAAEAAAEaAAUAAAABAAAAYgEbAAUAAAABAAAAagEoAAMAAAABAAIAAAExAAIAAAAhAAAAcgEyAAIAAAAUAAAAk4dpAAQAAAABAAAAqAAAANQALcbAAAAnEAAtxsAAACcQQWRvYmUgUGhvdG9zaG9wIDIyLjIgKE1hY2ludG9zaCkAMjAyMTowOToyOCAyMDoyMzoxMQAAAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAligAwAEAAAAAQAAAMgAAAAAAAAABgEDAAMAAAABAAYAAAEaAAUAAAABAAABIgEbAAUAAAABAAABKgEoAAMAAAABAAIAAAIBAAQAAAABAAABMgICAAQAAAABAAAEFwAAAAAAAABIAAAAAQAAAEgAAAAB/9j/7QAMQWRvYmVfQ00AAf/uAA5BZG9iZQBkgAAAAAH/2wCEAAwICAgJCAwJCQwRCwoLERUPDAwPFRgTExUTExgRDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwBDQsLDQ4NEA4OEBQODg4UFA4ODg4UEQwMDAwMEREMDAwMDAwRDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDP/AABEIADAAkAMBIgACEQEDEQH/3QAEAAn/xAE/AAABBQEBAQEBAQAAAAAAAAADAAECBAUGBwgJCgsBAAEFAQEBAQEBAAAAAAAAAAEAAgMEBQYHCAkKCxAAAQQBAwIEAgUHBggFAwwzAQACEQMEIRIxBUFRYRMicYEyBhSRobFCIyQVUsFiMzRygtFDByWSU/Dh8WNzNRaisoMmRJNUZEXCo3Q2F9JV4mXys4TD03Xj80YnlKSFtJXE1OT0pbXF1eX1VmZ2hpamtsbW5vY3R1dnd4eXp7fH1+f3EQACAgECBAQDBAUGBwcGBTUBAAIRAyExEgRBUWFxIhMFMoGRFKGxQiPBUtHwMyRi4XKCkkNTFWNzNPElBhaisoMHJjXC0kSTVKMXZEVVNnRl4vKzhMPTdePzRpSkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2JzdHV2d3h5ent8f/2gAMAwEAAhEDEQA/APVUkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJT//0PVUlzGR9aM6h2V0n0aj9YPtIo6fQRY2m2q7fbi9Qcdr3/ZsbGryPt/pPf8Ap8K+n1KvWoXTCY157pKXSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJT//R6nJ6X1+3Ou+srKy3qONaKsHp3qja/p7CWX0WuHp0syuoOc7OZ6nrfZ309Pp/wd66sGQDxPYrAf0n64F7iz6wUtaSS1v2BpgTo3d9qTfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKehSXPfsj65f/ADw0/wDuPb/71Jfsj65f/PDT/wC49v8A71JKf//Z/+0NSlBob3Rvc2hvcCAzLjAAOEJJTQQlAAAAAAAQAAAAAAAAAAAAAAAAAAAAADhCSU0EOgAAAAAA5QAAABAAAAABAAAAAAALcHJpbnRPdXRwdXQAAAAFAAAAAFBzdFNib29sAQAAAABJbnRlZW51bQAAAABJbnRlAAAAAENscm0AAAAPcHJpbnRTaXh0ZWVuQml0Ym9vbAAAAAALcHJpbnRlck5hbWVURVhUAAAAAQAAAAAAD3ByaW50UHJvb2ZTZXR1cE9iamMAAAAMAFAAcgBvAG8AZgAgAFMAZQB0AHUAcAAAAAAACnByb29mU2V0dXAAAAABAAAAAEJsdG5lbnVtAAAADGJ1aWx0aW5Qcm9vZgAAAAlwcm9vZkNNWUsAOEJJTQQ7AAAAAAItAAAAEAAAAAEAAAAAABJwcmludE91dHB1dE9wdGlvbnMAAAAXAAAAAENwdG5ib29sAAAAAABDbGJyYm9vbAAAAAAAUmdzTWJvb2wAAAAAAENybkNib29sAAAAAABDbnRDYm9vbAAAAAAATGJsc2Jvb2wAAAAAAE5ndHZib29sAAAAAABFbWxEYm9vbAAAAAAASW50cmJvb2wAAAAAAEJja2dPYmpjAAAAAQAAAAAAAFJHQkMAAAADAAAAAFJkICBkb3ViQG/gAAAAAAAAAAAAR3JuIGRvdWJAb+AAAAAAAAAAAABCbCAgZG91YkBv4AAAAAAAAAAAAEJyZFRVbnRGI1JsdAAAAAAAAAAAAAAAAEJsZCBVbnRGI1JsdAAAAAAAAAAAAAAAAFJzbHRVbnRGI1B4bEBywAAAAAAAAAAACnZlY3RvckRhdGFib29sAQAAAABQZ1BzZW51bQAAAABQZ1BzAAAAAFBnUEMAAAAATGVmdFVudEYjUmx0AAAAAAAAAAAAAAAAVG9wIFVudEYjUmx0AAAAAAAAAAAAAAAAU2NsIFVudEYjUHJjQFkAAAAAAAAAAAAQY3JvcFdoZW5QcmludGluZ2Jvb2wAAAAADmNyb3BSZWN0Qm90dG9tbG9uZwAAAAAAAAAMY3JvcFJlY3RMZWZ0bG9uZwAAAAAAAAANY3JvcFJlY3RSaWdodGxvbmcAAAAAAAAAC2Nyb3BSZWN0VG9wbG9uZwAAAAAAOEJJTQPtAAAAAAAQASwAAAABAAEBLAAAAAEAAThCSU0EJgAAAAAADgAAAAAAAAAAAAA/gAAAOEJJTQQNAAAAAAAEAAAAWjhCSU0EGQAAAAAABAAAAB44QklNA/MAAAAAAAkAAAAAAAAAAAEAOEJJTScQAAAAAAAKAAEAAAAAAAAAAThCSU0D9QAAAAAASAAvZmYAAQBsZmYABgAAAAAAAQAvZmYAAQChmZoABgAAAAAAAQAyAAAAAQBaAAAABgAAAAAAAQA1AAAAAQAtAAAABgAAAAAAAThCSU0D+AAAAAAAcAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAA4QklNBAAAAAAAAAIAAjhCSU0EAgAAAAAABgAAAAAAADhCSU0EMAAAAAAAAwEBAQA4QklNBC0AAAAAAAIAADhCSU0ECAAAAAAAEAAAAAEAAAJAAAACQAAAAAA4QklNBB4AAAAAAAQAAAAAOEJJTQQaAAAAAANJAAAABgAAAAAAAAAAAAAAyAAAAlgAAAAKAFUAbgB0AGkAdABsAGUAZAAtADEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAlgAAADIAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAADIAAAAAFJnaHRsb25nAAACWAAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAAAyAAAAABSZ2h0bG9uZwAAAlgAAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJdmVydEFsaWduZW51bQAAAA9FU2xpY2VWZXJ0QWxpZ24AAAAHZGVmYXVsdAAAAAtiZ0NvbG9yVHlwZWVudW0AAAARRVNsaWNlQkdDb2xvclR5cGUAAAAATm9uZQAAAAl0b3BPdXRzZXRsb25nAAAAAAAAAApsZWZ0T3V0c2V0bG9uZwAAAAAAAAAMYm90dG9tT3V0c2V0bG9uZwAAAAAAAAALcmlnaHRPdXRzZXRsb25nAAAAAAA4QklNBCgAAAAAAAwAAAACP/AAAAAAAAA4QklNBBQAAAAAAAQAAAADOEJJTQQMAAAAAAQzAAAAAQAAAJAAAAAwAAABsAAAUQAAAAQXABgAAf/Y/+0ADEFkb2JlX0NNAAH/7gAOQWRvYmUAZIAAAAAB/9sAhAAMCAgICQgMCQkMEQsKCxEVDwwMDxUYExMVExMYEQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAQ0LCw0ODRAODhAUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAAwAJADASIAAhEBAxEB/90ABAAJ/8QBPwAAAQUBAQEBAQEAAAAAAAAAAwABAgQFBgcICQoLAQABBQEBAQEBAQAAAAAAAAABAAIDBAUGBwgJCgsQAAEEAQMCBAIFBwYIBQMMMwEAAhEDBCESMQVBUWETInGBMgYUkaGxQiMkFVLBYjM0coLRQwclklPw4fFjczUWorKDJkSTVGRFwqN0NhfSVeJl8rOEw9N14/NGJ5SkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2N0dXZ3eHl6e3x9fn9xEAAgIBAgQEAwQFBgcHBgU1AQACEQMhMRIEQVFhcSITBTKBkRShsUIjwVLR8DMkYuFygpJDUxVjczTxJQYWorKDByY1wtJEk1SjF2RFVTZ0ZeLys4TD03Xj80aUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9ic3R1dnd4eXp7fH/9oADAMBAAIRAxEAPwD1VJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSU//9D1VJcxkfWjOodldJ9Go/WD7SKOn0EWNptqu324vUHHa9/2bGxq8j7f6T3/AKfCvp9Sr1qF0wmNee6Sl0kkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSU//0epyel9ftzrvrKyst6jjWirB6d6o2v6ewll9Frh6dLMrqDnOzmep632d9PT6f8HeurBkA8T2KwH9J+uBe4s+sFLWkktb9gaYE6N3fak37I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSnoUlz37I+uX/wA8NP8A7j2/+9SX7I+uX/zw0/8AuPb/AO9SSn//2QA4QklNBCEAAAAAAFcAAAABAQAAAA8AQQBkAG8AYgBlACAAUABoAG8AdABvAHMAaABvAHAAAAAUAEEAZABvAGIAZQAgAFAAaABvAHQAbwBzAGgAbwBwACAAMgAwADIAMQAAAAEAOEJJTQQGAAAAAAAHAAgBAQABAQD/4Q7faHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwNiA3OS4xNjQ2NDgsIDIwMjEvMDEvMTItMTU6NTI6MjkgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMi4yIChNYWNpbnRvc2gpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMS0wOS0yOFQyMDoyMzoxMS0wNDowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0wOS0yOFQyMDoyMzoxMS0wNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjEtMDktMjhUMjA6MjM6MTEtMDQ6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YzgzZmUzYmEtNTBkYi00ZDdjLTkzNGUtNjQ3MWQyZTg4MDFlIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6ZjYyYWNiM2QtZTkwMC05MjQzLThlZjEtN2QyZGQ4MjZiYWMyIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjI1NzEyYmQtY2U5Mi00MDNiLWFhNTUtNTc1N2Y0YTkyOTE3IiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIGRjOmZvcm1hdD0iaW1hZ2UvanBlZyI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MjI1NzEyYmQtY2U5Mi00MDNiLWFhNTUtNTc1N2Y0YTkyOTE3IiBzdEV2dDp3aGVuPSIyMDIxLTA5LTI4VDIwOjIzOjExLTA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoTWFjaW50b3NoKSIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6YzgzZmUzYmEtNTBkYi00ZDdjLTkzNGUtNjQ3MWQyZTg4MDFlIiBzdEV2dDp3aGVuPSIyMDIxLTA5LTI4VDIwOjIzOjExLTA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuMiAoTWFjaW50b3NoKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSJYICAgICAgICAiIHBob3Rvc2hvcDpMYXllclRleHQ9IlggICAgICAgICIvPiA8cmRmOmxpIHBob3Rvc2hvcDpMYXllck5hbWU9Il9fX19fX19fX19fXyIgcGhvdG9zaG9wOkxheWVyVGV4dD0iX19fX19fX19fX19fIi8+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6VGV4dExheWVycz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0idyI/Pv/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAABAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChjKSAxOTk4IEhld2xldHQtUGFja2FyZCBDb21wYW55AABkZXNjAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAEnNSR0IgSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYWVogAAAAAAAA81EAAQAAAAEWzFhZWiAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPZGVzYwAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRlc2MAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAACxSZWZlcmVuY2UgVmlld2luZyBDb25kaXRpb24gaW4gSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdmlldwAAAAAAE6T+ABRfLgAQzxQAA+3MAAQTCwADXJ4AAAABWFlaIAAAAAAATAlWAFAAAABXH+dtZWFzAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAACjwAAAAJzaWcgAAAAAENSVCBjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADcAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8ApACpAK4AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23////uACFBZG9iZQBkQAAAAAEDABADAgMGAAAAAAAAAAAAAAAA/9sAhAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAgICAgICAgICAgIDAwMDAwMDAwMDAQEBAQEBAQEBAQECAgECAgMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwP/wgARCADIAlgDAREAAhEBAxEB/8QAhQABAAMBAQAAAAAAAAAAAAAAAAkKCwgGAQEAAAAAAAAAAAAAAAAAAAAAEAADAAICAQUBAAAAAAAAAAAAGQoICQYHYHCgAgMFBBEAAAUEAwAABgIDAQAAAAAAAgMEBQYAAQcIN9iZYBESExQJIhVwoBYnEgEAAAAAAAAAAAAAAAAAAACg/9oADAMBAQIRAxEAAAC/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADPrLsB1oZ6RepOhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAFNgtblfAv8AwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM3sjvNVY98AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADPFIYzWaPeAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAET5TsLGpCWX8gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADM8NBs6oMyI0KTrQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGYIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAafYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/9oACAECAAEFAPep/wD/2gAIAQMAAQUA96n/AP/aAAgBAQABBQD2DW+TaBvP1JZ8YL5g9ZZ7YoG4mizYJ+3syxS4Z3x1/jv4Nu+1kfh7TcEpLdlP7+J+VtEu0j4azMCpANTnz/Q+/wAIrP1j8gxayQ/K5ZlZVHtO6r6v4D0l1r4RWhsm5Zkb31xD+PKKX/b91b2dwPurrbwfc/st4tqzwYkv1y8pyqyipe1TfXsawfjx2vfD7v5vB96nW+1bcTs0wkxH6xwTxVN22m3NbCbaXgxkNznKfFT1cWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2SC07JBadkgtOyQWnZILTskFp2Sei//9oACAECAgY/AGp//9oACAEDAgY/AGp//9oACAEBAQY/AP8AQaLaIhtoCR6l5dWCyxru1S7X/WFzal0WbHRtMneD5O/NOGmOcnggbuuA2jUFOpTydH17epu4fnHGHgwpthiVSXeK5dhqB8VMglqNc4wuVp/qb5nAn4xCceQB9hknSqm9Ta1/kIZH3A/wGG96tpN+o/KqePMEHlbLr0AUbxfhXJrxnbY94kRTI/p2p3y7C5q3tsdjEjVEx1D+J+AQarSLlh6hQlOSiT4liuz+YTs87Bt8PazMvZQFFoPC0UgnS4r89/IY43juMxGLt0bZFykSFuuWiAecjTlmqBDPGYO/wNP8JIUzamzhCbnZQ1vky80tEU1ZXj7asKSR5zc7plJiSL5Ba1B7M4/xEAmykpX9AjEhXynX6v8AYY9dFoZniYOxeN26VCVN6vGm00XsJieYAqQKiLf1YsoNrQJvNKOGXcuQNCJOWXc1cbepQtgL8W3bN7Dhd8R6/lplact4jC1e2CtM8uJ0xpCv6isZMSwJyUYyhEXe1beUZ/AwVqef2uZ7jpik4SqSwjUdG+lEqhqVIhOMcylnAFzDz1H5AVAlkaaTDgAM+uzod9N7XSnX+CIP+1fWlE6xWMZcnLLfMTnDvy0CnF+zDCIh4h+VEipBcImK2TC2f741Zf2glyZtMOMMuqcyrD17hs5SKYJB4PiLH0fyeqiCsxQw4lxNBELSrzzlBsTu1j2kiYZVyW9KgNAPxB3Ac5MzequpTtw1VQPD+LIw1wvG+MomxQeDxRmIsnbGCMRtuTtTQ2pS7fMQgp0aYNhDHcRho/mMYhDEIV/gjGn6etYDlcp/pJzBlmcG2ODCYsyBnuWqECTEWFkKktcWlWJ4taQELl6c21yhvq9GAVyz2wdr4/XZEsolzQyRyMHTk2JJyEjHn/WzKaJrMnrXGiXByEUJfG5O0KC0YFSlOEEmjJBw72TXCIcDy9i6Stsyxxk2Ix+dQeVNB1j21/i0obEzwyuiUfysKwFaBWAVwCsEwsV7hGEIrXtb4HyLsCea3L8tv/8A5trxDlv2T7yjL8kQrRMytWgMMLupjMJQJVD27XvcIRo0N04RffUEAHk79s+yydzljXjCcSm2KXqUlHGnZL2cnFljtkHKKkRxYErwHHrbIzRhNuAZd5C8FHkiApbBfQ45ExnH/wA7aTU1DJMl4r/r04BO89hVkBazJuIv4lDPXnyBqaSnBnJD8zbvbcQQXcAFij6339Vma5KAJ6b/AKXJeorm8L0RFjUohHSDKGEm4BgCFKtWScYsljUVYR5tyRPFriAUQmL+CI5jfHmj+58U1XxnNm/X/AMtnusec4filMW+yRvZ8g7ETSVvECSMzLHJS8lhV3cVBwCk0Xa0V7hCbY+5mEtUMRJQlw3DUIbY1Z1GiRoXGYSMVhr5jPn8lCWUlFI53K1ix2XiAGwPyVY7AtYFghtTZtv+sbXnYOfQXJEwT7LY5cNaMSZGykbgfNLXI07vOYi8ooEwyL/mmNdKzrO7OmVATtyhrczW1MWMlvPADDebspYRybrjlSWxVMHJ+FctQKb45lsCyC1CG1yxrKYsgMEckCuMHu6QxQzuAk1i1zYcSba/13GEP+XORt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3ciuRt//AFig3cj/AAv/AP/Z";
a.forEach(function(a){b.push({pid:app.patient.pid,id:a.get("letter_id"),version:a.get("letter_version"),content:a.get("letter_content"),document_code:a.get("document_code"),facility_id:app.user.facility})}),LegalLetters.doPreviewDocuments(b,c,function(a){a.forEach(function(a){app.onDocumentView(a,"temp")})})},onPatientLegalLettersGridSelectionChange:function(a,b){var c=!0;b.forEach(function(a){c&&(c=""!==a.get("signature"))}),this.getPatientLegalLettersSignDocumentBtn().setDisabled(c)},onPatientLegalLettersGridItemDblClick:function(a,b){var c=b.get("document_id");c>0&&app.onDocumentView(b.get("document_id"))},onPatientLegalLettersGridActive:function(a){var b=a.getStore();b.getProxy().extraParams={include_not_signed:!0},b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}]),this.getLegalLettersToSign(b)},getLegalLettersToSign:function(a){LegalLetters.getLegalLettersToSignByPid(app.patient.pid,app.user.facility,"PRE-REGISTRATION",function(b){b.forEach(function(b){a.add({letter_id:b.id,letter_version:b.version,letter_title:b.title,letter_content:b.content,document_code:b.document_code,pid:app.patient.pid,signature:""})})})}}),Ext.define("App.controller.patient.Medical",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"MedicalWindow",selector:"#MedicalWindow"},{ref:"EncounterMedicalToolbar",selector:"#EncounterMedicalToolbar"}],init:function(){var a=this;a.control({viewport:{navkey:a.onNavKey},"#MedicalWindow #immunization":{show:a.onPanelShow},"#MedicalWindow #allergies":{show:a.onPanelShow},"#MedicalWindow #activeproblems":{show:a.onPanelShow},"#MedicalWindow #familyhistory":{show:a.onPanelShow},"#MedicalWindow #patientprocedureshistorygrid":{show:a.onPanelShow},"#MedicalWindow #advancedirectives":{show:a.onPanelShow},"#MedicalWindow #medications":{show:a.onPanelShow},"#MedicalWindow #laboratories":{show:a.onPanelShow},"#MedicalWindow #socialhistory":{show:a.onPanelShow},"#MedicalWindow #referrals":{show:a.onPanelShow}}),a.items_indexes=Ext.state.Manager.get("appmedicalwinodwtaborder")||{}},onMedicalPanelIndexChange:function(a){this.items_indexes=a,Ext.state.Manager.set("appmedicalwinodwtaborder",a)},onMedicalWindowTabPanelDrop:function(a,b,c,d,e){var f=b.items.items,g={};f.forEach(function(a,b){g[a.card.itemId]=b}),this.onMedicalPanelIndexChange(g),this.reorderEnvounterMedicalToolbar(d,e)},reorderEnvounterMedicalToolbar:function(a,b){say("reorderEnvounterMedicalToolbar"),say(a),say(b);var c=this.getEncounterMedicalToolbar(),d=c.remove(a,!1);c.insert(b,d),c.doLayout()},getMedicalTabButtons:function(){var b,c=[],d=100;return a("access_patient_immunizations")&&(b=void 0!==this.items_indexes.immunization?this.items_indexes.immunization:d++,Ext.Array.insert(c,b,[{text:_("vaccs")+" ",action:"immunization",margin:"0 3 0 0",tooltip:_("vaccines_immunizations"),style:{backgroundColor:g("immunizations_tab_color"),backgroundImage:"none"},acl:a("access_patient_immunizations")}])),a("access_patient_allergies")&&(b=void 0!==this.items_indexes.allergies?this.items_indexes.allergies:d++,Ext.Array.insert(c,b,[{text:_("al")+" ",action:"allergies",margin:"0 3 0 0",tooltip:_("allergies"),style:{backgroundColor:g("allergies_tab_color"),backgroundImage:"none"},acl:a("access_patient_allergies")}])),a("access_active_problems")&&(b=void 0!==this.items_indexes.activeproblems?this.items_indexes.activeproblems:d++,Ext.Array.insert(c,b,[{text:_("act_prob")+" ",action:"activeproblems",margin:"0 3 0 0",tooltip:_("active_problems"),style:{backgroundColor:g("problems_tab_color"),backgroundImage:"none"},acl:a("access_active_problems")}])),a("access_family_history")&&(b=void 0!==this.items_indexes.familyhistory?this.items_indexes.familyhistory:d++,Ext.Array.insert(c,b,[{text:_("fam_hx")+" ",action:"familyhistory",margin:"0 3 0 0",tooltip:_("family_history"),style:{backgroundColor:g("family_history_tab_color"),backgroundImage:"none"},acl:a("access_family_history")}])),a("access_procedures_history")&&(b=void 0!==this.items_indexes.procedureshistory?this.items_indexes.procedureshistory:d++,Ext.Array.insert(c,b,[{text:_("proc_hx")+" ",action:"procedureshistory",margin:"0 3 0 0",tooltip:_("procedure_history"),style:{backgroundColor:g("procedure_history_tab_color"),backgroundImage:"none"},acl:a("access_procedures_history")}])),a("access_patient_advance_directive")&&(b=void 0!==this.items_indexes.advancedirectives?this.items_indexes.advancedirectives:d++,Ext.Array.insert(c,b,[{text:_("adv_dir")+" ",action:"advancedirectives",margin:"0 3 0 0",tooltip:_("advance_directives"),style:{backgroundColor:g("advance_directive_tab_color"),backgroundImage:"none"},acl:a("access_patient_advance_directive")}])),a("access_patient_medications")&&(b=void 0!==this.items_indexes.medications?this.items_indexes.medications:d++,Ext.Array.insert(c,b,[{text:_("meds")+" ",action:"medications",margin:"0 3 0 0",tooltip:_("medications"),style:{backgroundColor:g("medications_tab_color"),backgroundImage:"none"},acl:a("access_patient_medications")}])),a("access_patient_results")&&(b=void 0!==this.items_indexes.laboratories?this.items_indexes.laboratories:d++,Ext.Array.insert(c,b,[{text:_("res")+" ",action:"laboratories",margin:"0 3 0 0",tooltip:_("results"),style:{backgroundColor:g("results_tab_color"),backgroundImage:"none"},acl:a("access_patient_results")}])),a("access_patient_social_history")&&(b=void 0!==this.items_indexes.social?this.items_indexes.social:d++,Ext.Array.insert(c,b,[{text:_("soc_hx")+" ",action:"social",margin:"0 3 0 0",tooltip:_("social_history"),style:{backgroundColor:g("social_history_tab_color"),backgroundImage:"none"},acl:a("access_patient_social_history")}])),a("access_patient_functional_status")&&(b=void 0!==this.items_indexes.functionalstatus?this.items_indexes.functionalstatus:d++,Ext.Array.insert(c,b,[{text:_("func_stat")+" ",action:"functionalstatus",margin:"0 3 0 0",tooltip:_("functional_status"),style:{backgroundColor:g("functional_status_tab_color"),backgroundImage:"none"},acl:a("access_patient_functional_status")}])),a("access_patient_referrals")&&(b=void 0!==this.items_indexes.referrals?this.items_indexes.referrals:d++,Ext.Array.insert(c,b,[{text:_("refs")+" ",action:"referrals",margin:"0 3 0 0",tooltip:_("referrals"),style:{backgroundColor:g("referrals_tab_color"),backgroundImage:"none"},acl:a("access_patient_referrals")}])),a("access_patient_implantable_devices")&&(b=void 0!==this.items_indexes.ImplantableDeviceGrid?this.items_indexes.ImplantableDeviceGrid:d++,Ext.Array.insert(c,b,[{text:_("imp_devs")+" ",action:"ImplantableDeviceGrid",margin:"0 3 0 0",tooltip:_("implantable_devices"),style:{backgroundColor:g("implantable_devices_tab_color"),backgroundImage:"none"},acl:a("access_patient_implantable_devices")}])),a("access_patient_pain_scales")&&(b=void 0!==this.items_indexes.PainScaleGrid?this.items_indexes.PainScaleGrid:d++,Ext.Array.insert(c,b,[{text:_("pain_scale")+" ",action:"PainScaleGrid",margin:"0 3 0 0",tooltip:_("pain_scale"),style:{backgroundColor:g("pain_scales_tab_color"),backgroundImage:"none"},acl:a("access_patient_implantable_devices")}])),a("access_patient_doctors_notes")&&(b=void 0!==this.items_indexes.DoctorsNotes?this.items_indexes.DoctorsNotes:d++,Ext.Array.insert(c,b,[{text:_("doc_nt"),action:"DoctorsNotes",margin:"0 3 0 0",tooltip:_("doctors_notes"),style:{backgroundColor:g("doctors_notes_tab_color"),backgroundImage:"none"},acl:a("access_patient_doctors_notes")}])),a("access_patient_lab_orders")&&(b=void 0!==this.items_indexes.LabOrders?this.items_indexes.LabOrders:d++,Ext.Array.insert(c,b,[{text:_("lab_orders"),action:"LabOrders",margin:"0 3 0 0",style:{backgroundColor:g("lab_orders_tab_color"),backgroundImage:"none"},acl:a("access_patient_lab_orders")}])),a("access_patient_rad_orders")&&(b=void 0!==this.items_indexes.RadOrders?this.items_indexes.RadOrders:d++,Ext.Array.insert(c,b,[{text:_("xray_ct_orders"),action:"RadOrders",margin:"0 3 0 0",style:{backgroundColor:g("rad_orders_tab_color"),backgroundImage:"none"},acl:a("access_patient_rad_orders")}])),a("access_patient_rx_orders")&&(b=void 0!==this.items_indexes.RxOrderGrid?this.items_indexes.RxOrderGrid:d++,Ext.Array.insert(c,b,[{text:_("rx_orders"),action:"RxOrderGrid",margin:"0 3 0 0",style:{backgroundColor:g("rx_orders_tab_color"),backgroundImage:"none"},acl:a("access_patient_rx_orders")}])),Ext.Array.push(c,["-",{text:_("documents"),itemId:"EncounterPatientDocumentsBtn",icon:"resources/images/icons/icoDOC-16.png"}]),c},getMedicalTabPanelItems:function(){var b=[],c=0,d=100;return a("access_patient_immunizations")&&(c=void 0!==this.items_indexes.immunization?this.items_indexes.immunization:d++,Ext.Array.insert(b,c,[{xtype:"patientimmunizationspanel",itemId:"immunization",tabConfig:{tooltip:_("vaccines_immunizations"),style:{backgroundColor:g("immunizations_tab_color"),backgroundImage:"none"}}}])),a("access_patient_allergies")&&(c=void 0!==this.items_indexes.allergies?this.items_indexes.allergies:d++,Ext.Array.insert(b,c,[{xtype:"patientallergiespanel",itemId:"allergies",tabConfig:{tooltip:_("allergies"),style:{backgroundColor:g("allergies_tab_color"),backgroundImage:"none"}}}])),a("access_active_problems")&&(c=void 0!==this.items_indexes.activeproblems?this.items_indexes.activeproblems:d++,Ext.Array.insert(b,c,[{xtype:"patientactiveproblemspanel",itemId:"activeproblems",tabConfig:{tooltip:_("active_problems"),style:{backgroundColor:g("problems_tab_color"),backgroundImage:"none"}}}])),a("access_family_history")&&(c=void 0!==this.items_indexes.familyhistory?this.items_indexes.familyhistory:d++,Ext.Array.insert(b,c,[{xtype:"patientfamilyhistorypanel",itemId:"familyhistory",tabConfig:{tooltip:_("family_history"),style:{backgroundColor:g("family_history_tab_color"),backgroundImage:"none"}}}])),a("access_procedures_history")&&(c=void 0!==this.items_indexes.procedureshistory?this.items_indexes.procedureshistory:d++,Ext.Array.insert(b,c,[{xtype:"patientprocedureshistorygrid",itemId:"procedureshistory",tabConfig:{tooltip:_("procedure_history"),style:{backgroundColor:g("procedure_history_tab_color"),backgroundImage:"none"}}}])),a("access_patient_advance_directive")&&(c=void 0!==this.items_indexes.advancedirectives?this.items_indexes.advancedirectives:d++,Ext.Array.insert(b,c,[{xtype:"patientadvancedirectivepanel",itemId:"advancedirectives",tabConfig:{tooltip:_("advance_directives"),style:{backgroundColor:g("advance_directive_tab_color"),backgroundImage:"none"}}}])),a("access_patient_medications")&&(c=void 0!==this.items_indexes.medications?this.items_indexes.medications:d++,Ext.Array.insert(b,c,[{xtype:"patientmedicationspanel",itemId:"medications",tabConfig:{tooltip:_("medications"),style:{backgroundColor:g("medications_tab_color"),backgroundImage:"none"}}}])),a("access_patient_results")&&(c=void 0!==this.items_indexes.laboratories?this.items_indexes.laboratories:d++,Ext.Array.insert(b,c,[{xtype:"patientresultspanel",itemId:"laboratories",tabConfig:{tooltip:_("results"),style:{backgroundColor:g("results_tab_color"),backgroundImage:"none"}}}])),a("access_patient_social_history")&&(c=void 0!==this.items_indexes.social?this.items_indexes.social:d++,Ext.Array.insert(b,c,[{xtype:"patientsocialpanel",itemId:"social",tabConfig:{tooltip:_("social_history"),style:{backgroundColor:g("social_history_tab_color"),backgroundImage:"none"}}}])),a("access_patient_functional_status")&&(c=void 0!==this.items_indexes.functionalstatus?this.items_indexes.functionalstatus:d++,Ext.Array.insert(b,c,[{xtype:"patientcognitiveandfunctionalstatuspanel",itemId:"functionalstatus",tabConfig:{tooltip:_("functional_status"),style:{backgroundColor:g("functional_status_tab_color"),backgroundImage:"none"}}}])),a("access_patient_referrals")&&(c=void 0!==this.items_indexes.referrals?this.items_indexes.referrals:d++,Ext.Array.insert(b,c,[{xtype:"patientreferralspanel",itemId:"referrals",tabConfig:{tooltip:_("referrals"),style:{backgroundColor:g("referrals_tab_color"),backgroundImage:"none"}}}])),a("access_patient_implantable_devices")&&(c=void 0!==this.items_indexes.ImplantableDeviceGrid?this.items_indexes.ImplantableDeviceGrid:d++,Ext.Array.insert(b,c,[{xtype:"implantabledevicepanel",tabConfig:{tooltip:_("implantable_devices"),style:{backgroundColor:g("implantable_devices_tab_color"),backgroundImage:"none"}}}])),a("access_patient_pain_scales")&&(c=void 0!==this.items_indexes.PainScaleGrid?this.items_indexes.PainScaleGrid:d++,Ext.Array.insert(b,c,[{xtype:"painscalepanel",tabConfig:{tooltip:_("pain_scales"),style:{backgroundColor:g("pain_scales_tab_color"),backgroundImage:"none"}}}])),a("access_patient_doctors_notes")&&(c=void 0!==this.items_indexes.DoctorsNotes?this.items_indexes.DoctorsNotes:d++,Ext.Array.insert(b,c,[{xtype:"patientdoctorsnotepanel",tabConfig:{tooltip:_("doctors_notes"),style:{backgroundColor:g("doctors_notes_tab_color"),backgroundImage:"none"}}}])),a("access_patient_lab_orders")&&(c=void 0!==this.items_indexes.LabOrders?this.items_indexes.LabOrders:d++,Ext.Array.insert(b,c,[{xtype:"patientlaborderspanel",tabConfig:{tooltip:_("laboratory_orders"),style:{backgroundColor:g("lab_orders_tab_color"),backgroundImage:"none"}}}])),a("access_patient_rad_orders")&&(c=void 0!==this.items_indexes.RadOrders?this.items_indexes.RadOrders:d++,Ext.Array.insert(b,c,[{xtype:"patientradorderspanel",tabConfig:{tooltip:_("radiology_orders"),style:{backgroundColor:g("rad_orders_tab_color"),backgroundImage:"none"}}}])),a("access_patient_rx_orders")&&(c=void 0!==this.items_indexes.RxOrderGrid?this.items_indexes.RxOrderGrid:d++,Ext.Array.insert(b,c,[{xtype:"patientrxorderspanel",tabConfig:{tooltip:_("medication_orders"),style:{backgroundColor:g("rx_orders_tab_color"),backgroundImage:"none"}}}])),b},onNavKey:function(a,b){if(!app.patient.pid)return void app.msg(_("oops"),_("patient_error"),!0);var c=this.getMedicalWindow().show();switch(b){case a.ONE:c.cardSwitch("immunization");break;case a.TWO:c.cardSwitch("allergies");break;case a.THREE:c.cardSwitch("activeproblems");break;case a.FOUR:c.cardSwitch("medications");break;case a.FIVE:c.cardSwitch("laboratories");break;case a.SIX:c.cardSwitch("socialhistory");break;case a.SEVEN:c.cardSwitch("referrals")}},onPanelShow:function(a){this.setWindowTitle(a.title)},setWindowTitle:function(a){this.getMedicalWindow().setTitle(app.patient.name+" ("+a+") "+(app.patient.readOnly?'-  <span style="color:red">[Read Mode]</span>':""))}}),Ext.define("App.controller.patient.MedicationsAdministered",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"MedicationsAdministeredGrid",selector:"#MedicationsAdministeredGrid"},{ref:"MedicationsAdministeredGridAddBtn",selector:"#MedicationsAdministeredGridAddBtn"},{ref:"MedicationsAdministeredEditWindow",selector:"#MedicationsAdministeredEditWindow"},{ref:"MedicationsAdministeredEditForm",selector:"#MedicationsAdministeredEditForm"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onViewportEncounterLoad},"#MedicationsAdministeredGrid":{itemdblclick:a.onMedicationsAdministeredGridItemDblClick},"#MedicationsAdministeredEditCancelBtn":{click:a.onMedicationsAdministeredEditCancelBtnClick},"#MedicationsAdministeredEditSaveBtn":{click:a.onMedicationsAdministeredEditSaveBtnClick},"#MedicationsAdministeredEditAdministerSearchField":{select:a.onMedicationsAdministeredEditAdministerSearchFieldSelect},"#MedicationsAdministeredEditAdverseReactionField":{select:a.onMedicationsAdministeredEditAdverseReactionFieldSelect}})},onViewportEncounterLoad:function(a){var b=this.getMedicationsAdministeredGrid().getStore();b.clearFilter(!0),b.load({filters:[{property:"pid",value:a.get("pid")},{property:"eid",value:a.get("eid")}],params:{pid:a.get("pid"),eid:a.get("eid"),include_not_administered:!0}})},onMedicationsAdministeredEditAdministerSearchFieldSelect:function(a,b){var c=this,d=c.getMedicationsAdministeredEditForm().getForm(),e=d.getRecord();e.set({administered_uid:b[0].get("id"),administered_title:b[0].get("title"),administered_fname:b[0].get("fname"),administered_mname:b[0].get("mname"),administered_lname:b[0].get("lname")})},onMedicationsAdministeredEditAdverseReactionFieldSelect:function(a,b){var c=this,d=c.getMedicationsAdministeredEditForm().getForm(),e=d.getRecord();e.set({adverse_reaction_text:b[0].get("option_name"),adverse_reaction_code:b[0].get("code"),adverse_reaction_code_type:b[0].get("code_type")})},onMedicationsAdministeredGridItemDblClick:function(a,b){this.showMedicationsAdministeredEditWindow();var c=this.getMedicationsAdministeredEditForm().getForm();c.loadRecord(b)},onMedicationsAdministeredEditCancelBtnClick:function(){this.getMedicationsAdministeredEditForm().getForm().reset(),this.getMedicationsAdministeredEditWindow().close()},onMedicationsAdministeredEditSaveBtnClick:function(){var a=this,b=a.getMedicationsAdministeredEditForm().getForm(),c=b.getRecord(),d=b.getValues();b.isValid()&&(c.set(d),c.save({callback:function(){a.getMedicationsAdministeredEditForm().getForm().reset(),a.getMedicationsAdministeredEditWindow().close()}}))},showMedicationsAdministeredEditWindow:function(){return this.getMedicationsAdministeredEditWindow()||Ext.create("App.view.patient.windows.MedicationsAdministeredEditWindow"),this.getMedicationsAdministeredEditWindow().show()}}),Ext.define("App.controller.patient.Medications",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"MedicationsPanel",selector:"patientmedicationspanel"},{ref:"PatientMedicationsGrid",selector:"#patientMedicationsGrid"},{ref:"addPatientMedicationBtn",selector:"#addPatientMedicationBtn"},{ref:"PatientMedicationReconciledBtn",selector:"#PatientMedicationReconciledBtn"},{ref:"PatientMedicationActiveBtn",selector:"#PatientMedicationActiveBtn"},{ref:"PatientMedicationUserLiveSearch",selector:"#PatientMedicationUserLiveSearch"},{ref:"PatientMedicationLiveSearch",selector:"#PatientMedicationLiveSearch"},{ref:"AdministeredMedicationsGrid",selector:"#AdministeredMedicationsGrid"},{ref:"AdministeredMedicationsLiveSearch",selector:"#AdministeredMedicationsLiveSearch"},{ref:"AdministeredMedicationsUserLiveSearch",selector:"#AdministeredMedicationsUserLiveSearch"},{ref:"AdministeredMedicationsAddBtn",selector:"#AdministeredMedicationsAddBtn"},{ref:"ReviewMedicationsBtn",selector:"#ReviewMedicationsBtn"},{ref:"EncounterProcedureGrid",selector:"#EncounterProcedureGrid"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onViewportEncounterLoad},patientmedicationspanel:{activate:a.onMedicationsPanelActive},"#patientMedicationsGrid":{beforeedit:a.onPatientMedicationsGridBeforeEdit,beforeitemcontextmenu:a.onPatientMedicationsGridBeforeItemContextMenu},"#PatientMedicationEndDateField":{select:a.onPatientMedicationEndDateFieldSelect},"#addPatientMedicationBtn":{click:a.onAddPatientMedicationBtnClick},"#PatientMedicationLiveSearch":{select:a.onMedicationLiveSearchSelect},"#PatientMedicationActiveBtn":{click:a.onPatientMedicationActiveBtnClick},"#PatientMedicationReconciledBtn":{click:a.onPatientMedicationReconciledBtnClick},"#PatientMedicationUserLiveSearch":{select:a.onPatientMedicationUserLiveSearchSelect,reset:a.onPatientMedicationUserLiveSearchReset},"#AdministeredMedicationsGrid":{beforeedit:a.onAdministeredMedicationsGridBeforeEdit},"#AdministeredMedicationsLiveSearch":{select:a.onAdministeredMedicationsLiveSearchSelect},"#AdministeredMedicationsUserLiveSearch":{select:a.onAdministeredMedicationsUserLiveSearchSelect},"#AdministeredMedicationsAddBtn":{click:a.onAdministeredMedicationsAddBtnClick},"#PatientMedicationsGridActivateMenu":{click:a.onPatientMedicationsGridActivateMenuClick},"#ReviewMedicationsBtn":{click:a.onReviewMedicationsBtnClick},"#PatientMedicationsGridInactivateMenu":{click:a.onPatientMedicationsGridInactivateMenu}})},onPatientMedicationEndDateFieldSelect:function(a){var b=a.up("form").getForm();b.findField("is_active").setValue(!1),b.getRecord().set({is_active:!1,active:!1})},onPatientMedicationsGridBeforeItemContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showContextMenu(a,b,e)},showContextMenu:function(a,b,c){a.context_menu||(a.context_menu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("activate"),itemId:"PatientMedicationsGridActivateMenu"},{text:_("inactivate"),itemId:"PatientMedicationsGridInactivateMenu"}]})),a.context_menu.record=b,a.context_menu.showAt(c.getXY())},onPatientMedicationsGridActivateMenuClick:function(a){var b=a.up("menu").record;b.set({is_active:!0,end_date:null}),b.store.sync()},onPatientMedicationsGridInactivateMenu:function(a){var b=a.up("menu").record;b.set({is_active:!1,end_date:app.getDate()}),b.store.sync()},onViewportEncounterLoad:function(){},onAdministeredMedicationsGridBeforeEdit:function(a,b){var c=this,d=c.getAdministeredMedicationsUserLiveSearch();d.forceSelection=!1,d.setValue(b.record.data.administered_by),Ext.Function.defer(function(){d.forceSelection=!0},200)},onAdministeredMedicationsLiveSearchSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({RXCUI:b[0].data.RXCUI,CODE:b[0].data.CODE,GS_CODE:b[0].data.GS_CODE,NDC:b[0].data.NDC,TTY:b[0].data.TTY})},onAdministeredMedicationsUserLiveSearchSelect:function(a,b){var c=b[0],d=a.up("form").getForm().getRecord();d.set({administered_uid:c.data.id})},onAdministeredMedicationsAddBtnClick:function(){var a=this,b=a.getAdministeredMedicationsGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,created_uid:app.user.id,created_date:new Date,begin_date:new Date,end_date:new Date,administered_date:new Date,administered_uid:app.user.id,title:app.user.title,fname:app.user.fname,mname:app.user.mname,lname:app.user.lname}),b.editingPlugin.startEdit(0,0)},onPatientMedicationsGridBeforeEdit:function(){},onPatientMedicationUserLiveSearchSelect:function(a,b){var c=b[0],d=a.up("form").getForm().getRecord();d.set({fname:c.data.fname}),d.set({lname:c.data.lname}),d.set({mname:c.data.mname}),d.set({title:c.data.title}),d.set({administered_uid:c.data.id})},onPatientMedicationUserLiveSearchReset:function(a){var b=a.up("form").getForm().getRecord();b.set({fname:""}),b.set({lname:""}),b.set({mname:""}),b.set({title:""}),b.set({administered_uid:""})},onAddPatientMedicationBtnClick:function(){var a=this,b=a.getPatientMedicationsGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,created_uid:app.user.id,create_date:new Date,created_date:new Date,begin_date:new Date,is_active:!0}),b.editingPlugin.startEdit(0,0)},onReviewMedicationsBtnClick:function(){var a=this,b=this.getController("patient.encounter.Encounter").getEncounterRecord();b.set({review_medications:!0}),b.save({success:function(){var b=a.getEncounterProcedureGrid().getStore(),c=new Date;app.msg(_("sweet"),_("items_to_review_save_and_review"));var d=b.findBy(function(a){var b=a.get("eid"),c=a.get("code");return b===app.patient.eid&&"428191000124101"===c});-1===d&&(b.add({pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,update_uid:app.user.id,create_date:c,update_date:c,code:"428191000124101",code_text:"Documentation of current medications (procedure)",code_type:"SNOMED-CT",performer_id:0,procedure_date:c,encounter_dx_id:0}),b.sync({callback:function(){app.msg(_("sweet"),"Documentation of current medications (procedure) Added")}}))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})},onMedicationLiveSearchSelect:function(a,b){var c=a.up("form").getForm(),d=b[0],e=c.getRecord();e.set({RXCUI:d.data.RXCUI,CODE:d.data.CODE,GS_CODE:d.data.GS_CODE,NDC:d.data.NDC,TTY:d.data.TTY});var f={};Rxnorm.getMedicationAttributesByRxcuiApi(d.data.RXCUI,function(a){a.propConceptGroup&&a.propConceptGroup.propConcept.forEach(function(a){if("ATTRIBUTES"==a.propCategory||"CODES"==a.propCategory){f[a.propCategory]||(f[a.propCategory]={});var b=a.propName.replace(" ","_");f[a.propCategory][b]=a.propValue}}),f.ATTRIBUTES&&f.ATTRIBUTES.SCHEDULE&&"0"!=f.ATTRIBUTES.SCHEDULE&&e.set({is_controlled:!0})})},onPatientMedicationReconciledBtnClick:function(){this.onMedicationsPanelActive()},onPatientMedicationActiveBtnClick:function(){this.onMedicationsPanelActive()},onMedicationsPanelActive:function(){var a=this.getPatientMedicationsGrid().getStore(),b=this.getPatientMedicationReconciledBtn().pressed,c=this.getPatientMedicationActiveBtn().pressed;a.clearFilter(!0),a.load({filters:[{property:"pid",value:app.patient.pid}],params:{reconciled:b,active:c}})}}),Ext.define("App.controller.patient.MiniMentalStateExam",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"MiniMentalStateExamGridPanel",selector:"#MiniMentalStateExamGridPanel"},{ref:"MiniMentalStateExamWindow",selector:"#MiniMentalStateExamWindow"},{ref:"MiniMentalStateExamForm",selector:"#MiniMentalStateExamForm"}],init:function(){var a=this;a.control({"#MiniMentalStateExamGridPanel":{activate:a.onMiniMentalStateExamGridPanelActivate,itemdblclick:a.onMiniMentalStateExamGridPanelItemDblClick},"#MiniMentalStateExamAddBtn":{click:a.onMiniMentalStateExamAddBtnClick},"#MiniMentalStateExamWindowCancelBtn":{click:a.onMiniMentalStateExamWindowCancelBtnClick},"#MiniMentalStateExamWindowSaveBtn":{click:a.onMiniMentalStateExamWindowSaveBtnClick}})},onMiniMentalStateExamGridPanelActivate:function(a){a.getStore().load({filters:[{property:"pid",value:app.patient.pid}]})},onMiniMentalStateExamGridPanelItemDblClick:function(a,b){this.showMiniMentalStateExamWindow(),this.getMiniMentalStateExamForm().getForm().loadRecord(b)},onMiniMentalStateExamWindowSaveBtnClick:function(){var a=this.getMiniMentalStateExamWindow(),b=this.getMiniMentalStateExamForm().getForm(),c=this.getMiniMentalStateExamGridPanel().getStore(),d=b.getValues(),e=b.getRecord(),f=0;b.isValid()&&(d.orientation_time_score&&(f+=parseInt(d.orientation_time_score)),d.orientation_place_score&&(f+=parseInt(d.orientation_place_score)),d.registration_score&&(f+=parseInt(d.registration_score)),d.attention_calculation_score&&(f+=parseInt(d.attention_calculation_score)),d.recall_score&&(f+=parseInt(d.recall_score)),d.language_score&&(f+=parseInt(d.language_score)),d.repetition_score&&(f+=parseInt(d.repetition_score)),d.complex_commands_score&&(f+=parseInt(d.complex_commands_score)),d.total_score=f,e.set(d),e.store||c.add(e),0===c.getModifiedRecords().length&&0===c.getNewRecords().length&&0===c.getRemovedRecords().length&&(b.reset(),a.close()),c.sync({callback:function(){b.reset(),a.close()}}))},onMiniMentalStateExamAddBtnClick:function(){this.showMiniMentalStateExamWindow();var a=Ext.create("App.model.patient.MiniMentalStateExam",{pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,create_date:new Date}),b=this.getMiniMentalStateExamForm().getForm();b.loadRecord(a)},onMiniMentalStateExamWindowCancelBtnClick:function(){this.getMiniMentalStateExamWindow().close()},showMiniMentalStateExamWindow:function(){return this.getMiniMentalStateExamWindow()||Ext.create("App.view.patient.windows.MiniMentalStateExam"),this.getMiniMentalStateExamWindow().show()}}),Ext.define("App.controller.patient.NursesNotes",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"NursesNotesGrid",selector:"#NursesNotesGrid"},{ref:"NursesNoteEditWindow",selector:"#NursesNoteEditWindow"},{ref:"NursesNoteSnippetsGrid",selector:"#NursesNoteSnippetsGrid"},{ref:"NursesNoteSnippetEditWindow",selector:"#NursesNoteSnippetEditWindow"},{ref:"NursesNoteSnippetEditWindowForm",selector:"#NursesNoteSnippetEditWindowForm"},{ref:"NursesNoteEditWindowFormNoteField",selector:"#NursesNoteEditWindowFormNoteField"}],init:function(){var a=this;a.control({"#NursesNoteEditWindow":{close:a.onNursesNoteEditWindowClose},"#NursesNotesGrid":{activate:a.onNursesNotesGridActive,itemdblclick:a.onNursesNotesGridItemDblClick},"#NursesNotesGridAddBtn":{click:a.onNursesNotesGridAddBtnClick},"#NursesNoteEditWindowCancelBtn":{click:a.onNursesNoteEditWindowCancelBtnClick},"#NursesNoteEditWindowSaveBtn":{click:a.onNursesNoteEditWindowSaveBtnClick},"#NursesNoteEditWindowSignBtn":{click:a.onNursesNoteEditWindowSignBtnClick},"#NursesNoteSnippetAddBtn":{click:a.onNursesNoteSnippetAddBtnClick},"#NursesNoteSnippetsGrid":{render:a.onNursesNoteEditWindowRender,itemdblclick:a.onNursesNoteSnippetsGridItemDblClick},"#NursesNoteSnippetEditWindowCancelBtn":{click:a.onNursesNoteSnippetEditWindowCancelBtnClick},"#NursesNoteSnippetEditWindowSaveBtn":{click:a.onNursesNoteSnippetEditWindowSaveBtnClick}})},onNursesNoteEditWindowClose:function(){var a=app.getActivePanel();"App.view.patient.Encounter"===a.$className&&a.getProgressNote()},onNursesNoteSnippetsGridItemDblClick:function(a,b){var c=b.get("snippet"),d=this.getNursesNoteEditWindowFormNoteField();Ext.isChrome?(d.inputEl.dom.focus(),document.execCommand("insertText",!1,c)):d.inputEl.dom.value+=" "+c},onNursesNoteSnippetEditWindowCancelBtnClick:function(a){a.up("window").close(),this.getNursesNoteSnippetsGrid().getStore().rejectChanges()},onNursesNoteSnippetEditWindowSaveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=c.getRecord(),f=this.getNursesNoteSnippetsGrid().getStore();e.set(d),f.sync({callback:function(){b.close()}})},onNursesNoteSnippetAddBtnClick:function(a){var b=this.showNursesNoteSnippetEditWindow().down("form").getForm(),c=a.up("grid").getStore(),d=c.add({uid:app.user.id,index:0,create_uid:app.user.id,update_uid:app.user.id,create_date:app.getDate(),update_date:app.getDate()});b.loadRecord(d[0])},onSnippetBtnEdit:function(a,b,c,d,e,f){var g=this.showNursesNoteSnippetEditWindow().down("form").getForm();g.loadRecord(f)},onNursesNoteEditWindowRender:function(a){a.getStore().load()},onNursesNoteEditWindowCancelBtnClick:function(a){this.getNursesNotesGrid().getStore().rejectChanges(),a.up("window").close()},onNursesNoteEditWindowSaveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=c.getRecord(),f=this.getNursesNotesGrid().getStore();return e.set(d),Ext.Object.isEmpty(e.getChanges())?void b.close():void f.sync({callback:function(){b.close()}})},onNursesNoteEditWindowSignBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("form").getForm(),e=d.getValues(),f=d.getRecord(),g=this.getNursesNotesGrid().getStore();app.passwordVerificationWin(function(d,h){"ok"===d&&User.verifyUserPass(h,function(d){d?(e.signer_uid=app.user.id,e.signer_date=app.getDate(),e.nurse_fname=app.user.fname,e.nurse_mname=app.user.mname,e.nurse_lname=app.user.lname,e.nurse_name="",f.set(e),g.sync({callback:function(){c.close()}})):Ext.Msg.show({title:"Oops!",msg:_("incorrect_password"),buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.ERROR,fn:function(c){"ok"===c&&b.onNursesNoteEditWindowSaveBtnClick(a)}})})})},onNursesNotesGridAddBtnClick:function(a){var b=this.showNursesNotesWindow().down("form").getForm(),c=a.up("grid").getStore(),d=c.add({pid:app.patient.pid,eid:app.patient.eid,in_error:!1,create_uid:app.user.id,update_uid:app.user.id,create_date:app.getDate(),update_date:app.getDate(),nurse_name:app.user.getFullName()});b.loadRecord(d[0])},onNursesNotesGridItemDblClick:function(a,b){if(b.get("create_uid")>0&&b.get("create_uid")!==app.user.id)return void app.msg(_("oops"),"Cannot modify notes from another user",!0);if(b.get("signer_uid")>0)return void app.msg(_("oops"),"Cannot modify signed notes",!0);var c=this.showNursesNotesWindow().down("form").getForm();c.loadRecord(b)},showNursesNotesWindow:function(){return this.getNursesNoteEditWindow()||Ext.create("App.view.patient.windows.NursesNoteEditWindow"),this.getNursesNoteEditWindow().show()},showNursesNoteSnippetEditWindow:function(){return this.getNursesNoteSnippetEditWindow()||Ext.create("App.view.patient.windows.NursesNoteSnippetEditWindow"),this.getNursesNoteSnippetEditWindow().show()},onNursesNotesGridActive:function(a){a.getStore().load({filters:[{property:"pid",value:app.patient.pid},{property:"eid",value:app.patient.eid}]})}}),Ext.define("App.controller.patient.PainScale",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PainScaleGrid",selector:"#PainScaleGrid"},{ref:"PainScaleGridAddBtn",selector:"#PainScaleGridAddBtn"},{ref:"PainScaleReviewBtn",selector:"#PainScaleReviewBtn"}],init:function(){var a=this;
a.control({"#PainScaleGrid":{activate:a.onPainScaleGridActivate,validateedit:a.onPainScaleGridValidateEdit,beforeedit:a.onPainScaleGridBeforeEdit},"#PainScaleGridAddBtn":{click:a.onPainScaleGridAddBtnClick},"#PainScaleReviewBtn":{click:a.onPainScaleReviewBtnClick}})},onPainScaleGridActivate:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},onPainScaleGridAddBtnClick:function(a){var b=a.up("grid"),c=b.getStore();b.editingPlugin.cancelEdit();var d=c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,create_date:new Date,created_uid:app.user.id,update_date:new Date,update_uid:app.user.id,pain_scale:0});b.editingPlugin.startEdit(d[0],0)},onPainScaleReviewBtnClick:function(){var a=this.getController("patient.encounter.Encounter").getEncounterRecord();a.set({review_pain_scales:!0}),a.save({success:function(){app.msg(_("sweet"),_("items_to_review_save_and_review"))},failure:function(){app.msg(_("oops"),_("items_to_review_entry_error"))}})},onPainScaleGridValidateEdit:function(a){{var b=a.editor.getForm(),c=b.findField("anatomical_region_code_text"),d=c.findRecordByValue(c.getValue()),e=b.getValues(),f=b.getRecord();this.getPainScaleGrid().getStore()}d&&(e.anatomical_region_code=d.get("ConceptId"),e.anatomical_region_code_type=d.get("CodeType"),e.update_date=new Date),f.set(e)},onPainScaleGridBeforeEdit:function(){return a("edit_patient_pain_scales")?void 0:!1}}),Ext.define("App.controller.patient.PictureIdCard",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientSummaryImagesPanel",selector:"#PatientSummaryImagesPanel"},{ref:"PatientSummaryImagesPictureIdCardPrintersCombo",selector:"#PatientSummaryImagesPictureIdCardPrintersCombo"},{ref:"PatientSummaryImagesPictureIdCardPrinterImage",selector:"#PatientSummaryImagesPictureIdCardPrinterImage"},{ref:"PatientSummaryImagesPictureIdCardPrintBtn",selector:"#PatientSummaryImagesPictureIdCardPrintBtn"}],init:function(){var a=this;a.control({"#PatientSummaryImagesPanel":{beforerender:a.onPatientSummaryImagesPanelBeforeRender},"#PatientSummaryImagesPictureIdCardBtn":{click:a.onPatientSummaryImagesPictureIdCardBtnClick},"#PatientSummaryImagesPictureIdCardPrintBtn":{click:a.onPatientSummaryImagesPictureIdCardPrintBtnClick}})},onPatientSummaryImagesPictureIdCardBtnClick:function(a){var b=a.up("patientdeomgraphics").down("#PatientSummaryImagesPanel").down("image"),c={"[PATIENT_NAME]":app.patient.name,"[RECORD_NUMBER]":app.patient.pubpid,"[FACILITY]":app.getController("Main").getCurrentFacilityName(),"[IMAGE]":b.src};PictureIdCard.Create(c,function(a){a.success&&Ext.create("Ext.window.Window",{title:_("picture_id_card"),layout:"fit",items:[{xtype:"image",itemId:"PatientSummaryImagesPictureIdCardPrinterImage",base64data:a.base64data,src:"data:image/jpg;base64,"+a.base64data,width:a.width/4,height:a.height/4}],dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:70},items:["->",{xtype:"printerscombo",itemId:"PatientSummaryImagesPictureIdCardPrintersCombo"},{text:_("print"),itemId:"PatientSummaryImagesPictureIdCardPrintBtn"}]}]}).show()})},onPatientSummaryImagesPictureIdCardPrintBtnClick:function(){var a=this.getPatientSummaryImagesPictureIdCardPrintersCombo().findRecordByValue(this.getPatientSummaryImagesPictureIdCardPrintersCombo().getValue()),b=this.getPatientSummaryImagesPictureIdCardPrinterImage();return a?void app.getController("Print").doPrint(a,b.base64data):void app.msg(_("oops"),_("no_printer_selected"),!0)},onPatientSummaryImagesPanelBeforeRender:function(a){a.addDocked({xtype:"toolbar",dock:"top",items:[{xtype:"button",text:_("picture_id_card"),itemId:"PatientSummaryImagesPictureIdCardBtn",flex:1}]})}}),Ext.define("App.controller.patient.Patient",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"NewPatientWindow",selector:"#NewPatientWindow"},{ref:"NewPatientWindowForm",selector:"#NewPatientWindowForm"},{ref:"NewPatientWindowInsuranceForm",selector:"#NewPatientWindowInsuranceForm"},{ref:"PossiblePatientDuplicatesWindow",selector:"#PossiblePatientDuplicatesWindow"},{ref:"PatientDemographicForm",selector:"#PatientDemographicForm"},{ref:"PatientDemographicsPanel",selector:"#PatientDemographicsPanel"},{ref:"PatientSummaryPatientImage",selector:"#PatientSummaryPatientImage"},{ref:"PatientSummaryQrcodeImage",selector:"#PatientSummaryQrcodeImage"}],init:function(){var a=this;a.control({viewport:{afterdemographicssave:a.onAfterDemographicsSave,demographicsrecordload:a.onDemographicsRecordLoad},"#NewPatientWindow":{close:a.onNewPatientWindowClose},"#HeaderNewPatientBtn":{click:a.onHeaderNewPatientBtnClick},"#SearchNewPatientBtn":{click:a.onSearchNewPatientBtnClick},"#NewPatientWindowCancelBtn":{click:a.onNewPatientWindowCancelBtnClick},"#NewPatientWindowSaveBtn":{click:a.onNewPatientWindowSaveBtnClick},"#NewPatientWindowImportFromCdaBtn":{click:a.onNewPatientWindowImportFromCdaBtnClick},"#PatientCdaImportBtn":{click:a.onPatientCdaImportBtnClick},"#PossiblePatientDuplicatesWindow":{close:a.onPossiblePatientDuplicatesWindowClose},"#PossiblePatientDuplicatesWindow > grid":{itemdblclick:a.onPossiblePatientDuplicatesGridItemDblClick},"#PatientPossibleDuplicatesBtn":{click:a.onPatientPossibleDuplicatesBtnClick},"#PossiblePatientDuplicatesContinueBtn":{click:a.onPossiblePatientDuplicatesContinueBtnClick},"#PossiblePatientDuplicatesCancelBtn":{click:a.onPossiblePatientDuplicatesCancelBtnClick},"textfield[action=last_name_field]":{keyup:a.onPatientLastNameFieldKeyUp},"#DemographicAddressCopyBtn":{click:a.onDemographicAddressCopyBtnClick},"#PatientSummaryQrcodeImagePrintBtn":{click:a.onPatientSummaryQrcodeImagePrintBtnClick}}),a.importCtrl=this.getController("patient.CCDImport")},onAfterDemographicsSave:function(a,b){this.setPatientImages(a,b)},onDemographicsRecordLoad:function(a,b){this.setPatientImages(a,b)},setPatientImages:function(a,b){var c=this.getPatientSummaryPatientImage(),d=this.getPatientSummaryQrcodeImage();c.setSrc(""!==a.data.image?a.data.image:b.defaultPatientImage),d.setSrc(""!==a.data.qrcode?a.data.qrcode:b.defaultQRCodeImage)},onPatientSummaryQrcodeImagePrintBtnClick:function(){var a=this.getPatientSummaryQrcodeImage();printJS({printable:a.imgEl.dom.src,type:"image",documentTitle:""})},onDemographicAddressCopyBtnClick:function(a){var b=a.up("form").getForm(),c=b.getValues();b.setValues({physical_address:c.postal_address,physical_address_cont:c.postal_address_cont,physical_city:c.postal_city,physical_state:c.postal_state,physical_zip:c.postal_zip,physical_country:c.postal_country}),app.msg(_("info"),_("postal_address_copied"),"blue")},onPatientLastNameFieldKeyUp:function(a){var b=a.getValue().trim().split(" ").length>1;a.has_two_last_names=b,b?a.removeCls("x-field-yellow"):(a.has_two_last_names="x-field-yellow",a.addCls("x-field-yellow"))},onNewPatientWindowClose:function(){this.getNewPatientWindowForm().getForm().reset(),this.getNewPatientWindowInsuranceForm().getForm().reset()},onHeaderNewPatientBtnClick:function(){this.showNewPatientWindow()},onSearchNewPatientBtnClick:function(a){this.showNewPatientWindow(a.newPatientCallback)},onNewPatientWindowCancelBtnClick:function(){this.getNewPatientWindowForm().getForm().reset(!0),this.getNewPatientWindow().close()},onNewPatientWindowSaveBtnClick:function(){var a=this,b=a.getNewPatientWindow(),c=a.getNewPatientWindowForm().getForm(),d=c.getValues(),e={fname:d.fname,mname:d.mname,lname:d.lname,DOB:d.DOB,sex:d.sex,phone_mobile:d.phone_mobile,email:d.email,phone_home:d.phone_home,phone_work:d.phone_work,postal_address:d.postal_address,postal_address_cont:d.postal_address_cont,postal_city:d.postal_city,postal_state:d.postal_state,postal_zip:d.postal_zip,postal_country:d.postal_country,physical_address:d.physical_address,physical_address_cont:d.physical_address_cont,physical_city:d.physical_city,physical_state:d.physical_state,physical_zip:d.physical_zip,physical_country:d.physical_country,first_visit_date:app.getDate(),primary_facility:app.user.facility},f=a.getNewPatientWindowInsuranceForm().getForm(),g=f.getValues(),h=g.insurance_id>0;c.isValid()&&(h&&(e.insurance={insurance_id:g.insurance_id,insurance_type:"P",effective_date:null,expiration_date:null,policy_number:g.policy_number,group_number:g.group_number,card_first_name:g.subscriber_given_name,card_middle_name:g.subscriber_middle_name,card_last_name:g.subscriber_surname,subscriber_relationship:"01",subscriber_given_name:g.subscriber_given_name,subscriber_middle_name:g.subscriber_middle_name,subscriber_surname:g.subscriber_surname,subscriber_sex:e.sex,subscriber_dob:e.DOB,subscriber_policy_number:g.subscriber_policy_number,subscriber_phone:e.phone_mobile||e.phone_home,subscriber_street:e.postal_address+", "+e.postal_address_cont,subscriber_city:e.postal_city,subscriber_state:e.postal_state,subscriber_country:e.postal_country,subscriber_postal_code:e.postal_zip,display_order:1,create_uid:app.user.id,update_uid:app.user.id,create_date:Ext.Date.format(new Date,"Y-m-d H:i:s"),update_date:Ext.Date.format(new Date,"Y-m-d H:i:s")},e.policy_number=g.policy_number||null),a.lookForPossibleDuplicates(e,null,function(a,c){c===!0?(b.el.mask(_("please_wait")),Patient.createNewPatient(e,function(a){app.setPatient(a.pid,null,null,function(){b.el.unmask(),b.close(),b.newPatientCallback&&b.newPatientCallback(a)},!0)})):c.isModel===!0&&(b.el.mask(_("please_wait")),app.setPatient(c.get("pid"),null,null,function(){a.close(),b.el.unmask(),b.close(),b.newPatientCallback&&b.newPatientCallback(c)},!0))}))},showNewPatientWindow:function(a){return this.getNewPatientWindow()||Ext.create("App.view.patient.windows.NewPatient"),this.getNewPatientWindow().newPatientCallback=a,this.getNewPatientWindow().show()},doCapitalizeEachLetterOnKeyUp:function(){},onPossiblePatientDuplicatesGridItemDblClick:function(a,b){var c=this.getPossiblePatientDuplicatesWindow();"function"==typeof c.callbackFn?c.callbackFn(c,b):"openPatientSummary"===c.action&&app.setPatient(b.data.pid,null,null,function(){app.openPatientSummary(),a.up("window").close()})},onPossiblePatientDuplicatesWindowClose:function(a){var b=a.down("grid").getStore();b.removeAll(),b.commitChanges()},checkForPossibleDuplicates:function(a){var b,c=this,d=a.isPanel?a.getForm():a.up("form").getForm();d.isValid()&&(b={fname:d.findField("fname").getValue(),lname:d.findField("lname").getValue(),sex:d.findField("sex").getValue(),DOB:d.findField("DOB").getValue()},d.getRecord()&&(b.pid=d.getRecord().data.pid),c.lookForPossibleDuplicates(b,"openPatientSummary"))},lookForPossibleDuplicates:function(a,b,c){var d=this,e=d.getPossiblePatientDuplicatesWindow()||Ext.create("App.view.patient.windows.PossibleDuplicates"),f=e.down("grid").getStore();e.action=b,e.callbackFn=c,f.getProxy().extraParams=a,f.load({callback:function(a){a.length>0?e.show():(app.msg(_("sweet"),_("no_possible_duplicates_found")),"function"==typeof e.callbackFn&&e.callbackFn(e,!0))}})},onPatientPossibleDuplicatesBtnClick:function(a){this.checkForPossibleDuplicates(a.up("panel").down("form"))},onPossiblePatientDuplicatesContinueBtnClick:function(){var a=this.getPossiblePatientDuplicatesWindow();a.fireEvent("continue",a),"function"==typeof a.callbackFn&&a.callbackFn(a,!0),a.close()},onPossiblePatientDuplicatesCancelBtnClick:function(){var a=this.getPossiblePatientDuplicatesWindow();a.fireEvent("cancel",a),"function"==typeof a.callbackFn&&a.callbackFn(a,!1),a.close()},onNewPatientWindowImportFromCdaBtnClick:function(a){a.up("window").close();var b=this,c=Ext.create("App.ux.form.fields.UploadString");c.allowExtensions=["xml","ccd","cda","ccda"],c.on("uploadready",function(a,c){b.getDocumentData(c,null)}),c.show()},onPatientCdaImportBtnClick:function(){var a=this,b=Ext.create("App.ux.form.fields.UploadString");b.allowExtensions=["xml","ccd","cda","ccda"],b.on("uploadready",function(b,c){a.getDocumentData(c,app.patient.pid)}),b.show()},getDocumentData:function(a,b){var c=this;CDA_Parser.parseDocument(a,function(d){c.importCtrl.validatePosibleDuplicates=!1,c.importCtrl.CcdImport(d,b,a),c.importCtrl.validatePosibleDuplicates=!0,c.promptCcdScore(a,d)})},promptCcdScore:function(a,b){var c=this;Ext.Msg.show({title:"C-CDA Score",msg:"Would you like to see this C-CDA score?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"===d&&c.doCcdScore(a,b)}})},doCcdScore:function(a,b){CDA_ScoreCard.getScoreDocument(a,Ext.String.format("{0}, {1} {3} (C-CDA)",b.patient.lname,b.patient.fname,b.patient.title),function(a){a&&app.getController("DocumentViewer").doDocumentView(a.id,"temp")})}}),Ext.define("App.controller.patient.PatientSearch",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientSearchFrom",selector:"#PatientSearchFrom"},{ref:"PatientSearchGrid",selector:"#PatientSearchGrid"},{ref:"PatientSearchFromSearchBtn",selector:"#PatientSearchFromSearchBtn"}],init:function(){var a=this;a.control({"#PatientSearchFromSearchBtn":{click:a.onPatientSearchFromSearchBtnClick}})},onPatientSearchFromSearchBtnClick:function(){var a=this,b=a.getPatientSearchGrid().getStore(),c=a.getPatientSearchFrom().getForm(),d=c.getValues(),e={};c.isValid()&&(Ext.Object.each(d,function(a,b){""!=b&&("lab_results"==a&&Ext.isObject(b)&&(b=[b]),e[a]=b)}),b.getProxy().extraParams=e,b.load())}}),Ext.define("App.controller.patient.PatientMerge",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientMergeWindow",selector:"#PatientMergeWindow"},{ref:"PatientMergeBtn",selector:"#PatientMergeBtn"},{ref:"PatientMergeRecordOneForm",selector:"#PatientMergeRecordOneForm"},{ref:"PatientMergeRecordTwoForm",selector:"#PatientMergeRecordTwoForm"}],init:function(){var a=this;a.control({"#PatientMergeBtn":{click:a.onPatientMergeBtnClick},"button[toggleGroup=patientmergegroup]":{toggle:a.onPatientMergeGroupBtnToggle},"#PatientMergeCancelBtn":{click:a.onPatientMergeCancelBtnClick},"#PatientMergeMergeBtn":{click:a.onPatientMergeMergeBtnClick},"#PatientMergeRecordSerchField":{select:a.onPatientMergeRecordSerchFieldSelect}}),a.bufferMergeForms=Ext.Function.createBuffered(a.setMergeForms,100,a)},onPatientMergeBtnClick:function(){a("allow_merge_patients")&&(this.showPatientMergeWindow(),this.getPatientMergeRecordOneForm().getForm().loadRecord(app.patient.record))},onPatientMergeGroupBtnToggle:function(a,b){var c=a.up("form");c.primaryRecord=b,this.bufferMergeForms()},setMergeForms:function(){var a=this.getPatientMergeWindow().query("form[primaryRecord=true]")[0],b=this.getPatientMergeWindow().query("form[primaryRecord=false]")[0];a.body.setStyle({backgroundColor:"#c3ffc3"}),b.body.setStyle({backgroundColor:"#ffc3c3"}),a.setTitle(_("primary_record")),b.setTitle(_("merge_record"))},onPatientMergeCancelBtnClick:function(){this.getPatientMergeWindow().close()},onPatientMergeMergeBtnClick:function(){var a=this,b=a.getPrimaryRecord(),c=a.getSecondaryRecord();if(!b||!c)return void app.msg(_("oops"),_("merge_record_missing"),!0);var d=b.get("pid"),e=c.get("pid");Ext.Msg.show({title:_("wait"),msg:Ext.String.format(_("merge_action_msg"),e,d,e),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"===b&&(a.getPatientMergeWindow().el.mask(_("merging")),Merge.merge(d,e,function(b){return a.getPatientMergeWindow().el.unmask(),b!==!0?(say(b),void app.msg(_("oops"),_("error_merging_patient"),!0)):(a.getPatientMergeWindow().close(),app.msg(_("sweet"),_("patients_merged")),void app.setPatient(d,null,null,function(){app.openPatientSummary()}))}))}})},onPatientMergeRecordSerchFieldSelect:function(a,b){var c=this;App.model.patient.Patient.load(b[0].get("pid"),{callback:function(a){c.getPatientMergeRecordTwoForm().getForm().loadRecord(a)}})},getPrimaryRecord:function(){var a=this.getPatientMergeWindow().query("form[primaryRecord=true]");return 0===a.length?(app.msg(_("oops"),_("not_primary_record_selected"),!0),!1):a.length>1?(app.msg(_("oops"),_("multiple_primary_records_found"),!0),!1):a[0].getForm().getRecord()||!1},getSecondaryRecord:function(){var a=this.getPatientMergeWindow().query("form[primaryRecord=false]");return a[0].getForm().getRecord()||!1},showPatientMergeWindow:function(){return this.getPatientMergeWindow()||Ext.create("App.view.patient.windows.PatientMerge"),this.getPatientMergeWindow().show()}}),Ext.define("App.controller.patient.Referrals",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"ReferralPanelGrid",selector:"patientreferralspanel"},{ref:"AddReferralBtn",selector:"button[action=addReferralBtn]"},{ref:"PrintReferralBtn",selector:"#printReferralBtn"},{ref:"ReferralProviderCombo",selector:"#ReferralProviderCombo"},{ref:"ReferralLocalProviderCombo",selector:"#ReferralLocalProviderCombo"},{ref:"ReferralExternalProviderCombo",selector:"#ReferralExternalProviderCombo"},{ref:"ReferralExternalReferralCheckbox",selector:"#ReferralExternalReferralCheckbox"}],init:function(){var a=this;a.control({patientreferralspanel:{activate:a.onReferralActive,selectionchange:a.onGridSelectionChange,beforeedit:a.onGridBeforeEdit},"button[action=addReferralBtn]":{click:a.onAddReferralBtnClicked},"#ReferralServiceSearch":{select:a.onReferralServiceSearchSelect},"#referralDiagnosisSearch":{select:a.onReferralDiagnosisSearchSelect},"#ReferralExternalReferralCheckbox":{change:a.onReferralExternalReferralCheckboxChange},"#printReferralBtn":{click:a.onPrintReferralBtnClick},"#ReferralProviderCombo":{select:a.onReferralProviderComboSelect},"#ReferralLocalProviderCombo":{select:a.onReferralLocalProviderComboSelect},"#ReferralExternalProviderCombo":{select:a.onReferralExternalProviderComboSelect}})},onGridBeforeEdit:function(a,b){this.getReferralExternalReferralCheckbox().setValue(b.record.data.is_external_referral),this.getReferralLocalProviderCombo().setValue(b.record.data.refer_to_text),this.getReferralExternalProviderCombo().setValue(b.record.data.refer_to_text)},onReferralProviderComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({refer_by:b[0].data.option_value})},onReferralLocalProviderComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({refer_to:b[0].data.id})},onReferralExternalProviderComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({refer_to:b[0].data.id})},onPrintReferralBtnClick:function(a,b){var c,d,e=this,f=e.getReferralPanelGrid(),g=f.getSelectionModel(),h=a.isModel?[a]:g.getSelection();for(f.view.el&&f.view.el.mask(_("generating_documents")),d=0;d<h.length;d++)c={pid:app.patient.pid,eid:app.patient.eid,referralId:h[d].data.id,templateId:10,docType:"Referral"},DocumentHandler.createTempDocument(c,function(a,c){b===!0?Printer.doTempDocumentPrint(1,c.result.id):window.dual?dual.onDocumentView(c.result.id,"Referral"):app.onDocumentView(c.result.id,"Referral"),f.view.el&&f.view.el.unmask()})},onGridSelectionChange:function(a,b){this.getPrintReferralBtn().setDisabled(0==b.length)},onReferralServiceSearchSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({service_code:b[0].get("ConceptId"),service_code_type:b[0].get("CodeType")})},onReferralDiagnosisSearchSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({diagnosis_code:b[0].data.code,diagnosis_code_type:b[0].data.code_type})},onReferralExternalReferralCheckboxChange:function(a,b){this.getReferralLocalProviderCombo().setVisible(!b),this.getReferralLocalProviderCombo().setDisabled(b),this.getReferralExternalProviderCombo().setVisible(b),this.getReferralExternalProviderCombo().setDisabled(!b)},onReferralActive:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},onAddReferralBtnClicked:function(){var a,b=this,c=b.getReferralPanelGrid().getStore(),d=b.getReferralPanelGrid().editingPlugin;d.cancelEdit(),a=c.add({pid:app.patient.pid,eid:app.patient.eid,create_date:app.getDate(),create_uid:app.user.id,referral_date:app.getDate()}),d.startEdit(a[0],0)},doAddReferralByTemplate:function(a){var b=this,c=b.getReferralPanelGrid(),d=c.getStore();a.pid=app.patient.pid,a.eid=app.patient.eid,a.refer_by=app.user.id,a.refer_by_text="",a.referral_date=app.getDate(),a.create_uid=app.user.id,a.update_uid=app.user.id,a.create_date=app.getDate(),a.update_date=app.getDate();var e=d.add(a)[0];e.save({success:function(){app.msg(_("sweet"),a.service_text+" Referral "+_("added"))}})}}),Ext.define("App.controller.patient.ProceduresHistory",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"ProceduresHistoryGrid",selector:"patientprocedureshistorygrid"}],init:function(){var a=this;a.control({patientprocedureshistorygrid:{activate:a.onProceduresHistoryGridActivate},"#ProceduresHistoryGridAddBtn":{click:a.onProceduresHistoryGridAddBtnClick},"#ProceduresHistoryGridProcedureField":{select:a.onProceduresHistoryGridProcedureFieldSelect},"#ProceduresHistoryGridTargetSiteField":{select:a.onProceduresHistoryGridTargetSiteFieldSelect}})},onProceduresHistoryGridProcedureFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({procedure_code:b[0].get("ConceptId"),procedure_code_type:b[0].get("CodeType"),procedure:b[0].get("Term")})},onProceduresHistoryGridTargetSiteFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({target_site_code:b[0].get("ConceptId"),target_site_code_type:b[0].get("CodeType"),target_site_code_text:b[0].get("Term")})},onProceduresHistoryGridAddBtnClick:function(a){var b=a.up("grid"),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,created_uid:app.user.id,create_date:new Date}),b.editingPlugin.startEdit(0,0)},onProceduresHistoryGridActivate:function(a){var b=a.getStore();b.clearFilter(!0),b.load({filters:[{property:"pid",value:app.patient.pid}]})}}),Ext.define("App.controller.patient.ProgressNotesHistory",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"EncounterProgressNotesHistoryGrid",selector:"#EncounterProgressNotesHistoryGrid"},{ref:"ProgressNotesHistoryMineBtn",selector:"#ProgressNotesHistoryMineBtn"},{ref:"ProgressNotesHistorySpecialtyBtn",selector:"#ProgressNotesHistorySpecialtyBtn"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onBeforeEncounterLoad,encounterload:a.onEncounterLoad},"#EncounterProgressNotesHistoryGrid":{afterrender:a.onEncounterProgressNotesHistoryGridAfterRender},"#ProgressNotesHistoryMineBtn":{toggle:a.onProgressNotesHistoryMineBtnToggle},"#ProgressNotesHistorySpecialtyBtn":{toggle:a.onProgressNotesHistorySpecialtyBtnToggle}}),a.encOunterCtl=this.getController("patient.encounter.Encounter")},onProgressNotesHistoryMineBtnToggle:function(){this.doEncounterProgressNotesHistoryGridFilter()},onProgressNotesHistorySpecialtyBtnToggle:function(){this.doEncounterProgressNotesHistoryGridFilter()},doEncounterProgressNotesHistoryGridFilter:function(){var a,b,c=this,d=c.getEncounterProgressNotesHistoryGrid().getStore(),e=c.getProgressNotesHistoryMineBtn(),f=c.getProgressNotesHistorySpecialtyBtn(),g=c.encOunterCtl.getEncounterRecord(),h=[];null!==g&&(a=g.get("provider_uid"),b=g.get("specialty_id"),e.pressed&&null!=a&&h.push({property:"provider_uid",value:a}),f.pressed&&null!=b&&h.push({property:"specialty_id",value:b}),0===h.length?d.clearFilter():(d.clearFilter(!0),d.filter(h)))},onEncounterProgressNotesHistoryGridAfterRender:function(){},onBeforeEncounterLoad:function(){},onEncounterLoad:function(a){this.loadPatientProgressHistory(a.get("pid"),a.get("eid"))},loadPatientProgressHistory:function(a,b){var c=this.getEncounterProgressNotesHistoryGrid(),d=c?c.getStore():!1;say("loadPatientProgressHistory --->>>"),say("pid: "+a),say("eid: "+b),say(c),say(d),say(app.patient),say("loadPatientProgressHistory <<<---"),c&&c.rendered&&d.tree.root.removeAll(),d&&d.load({params:{pid:a,eid:b},callback:function(a){say("loadPatientProgressHistory load callback --->>>"),say(a),say("loadPatientProgressHistory load callback <<<---")}})}}),Ext.define("App.controller.patient.PdfForms",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientSummaryImagesPanel",selector:"#PatientSummaryImagesPanel"},{ref:"PatientPdfFormsWindow",selector:"#PatientPdfFormsWindow"}],init:function(){var a=this;a.control({"#PatientSummaryImagesPanel":{beforerender:a.onPatientSummaryImagesPanelBeforeRender},"#PatientPdfFormsBtn":{click:a.onPatientPdfFormsBtnClick},"#PatientPdfFormsWindowCancelBtn":{click:a.onPatientPdfFormsWindowCancelBtnClick},"#PatientPdfFormsWindowGenerateBtn":{click:a.onPatientPdfFormsWindowGenerateBtnClick}}),a.pdf_forms_fieldsets=[],a.getDocumentPdfFormFieldsets()},onPatientPdfFormsWindowCancelBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm();b.pid=void 0,b.facility_id=void 0,b.referring_id=void 0,b.custom_fields=void 0,c.reset(),b.close()},onPatientPdfFormsWindowGenerateBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=[];return Ext.isArray(d.pdf_form_id)?d.pdf_form_id.forEach(function(a){a>0&&e.push(a)}):e.push(d.pdf_form_id),0===e.length?void app.msg(_("oops"),"Nothing to Generate","yellow"):(b.el.mask("Generating..."),b.facility_id=b.facility_id>0?b.facility_id:app.user.facility,void DocumentPdfForms.generatePdfForms(e,b.pid,b.facility_id,b.referring_id,b.custom_fields,function(a){b.el.unmask(),c.reset(),b.pid=void 0,b.facility_id=void 0,b.referring_id=void 0,b.custom_fields=void 0,b.close(),app.getController("DocumentViewer").doDocumentView(a.id,"pdf_form")}))},getDocumentPdfFormFieldsets:function(){var a=this,b={};DocumentPdfForms.getDocumentPdfForms({is_active:!0},function(c){c.forEach(function(c){var d=b[c.document_type],e={xtype:"checkboxfield",name:"pdf_form_id",inputValue:c.id,boxLabel:c.document_title};if(void 0!==d)a.pdf_forms_fieldsets[d].items.push(e);else{var f={xtype:"fieldset",title:c.document_type,items:[e]};a.pdf_forms_fieldsets.push(f),b[c.document_type]=a.pdf_forms_fieldsets.indexOf(f)}})})},doShowPdfForm:function(a,b,c,d){var e=this.showPatientPdfFormsWindow();e.pid=a,e.facility_id=b,e.referring_id=c,e.custom_fields=d,e.el.unmask(),e.down("form").getForm().reset()},onPatientPdfFormsBtnClick:function(){this.doShowPdfForm(app.patient.pid)},showPatientPdfFormsWindow:function(){var a=this;return a.getPatientPdfFormsWindow()||Ext.create("Ext.window.Window",{title:"Patient Forms",itemId:"PatientPdfFormsWindow",width:600,layout:"fit",closeAction:"hide",bodyPadding:5,items:[{xtype:"form",itemId:"PatientPdfFormsWindowForm",bodyPadding:10,items:a.pdf_forms_fieldsets}],buttons:[{xtype:"button",text:_("cancel"),itemId:"PatientPdfFormsWindowCancelBtn"},{xtype:"button",text:_("generate"),itemId:"PatientPdfFormsWindowGenerateBtn"}]}),a.getPatientPdfFormsWindow().show()},onPatientSummaryImagesPanelBeforeRender:function(a){a.addDocked({xtype:"toolbar",dock:"bottom",items:[{xtype:"button",text:_("pdf_forms"),itemId:"PatientPdfFormsBtn",iconCls:"far fa-file-alt",flex:1}]},0)}}),Ext.define("App.controller.patient.RadOrders",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"RadOrdersGrid",selector:"patientradorderspanel"},{ref:"PrintRadOrderBtn",selector:"patientradorderspanel #printRadOrderBtn"}],init:function(){var a=this;a.control({patientradorderspanel:{activate:a.onRadOrdersGridActive,selectionchange:a.onRadOrdersGridSelectionChange,beforerender:a.onRadOrdersGridBeforeRender},"#radOrderliveSearch":{select:a.onRadSearchSelect},"patientradorderspanel #newRadOrderBtn":{click:a.onNewRadOrderBtnClick},"patientradorderspanel #printRadOrderBtn":{click:a.onPrintRadOrderBtnClick},"#RadOrdersUnableToPerformField":{select:a.onRadOrdersUnableToPerformFieldSelect,fieldreset:a.onRadOrdersUnableToPerformFieldReset}}),a.encounterCtl=a.getController("patient.encounter.Encounter")},onRadOrdersUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onRadOrdersUnableToPerformFieldReset:function(a){var b=a.up("form").getForm(),c=b.getRecord();a.setValue(null),c.set({not_performed_code:null,not_performed_code_type:null,not_performed_code_text:null})},onOrdersDeleteActionHandler:function(b,c,d,e,f,g){if(!a("remove_patient_order"))return void app.msg(_("oops"),_("not_authorized"),!0);var h=b.getStore();Ext.Msg.show({title:_("wait"),msg:"<b>"+g.get("STR")+"</b><br><br>"+_("delete_this_record"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&Ext.Msg.show({title:_("wait"),msg:_("this_action_can_not_be_undone_continue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(h.remove(g),h.sync({callback:function(){h.remove(g),h.sync({callback:function(){}})}}))}})}})},onRadOrdersGridBeforeRender:function(a){app.on("patientunset",function(){a.editingPlugin.cancelEdit(),a.getStore().removeAll()})},onRadSearchSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({code:b[0].data.loinc_number,code_type:b[0].data.code_type}),c.findField("code")&&c.findField("code").setValue(b[0].data.code),c.findField("note")&&c.findField("note").focus(!1,200)},onRadOrdersGridSelectionChange:function(a,b){this.getPrintRadOrderBtn().setDisabled(0===b.length)},onNewRadOrderBtnClick:function(){var a=this,b=a.getRadOrdersGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,date_ordered:new Date,order_type:"rad",status:"Pending",priority:"Normal"}),b.editingPlugin.startEdit(0,0)},onPrintRadOrderBtnClick:function(a,b){var c=this,d=c.getRadOrdersGrid(),e=Ext.isArray(a)?a:d.getSelectionModel().getSelection(),f={};e.forEach(function(a){var b=Ext.Date.format(a.get("date_ordered"),"Y-m-d"),c=g("order_pdf_format")||null,d="_"+a.get("eid")+a.get("pid")+a.get("uid")+b;f[d]||(f[d]={},f[d].pid=a.get("pid"),f[d].eid=a.get("eid"),f[d].date_ordered=b,f[d].provider_uid=a.get("uid"),f[d].orderItems=[],f[d].docType="Rad",f[d].templateId=6,f[d].pdf_format=c,f[d].dx_required=!1,f[d].orderItems.push(["Description","Notes"])),f[d].orderItems.push([a.get("description")+" ["+a.get("code_type")+":"+a.get("code")+"]",a.get("note")])}),Ext.Object.each(f,function(a,c){DocumentHandler.createTempDocument(c,function(a){return Ext.isString(a)?void app.msg(_("oops"),a,!0):void(b===!0?Printer.doTempDocumentPrint(1,a.id):window.dual?dual.onDocumentView(a.id,"Rad"):app.onDocumentView(a.id,"Rad"))})})},onRadOrdersGridActive:function(a){var b=a.getStore();a.editingPlugin.editing||(b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid},{property:"order_type",value:"rad"},{property:"is_external_order",value:0}]))},radOrdersGridStatusColumnRenderer:function(a){var b="black";return"Canceled"==a?b="red":"Pending"==a?b="orange":"Routed"==a?b="blue":"Complete"==a&&(b="green"),'<div style="color:'+b+'">'+a+"</div>"},doAddOrderByTemplate:function(a){var b=this,c=b.getRadOrdersGrid(),d=c.getStore();a.pid=app.patient.pid,a.eid=app.patient.eid,a.uid=app.user.id,a.date_ordered=new Date,a.order_type="rad",a.status="Pending",a.priority="Normal";var e=d.add(a)[0];e.save({success:function(){app.msg(_("sweet"),a.description+" "+_("added"))}})}}),Ext.define("App.controller.patient.Reminders",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientRemindersAddBtn",selector:"#RemindersAddBtn"},{ref:"PatientSummaryRemindersPanel",selector:"#PatientSummaryRemindersPanel"}],init:function(){var a=this;a.control({"#PatientSummaryRemindersPanel":{activate:a.onPatientSummaryRemindersPanelActivate},"#PatientRemindersAddBtn":{click:a.onPatientRemindersAddBtnClick}})},onPatientSummaryRemindersPanelActivate:function(){this.getPatientSummaryRemindersPanel().getStore().load({filters:[{property:"pid",value:app.patient.pid}]})},onPatientRemindersAddBtnClick:function(a){var b=a.up("grid"),c=b.store;b.plugins[0].cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,reminder_type:"appointment",reminder_date:new Date,reminder_note:"",create_date:new Date,create_uid:app.user.id}),b.plugins[0].startEdit(0,0)}}),Ext.define("App.controller.patient.Social",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"SocialPanel",selector:"patientsocialpanel"},{ref:"SocialHistoryGrid",selector:"patientsocialhistorypanel"},{ref:"SocialHistoryTypeCombo",selector:"combobox[action=socialHistoryTypeCombo]"},{ref:"SocialHistoryAddBtn",selector:"button[action=socialHistoryAddBtn]"},{ref:"ObservationColumn",selector:"#socialhistorypanelobservationcolumn"},{ref:"SmokingStatusCombo",selector:"#socialsmokingstatuscombo"}],init:function(){var a=this;
a.control({patientsocialpanel:{activate:a.onSocialPanelActive},patientsocialhistorypanel:{beforeedit:a.onSocialHistoryBeforeEdit},"button[action=socialHistoryAddBtn]":{click:a.onAddBtnClicked},"combobox[action=socialHistoryTypeCombo]":{select:a.onHistoryTypeComboSelectionChanged},"#socialsistoryobservationcombo":{select:a.onHistoryObservationComboSelect},"#socialsmokingstatuscombo":{select:a.onSmokingStatusComboSelect},"#reviewsmokingstatuscombo":{select:a.onSmokingStatusComboSelect},"#PatientSmokingStatusGridCounselingField":{select:a.onPatientSmokingStatusGridCounselingFieldSelect}}),a.smokeStatusStore=Ext.create("App.store.patient.SmokeStatus",{pageSize:1e3,listeners:{scope:a,load:a.onSmokeStatusStoreLoad}})},onPatientSmokingStatusGridCounselingFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({counseling_code:b[0].get("code"),counseling_code_type:b[0].get("code_type")})},onSmokeStatusStoreLoad:function(a){a.last()&&this.getSmokingStatusCombo()&&this.getSmokingStatusCombo().setValue(a.last().data.status)},onSmokingStatusComboSelect:function(a,b){var c=this;c.smokeStatusStore.add({pid:app.patient.pid,eid:app.patient.eid,status:b[0].data.option_name,status_code:b[0].data.code,status_code_type:b[0].data.code_type,create_uid:app.user.id,create_date:new Date}),c.smokeStatusStore.sync({success:function(){window.dual?dual.msg(_("sweet"),_("record_updated")):app.msg(_("sweet"),_("record_updated")),c.loadSmokeStatusStore(a.up("grid").up("panel"))},failure:function(){window.dual?dual.msg(_("oops"),_("record_error"),!0):app.msg(_("oops"),_("record_error"),!0)}})},onAddBtnClicked:function(){var a,b=this.getSocialHistoryTypeCombo().lastSelection[0],c=this.getSocialHistoryGrid().editingPlugin;this.getSocialHistoryTypeCombo().isValid()&&(c.cancelEdit(),a=this.getSocialHistoryGrid().getStore().add({pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,update_uid:app.user.id,create_date:new Date,update_date:new Date,category_code:b.data.code,category_code_type:b.data.code_type,category_code_text:b.data.option_name}),c.startEdit(a[0],0))},onSocialHistoryBeforeEdit:function(a,b){var c,d=this.getObservationColumn();c="229819007"==b.record.data.category_code?{xtype:"gaiaehr.combo",valueField:"option_name",itemId:"socialsistoryobservationcombo",list:106}:"160573003"==b.record.data.category_code?{xtype:"gaiaehr.combo",valueField:"option_name",itemId:"socialsistoryobservationcombo",list:105}:"256235009"==b.record.data.category_code?{xtype:"gaiaehr.combo",valueField:"option_name",itemId:"socialsistoryobservationcombo",list:107}:"363908000"==b.record.data.category_code?{xtype:"gaiaehr.combo",valueField:"option_name",itemId:"socialsistoryobservationcombo",list:108}:{xtype:"textfield"},c._marginWidth=2,d.setEditor(c),a.editor.onColumnResize(d)},onHistoryObservationComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({observation_code:b[0].data.code,observation_code_type:b[0].data.code_type})},onHistoryTypeComboSelectionChanged:function(){this.getSocialHistoryAddBtn().enable()},loadSmokeStore:function(){this.smokeStatusStore.clearFilter(!0),this.smokeStatusStore.filter([{property:"pid",value:app.patient.pid}])},loadSmokeStatusStore:function(a){var b=a.query("#PatientSmokingStatusGrid");if(b.length>0){var c=b[0].getStore();c.clearFilter(!0),c.filter([{property:"pid",value:app.patient.pid}])}},loadSocialHistoryStore:function(a){var b=a.query("#PatientSocialHistoryGrid");if(b.length>0){var c=b[0].getStore();c.clearFilter(!0),c.filter([{property:"pid",value:app.patient.pid}])}},onSocialPanelActive:function(a){this.loadSmokeStatusStore(a),this.loadSocialHistoryStore(a),this.loadSmokeStore(),this.getSmokingStatusCombo().reset()}}),Ext.define("App.controller.patient.SocialPsychologicalBehavioral",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"SocialPsychologicalBehavioralPanel",selector:"#SocialPsychologicalBehavioralPanel"},{ref:"SocialPsychologicalBehavioralWindow",selector:"#SocialPsychologicalBehavioralWindow"},{ref:"SocialPsychologicalBehavioralForm",selector:"#SocialPsychologicalBehavioralForm"},{ref:"SocialPsychologicalBehavioralGrid",selector:"#SocialPsychologicalBehavioralGrid"},{ref:"SocialPsychologicalBehavioralChart",selector:"#SocialPsychologicalBehavioralChart"}],init:function(){var a=this;a.control({"#SocialPsychologicalBehavioralPanel":{activate:a.onSocialPsychologicalBehavioralPanelActivate},"#SocialPsychologicalBehavioralGrid":{itemdblclick:a.onSocialPsychologicalBehavioralGridItemDblClick},"#SocialPsychologicalBehavioralAddBtn":{click:a.onSocialPsychologicalBehavioralAddBtnClick},"#SocialPsychologicalBehavioralPanelSaveBtn":{click:a.onSocialPsychologicalBehavioralPanelSaveBtnClick},"#SocialPsychologicalBehavioralPanelCancelBtn":{click:a.onSocialPsychologicalBehavioralPanelCancelBtnClick}})},doTest:function(){var a=this;a.showSocialPsychologicalBehavioralWindow()},onSocialPsychologicalBehavioralPanelActivate:function(){var a=this.getSocialPsychologicalBehavioralGrid().getStore();a.clearFilter(),a.filter([{property:"pid",value:app.patient.pid||0}])},onSocialPsychologicalBehavioralAddBtnClick:function(){this.showSocialPsychologicalBehavioralWindow();var a=this.getSocialPsychologicalBehavioralGrid().getStore(),b=this.getSocialPsychologicalBehavioralForm().getForm(),c=a.add({pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,create_date:new Date});b.reset(),b.loadRecord(c[0])},onSocialPsychologicalBehavioralGridItemDblClick:function(a,b){this.showSocialPsychologicalBehavioralWindow();var c=this.getSocialPsychologicalBehavioralForm().getForm();c.reset(),c.loadRecord(b)},onSocialPsychologicalBehavioralPanelSaveBtnClick:function(){var a=this,b=a.getSocialPsychologicalBehavioralForm().getForm(),c=b.getRecord(),d=b.getValues();if(b.isValid())return d.patient_health_score=d.interest_pleasure+d.feeling_down_depressed,d.patient_drink_score=d.drink_often+d.drink_per_day+d.drink_more_than_6,d.patient_isolation_score=d.marital_status+d.phone_family+d.together_friends+d.religious_services+d.belong_organizations,d.patient_humiliation_score=d.abused_by_partner+d.afraid_of_partner+d.raped_by_partner+d.physically_hurt_by_partner,c.set(d),Ext.Object.isEmpty(c.getChanges())?void a.getSocialPsychologicalBehavioralWindow().close():void c.store.sync({callback:function(){a.getSocialPsychologicalBehavioralWindow().close()}})},onSocialPsychologicalBehavioralPanelCancelBtnClick:function(){this.getSocialPsychologicalBehavioralWindow().close()},showSocialPsychologicalBehavioralWindow:function(){return this.getSocialPsychologicalBehavioralWindow()||Ext.create("App.view.patient.windows.SocialPsychologicalBehavioral"),this.getSocialPsychologicalBehavioralWindow().show()}}),Ext.define("App.controller.patient.RxOrders",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"RxOrdersGrid",selector:"patientrxorderspanel"},{ref:"RxOrdersGridTopToolbar",selector:"#RxOrdersGridTopToolbar"},{ref:"RxNormOrderLiveSearch",selector:"#RxNormOrderLiveSearch"},{ref:"CloneRxOrderBtn",selector:"#cloneRxOrderBtn"},{ref:"PrintRxOrderBtn",selector:"#printRxOrderBtn"},{ref:"RxEncounterDxLiveSearch",selector:"#rxEncounterDxLiveSearch"},{ref:"RxEncounterDxCombo",selector:"#RxEncounterDxCombo"},{ref:"RxOrderMedicationInstructionsCombo",selector:"#RxOrderMedicationInstructionsCombo"},{ref:"RxOrderGridFormNotesField",selector:"#RxOrderGridFormNotesField"},{ref:"RxOrderCompCheckBox",selector:"#RxOrderCompCheckBox"},{ref:"RxOrderSplyCheckBox",selector:"#RxOrderSplyCheckBox"},{ref:"RxOrdersShowAllMedicationsBtn",selector:"#RxOrdersShowAllMedicationsBtn"},{ref:"RxOrderActiveDrugAllergyFieldset",selector:"#RxOrderActiveDrugAllergyFieldset"}],init:function(){var a=this;a.control({patientrxorderspanel:{activate:a.onRxOrdersGridActive,selectionchange:a.onRxOrdersGridSelectionChange,beforerender:a.onRxOrdersGridBeforeRender,beforeedit:a.onRxOrdersGridBeforeEdit,edit:a.onRxOrdersGridEdit,validedit:a.onRxOrdersGridValidEdit},"#RxOrdersGridTopToolbar > button[action=rx_show]":{toggle:a.onRxOrdersGridShowBtnToggle},"#RxOrderEndDateField":{select:a.onRxOrderEndDateFieldSelect},"#RxNormOrderLiveSearch":{beforeselect:a.onRxNormOrderLiveSearchBeforeSelect},"#newRxOrderBtn":{click:a.onNewRxOrderBtnClick},"#cloneRxOrderBtn":{click:a.onCloneRxOrderBtnClick},"#printRxOrderBtn":{click:a.onPrintRxOrderBtnClick},"#RxOrderCompCheckBox":{change:a.onRxOrderCompCheckBoxChange},"#RxOrderSplyCheckBox":{change:a.onRxOrderSplyCheckBoxChange},"#RxOrdersShowAllMedicationsBtn":{toggle:a.onRxOrdersShowAllMedicationsBtnToggle},"#RxOrderGridFormUnableToPerformField":{select:a.onRxOrderGridFormUnableToPerformFieldSelect,fieldreset:a.onRxOrderGridFormUnableToPerformFieldReset}})},onRxOrderEndDateFieldSelect:function(a){var b=a.up("form").getForm();say("onRxOrderEndDateFieldSelect"),say(a),b.getRecord().set({is_active:!1,active:!1})},onRxOrderGridFormUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onRxOrderGridFormUnableToPerformFieldReset:function(a){var b=a.up("form").getForm(),c=b.getRecord();a.setValue(null),c.set({not_performed_code:null,not_performed_code_type:null,not_performed_code_text:null})},onRxOrdersShowAllMedicationsBtnToggle:function(){this.doLoadOrdersGrid()},onRxOrdersDeleteActionHandler:function(b,c,d,e,f,g){if(!a("remove_patient_medication"))return void app.msg(_("oops"),_("not_authorized"),!0);var h=b.getStore();Ext.Msg.show({title:_("wait"),msg:"<b>"+g.get("STR")+"</b><br><br>"+_("delete_this_record"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&Ext.Msg.show({title:_("wait"),msg:_("this_action_can_not_be_undone_continue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(h.remove(g),h.sync({callback:function(){h.remove(g),h.sync({callback:function(){}})}}))}})}})},onRxOrderCompCheckBoxChange:function(a,b){b&&this.getRxOrderSplyCheckBox().setValue(!1)},onRxOrderSplyCheckBoxChange:function(a,b){b&&this.getRxOrderCompCheckBox().setValue(!1)},doSelectOrderByOrderId:function(a){var b=this.getRxOrdersGrid().getSelectionModel(),c=this.getRxOrdersGrid().getStore().getById(a);return c?(b.select(c),c):!1},onRxOrdersGridBeforeRender:function(a){app.on("patientunset",function(){a.editingPlugin.cancelEdit(),a.getStore().removeAll()})},onRxOrdersGridSelectionChange:function(a,b){this.getCloneRxOrderBtn().setDisabled(0===b.length),this.getPrintRxOrderBtn().setDisabled(0===b.length)},onRxNormOrderLiveSearchBeforeSelect:function(a,b){var c,d=a.up("form").getForm(),e=this.getRxOrderMedicationInstructionsCombo(),f=d.getRecord();f.set({STR:b.data.STR,RXCUI:b.data.RXCUI,CODE:b.data.CODE,GS_CODE:b.data.GS_CODE,NDC:b.data.NDC,TTY:b.data.TTY});try{var g={};Rxnorm.getMedicationAttributesByRxcuiApi(b.data.RXCUI,function(a){a.propConceptGroup&&a.propConceptGroup.propConcept.forEach(function(a){if("ATTRIBUTES"===a.propCategory||"CODES"===a.propCategory){g[a.propCategory]||(g[a.propCategory]={});var b=a.propName.replace(" ","_");g[a.propCategory][b]=a.propValue}}),g.ATTRIBUTES&&g.ATTRIBUTES.SCHEDULE&&"0"!=g.ATTRIBUTES.SCHEDULE&&f.set({is_controlled:!0})}),c=b.instructions(),e.bindStore(c,!0),e.store=c,e.store.load(),d.findField("dispense").focus(!1,200)}catch(h){}},onRxOrdersGridBeforeEdit:function(a,b){if(!b.record.data.date_ordered)return app.msg(_("oops"),_("unable_to_edit_non_ordered_medication"),!0),!1;this.getRxEncounterDxCombo().getStore().load({filters:[{property:"eid",value:b.record.data.eid}]}),this.getRxOrderMedicationInstructionsCombo().getStore().load({filters:[{property:"rxcui",value:b.record.data.RXCUI}]});var c=this;Allergies.getPatientAllergiesByEid(10,function(a){if(a!==!1){for(var b=c.getRxOrderActiveDrugAllergyFieldset(),d="<ul>",e=0;e<a.length;e++)d+="<li><b>"+a[e].allergy+"</b> - "+a[e].reaction+" - "+a[e].severity+"</li>";d+="</ul>",b.update(d)}})},onRxOrdersGridValidEdit:function(){},onRxOrdersGridEdit:function(a,b){var c,d=this.getRxOrderMedicationInstructionsCombo(),e=b.record.data.directions,f=d.findRecordByValue(e);return f!==!1?!0:(Ext.Msg.show({title:_("new_instruction"),msg:"<p>"+e+"</p><p>"+_("would_you_like_to_save_it")+"</p>",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(c=d.getStore(),c.add({rxcui:b.record.data.RXCUI,occurrence:"1",instruction:e}),c.sync())}}),!0)},onNewRxOrderBtnClick:function(a){var b=a.up("grid");b.editingPlugin.cancelEdit(),b.getStore().insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,refill:0,daw:null,date_ordered:new Date,begin_date:new Date,created_date:new Date,is_active:!0,active:!0}),b.editingPlugin.startEdit(0,0)},onCloneRxOrderBtnClick:function(){var a=this;Ext.Msg.show({title:_("wait"),msg:_("sure_you_want_clone_prescription"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"===b&&a.doCloneOrder()}})},doCloneOrder:function(a){var b,c,d=this,e=d.getRxOrdersGrid(),f=e.getSelectionModel(),g=e.getStore(),h=f.getSelection(),i=app.getDate(),j=[];e.editingPlugin.cancelEdit(),f.deselectAll();for(var k=0;k<h.length;k++)c=Ext.clone(h[k].data),h[k].set({is_active:!1,active:!1,end_date:i}),c.is_active=!0,c.active=!0,c.end_date=null,c.pid=app.patient.pid,c.eid=app.patient.eid,c.uid=app.user.id,c.ref_order=c.id,"string"==typeof a&&(c.ref_order+="~"+a),c.date_ordered=i,c.begin_date=i,c.created_date=i,c.id=null,j.push(c);return b=g.insert(0,j),g.sync(),b},onPrintRxOrderBtnClick:function(a,b){var c,d,e=this,f=e.getRxOrdersGrid(),h=Ext.isArray(a)?a:f.getSelectionModel().getSelection(),i=g("order_pdf_format")||null,j=!0,k="",l={};h.forEach(function(a){var b=Ext.Date.format(a.get("date_ordered"),"Y-m-d"),e="_"+a.get("eid")+a.get("pid")+a.get("uid")+b;if(l[e]||(l[e]={},l[e].pid=a.get("pid"),l[e].eid=a.get("eid"),l[e].date_ordered=b,l[e].provider_uid=a.get("uid"),l[e].orderItems=[],l[e].docType="Rx",l[e].templateId=5,l[e].pdf_format=i,c=j?[""]:["Description","Instructions","Dispense","Refill","Days Supply","Dx","Notes","References"],l[e].orderItems.push(c)),""!==a.get("ref_order")&&(d=a.get("ref_order").split("~"),d.length>=3&&(k="Rx Reference#: "+d[2])),j){var f=[];f.push("<u>"+_("order_number")+"</u>: "+g("rx_order_number_prefix")+a.get("id")),f.push("<u>"+_("description")+"</u>: <b>"+a.get("STR").toUpperCase()+"</b>"),f.push("<u>"+_("dispense_as_written")+"</u>: "+_(a.get("daw")?"yes":"no")),f.push("<u>"+_("quantity")+"</u>: "+a.get("dispense")),a.get("days_supply")&&f.push("<u>"+_("days_supply")+"</u>: "+a.get("days_supply")),f.push("<u>"+_("refill")+"</u>: "+a.get("refill")),f.push("<u>"+_("instructions")+"</u>: "+a.get("directions"));var h=a.get("dxs").join?a.get("dxs").join(", "):a.get("dxs");h&&""!==h&&f.push("<u>"+_("dx")+"</u>: "+(a.get("dxs").join?a.get("dxs").join(", "):a.get("dxs"))),""!==a.get("notes")&&f.push("<u>"+_("notes_to_pharmacist")+"</u>: "+a.get("notes")),""!==k&&f.push("<u>References</u>: "+k),""!==a.get("system_notes")&&f.push("<b>"+a.get("system_notes")+"</b>"),l[e].orderItems.push([f.join("<br>")])}else l[e].orderItems.push([a.get("STR")+" "+a.get("dose")+" "+a.get("route")+" "+a.get("form"),a.get("directions"),a.get("dispense"),a.get("refill"),a.get("days_supply"),a.get("dxs").join?a.get("dxs").join(", "):a.get("dxs"),a.get("notes"),k])}),Ext.Object.each(l,function(a,c){DocumentHandler.createTempDocument(c,function(a,c){b===!0?Printer.doTempDocumentPrint(1,c.result.id):window.dual?dual.onDocumentView(c.result.id,"Rx"):app.onDocumentView(c.result.id,"Rx")})})},onRxOrdersGridShowBtnToggle:function(a,b){b&&this.doLoadOrdersGrid()},onRxOrdersGridActive:function(){this.doLoadOrdersGrid()},doAddOrderByTemplate:function(a){var b=this,c=b.getRxOrdersGrid(),d=c.getStore(),e=new Date;a.pid=app.patient.pid,a.eid=app.patient.eid,a.uid=app.user.id,a.date_ordered=e,a.begin_date=e,a.created_date=e,d.add(a),d.sync({success:function(){app.msg(_("sweet"),a.STR+" "+_("added"))}})},doLoadOrdersGrid:function(){if(this.getRxOrdersGrid()){var a=this.getRxOrdersGrid(),b=a.getStore(),c=this.getRxOrdersGridTopToolbar().query("button[pressed]");if(!a.editingPlugin.editing){var d=[{property:"pid",value:app.patient.pid}];c.length>0&&"last_6_months"===c[0].action2?d.push({property:"date_ordered",operator:">=",value:Ext.util.Format.date(Ext.Date.subtract(new Date,Ext.Date.MONTH,6),"Y-m-d H:i:s")}):c.length>0&&"last_year"===c[0].action2&&d.push({property:"date_ordered",operator:">=",value:Ext.util.Format.date(Ext.Date.subtract(new Date,Ext.Date.MONTH,12),"Y-m-d H:i:s")}),this.getRxOrdersShowAllMedicationsBtn().pressed||d.push({property:"date_ordered",operator:"!=",value:null}),b.clearFilter(!0),b.filter(d)}}},ndcConvertToElevenDigits:function(a){if(""===a)return a;var b=a.split("-");return 11===b[0].length?b[0]:3!==b.length?b.join(""):(4===b[0].length?b[0]="0"+b[0]:3===b[1].length?b[1]="0"+b[1]:1===b[2].length&&(b[2]="0"+b[2]),b.join(""))}}),Ext.define("App.controller.patient.Visits",{extend:"Ext.app.Controller",refs:[],init:function(){var a=this;a.control({"#PatientVisitsPanel":{activate:a.onPatientVisitsPaneActivate}})},onPatientVisitsPaneActivate:function(a){a.updateTitle(app.patient.name+" ("+_("encounters")+")"),a.historyGrid.store.clearFilter(!0),a.historyGrid.store.filter([{property:"pid",value:app.patient.pid}])}}),Ext.define("App.controller.patient.Summary",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientSummaryPanel",selector:"#PatientSummaryPanel"},{ref:"PatientSummaryEncounterServicesPanel",selector:"#PatientSummaryEncounterServicesPanel"},{ref:"PatientSummaryEncounterServicesPanelRenderingPhysicianField",selector:"#PatientSummaryEncounterServicesPanelRenderingPhysicianField"},{ref:"PatientDocumentPanel",selector:"patientdocumentspanel"},{ref:"PatientCcdPanel",selector:"patientccdpanel"},{ref:"ReferralPanelGrid",selector:"patientreferralspanel"},{ref:"AddReferralBtn",selector:"button[action=addReferralBtn]"},{ref:"PrintReferralBtn",selector:"#printReferralBtn"}],summary_panel_is_active:!1,init:function(){var a=this;a.control({viewport:{patientset:a.onPatientSet},"#PatientSummaryPanel":{activate:a.onPatientSummaryPanelActivate,deactivate:a.onPatientSummaryPanelDeactivate},"#PatientSummaryEncountersPanel":{itemdblclick:a.onPatientSummaryEncounterDblClick},"#PatientSummaryContactsPanel":{activate:a.reloadGrid},"#PatientSummeryNotesPanel":{activate:a.reloadGrid},"#PatientSummaryVitalsPanel":{activate:a.reloadGrid},"#PatientEncounterHistoryPanel":{activate:a.reloadGrid},"#PatientAmendmentsPanel":{activate:a.reloadGrid},"#PatientSummaryDocumentsPanel":{activate:a.reloadGrid},"#PatientSummaryPreventiveCareAlertsPanel":{activate:a.reloadGrid}}),a.nav=a.getController("Navigation")},onPatientSet:function(){say("summary_panel.....");var a=this.getPatientSummaryPanel();say(a),a&&a.loadPatient()},onPatientSummaryPanelActivate:function(a){this.summary_panel_is_active=!0;var b=this.nav.getExtraParams();b&&(b.document?a.down("tabpanel").setActiveTab(this.getPatientDocumentPanel()):b.ccd&&a.down("tabpanel").setActiveTab(this.getPatientCcdPanel()))},onPatientSummaryPanelDeactivate:function(){this.summary_panel_is_active=!1},onPatientSummaryEncounterDblClick:function(a,b){app.openEncounter(b.data.eid)},reloadGrid:function(a){var b;b="PatientSummaryVitalsPanel"==a.itemId?a.down("vitalsdataview").getStore():a.getStore(),b.load({filters:[{property:"pid",value:app.patient.pid}]})}}),Ext.define("App.controller.patient.encounter.Addenda",{extend:"Ext.app.Controller",refs:[{ref:"EncounterSoapAddendaFieldSet",selector:"#EncounterSoapAddendaFieldSet"},{ref:"EncounterSoapAddendaGrid",selector:"#EncounterSoapAddendaGrid"},{ref:"EncounterAddendumWindow",selector:"#EncounterAddendumWindow"},{ref:"EncounterAddendumForm",selector:"#EncounterAddendumForm"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onEncounterLoad},"#EncounterMedicalToolbarAddendumAddBtn":{click:a.onEncounterMedicalToolbarAddendumAddBtnClick},"#EncounterAddendumFormCancelBtn":{click:a.onEncounterAddendumFormCancelBtnClick},"#EncounterAddendumFormSaveBtn":{click:a.onEncounterAddendumFormSaveBtnClick}})},onEncounterLoad:function(a){var b=this,c=b.getEncounterSoapAddendaFieldSet(),d=b.getEncounterSoapAddendaGrid();c&&d&&d.store.load({filters:[{property:"eid",value:a.get("eid")}],callback:function(a){c.setVisible(a.length>0)}})},onEncounterMedicalToolbarAddendumAddBtnClick:function(){this.showEncounterAddendumWindow()},showEncounterAddendumWindow:function(){return this.getEncounterAddendumWindow()||Ext.create("App.view.patient.encounter.EncounterAddendumWindow"),this.getEncounterAddendumWindow().show()},onEncounterAddendumFormCancelBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm();c.reset(),b.close()},onEncounterAddendumFormSaveBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("form").getForm(),e=d.getValues(),f=b.getEncounterSoapAddendaFieldSet(),g=b.getEncounterSoapAddendaGrid();if(d.isValid()){c.el.mask("Saving..."),e.pid=app.patient.pid,e.eid=app.patient.eid,e.create_uid=app.user.id,e.update_uid=app.user.id,e.create_date=app.getDate(),e.update_date=app.getDate(),e.created_by_fname=app.user.fname,e.created_by_mname=app.user.mname,e.created_by_lname=app.user.lname,e.created_by="";var h=Ext.create("App.model.patient.encounter.Addendum",e);f.setVisible(!0),g.getStore().add(h),g.getStore().sync({callback:function(){c.el.unmask(),d.reset(),c.close(),app.msg(_("sweet"),"Addendum Added")}})}}}),Ext.define("App.controller.patient.Vitals",{extend:"Ext.app.Controller",refs:[{ref:"EncounterPanelVitalsPanel",selector:"#encounterPanel vitalspanel"},{ref:"VitalsPanel",selector:"vitalspanel"},{ref:"VitalsBlocksPanel",selector:"vitalspanel #vitalsBlocks"},{ref:"VitalsBlocksPanel",selector:"vitalspanel #vitalsBlocks"},{ref:"VitalsHistoryGrid",selector:"vitalspanel #historyGrid"},{ref:"VitalsAddBtn",selector:"vitalspanel #vitalAddBtn"},{ref:"VitalSignBtn",selector:"vitalspanel #vitalSignBtn"},{ref:"VitalTempFField",selector:"#vitalTempFField"},{ref:"VitalTempCField",selector:"#vitalTempCField"},{ref:"VitalHeightInField",selector:"#vitalHeightInField"},{ref:"VitalHeightCmField",selector:"#vitalHeightCmField"},{ref:"VitalWeightKgField",selector:"#vitalWeightKgField"},{ref:"VitalWeightLbsField",selector:"#vitalWeightLbsField"},{ref:"BpBlock",selector:"vitalspanel #pulseBlock"},{ref:"BpBlock",selector:"vitalspanel #bpBlock"},{ref:"TempBlock",selector:"vitalspanel #tempBlock"},{ref:"WeighBlock",selector:"vitalspanel #weighBlock"},{ref:"HeightBlock",selector:"vitalspanel #heightBlock"},{ref:"BmiBlock",selector:"vitalspanel #bmiBlock"},{ref:"NotesBlock",selector:"vitalspanel #notesBlock"},{ref:"PatientChartsWindow",selector:"#PatientChartsWindow"},{ref:"PatientChartsIframe",selector:"#PatientChartsIframe"},{ref:"PatientChartWeightVsAgeToFiveBtn",selector:"#PatientChartWeightVsAgeToFiveBtn"}],init:function(){var a=this;a.control({viewport:{beforeencounterload:a.onAppBeforeEncounterLoad},"#PatientSummaryPanel vitalspanel":{activate:a.onPatientSummaryPanelVitalsPanelActivate},"vitalspanel #historyGrid":{selectionchange:a.onHistoryGridSelectionChange,beforeselect:a.onHistoryGridBeforeSelect,beforeedit:a.onHistoryGridBeforeEdit,validateedit:a.onHistoryGridValidEdit,edit:a.onHistoryGridEdit},"vitalspanel #vitalAddBtn":{click:a.onVitalAddBtnClick},"vitalspanel #vitalSignBtn":{click:a.onVitalSignBtnClick},"vitalspanel #vitalChartsBtn":{click:a.onVitalChartsBtnClick},"#PatientChartWeightVsAgeToFiveBtn":{click:a.onPatientChartWeightVsAgeToFiveBtnClick},"#PatientChartWeightVsAgeToTwentyBtn":{click:a.onPatientChartWeightVsAgeToTwentyBtnClick},"#PatientChartHeadCircumferenceVsAgeToFiveBtn":{click:a.onPatientChartHeadCircumferenceVsAgeToFiveBtnClick},"#PatientChartLengthVsAgeToFiveBtn":{click:a.onPatientChartLengthVsAgeToFiveBtnClick},"#PatientChartBMIBtn":{click:a.onPatientChartBMIBtnClick},"#vitalTempFField":{keyup:a.onVitalTempFFieldKeyUp},"#vitalTempCField":{keyup:a.onVitalTempCFieldKeyUp},"#vitalHeightInField":{keyup:a.onVitalHeightInFieldKeyUp},"#vitalHeightCmField":{keyup:a.onVitalHeightCmFieldKeyUp},"#vitalWeightLbsField":{keyup:a.onVitalWeightLbsFieldKeyUp},"#vitalWeightKgField":{keyup:a.onVitalWeightKgFieldKeyUp}})},getVitalRecordsByDate:function(a){if(!a||!a.toLocaleDateString)return[];var b=a.toLocaleDateString(),c=this.getVitalsHistoryGrid().getStore();return c.queryBy(function(a){return a.get("date").toLocaleDateString()===b}).items},onVitalChartsBtnClick:function(){this.getPatientChartsWindow()||Ext.create("App.view.patient.windows.Charts"),this.getPatientChartsWindow().show()},onPatientChartWeightVsAgeToFiveBtnClick:function(){var a=this.getChatData("weight_kg"),b="M"===app.patient.sex?"boys":"girls";this.getPatientChartsIframe().setSrc("lib/growthchart/index.html?type=wfa_"+b+"_0_to_5&data="+JSON.stringify(a))},onPatientChartWeightVsAgeToTwentyBtnClick:function(){var a=this.getChatData("weight_kg"),b="M"===app.patient.sex?"boys":"girls";this.getPatientChartsIframe().setSrc("lib/growthchart/index.html?type=wfa_"+b+"_2_to_20&data="+JSON.stringify(a))},onPatientChartHeadCircumferenceVsAgeToFiveBtnClick:function(){var a=this.getChatData("head_circumference_cm"),b="M"===app.patient.sex?"boys":"girls";this.getPatientChartsIframe().setSrc("lib/growthchart/index.html?type=hcfa_"+b+"_0_to_5&data="+JSON.stringify(a))},onPatientChartLengthVsAgeToFiveBtnClick:function(){var a=this.getChatData("height_cm"),b="M"===app.patient.sex?"boys":"girls";this.getPatientChartsIframe().setSrc("lib/growthchart/index.html?type=lfa_"+b+"_0_to_5&data="+JSON.stringify(a))},onPatientChartBMIBtnClick:function(){var a=this.getChatData("bmi"),b="M"===app.patient.sex?"boys":"girls";this.getPatientChartsIframe().setSrc("lib/growthchart/index.html?type=bmi_"+b+"_2_to_20&data="+JSON.stringify(a))},getChatData:function(a){var b=this,c=b.getVitalsHistoryGrid().getStore(),d=c.data.items,e=app.patient.record.get("DOB"),f=[];return d.forEach(function(b){var c=b.get(a),d=app.getAge(e,b.get("date")),g=12*d.years+d.months;Ext.isEmpty(c)||0===c||f.push([g,c])}),f},onPatientSummaryPanelVitalsPanelActivate:function(a){var b=a.down("grid"),c=b.getSelectionModel(),d=b.getStore();d.clearFilter(!0),d.load({filters:[{property:"pid",value:app.patient.pid}],callback:function(a){a.length>0&&c.select(a[0])}})},onRxOrdersDeleteActionHandler:function(b,c,d,e,f,h){if(!a("remove_patient_vitals"))return void app.msg(_("oops"),_("not_authorized"),!0);var i=b.getStore();return h.get("eid")!==app.patient.eid?void app.msg(_("oops"),_("remove_encounter_related_error"),!0):void Ext.Msg.show({title:_("wait"),msg:"<b>"+Ext.Date.format(h.get("date"),g("date_time_display_format"))+"</b><br><br>"+_("delete_this_record"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&Ext.Msg.show({title:_("wait"),msg:_("this_action_can_not_be_undone_continue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(i.remove(h),i.sync({callback:function(){i.remove(h),i.sync({callback:function(){}})}}))}})}})},onAppBeforeEncounterLoad:function(a,b){if(b.down("vitalspanel")){var c=this,d=b.down("vitalspanel").down("grid"),e=d.getSelectionModel(),f=d.getStore();f.clearFilter(!0),f.load({filters:[{property:"pid",value:a.get("pid")}],callback:function(b){b.length>0&&(e.select(b[0]),app.fireEvent("patientvitalsload",c,a,b,f))}})}},onHistoryGridSelectionChange:function(a,b){var c=a.view.panel.down("#vitalSignBtn");this.doUpdateBlocks(a.view.panel.up("vitalspanel"),b),0===b.length||b[0].data.auth_uid>0?c.disable():c.enable()},onHistoryGridBeforeSelect:function(a,b){var c=a.getSelection().length;return c>0&&b.data.auth_uid>0?(app.msg(_("oops"),_("multi_select_signed_records_not_authorized"),!0),!1):!0},onHistoryGridValidEdit:function(b,c){var d=this,e=b.editor.getForm(),f=d.isMetric()?e.findField("weight_kg").getValue():e.findField("weight_lbs").getValue(),g=d.isMetric()?e.findField("height_cm").getValue():e.findField("height_in").getValue(),h=d.bmi(f,g),i=d.bmiStatus(h);c.record.set({bmi:h,bmi_status:i}),a("sign_enc")&&0===c.record.get("auth_uid")&&c.record.set({authorized_by:app.getUserFullname(),auth_uid:app.user.id})},onHistoryGridEdit:function(a,b){this.doUpdateBlocks(a.view.panel.up("vitalspanel"),[b.record])},onHistoryGridBeforeEdit:function(a,b){var c=b.record.get("auth_uid");return 0!==c&&c!==app.user.id?(app.msg(_("oops"),_("this_record_can_not_be_modified_because_it_has_been_signed_by")+" "+b.record.data.authorized_by,!0),!1):!0},onVitalAddBtnClick:function(a){var b,c=a.up("grid"),d=c.getStore();c.editingPlugin.cancelEdit(),b=d.add({pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,administer_by:app.getUserFullname(),date:new Date}),c.editingPlugin.startEdit(b[0],1)},onVitalSignBtnClick:function(){var a=this,b=a.getVitalsHistoryGrid(),c=b.getSelectionModel(),d=c.getSelection();app.fireEvent("beforevitalssigned",d),app.passwordVerificationWin(function(b,c){"ok"===b&&User.verifyUserPass(c,function(b,c){if(c.result){for(var e=0;e<d.length;e++)d[e].set({auth_uid:app.user.id});d[0].store.sync({callback:function(){app.msg("Sweet!",_("vitals_signed")),app.fireEvent("vitalssigned",d)}})}else Ext.Msg.show({title:"Oops!",msg:_("incorrect_password"),buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.ERROR,fn:function(b){"ok"===b&&a.onVitalSignBtnClick()}})})})},doUpdateBlocks:function(a,b){var c=this,d=a.down("#pulseBlock"),e=a.down("#bpBlock"),f=a.down("#tempBlock"),g=a.down("#weighBlock"),h=a.down("#heightBlock"),i=a.down("#bmiBlock"),j=a.down("#notesBlock");b.length>0?(d.update(c.getBlockTemplate("pulse",b[0])),e.update(c.getBlockTemplate("bp",b[0])),c.isMetric()?(f.update(c.getBlockTemplate("temp_c",b[0])),g.update(c.getBlockTemplate("weight_kg",b[0])),h.update(c.getBlockTemplate("height_cm",b[0]))):(f.update(c.getBlockTemplate("temp_f",b[0])),g.update(c.getBlockTemplate("weight_lbs",b[0])),h.update(c.getBlockTemplate("height_in",b[0]))),i.update(c.getBlockTemplate("bmi",b[0])),j.update(c.getBlockTemplate("other_notes",b[0]))):(d.update(c.getBlockTemplate("pulse",!1)),e.update(c.getBlockTemplate("bp",!1)),c.isMetric()?(f.update(c.getBlockTemplate("temp_c",!1)),g.update(c.getBlockTemplate("weight_kg",!1)),h.update(c.getBlockTemplate("height_cm",!1))):(f.update(c.getBlockTemplate("temp_f",!1)),g.update(c.getBlockTemplate("weight_lbs",!1)),h.update(c.getBlockTemplate("height_in",!1))),i.update(c.getBlockTemplate("bmi",!1)),j.update(c.getBlockTemplate("other_notes",!1)))},getBlockTemplate:function(a,b){var c="",d="",e="",f="",g="center";return b!==!1?"pulse"===a?(c=_(a),d=b.data.pulse?+b.data.pulse:"--",e=_("bpm")):"bp"===a?(c=_(a),d=b.data.bp_systolic+"/"+b.data.bp_diastolic,d="null/null"===d||"/"===d?"--/--":d,e=_("systolic")+"/"+_("diastolic")):"temp_c"===a||"temp_f"===a?(c=_("temp"),f="temp_c"===a?"&deg;C":"&deg;F",d=null===b.data[a]||""===b.data[a]?"--":b.data[a]+f,e=""===b.data.temp_location?"--":b.data.temp_location):"weight_lbs"===a||"weight_kg"===a?(c=_("weight"),d=null===b.data[a]||""===b.data[a]?"--":b.data[a]+f,e="weight_lbs"===a?"lbs/oz":"Kg"):"height_in"===a||"height_cm"===a?(c=_("height"),f="height_in"===a?" in":" cm",d=null===b.data[a]||""===b.data[a]?"--":b.data[a]+f):"bmi"===a?(c=_(a),d=null===b.data[a]||""===b.data[a]?"--":this.decimalRound10(b.data[a],-1),e=""===b.data.bmi_status?"--":b.data.bmi_status):"other_notes"===a&&(c=_("notes"),d=null===b.data[a]||""===b.data[a]?"--":b.data[a],g="left"):("temp_c"==a||"temp_f"==a?c=_("temp"):"weight_lbs"==a||"weight_kg"==a?c=_("weight"):"height_in"==a||"height_cm"==a?c=_("height"):"other_notes"==a?(c=_("notes"),g="left"):c=_(a),d="bp"==a?"--/--":"--",e="--"),'<p class="title">'+c+'</p><p class="value" style="text-align: '+g+'">'+d+'</p><p class="extra">'+e+"</p>"},onVitalStoreWrite:function(a,b,c){app.fireEvent("vitalwrite",a,b,c)},onVitalTempFFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({temp_c:this.fc(a.getValue())})},onVitalTempCFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({temp_f:this.cf(a.getValue())})
},onVitalHeightInFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({height_cm:this.incm(a.getValue())})},onVitalHeightCmFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({height_in:this.cmin(a.getValue())})},onVitalWeightLbsFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({weight_kg:this.lbskg(a.getValue())})},onVitalWeightKgFieldKeyUp:function(a){a.up("form").getForm().getRecord().set({weight_lbs:this.kglbs(a.getValue())})},cf:function(a){return Ext.util.Format.round(9*a/5+32,1)},fc:function(a){return Ext.util.Format.round(5*(a-32)/9,1)},lbskg:function(a){var b=a[0]||0,c=a[1]||0,d=0;return b>0&&(d+=b/2.2046),c>0&&(d+=c/35.274),Ext.util.Format.round(d,1)},kglbs:function(a){return Ext.util.Format.round(2.2046*a,1)},incm:function(a){return Math.floor(2.54*a)},cmin:function(a){return Ext.util.Format.round(a/2.54,0)},bmi:function(weight,height){var bmi="",foo=weight.split("/");return foo.length>1&&(weight=eval(foo[0])+foo[1]/16),weight>0&&height>0&&(bmi=this.isMetric()?weight/(height/100*(height/100)):weight/(height*height)*703),bmi.toFixed?bmi.toFixed(1):bmi},bmiStatus:function(a){var b="";return""==a?"":(15>a?b=_("very_severely_underweight"):a>=15&&16>a?b=_("severely_underweight"):a>=16&&18.5>a?b=_("underweight"):a>=18.5&&25>a?b=_("normal"):a>=25&&30>a?b=_("overweight"):a>=30&&35>a?b=_("obese_class_1"):a>=35&&40>a?b=_("obese_class_2"):a>=40&&(b=_("obese_class_3")),b)},isMetric:function(){return"metric"===g("units_of_measurement")},decimalAdjust:function(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?0/0:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))},decimalRound10:function(a,b){return this.decimalAdjust("round",a,b)},floorRound10:function(a,b){return decimalAdjust("floor",a,b)},ceilRound10:function(a,b){return decimalAdjust("ceil",a,b)}}),Ext.define("App.controller.patient.encounter.EncounterDocuments",{extend:"Ext.app.Controller",requires:[],refs:[],init:function(){var a=this;this.control({"#EncounterDocumentsViewBtn":{click:a.onEncounterDocumentsViewBtnClick},"#EncounterDocumentsPrintBtn":{click:a.onEncounterDocumentsPrintBtnClick}})},onEncounterDocumentsPrintBtnClick:function(a){for(var b=a.up("grid"),c=b.getSelectionModel().getSelection(),d={},e=0;e<c.length;e++){var f=c[e].data;d[f.document_type]||(d[f.document_type]={},d[f.document_type].controller=f.controller,d[f.document_type].method=f.method,d[f.document_type].items=[]),Ext.Array.push(d[f.document_type].items,f.record_id)}this.doEncounterDocumentsView(d,!0)},onEncounterDocumentsViewBtnClick:function(a){for(var b=a.up("grid"),c=b.getSelectionModel().getSelection(),d={},e=0;e<c.length;e++){var f=c[e].data;d[f.document_type]||(d[f.document_type]={},d[f.document_type].controller=f.controller,d[f.document_type].method=f.method,d[f.document_type].items=[]),Ext.Array.push(d[f.document_type].items,f.record_id)}this.doEncounterDocumentsView(d,!1)},doEncounterDocumentsView:function(a,b){var c,d=this;Ext.Object.each(a,function(a,e){if("NOTE"===a.toUpperCase()){var f=Ext.data.StoreManager.lookup("DoctorsNotesStore"),g=[];for(c=0;c<e.items.length;c++)Ext.Array.push(g,{property:"id",value:e.items[c]});f.load({filters:g,callback:function(a){d.getController(e.controller)[e.method](a[0],b)}})}else if("REFERRAL"===a.toUpperCase()){var h=Ext.data.StoreManager.lookup("ReferralsStore"),i=[];for(c=0;c<e.items.length;c++)Ext.Array.push(i,{property:"id",value:e.items[c]});h.load({filters:i,callback:function(a){d.getController(e.controller)[e.method](a[0],b)}})}else if("RX"===a.toUpperCase()){var j=Ext.data.StoreManager.lookup("RxOrderStore"),k=[];for(c=0;c<e.items.length;c++)Ext.Array.push(k,{property:"id",value:e.items[c]});j.load({filters:k,callback:function(a){d.getController(e.controller)[e.method](a,b)}})}else if("RAD"===a.toUpperCase()){var l=Ext.data.StoreManager.lookup("LabOrderStore"),m=[];for(c=0;c<e.items.length;c++)Ext.Array.push(m,{property:"id",value:e.items[c]});l.load({filters:m,callback:function(a){d.getController(e.controller)[e.method](a,b)}})}else if("LAB"===a.toUpperCase()){var n=Ext.data.StoreManager.lookup("RadOrderStore"),o=[];for(c=0;c<e.items.length;c++)Ext.Array.push(o,{property:"id",value:e.items[c]});n.load({filters:o,callback:function(a){d.getController(e.controller)[e.method](a,b)}})}})},loadDocumentsByEid:function(a,b){var c=a.getStore();c.removeAll(),Encounter.getEncounterPrintDocumentsByEid(b,function(a){for(var b=[],d=0;d<a.length;d++){var e=a[d];"rx"==e.document_type?(e.controller="patient.RxOrders",e.method="onPrintRxOrderBtnClick"):"rad"==e.document_type?(e.controller="patient.RadOrders",e.method="onPrintRadOrderBtnClick"):"lab"==e.document_type?(e.controller="patient.LabOrders",e.method="onPrintLabOrderBtnClick"):"note"==e.document_type?(e.controller="patient.DoctorsNotes",e.method="onPrintDoctorsNoteBtn"):"referral"==e.document_type&&(e.controller="patient.Referrals",e.method="onPrintReferralBtnClick"),e.document_type=Ext.String.capitalize(e.document_type),Ext.Array.push(b,e)}b.length>0&&(c.loadRawData(b),app.fireEvent("encounterdocumentsload",c))})}}),Ext.define("App.controller.patient.encounter.EncounterSign",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"EncounterSignWindow",selector:"#EncounterSignWindow"},{ref:"EncounterCoSignSupervisorCombo",selector:"#EncounterCoSignSupervisorCombo"},{ref:"EncounterCoSignSupervisorBtn",selector:"#EncounterCoSignSupervisorBtn"},{ref:"EncounterCancelSignBtn",selector:"#EncounterCancelSignBtn"},{ref:"EncounterSignBtn",selector:"#EncounterSignBtn"},{ref:"EncounterSignDocumentGrid",selector:"#EncounterSignDocumentGrid"},{ref:"EncounterSignAlertGrid",selector:"#EncounterSignAlertGrid"}],init:function(){var a=this;this.control({"#EncounterSignWindow":{show:a.onEncounterSignWindowShow},"#EncounterCoSignSupervisorCombo":{beforerender:a.onEncounterCoSignSupervisorComboBeforeRender},"#EncounterCoSignSupervisorBtn":{click:a.onEncounterCoSignSupervisorBtnClick},"#EncounterSignBtn":{click:a.onEncounterSignBtnClick},"#EncounterCancelSignBtn":{click:a.onEncounterCancelSignBtnClick}})},onEncounterCoSignSupervisorBtnClick:function(){this.coSignEncounter()},onEncounterSignBtnClick:function(){this.signEncounter()},onEncounterCancelSignBtnClick:function(){this.cancelCheckout()},coSignEncounter:function(){this.getEncounterSignWindow().enc.doSignEncounter(!0)},signEncounter:function(){a("require_enc_supervisor")?this.getEncounterCoSignSupervisorCombo().isValid()&&this.getEncounterSignWindow().enc.doSignEncounter(!1):this.getEncounterSignWindow().enc.doSignEncounter(!1)},cancelCheckout:function(){this.getEncounterSignWindow().close(),this.getEncounterSignWindow().down("form").getForm().reset()},onEncounterCoSignSupervisorComboBeforeRender:function(a){a.getStore().load()},onEncounterSignWindowShow:function(){var b=this,c=b.getEncounterSignWindow(),d=b.getEncounterCoSignSupervisorCombo(),e=b.getEncounterCoSignSupervisorBtn(),f=b.getEncounterSignBtn();b.encounter=c.enc.encounter,b.pid=c.enc.pid,b.eid=c.enc.eid,a("access_encounter_checkout")&&(App.app.getController("patient.encounter.SuperBill").reconfigureSupperBillGrid(b.encounter.services()),b.getEncounterSignAlertGrid().getStore().load({params:{eid:b.eid}})),b.getEncounterSignDocumentGrid().loadDocs(app.patient.eid);var g=null!=c.enc.encounter.data.supervisor_uid&&c.enc.encounter.data.supervisor_uid>0;g?d.setValue(c.enc.encounter.data.supervisor_uid):d.reset(),c.enc.isClose()||!a("sign_enc")?(f.disable(),e.disable(),d.setVisible(g),d.disable()):!g&&a("require_enc_supervisor")?(f.enable(),e.disable(),d.show(),d.enable()):g&&a("sign_enc_supervisor")?(f.disable(),e.enable(),d.show(),d.enable()):(f.enable(),e.disable(),d.hide(),d.disable())},alertIconRenderer:function(a){return 1==a?'<img src="resources/images/icons/icoLessImportant.png" />':2==a?'<img src="resources/images/icons/icoImportant.png" />':a}}),Ext.define("App.controller.patient.encounter.SuperBill",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"SuperBillGrid",selector:"superbillpanel"},{ref:"SuperBillServiceAddBtn",selector:"#SuperBillServiceAddBtn"},{ref:"SuperBillEncounterDxCombo",selector:"#SuperBillEncounterDxCombo"},{ref:"SuperBillPoceduresQuickPick",selector:"#SuperBillPoceduresQuickPick"},{ref:"SuperBillPoceduresQuickPickForm",selector:"#SuperBillPoceduresQuickPickForm"}],init:function(){var a=this;this.control({viewport:{immunizationedit:a.onImmunizationEdit},superbillpanel:{beforeedit:a.onSuperBillGridBeforeEdit},"#SuperBillServiceAddBtn":{click:a.onSuperBillServiceAddBtnClick},"#SuperCptSearchCmb":{select:a.onSuperCptSearchCmbSelect},"#SuperBillServiceQuickPickBtn":{click:a.onSuperBillServiceQuickPickBtnClick},"#SuperBillPoceduresQuickPickCancelBtn":{click:a.onSuperBillPoceduresQuickPickCancelBtnClick},"#SuperBillPoceduresQuickPickSaveBtn":{click:a.onSuperBillPoceduresQuickPickSaveBtnClick}}),a.encounterCtl=this.getController("patient.encounter.Encounter")},onImmunizationEdit:function(a,b){var c=this.getServiceFormEncounterRecord("cvx",b.data.id);0==c.length&&this.promptAddService(b,"cvx")},promptAddService:function(a,b){var c=this;Ext.Msg.show({title:_("wait"),msg:_("super_bill_prompt_add_question"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"==d&&c.addService(a,b)}})},addService:function(a,b){var c=this;"cvx"==b&&Immunizations.getCptByCvx(a.data.code,function(d){0==d.length?app.msg(_("oops"),_("no_service_code_found"),!0):1==d.length&&c.doAddService(a,b,d[0])})},doAddService:function(a,b,c,d){var e=this.ecounterCtl.getEncounterRecord().services(),f={pid:a.data.pid,eid:a.data.eid,units:1,reference_type:b,reference_id:a.data.id,code:c?c.data.code:a.data.code,code_type:c?c.data.code_type:a.data.code_type,code_text:c?c.data.code_text:a.data.code_text,create_uid:app.user.id,date_create:new Date};a.data.tooth&&(f.tooth=a.data.tooth),a.data.surfaceString&&(f.surface=a.data.surfaceString),a.data.cavity_quadrant&&(f.cavity_quadrant=a.data.cavity_quadrant);var g=e.add(f);e.sync({callback:function(){app.msg(_("sweet"),_("service_added")),"function"==typeof d&&d(g[0])}})},getServiceRecord:function(a){var b=this.getController("patient.encounter.Encounter").getEncounterRecord().services();return b.getById(a)},onSuperBillGridBeforeEdit:function(a,b){this.getSuperBillEncounterDxCombo().getStore().load({filters:[{property:"eid",value:b.record.data.eid}]})},onSuperBillServiceAddBtnClick:function(){var a=this,b=a.getSuperBillGrid(),c=b.getStore(),d=a.getController("patient.encounter.EncounterSign").encounter;b.editingPlugin.cancelEdit();var e=c.add({pid:d.data.pid,eid:d.data.eid,units:1,create_uid:app.user.id,date_create:new Date});b.editingPlugin.startEdit(e[0],0)},onSuperCptSearchCmbSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({code:b[0].data.code,code_type:b[0].data.code_type})},onRemoveService:function(a){a.destroy()},reconfigureSupperBillGrid:function(a){this.getSuperBillGrid().reconfigure(a)},getServiceFormEncounterRecord:function(a,b){var c=this.getController("patient.encounter.Encounter").getEncounterRecord(),d=[];if(null==c)return d;for(var e=c.services(),f=e.data.items,g=e.data.items.length,h=0;g>h;h++){var i=f[h];i.data.reference_type==a&&i.data.reference_id==b&&Ext.Array.push(d,i)}return d},onSuperBillServiceQuickPickBtnClick:function(){this.showoSuperBillPoceduresQuickPick();var a=this.getSuperBillPoceduresQuickPickForm(),b=this.encounterCtl.getEncounterRecord();a.getForm().reset(),this.loadQuickProceduresFields(a,b.get("specialty_id"))},onSuperBillPoceduresQuickPickCancelBtnClick:function(){this.getSuperBillPoceduresQuickPickForm().getForm().reset(),this.getSuperBillPoceduresQuickPick().close()},onSuperBillPoceduresQuickPickSaveBtnClick:function(){var a=this,b=a.getSuperBillPoceduresQuickPickForm(),c=b.getForm(),d=c.getValues(),e=this.encounterCtl.getEncounterRecord(),f=e.get("pid"),g=e.get("eid"),h=[];if(d.services&&null!=e){d.services.forEach(function(a){if("0"!==a){var b=a.split(":");h.push({pid:f,eid:g,units:1,reference_type:"",reference_id:0,code:b[1],code_type:b[0],code_text:b[2],create_uid:app.user.id,date_create:app.getDate()})}});var i=e.services();i.add(h),b.el.mask(_("saving")),i.sync({callback:function(){b.el.unmask(),a.getSuperBillPoceduresQuickPickForm().getForm().reset(),a.getSuperBillPoceduresQuickPick().close()}})}},showoSuperBillPoceduresQuickPick:function(){return this.getSuperBillPoceduresQuickPick()||Ext.create("App.view.patient.windows.SuperBillPoceduresQuickPick"),this.getSuperBillPoceduresQuickPick().show()},loadQuickProceduresFields:function(a,b){a.specialty_id!==b&&(a.specialty_id=b,a.removeAll(),a.el.mask(_("loading")),Services.getServicesQuickPickFieldsBySpecialty(1,function(b){a.add(b),a.el.unmask()}))}}),Ext.define("App.controller.patient.encounter.PhysicalExam",{extend:"Ext.app.Controller",refs:[{ref:"EncounterPhysicalExamForm",selector:"#EncounterPhysicalExamForm"}],init:function(){var a=this;a.control({viewport:{encounterload:a.onEncounterLoad,encounterbeforesync:a.onEncounterSync}})},onEncounterSync:function(){var a=this,b=a.getEncounterPhysicalExamForm().getForm(),c=b.getRecord(),d=b.getValues();c.set(void 0===c.get("id")?{exam_data:d,create_uid:app.user.id,create_date:app.getDate(),update_uid:app.user.id,update_date:app.getDate()}:{exam_data:d,update_uid:app.user.id,update_date:app.getDate()}),Ext.Object.isEmpty(c.getChanges())||c.save({callback:function(a){say(c),say(a)}})},onEncounterLoad:function(a){var b=this,c=b.getEncounterPhysicalExamForm().getForm(),d=a.physicalexams().getAt(0);d?d.set({pid:a.get("pid")}):d=a.physicalexams().add({eid:a.get("eid"),pid:a.get("pid")})[0],c.loadRecord(d),c.setValues(d.get("exam_data"))}}),Ext.define("App.model.administration.ReferringProviderInsuranceBlacklist",{extend:"Ext.data.Model",table:{name:"referring_providers_insurance_blacklist"},fields:[{name:"id",type:"int"},{name:"npi",type:"string",len:10,index:!0},{name:"specialty_id",type:"int",useNull:!0,index:!0},{name:"specialty_name",type:"string",store:!1},{name:"insurance_id",type:"int",useNull:!0,index:!0},{name:"insurance_name",type:"string",store:!1},{name:"note",type:"string",len:255}],proxy:{type:"direct",api:{read:"ReferringProviders.getReferringProviderInsuranceBlacklists",create:"ReferringProviders.addReferringProviderInsuranceBlacklist",update:"ReferringProviders.updateReferringProviderInsuranceBlacklist",destroy:"ReferringProviders.deleteReferringProviderInsuranceBlacklist"}}}),Ext.define("App.controller.patient.encounter.SOAP",{extend:"Ext.app.Controller",recognition:null,speechAction:null,recognizing:!1,isError:!1,final_transcript:"",interim_transcript:"",field:{name:"subjective"},refs:[{ref:"Viewport",selector:"viewport"},{ref:"SoapPanel",selector:"#soapPanel"},{ref:"SoapForm",selector:"#soapPanel #soapForm"},{ref:"SoapProcedureWindow",selector:"#soapProcedureWindow"},{ref:"SoapProcedureForm",selector:"#soapProcedureWindow > form"},{ref:"SnippetsTreePanel",selector:"#soapPanel #SnippetsTreePanel"},{ref:"SpeechBtn",selector:"#soapPanel button[action=speechBtn]"},{ref:"EncounterProgressNotesPanel",selector:"#EncounterProgressNotesPanel"},{ref:"SoapDxCodesField",selector:"#SoapDxCodesField"},{ref:"SoapTemplateSpecialtiesCombo",selector:"#SoapTemplateSpecialtiesCombo"},{ref:"EncounterPanel",selector:"#encounterPanel"},{ref:"EncounterDetailForm",selector:"#EncounterDetailForm"}],init:function(){var a=this;a.control({viewport:{encounterbeforesync:a.onEncounterBeforeSync},"#soapPanel #soapForm":{render:a.onPanelFormRender,write:a.onSoapFormWrite},"#SoapFormReformatTextBtn":{render:a.onSoapFormReformatTextBtnRender,click:a.onSoapFormReformatTextBtnClick},"#soapPanel button[action=speechBtn]":{toggle:a.onSpeechBtnToggle},"#soapForm > fieldset > textarea":{focus:a.onSoapTextFieldFocus},"#soapProcedureWindow > form > textarea":{focus:a.onProcedureTextFieldFocus},"#SoapDxCodesField":{recordadd:a.onSoapDxCodesFieldRecordAdd},"#SoapHealthStatusCmb":{select:a.onSoapHealthStatusCmbSelect}})},onSoapFormReformatTextBtnRender:function(){app.on("KEY-ALT-W",this.onSoapFormReformatTextBtnClick,this)},onSoapFormReformatTextBtnClick:function(){var a=this,b=a.getSoapForm().getForm(),c=b.findField("subjective"),d=b.findField("objective"),e=b.findField("assessment"),f=b.findField("instructions");c.setValue(a.textParser(c.getValue(),!1,!1,!0,!0,!0,!0)),d.setValue(a.textParser(d.getValue(),!1,!1,!0,!0,!0,!0)),e.setValue(a.textParser(e.getValue(),!1,!1,!0,!0,!0,!0)),f.setValue(a.textParser(f.getValue(),!1,!1,!0,!0,!0,!0))},onSoapDxCodesFieldRecordAdd:function(){this.getSoapForm().autoSync&&this.getSoapDxCodesField().sync()},onSoapHealthStatusCmbSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({health_status_code:b[0].get("code"),health_status_code_type:b[0].get("code_type")})},doChiefComplaintHandler:function(a){var b=this.getEncounterPanel().encounter;b.set({brief_description:a.get("chief_complaint")}),Ext.Object.isEmpty(b.getChanges())||b.save()},onSoapFormWrite:function(a,b){b&&b.records&&b.records[0]&&this.doChiefComplaintHandler(b.records[0])},onEncounterBeforeSync:function(a,b,c,d){"soapForm"===c.owner.itemId&&(this.doChiefComplaintHandler(d),this.getSoapDxCodesField().sync())},onSoapTextFieldFocus:function(a){this.field=a,Ext.isWebKit&&(this.final_transcript=a.getValue(),this.interim_transcript="",this.field.tip||(this.field.tip=Ext.create("Ext.tip.ToolTip",{target:this.field.el,anchor:"top",anchorOffset:85,disabled:!0,html:"Press this button to clear the form"})))},onProcedureTextFieldFocus:function(a){this.field=a,Ext.isWebKit&&(this.final_transcript=a.getValue(),this.interim_transcript="")},onPanelFormRender:function(a){Ext.widget("careplangoalsnewwindow",{constrainTo:a.el.dom})},onSpeechBtnToggle:function(a,b){b?this.initSpeech():this.stopSpeech()},stopSpeech:function(){this.recognition.stop(),this.final_transcript="",this.interim_transcript="",delete this.recognition},initSpeech:function(){var a=this;a.recognition&&a.stopSpeech(),a.final_transcript=a.field.getValue(),a.recognition=new webkitSpeechRecognition,a.recognition.continuous=!0,a.recognition.interimResults=!0,a.recognition.lang=app.user.localization,a.recognition.onstart=function(){a.recognizing=!0,a.setRecordButton(!0)},a.recognition.onerror=function(){a.recognizing=!1,a.isError=!0,a.setRecordButton(!1)},a.recognition.onend=function(){a.recognizing=!1,a.setRecordButton(!1)},a.recognition.onresult=function(b){for(var c=b.resultIndex;c<b.results.length;++c)b.results[c].isFinal?(a.field.tip&&(a.field.tip.hide(),a.field.tip.setDisabled(!0)),a.field.setValue(a.field.getValue()+b.results[c][0].transcript)):a.field.tip&&(a.field.tip.setDisabled(!1),a.field.tip.update(b.results[c][0].transcript),a.field.tip.show())},a.recognition.start()},setRecordButton:function(a){this.getSpeechBtn().setIconCls(a?"speech-icon-active":"speech-icon-inactive")},textParser:function(a,b,c,d,e,f,g){return a=a.replace(/^[a-z]/,function(a){return a.toUpperCase()}),a=b?a.replace(/.*:.*/g,function(a){return a.toUpperCase()}):a.replace(/.*:/g,function(a){return a.toUpperCase()}),c&&(a=a.replace(/[.\n]\s*[a-z]/g,function(a){return a.toUpperCase()})),d&&(a=f?a.replace(/([a-z]\.)( |)([a-z])/gi,function(a,b,c,d){return b+"  "+d.toUpperCase()}):a.replace(/([a-z]\.)(  |)([a-z])/gi,function(a,b,c,d){return b+" "+d.toUpperCase()})),e&&(a=a.replace(/([a-z]\.)( |  )([a-z])/gi,function(a,b,c,d){return b+"  "+d.toUpperCase()}),a=a.replace(/(\r|\n|\r\n)([a-z])/gi,function(a,b,c){return b+c.toUpperCase()})),g&&(a=a.replace(/:( |  )[a-z]/g,function(a){return a.toUpperCase()})),a}}),Ext.define("App.controller.patient.encounter.Procedure",{extend:"Ext.app.Controller",refs:[{ref:"EncounterProcedureWindow",selector:"#EncounterProcedureWindow"},{ref:"EncounterProcedureForm",selector:"#EncounterProcedureForm"},{ref:"EncounterProcedureSnomedProblemSearch",selector:"#EncounterProcedureSnomedProblemSearch"},{ref:"EncounterProcedureSnomedSiteSearch",selector:"#EncounterProcedureSnomedSiteSearch"},{ref:"EncounterProcedureGrid",selector:"#EncounterProcedureGrid"}],init:function(){var a=this;a.control({"#EncounterProcedureSnomedProcedureSearch":{select:a.onEEncounterProcedureSnomedProcedureSearchSelect},"#EncounterProcedureSnomedSiteSearch":{select:a.onEncounterProcedureSnomedSiteSearchSelect},"#EncounterProcedureStatusField":{select:a.onEncounterProcedureStatusFieldSelect},"#EncounterProcedureFormSaveBtn":{click:a.onEncounterProcedureFormSaveBtnClick},"#EncounterProcedureFormCancelBtn":{click:a.onEncounterProcedureFormCancelBtnClick},"#EncounterProcedureGrid":{itemdblclick:a.onEncounterProcedureGridItemDblClick},"#EncounterProcedureGridAddBtn":{click:a.onEncounterProcedureGridAddBtnClick},"#EncounterProcedureUnableToPerformField":{select:a.onEncounterProcedureUnableToPerformFieldSelect}})},onEncounterProcedureUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onEEncounterProcedureSnomedProcedureSearchSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({code:b[0].get("ConceptId"),code_type:b[0].get("CodeType"),code_text:b[0].get("Term")})},onEncounterProcedureSnomedSiteSearchSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({target_site_code:b[0].get("ConceptId"),target_site_code_type:b[0].get("CodeType"),target_site_code_text:b[0].get("Term")})},onEncounterProcedureStatusFieldSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({status_code:b[0].get("code"),status_code_type:b[0].get("code_type"),status_code_text:b[0].get("code_type")})},onEncounterProcedureFormSaveBtnClick:function(){var a=this.getEncounterProcedureWindow(),b=this.getEncounterProcedureForm().getForm(),c=b.getValues(),d=b.getRecord(),e=app.getController("patient.encounter.Encounter");b.isValid()&&(d.set(c),Ext.Object.isEmpty(d.getChanges())?(b.reset(),a.close()):d.store.sync({callback:function(){b.reset(),a.close(),e.getProgressNote()}}))},onEncounterProcedureFormCancelBtnClick:function(){var a=this.getEncounterProcedureWindow(),b=this.getEncounterProcedureForm().getForm(),c=b.getRecord();c.store.rejectChanges(),b.reset(),a.close()},onEncounterProcedureGridItemDblClick:function(a,b){this.showEncounterProcedureWindow(),this.getEncounterProcedureForm().getForm().loadRecord(b)},onEncounterProcedureGridAddBtnClick:function(){var a=this.getEncounterProcedureGrid(),b=a.getStore(),c=Ext.create("App.model.patient.encounter.Procedures",{pid:app.patient.pid,eid:app.patient.eid,create_uid:app.user.id,update_uid:app.user.id,create_date:new Date,update_date:new Date});b.add(c),this.onEncounterProcedureGridItemDblClick(a,c)},showEncounterProcedureWindow:function(){return this.getEncounterProcedureWindow()||Ext.create("App.view.patient.windows.EncounterProcedureWindow"),this.getEncounterProcedureWindow().show()}}),Ext.define("App.view.patient.Medications",{extend:"Ext.panel.Panel",requires:["App.store.patient.Medications","App.store.administration.Medications","Ext.form.field.Trigger","App.ux.LiveRXNORMSearch","App.ux.combo.PrescriptionHowTo","App.ux.combo.PrescriptionTypes","App.ux.LiveSigsSearch","App.ux.LiveUserSearch","App.ux.form.fields.DateTime"],xtype:"patientmedicationspanel",title:_("meds"),layout:"border",border:!1,items:[{xtype:"grid",region:"center",action:"patientMedicationsListGrid",itemId:"patientMedicationsGrid",columnLines:!0,features:[{ftype:"grouping"}],store:Ext.create("App.store.patient.Medications",{autoSync:!1,startCollapsed:!0}),columns:[{xtype:"griddeletecolumn",acl:a("remove_patient_medication"),width:25},{xtype:"actioncolumn",width:25,groupable:!1,items:[{icon:"resources/images/icons/blueInfo.png",tooltip:"Get Info",handler:function(a,b,c,d,e,f){App.app.getController("InfoButton").doGetInfo(f.data.RXCUI,"RXCUI",f.data.STR)}}]},{header:_("medication"),flex:1,groupable:!0,hidden:!1,minWidth:200,dataIndex:"STR",editor:{xtype:"rxnormlivetsearch",itemId:"PatientMedicationLiveSearch",displayField:"STR",valueField:"STR",action:"medication",allowBlank:!1},renderer:function(a,b,c){var d="";return""!=c.data.RXCUI&&(d+=" RxNorm: "+c.data.RXCUI),""!=c.data.NDC&&(d+=" NDC: "+c.data.NDC),d=""!=d?" ("+d+" )":"","<b>"+a+"</b>"+d}},{header:_("instructions")+" (SIG)",flex:1,groupable:!0,hidden:!1,minWidth:200,dataIndex:"directions",editor:{xtype:"textfield"}},{xtype:"datecolumn",groupable:!1,format:"Y-m-d",header:_("begin_date"),width:150,dataIndex:"begin_date",sortable:!1,hideable:!1,editor:{xtype:"datefield",format:"Y-m-d"}},{xtype:"datecolumn",groupable:!1,format:"Y-m-d",header:_("end_date"),width:150,dataIndex:"end_date",sortable:!1,hideable:!1,editor:{xtype:"datefield",format:"Y-m-d",itemId:"PatientMedicationEndDateField"}},{header:_("active?"),groupable:!1,width:60,dataIndex:"is_active",editor:{xtype:"checkbox"},renderer:function(a){return app.boolRenderer(a)}}],plugins:Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:2}),bbar:["-",{text:_("reconciled"),itemId:"PatientMedicationReconciledBtn",enableToggle:!0,pressed:!0},"-",{text:_("active"),itemId:"PatientMedicationActiveBtn",enableToggle:!0,pressed:!1},"->",{text:_("review"),itemId:"ReviewMedicationsBtn"}]}],tbar:["->",{text:_("add_new"),itemId:"addPatientMedicationBtn",iconCls:"icoAdd"}]}),Ext.define("App.view.patient.Referrals",{extend:"Ext.grid.Panel",requires:["App.ux.LiveCPTSearch","App.ux.LiveICDXSearch","App.ux.LiveReferringPhysicianSearch","App.ux.combo.ActiveProviders","Ext.selection.CheckboxModel","App.ux.grid.RowFormEditing"],xtype:"patientreferralspanel",title:_("refs"),action:"referralsGrid",itemId:"patientReferralsGrid",columnLines:!0,allowDeselect:!0,store:Ext.create("App.store.patient.Referrals",{remoteFilter:!0,storeId:"ReferralsStore"}),plugins:[{ptype:"rowformediting",clicksToEdit:2,items:[{xtype:"container",defaults:{layout:"anchor"},layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,defaults:{labelAlign:"right",margin:"0 0 5 0"},items:[{xtype:"datefield",fieldLabel:_("referral_date"),name:"referral_date",format:"Y-m-d",validateBlank:!0},{xtype:"snomedliveproceduresearch",fieldLabel:_("requested_service"),displayField:"Term",valueField:"Term",name:"service_text",hideLabel:!1,itemId:"ReferralServiceSearch",anchor:"100%"},{xtype:"textareafield",fieldLabel:_("reason"),name:"referal_reason",anchor:"100%",height:60},{xtype:"liveicdxsearch",margin:"0 0 10",fieldLabel:_("diagnosis"),name:"diagnosis_text",hideLabel:!1,displayField:"code_text",valueField:"code_text",itemId:"referralDiagnosisSearch",anchor:"100%"}]},{xtype:"container",flex:1,defaults:{labelAlign:"right",margin:"0 0 5 0"},items:[{xtype:"activeproviderscombo",fieldLabel:_("refer_by"),name:"refer_by_text",width:350,displayField:"option_name",valueField:"option_name",itemId:"ReferralProviderCombo"},{xtype:"container",layout:"hbox",items:[{xtype:"activeproviderscombo",fieldLabel:_("refer_to"),name:"refer_to_text",labelAlign:"right",margin:"0 5 5 0",width:350,displayField:"fullname",valueField:"fullname",itemId:"ReferralLocalProviderCombo"},{xtype:"referringphysicianlivetsearch",fieldLabel:_("refer_to"),name:"refer_to_text",labelAlign:"right",margin:"0 5 5 0",hideLabel:!1,width:350,disabled:!0,hidden:!0,displayField:"fullname",valueField:"fullname",itemId:"ReferralExternalProviderCombo"},{xtype:"checkboxfield",boxLabel:_("external_referral"),itemId:"ReferralExternalReferralCheckbox",name:"is_external_referral"}]},{xtype:"gaiaehr.combo",fieldLabel:_("risk_level"),name:"risk_level",list:17,width:350},{xtype:"checkboxfield",fieldLabel:_("send_record"),name:"send_record",width:300}]}]}]}],selModel:Ext.create("Ext.selection.CheckboxModel"),columns:[{xtype:"datecolumn",text:_("date"),dataIndex:"referral_date",format:"Y-m-d",menuDisabled:!0,resizable:!1},{text:_("request"),dataIndex:"service_text",menuDisabled:!0,resizable:!1,flex:1},{text:_("refer_by"),dataIndex:"refer_by_text",menuDisabled:!0,resizable:!1,width:200},{text:_("refer_to"),dataIndex:"refer_to_text",menuDisabled:!0,resizable:!1,width:200}],tbar:["->",{text:_("referral"),iconCls:"icoAdd",itemId:"encounterRecordAdd",action:"addReferralBtn"},"-",{text:_("print"),iconCls:"icoPrint",disabled:!0,itemId:"printReferralBtn"}]}),Ext.define("App.model.patient.EncounterDx",{extend:"Ext.data.Model",table:{name:"encounter_dx",comment:"Encounter Diagnosis"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"dx_group",type:"int",index:!0},{name:"dx_order",type:"int",index:!0},{name:"dx_type",type:"string",index:!0,len:5},{name:"code",type:"string",len:25},{name:"code_type",type:"string",len:25},{name:"code_text",type:"string",len:300}],proxy:{type:"direct",api:{read:"Encounter.getEncounterDxs",create:"Encounter.createEncounterDx",update:"Encounter.updateEncounterDx",destroy:"Encounter.destroyEncounterDx"}},belongsTo:{model:"App.model.patient.SOAP",foreignKey:"eid"}}),Ext.define("App.model.patient.ProcedureHistory",{extend:"Ext.data.Model",table:{name:"patient_procedure_history"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"performed_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"procedure",type:"string",len:300},{name:"procedure_code",type:"string",len:40},{name:"procedure_code_type",type:"string",len:15},{name:"target_site_code",type:"string",len:40},{name:"target_site_code_text",type:"string",len:300},{name:"target_site_code_type",type:"string",len:15},{name:"performer",type:"string",len:300},{name:"performer_id",type:"int",index:!0},{name:"service_location",type:"string",len:300},{name:"service_location_id",type:"int",index:!0},{name:"notes",type:"string",dataType:"text"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"ProcedureHistory.getProcedureHistories",create:"ProcedureHistory.addProcedureHistory",update:"ProcedureHistory.updateProcedureHistory",destroy:"ProcedureHistory.destroyProcedureHistory"}}}),Ext.define("App.store.patient.ProcedureHistory",{extend:"Ext.data.Store",model:"App.model.patient.ProcedureHistory"}),Ext.define("App.model.administration.ReferringProvider",{extend:"Ext.data.Model",requires:["App.model.administration.ReferringProviderFacility","App.model.administration.ReferringProviderInsuranceBlacklist"],table:{name:"referring_providers"},fields:[{name:"id",type:"int"},{name:"title",type:"string",len:10},{name:"fname",type:"string",len:35},{name:"mname",type:"string",len:25},{name:"lname",type:"string",len:120},{name:"organization_name",type:"string",len:120},{name:"upin",type:"string",len:15,comment:"Carrier Claim Referring Physician UPIN Number"},{name:"lic",type:"string",len:15},{name:"npi",type:"string",len:15},{name:"ssn",type:"string",len:15},{name:"taxonomy",type:"string",len:15,comment:"taxonomy",defaultValue:"207Q00000X"},{name:"accept_mc",type:"bool",comment:"Accepts Medicare"},{name:"notes",type:"string",len:600},{name:"alerts",type:"string",dataType:"TEXT"},{name:"email",type:"string",len:180},{name:"direct_address",type:"string",len:180},{name:"phone_number",type:"string",len:25},{name:"fax_number",type:"string",len:25},{name:"cel_number",type:"string",len:25},{name:"allow_mail_notifications",type:"bool"},{name:"code",type:"string",len:50},{name:"username",type:"string",len:40,useNull:!0,index:!0},{name:"password",type:"string",len:300,encrypt:!0},{name:"authorized",type:"bool",index:!0},{name:"external_id",type:"string",len:25},{name:"global_id",type:"string",len:50,useNull:!0},{name:"authy_id",type:"string",len:45,index:!0},{name:"active",type:"bool",index:!0},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"ReferringProviders.getReferringProviders",create:"ReferringProviders.addReferringProvider",update:"ReferringProviders.updateReferringProvider"},reader:{root:"data"}},hasMany:[{model:"App.model.administration.ReferringProviderFacility",name:"facilities",foreignKey:"referring_provider_id"},{model:"App.model.administration.ReferringProviderInsuranceBlacklist",name:"blacklist",primaryKey:"npi",foreignKey:"npi"}]}),Ext.define("App.model.patient.SOAP",{extend:"Ext.data.Model",requires:["App.model.patient.Encounter","App.model.patient.EncounterDx","App.model.patient.encounter.Procedures"],table:{name:"encounter_soap",comment:"SOAP Data"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"chief_complaint",type:"string",store:!1},{name:"subjective",type:"string",dataType:"mediumtext"},{name:"objective",type:"string",dataType:"mediumtext"},{name:"assessment",type:"string",dataType:"mediumtext"},{name:"plan",type:"string",dataType:"mediumtext"},{name:"instructions",type:"string",dataType:"mediumtext"},{name:"health_status",type:"string",len:80},{name:"health_status_code",type:"string",len:25},{name:"health_status_code_type",type:"string",len:25}],proxy:{type:"direct",api:{update:"Encounter.updateSoap"},writer:{writeAllFields:!0}},hasMany:[{model:"App.model.patient.EncounterDx",name:"dxCodes",primaryKey:"eid",foreignKey:"eid"},{model:"App.model.patient.encounter.Procedures",name:"procedures",primaryKey:"eid",foreignKey:"eid"}],belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"}}),Ext.define("App.view.miscellaneous.AddressBook",{extend:"App.ux.RenderPanel",requires:["App.store.miscellaneous.AddressBook","Ext.toolbar.Paging","Ext.ux.SlidingPager"],pageTitle:_("address_book"),initComponent:function(){var a=this;
a.grid=Ext.create("Ext.grid.Panel",{store:a.store=Ext.create("App.store.miscellaneous.AddressBook"),columns:[{header:_("name"),width:200,dataIndex:"fullname"},{header:_("primary_phone"),dataIndex:"phone",width:120},{header:_("cell_phone"),dataIndex:"mobile",width:120},{header:_("fax"),dataIndex:"fax",width:120},{header:_("email"),dataIndex:"email",width:120},{header:_("direct_address"),dataIndex:"direct_address",width:120},{header:_("notes"),dataIndex:"notes",flex:1}],plugins:[{ptype:"rowformediting",items:[{xtype:"container",layout:"column",defaults:{xtype:"container",layout:"anchor",margin:5},items:[{width:500,defaults:{labelWidth:80,anchor:"100%"},items:[{xtype:"fieldcontainer",fieldLabel:_("name"),layout:"hbox",defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",emptyText:_("first_name"),name:"fname",width:130},{xtype:"textfield",emptyText:_("middle_name"),name:"mname",width:50},{xtype:"textfield",emptyText:_("last_name"),name:"lname",flex:1,margin:0}]},{xtype:"fieldcontainer",fieldLabel:_("address"),layout:"anchor",defaults:{anchor:"100%",margin:"0 0 5 0"},items:[{xtype:"textfield",emptyText:_("street"),name:"street"},{xtype:"textfield",name:"street_cont"},{xtype:"container",layout:"hbox",defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",emptyText:_("city"),name:"city",flex:1},{xtype:"textfield",emptyText:_("state"),name:"state",width:120},{xtype:"textfield",emptyText:_("zip"),name:"zip",width:100,margin:0}]},{xtype:"textfield",emptyText:_("country"),name:"country",margin:"5 0 0 0"}]},{xtype:"textfield",fieldLabel:_("notes"),name:"notes",margin:"5 0 5 0"}]},{width:300,layout:"anchor",defaults:{anchor:"100%",labelWidth:80,margin:"0 0 5 0"},items:[{xtype:"textfield",fieldLabel:_("phone")+" (1)",name:"phone"},{xtype:"textfield",fieldLabel:_("phone")+" (2)",name:"phone2"},{xtype:"textfield",fieldLabel:_("cell_phone"),name:"mobile"},{xtype:"textfield",fieldLabel:_("fax"),name:"fax"},{xtype:"textfield",fieldLabel:_("email"),name:"email",margin:"5 0 5 0",vtype:"email"},{xtype:"textfield",fieldLabel:_("url"),name:"url"}]},{width:300,layout:"anchor",defaults:{anchor:"100%",labelWidth:100,margin:"0 0 5 0"},items:[{xtype:"textfield",fieldLabel:_("direct_address"),name:"direct_address"}]}]}]}],tbar:[{text:_("add_contact"),iconCls:"icoAdd",scope:a,handler:a.onAddContact}],bbar:Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{})})}),a.pageBody=[a.grid],a.callParent(arguments)},onAddContact:function(){var a,b=this,c=b.grid,d=c.getStore(),e=c.editingPlugin;e.cancelEdit(),a=d.add({})[0],e.startEdit(a,0)},onActive:function(a){this.grid.getStore().load(),a(!0)}}),Ext.define("App.view.patient.AdvanceDirectives",{extend:"Ext.grid.Panel",requires:[],xtype:"patientadvancedirectivepanel",title:_("adv_dir"),columnLines:!0,store:Ext.create("App.store.patient.AdvanceDirectives",{remoteFilter:!0,autoSync:!1}),columns:[{text:_("directive"),flex:1,dataIndex:"code_text",editor:{xtype:"gaiaehr.combo",list:129,loadStore:!0}},{text:_("status"),dataIndex:"status_code_text",flex:1,editor:{xtype:"gaiaehr.combo",list:128,loadStore:!0}},{text:_("notes"),flex:2,dataIndex:"notes",editor:{xtype:"textfield"}},{xtype:"datecolumn",text:_("start_date"),dataIndex:"start_date",editor:{xtype:"datefield"}},{xtype:"datecolumn",text:_("end_date"),dataIndex:"end_date",editor:{xtype:"datefield"}},{xtype:"datecolumn",text:_("verified_date"),dataIndex:"verified_date",editor:{xtype:"datefield"}}],plugins:[{ptype:"rowediting",errorSummary:!1}],tbar:["->",{text:_("add_new"),itemId:"AdvanceDirectiveAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}],bbar:["->",{text:_("review"),itemId:"AdvanceDirectiveReviewBtn",action:"encounterRecordAdd"}]}),Ext.define("App.view.patient.LabOrders",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","Ext.grid.feature.Grouping","Ext.selection.CheckboxModel","App.ux.LiveLabsSearch","App.ux.combo.Combo"],xtype:"patientlaborderspanel",title:_("lab_orders"),itemId:"LabOrders",columnLines:!0,tabConfig:{cls:"order-tab"},store:Ext.create("App.store.patient.PatientsOrders",{storeId:"LabOrderStore",remoteFilter:!0,pageSize:200,sorters:[{property:"date_ordered",direction:"DESC"}],proxy:{type:"direct",api:{read:"Orders.getPatientLabOrders",create:"Orders.addPatientOrder",update:"Orders.updatePatientOrder",destroy:"Orders.deletePatientOrder"},remoteGroup:!1}}),selModel:Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:!1}),plugins:[{ptype:"rowediting",clicksToEdit:2}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("patient.LabOrders").onOrdersDeleteActionHandler(a,b,c,d,e,f)}}]},{header:_("void"),groupable:!1,width:50,align:"center",dataIndex:"void",tooltip:_("void"),editor:{xtype:"checkbox"},renderer:function(a){return app.voidRenderer(a)}},{header:_("order#"),width:60,dataIndex:"id",renderer:function(a,b,c){return c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("status"),width:75,dataIndex:"status",editor:{xtype:"gaiaehr.combo",list:40},renderer:function(a,b,c){var d=app.getController("patient.LabOrders").labOrdersGridStatusColumnRenderer(a);return c.data.void?'<span style="text-decoration: line-through;">'+d+"</span>":d}},{xtype:"datecolumn",header:_("date_ordered"),width:100,dataIndex:"date_ordered",format:"Y-m-d",editor:{xtype:"datefield"},renderer:function(a,b,c){var d=Ext.Date.format(a,g("date_display_format"));return c.data.void?'<span style="text-decoration: line-through;">'+d+"</span>":"<span>"+d+"</span>"}},{header:_("code"),width:100,dataIndex:"code",renderer:function(a,b,c){return c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("description"),flex:1,dataIndex:"description",editor:{xtype:"labslivetsearch",itemId:"rxLabOrderLabsLiveSearch"},renderer:function(a,b,c){return c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("notes"),flex:1,dataIndex:"note",editor:{xtype:"textfield"},renderer:function(a,b,c){return c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("unable_to_perform"),flex:1,dataIndex:"not_performed_code_text",editor:{xtype:"gaiaehr.combo",listKey:"unable_to_perform_ord",displayField:"option_name",valueField:"option_name",itemId:"LabOrdersUnableToPerformField",loadStore:!0,editable:!1,queryMode:"local",resetable:!0}},{header:_("priority"),width:100,dataIndex:"priority",editor:{xtype:"gaiaehr.combo",listKey:"proority"},renderer:function(a,b,c){return c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}},{header:_("date_collected"),width:100,dataIndex:"date_collected",editor:{xtype:"datefield"},renderer:function(a,b,c){return a=a?Ext.Date(a,g("date_display_format")):"",c.data.void?'<span style="text-decoration: line-through;">'+a+"</span>":"<span>"+a+"</span>"}}],tbar:[{text:_("eLab"),iconCls:"icoSend",itemId:"electronicLabOrderBtn"},"-","->","-",{text:_("new_order"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"newLabOrderBtn"},"-",{text:_("print"),iconCls:"icoPrint",disabled:!0,margin:"0 5 0 0",itemId:"printLabOrderBtn"}]}),Ext.define("App.model.patient.ImplantableDevice",{extend:"Ext.data.Model",table:{name:"patient_implantable_device"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"di",type:"string",index:!0,len:180},{name:"udi",type:"string",index:!0,len:600},{name:"description",type:"string",len:160},{name:"description_code",type:"string",len:20},{name:"description_code_type",type:"string",len:20},{name:"gmdnpt_name",type:"string",len:160},{name:"lot_number",type:"string",len:20},{name:"serial_number",type:"string",len:20},{name:"exp_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"mfg_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"donation_id",type:"string",len:160},{name:"brand_name",type:"string",len:80},{name:"version_model",type:"string",len:20},{name:"company_name",type:"string",len:80},{name:"mri_safety_info",type:"string",len:600},{name:"required_lnr",type:"bool"},{name:"status",type:"string",len:20},{name:"status_code",type:"string",len:20},{name:"status_code_type",type:"string",len:20},{name:"note",type:"string",dataType:"text"},{name:"implanted_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"removed_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"ImplantableDevice.getPatientImplantableDevices",create:"ImplantableDevice.addPatientImplantableDevice",update:"ImplantableDevice.updatePatientImplantableDevice"}}}),Ext.define("App.store.patient.ImplantableDevices",{extend:"Ext.data.Store",model:"App.model.patient.ImplantableDevice",remoteSort:!0}),Ext.define("App.view.patient.ImplantableDevice",{extend:"Ext.grid.Panel",requires:[],xtype:"implantabledevicepanel",itemId:"ImplantableDeviceGrid",title:_("imp_devs"),store:Ext.create("App.store.patient.ImplantableDevices",{remoteFilter:!0,remoteSort:!0}),plugins:[{ptype:"rowediting"}],columns:[{xtype:"actioncolumn",width:25,icon:"resources/images/icons/icoPatientInfo.png",tooltip:_("device_data"),handler:function(a,b,c,d,e,f){app.getController("patient.ImplantableDevice").onImplantableDeviceGridActionClick(a,f)}},{text:_("description"),dataIndex:"description",flex:1},{text:_("udi"),dataIndex:"udi",flex:2},{xtype:"datecolumn",text:_("implanted"),dataIndex:"implanted_date",format:g("date_display_format"),editor:{xtype:"datefield",format:g("date_display_format")}},{xtype:"datecolumn",text:_("removed"),dataIndex:"removed_date",format:g("date_display_format"),editor:{xtype:"datefield",format:g("date_display_format")}},{text:_("note"),dataIndex:"note",flex:2,editor:{xtype:"textfield"}},{text:_("status"),dataIndex:"status",editor:{xtype:"gaiaehr.combo",list:113}}],tbar:["->",{xtype:"button",text:_("add"),iconCls:"icoAdd",itemId:"ImplantableDeviceGridAddBtn"}],bbar:[{xtype:"button",text:_("active"),enableToggle:!0,itemId:"ImplantableDeviceGridActiveBtn"},"-","->",{text:_("review"),itemId:"ImplantableDeviceReviewBtn"}]}),Ext.define("App.store.patient.FamilyHistories",{extend:"Ext.data.Store",model:"App.model.patient.FamilyHistory"}),Ext.define("App.view.patient.FamilyHistory",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","Ext.grid.feature.Grouping"],xtype:"patientfamilyhistorypanel",title:_("fam_hx"),columnLines:!0,store:Ext.create("App.store.patient.FamilyHistories",{remoteFilter:!0,groupField:"relation"}),features:[{ftype:"grouping"}],plugins:[{ptype:"rowediting",clicksToEdit:2}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("patient.FamilyHistory").onDeactivateRecord(a,f)}}]},{xtype:"datecolumn",header:_("date"),width:100,dataIndex:"create_date",format:"Y-m-d",editor:{xtype:"datefield"}},{header:_("condition"),flex:1,dataIndex:"condition"},{header:_("relation"),flex:1,dataIndex:"relation",editor:{xtype:"gaiaehr.listcombosimple",list:109,itemId:"FamilyHistoryGridRelationField",valueField:"option_name",value:null}},{header:_("notes"),flex:2,dataIndex:"notes",editor:{xtype:"textfield"}},{header:_("status"),flex:1,dataIndex:"status"}],tbar:["->",{text:_("history"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"FamilyHistoryGridAddBtn"}]}),Ext.define("App.view.patient.RadOrders",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","Ext.selection.CheckboxModel","App.ux.combo.Combo","App.ux.LiveRadsSearch"],xtype:"patientradorderspanel",title:_("xray_ct_orders"),columnLines:!0,tabConfig:{cls:"order-tab"},itemId:"RadOrders",store:Ext.create("App.store.patient.PatientsOrders",{storeId:"RadOrderStore",remoteFilter:!0,pageSize:200,sorters:[{property:"date_ordered",direction:"DESC"}]}),selModel:Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:!1}),plugins:[{ptype:"rowediting",clicksToEdit:2}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("patient.RadOrders").onOrdersDeleteActionHandler(a,b,c,d,e,f)}}]},{header:_("order#"),width:60,dataIndex:"id"},{header:_("status"),width:75,dataIndex:"status",editor:{xtype:"gaiaehr.combo",list:40},renderer:function(a){return app.getController("patient.RadOrders").radOrdersGridStatusColumnRenderer(a)}},{xtype:"datecolumn",header:_("date_ordered"),width:100,dataIndex:"date_ordered",format:"Y-m-d",editor:{xtype:"datefield"}},{header:_("code"),width:100,dataIndex:"code"},{header:_("description"),flex:2,dataIndex:"description",editor:{xtype:"radslivetsearch",itemId:"radOrderliveSearch"}},{header:_("notes"),flex:2,dataIndex:"note",editor:{xtype:"textfield"}},{header:_("unable_to_perform"),flex:1,dataIndex:"not_performed_code_text",editor:{xtype:"gaiaehr.combo",listKey:"unable_to_perform_ord",displayField:"option_name",valueField:"option_name",itemId:"RadOrdersUnableToPerformField",loadStore:!0,editable:!1,queryMode:"local",resetable:!0}},{header:_("priority"),width:100,dataIndex:"priority",editor:{xtype:"gaiaehr.combo",listKey:"proority"}},{xtype:"datecolumn",header:_("date_collected"),width:100,dataIndex:"date_collected",format:g("date_display_format"),editor:{xtype:"datefield"}}],tbar:[{text:_("eRad"),iconCls:"icoSend",itemId:"electronicRadOrderBtn"},"-","->","-",{xtype:"button",text:_("new_order"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"newRadOrderBtn"},"-",{text:_("print"),iconCls:"icoPrint",disabled:!0,margin:"0 5 0 0",itemId:"printRadOrderBtn"}]}),Ext.define("App.view.patient.SupperBill",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","App.ux.LiveCPTSearch","App.ux.combo.EncounterICDS"],xtype:"superbillpanel",store:Ext.create("App.store.patient.EncounterServices"),columnLines:!0,plugins:[{ptype:"rowediting",errorSummary:!1}],columns:[{xtype:"actioncolumn",width:20,menuDisabled:!0,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){return App.app.getController("patient.encounter.SuperBill").onRemoveService(f)}}]},{header:_("units"),dataIndex:"units",width:40,editor:{xtype:"numberfield",minValue:1,allowBlank:!1}},{header:_("code"),dataIndex:"code",width:75},{text:_("service"),dataIndex:"code_text",flex:1,editor:{xtype:"livecptsearch",itemId:"SuperCptSearchCmb",valueField:"code_text_medium",allowBlank:!1}},{text:_("financial"),dataIndex:"financial_class",flex:1,hidden:!0,editor:{xtype:"gaiaehr.listcombo",displayField:"option_name",valueField:"option_value",loadStore:!0,queryMode:"local",list:135}},{header:_("modifiers"),dataIndex:"modifiers",width:100,editor:{xtype:"textfield"}},{header:_("diagnosis"),dataIndex:"dx_pointers",menuDisabled:!0,width:250,editor:{xtype:"encountericdscombo",itemId:"SuperBillEncounterDxCombo",allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",items:["->",{text:_("quick_pick"),iconCls:"icoAdd",itemId:"SuperBillServiceQuickPickBtn"},"-",{text:_("service"),iconCls:"icoAdd",itemId:"SuperBillServiceAddBtn"}]}]}),Ext.define("App.model.patient.PainScale",{extend:"Ext.data.Model",table:{name:"patient_pain_scales"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"anatomical_region_code",type:"string",len:40},{name:"anatomical_region_code_text",type:"string",len:300},{name:"anatomical_region_code_type",type:"string",len:15},{name:"pain_scale",type:"int"},{name:"create_uid",type:"int",comment:"create user ID"},{name:"update_uid",type:"int",comment:"update user ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"service_date",type:"date",dateFormat:"Y-m-d H:i:s",store:!1}],proxy:{type:"direct",api:{read:"PainScale.getPainsScales",create:"PainScale.addPainScale",update:"PainScale.addPainScale",destroy:"PainScale.destroyPainScale"},reader:{root:"data"},writer:{writeAllFields:!0},remoteGroup:!1}}),Ext.define("App.store.patient.PainScales",{extend:"Ext.data.Store",model:"App.model.patient.PainScale"}),Ext.define("App.view.patient.PainScale",{extend:"Ext.grid.Panel",requires:[],xtype:"painscalepanel",itemId:"PainScaleGrid",title:_("pain_scale"),store:Ext.create("App.store.patient.PainScales",{remoteFilter:!0,remoteSort:!0}),plugins:[{ptype:"rowediting"}],columns:[{xtype:"griddeletecolumn",acl:a("delete_patient_pain_scales"),width:25},{text:_("anatomical_region"),dataIndex:"anatomical_region_code_text",flex:1,editor:{xtype:"snomedlivebodysitesearch",name:"anatomical_region_code_text",displayField:"Term",valueField:"Term",allowBlank:!1}},{text:_("pain_scale"),dataIndex:"pain_scale",flex:2,renderer:function(a,b){var c=a+"0";return say(a),say(c),b.style=Ext.String.format("background: linear-gradient(90deg, rgb(37 157 249) 0%, rgb(37 157 249) {0}%, rgb(255 255 255) {0}%)",c),a},editor:{xtype:"slider",value:0,increment:1,minValue:0,maxValue:10}},{xtype:"datecolumn",text:_("service_date"),dataIndex:"service_date",format:g("date_display_format")}],tbar:["->",{xtype:"button",acl:a("add_patient_pain_scales"),text:_("add"),iconCls:"icoAdd",itemId:"PainScaleGridAddBtn"}],bbar:[{text:_("review"),itemId:"PainScaleReviewBtn"}]}),Ext.define("App.view.dashboard.panel.Portlet",{extend:"Ext.panel.Panel",alias:"widget.portlet",layout:"fit",anchor:"100%",frame:!0,closable:!0,collapsible:!0,animCollapse:!0,draggable:{moveOnDrag:!1},cls:"x-portlet",doClose:function(){this.closing||(this.closing=!0,this.el.animate({opacity:0,callback:function(){this.fireEvent("close",this),this[this.closeAction]()},scope:this}))}}),Ext.define("App.ux.combo.EncounterSupervisors",{extend:"Ext.form.ComboBox",alias:"widget.encountersupervisorscombo",initComponent:function(){var a=this;Ext.define("EncounterSupervisorsComboModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"int"}],proxy:{type:"direct",api:{read:"CombosData.getEncounterSupervisors"}}}),a.store=Ext.create("Ext.data.Store",{model:"EncounterSupervisorsComboModel",autoLoad:!1}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.ux.grid.AreasViewDropZone",{extend:"Ext.grid.ViewDropZone",handleNodeDrop:function(a,b,c){var d,e,f,g,h=this.view,i=h.getStore();if(!a.patient)if(a.copy)for(e=a.records,a.records=[],f=0,g=e.length;g>f;f++)a.records.push(e[f].copy());else a.view.store.remove(a.records,a.view===h);b&&c?(d=i.indexOf(b),"before"!==c&&d++,i.insert(d,a.records)):i.add(a.records)},notifyEnter:function(a,b,c){Ext.get(c.ddel.id).update(_("drop_patient_to_new_area")),this.callParent(arguments)},notifyOut:function(a,b,c){Ext.get(c.ddel.id).update(_("drag_patient_to_new_area")),this.callParent(arguments)}}),Ext.define("App.ux.grid.AreasDragDrop",{extend:"Ext.grid.plugin.DragDrop",alias:"plugin.areasgridviewdragdrop",onViewRender:function(a){var b,c=this;c.enableDrag&&(c.containerScroll&&(b=a.getEl()),c.dragZone=new Ext.view.DragZone({view:a,ddGroup:c.dragGroup||c.ddGroup,dragText:c.dragText,containerScroll:c.containerScroll,scrollEl:b})),c.enableDrop&&(c.dropZone=new App.ux.grid.AreasViewDropZone({view:a,ddGroup:c.dropGroup||c.ddGroup}))}}),Ext.define("App.ux.LiveEducationResourceSearch",{extend:"Ext.form.ComboBox",xtype:"educationresourcelivetsearch",hideLabel:!0,displayField:"surgery",valueField:"id",emptyText:_("search")+"...",typeAhead:!1,hideTrigger:!0,minChars:1,queryParam:"term",pageSize:10,language:"patient",initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"title"},{name:"url"},{name:"rank"},{name:"snippet"},{name:"FullSummary"},{name:"groupName"},{name:"mesh"},{name:"organizationName"}],model:"liveLiveEducationResourceSearchModel",pageSize:a.pageSize,autoLoad:!1,proxy:{type:"direct",api:{read:"EducationResources.search"},startParam:"retstart",limitParam:"retmax",reader:{root:"data"}}}),a.listConfig={loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{title}<span style="font-weight: normal"> ({snippet}) </span></h3></div>'}},a.listeners={beforequery:function(){var b="healthTopics";"patient"==a.language?app.patient.record&&"spa"==app.patient.record.get("language")&&(b="healthTopicsSpanish"):("spa"==a.language||"es"==a.language||"esp"==a.language)&&(b="healthTopicsSpanish"),a.store.getProxy().extraParams={db:b}}},a.callParent()}}),Ext.define("App.ux.AddTabButton",{alias:"plugin.AddTabButton",extend:"Ext.AbstractPlugin",toolTip:"Add Tab",iconCls:null,btnText:"+",forceText:!1,panelConfig:{xtype:"panel",title:"New Tab",closable:!0,hidden:!1},constructor:function(a){this.panelConfig=Ext.apply(this.panelConfig,a.tabConfig||{}),this.callParent(arguments)},init:function(a){var b=this;b.tabPanel=a,a instanceof Ext.TabPanel&&(b.btn=b.tabPanel.getTabBar().add({xtype:"tab",minWidth:25,text:b.iconCls&&!b.forceText?"":b.btnText,iconCls:b.iconCls,tooltip:b.toolTip,handler:b.onAddTabClick,closable:!1,acl:b.acl,scope:b}),b.btn.on("render",function(){if(b.iconCls&&!b.forceText){var a;"top"==b.tabPanel.tabPosition?a="margin: 0 0 3px 0; padding: 0":"bottom"==b.tabPanel.tabPosition&&(a="margin: 3px 0 0 0; padding: 0"),b.btn.btnWrap.applyStyles(a)}}))},onAddTabClick:function(){var a=this.tabPanel.add(this.panelConfig);this.tabPanel.fireEvent("newtabclick",a,this.tabPanel),this.tabPanel.setActiveTab(a)},setDisabled:function(a){this.btn.setDisabled(a)},setVisible:function(a){this.btn.setVisible(a)}}),Ext.define("App.ux.combo.Specialties",{extend:"App.ux.combo.ComboResettable",xtype:"specialtiescombo",displayField:"text_details",valueField:"id",editable:!1,emptyText:_("select"),queryMode:"local",store:Ext.create("App.store.administration.Specialties",{pageSize:500,autoLoad:!0})}),Ext.define("App.view.patient.encounter.CarePlanGoals",{extend:"Ext.grid.Panel",requires:["App.store.patient.CarePlanGoals"],xtype:"careplangoalsgrid",store:Ext.create("App.store.patient.CarePlanGoals"),frame:!0,columns:[{text:_("goal"),dataIndex:"goal",width:200},{text:_("instructions"),dataIndex:"instructions",flex:1}],tbar:[_("care_plan_goals"),"->",{text:_("new_goal"),iconCls:"icoAdd",itemId:"NewCarePlanGoalBtn"}]}),Ext.define("App.model.patient.MedicationAdministered",{extend:"Ext.data.Model",table:{name:"patient_medications_administered"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"order_id",type:"int",index:!0},{name:"rxcui",type:"string",len:40,index:!0},{name:"description",type:"string",len:180},{name:"instructions",type:"string",len:180},{name:"administered",type:"bool"},{name:"administered_uid",type:"int",index:!0},{name:"administered_amount",type:"string",len:40},{name:"administered_units",type:"string",len:40},{name:"administered_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"administered_by",type:"string",store:!1,convert:function(a,b){return(b.data.administered_title+" "+b.data.administered_fname+" "+(b.data.administered_mname||"")+" "+b.data.administered_lname).trim()}},{name:"administered_title",type:"string",store:!1},{name:"administered_fname",type:"string",store:!1},{name:"administered_mname",type:"string",store:!1},{name:"administered_lname",type:"string",store:!1},{name:"administration_site",type:"string",len:40},{name:"adverse_reaction_text",type:"string",len:120},{name:"adverse_reaction_code",type:"string",len:40},{name:"adverse_reaction_code_type",type:"string",len:15},{name:"manufacturer",type:"string",len:180},{name:"exp_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"lot_number",type:"string",len:60},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"note",type:"string",len:600},{name:"created_uid",type:"int"},{name:"updated_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Medications.getPatientMedicationsAdministered",create:"Medications.addPatientMedicationAdministered",update:"Medications.updatePatientMedicationAdministered",destroy:"Medications.destroyPatientMedicationAdministered"},writer:{writeAllFields:!0},remoteGroup:!1}}),Ext.define("App.store.patient.MedicationsAdministered",{extend:"Ext.data.Store",requires:["App.model.patient.MedicationAdministered"],model:"App.model.patient.MedicationAdministered"}),Ext.define("App.view.dashboard.panel.PortalColumn",{extend:"Ext.container.Container",alias:"widget.portalcolumn",requires:["Ext.layout.container.Anchor","App.view.dashboard.panel.Portlet"],layout:"anchor",defaultType:"portlet",cls:"x-portal-column"}),Ext.define("App.view.patient.windows.EncounterCheckOut",{extend:"App.ux.window.Window",requires:["Ext.grid.plugin.RowEditing","App.view.patient.SupperBill","App.ux.combo.EncounterSupervisors","App.ux.LiveCPTSearch"],title:_("checkout_and_signing"),itemId:"EncounterSignWindow",closeAction:"hide",modal:!0,layout:"border",width:1200,height:690,bodyPadding:5,pid:null,eid:null,items:[{xtype:"superbillpanel",title:_("super_bill"),region:"center",flex:2},{xtype:"encounterdocumentsgrid",title:_("documents"),region:"east",itemId:"EncounterSignDocumentGrid",width:250},{xtype:"form",title:_("additional_info"),region:"south",split:!0,height:250,layout:"column",defaults:{xtype:"fieldset",padding:8},items:[{xtype:"container",columnWidth:.5,defaults:{xtype:"fieldset",padding:8,margin:"5 1 5 5"},padding:0,layout:{type:"vbox",align:"stretch"},items:[{title:_("messages_notes_and_reminders"),defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"message",fieldLabel:_("message")},{xtype:"textfield",name:"reminder",fieldLabel:_("reminder")},{xtype:"textfield",grow:!0,name:"note",fieldLabel:_("note"),margin:0}]},{title:_("follow_up"),flex:1,defaults:{anchor:"100%"},items:[{xtype:"mitos.followupcombo",fieldLabel:_("time_interval"),name:"followup_time"},{fieldLabel:_("facility"),xtype:"activefacilitiescombo",name:"followup_facility",margin:0}]}]},{xtype:"fieldset",margin:5,padding:8,columnWidth:.5,layout:"fit",height:208,title:_("warnings_alerts"),items:[{xtype:"grid",hideHeaders:!0,store:Ext.create("App.store.patient.CheckoutAlertArea"),itemId:"EncounterSignAlertGrid",border:!1,rowLines:!1,header:!1,viewConfig:{stripeRows:!1,disableSelection:!0},columns:[{dataIndex:"alertType",width:30,renderer:function(a){return App.app.getController("patient.encounter.EncounterSign").alertIconRenderer(a)}},{dataIndex:"alert",flex:1}]}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",itemId:"EncounterSignWindowBottomToolbar",defaults:{minWidth:70},items:["->",{xtype:"encountersupervisorscombo",itemId:"EncounterCoSignSupervisorCombo",allowBlank:!1,width:250},{text:_("co_sign")+" ("+_("supervisor")+")",itemId:"EncounterCoSignSupervisorBtn"},{text:_("sign"),itemId:"EncounterSignBtn"},{text:_("cancel"),itemId:"EncounterCancelSignBtn"}]}]}),Ext.define("App.view.dashboard.panel.PortalPanel",{extend:"Ext.panel.Panel",alias:"widget.portalpanel",requires:["Ext.layout.container.Column","App.view.dashboard.panel.PortalDropZone","App.view.dashboard.panel.PortalColumn"],cls:"x-portal",bodyCls:"x-portal-body",defaultType:"portalcolumn",autoScroll:!0,manageHeight:!1,initComponent:function(){this.layout={type:"column"},this.callParent(),this.addEvents({validatedrop:!0,beforedragover:!0,dragover:!0,beforedrop:!0,drop:!0})},beforeLayout:function(){var a,b,c,d=this.layout.getLayoutItems(),e=d.length,f=["x-portal-column-first","x-portal-column-last"];for(a=0;e>a;a++)b=d[a],b.columnWidth=1/e,c=a==e-1,a?c?(b.addCls("x-portal-column-last"),b.removeCls("x-portal-column-first")):b.removeCls(f):c?b.addCls(f):(b.addCls("x-portal-column-first"),b.removeCls("x-portal-column-last"));return this.callParent(arguments)},initEvents:function(){this.callParent(),this.dd=Ext.create("App.view.dashboard.panel.PortalDropZone",this,this.dropConfig)},beforeDestroy:function(){this.dd&&this.dd.unreg(),this.callParent()}}),Ext.define("App.view.areas.PatientPoolAreas",{extend:"App.ux.RenderPanel",requires:["App.ux.grid.AreasDragDrop"],itemId:"PatientPoolAreasPanel",pageTitle:_("patient_pool_areas"),initComponent:function(){var a=this;a.pageBody=Ext.create("Ext.container.Container",{defaults:{flex:1,margin:2,frame:!1},layout:{type:"hbox",align:"stretch"}}),a.listeners={beforerender:a.setPoolAreas},a.pageBBar=[{xtype:"button",text:_("disable_alert_colors"),enableToggle:!0,stateful:!0,stateId:"PatientPoolAreasDisableAlertColorsBtnState",itemId:"PatientPoolAreasDisableAlertColorsBtn"},"->",{xtype:"button",icon:"resources/images/icons/gear.png",itemId:"PatientPoolAreasRulesBtn"}],a.patientPoolAreaCtl=app.getController("areas.PatientPoolAreas"),a.callParent(arguments)},onPatientDrop:function(a,b){var c=this,d=b.records[0].data?b.records[0].data.name:b.records[0].name,e=b.records[0].data?b.records[0].data.pid:b.records[0].pid;app.msg(_("sweet"),d+" "+_("sent_to")+" "+c.panel.title),app.nav.activePanel.doSendPatientToPoolArea(e,c.panel.action,void 0,function(a){b.records[0].set(a.zone?{zone:a.zone.data.zone,time_in:app.getDate()}:{time_in:app.getDate()}),b.records[0].commit()})},doSendPatientToPoolArea:function(a,b,c,d){var e=this;app.fireEvent("beforesendpatienttoarea",e,a,b,c),PoolArea.sendPatientToPoolArea({pid:a,sendTo:b,appointment_id:c},function(f){return app.fireEvent("sendpatienttoarea",e,a,b,c),null==f.floor_plan_id||f.zone?(app.unsetPatient(null,!0),app.nav.App_view_areas_PatientPoolAreas.reloadStores(),app.getPatientsInPoolArea(),void(d&&d(f))):(app.getController("areas.FloorPlan").promptPatientZoneAssignment(f.record.pid,f.floor_plan_id,b,f.zone),void(d&&d(f)))})},doSendPatientToPoolAreaByConcept:function(a,b,c,d){var e=this,f=e.patientPoolAreaCtl.getPoolAreaIdByConcept(b);e.doSendPatientToPoolArea(a,f,c,d)},reRenderPoolAreas:function(){var a=this,b=a.getPageBody().down("container");b.removeAll(),a.setPoolAreas()},getPoolAreas:function(){return this.getPageBody().down("container").items.items},setPoolAreas:function(){var a,b=this,c=b.getPageBody().down("container"),d=g("poolarea_order_by");"appointment"===d&&(d="appointment_time"),"checkin"===d&&(d="time_in"),b.stores=[],PoolArea.getFacilityActivePoolAreas(function(e,f){a=f.result;for(var h=0;h<a.length;h++){var i=Ext.create("App.store.areas.PoolDropAreas",{groupField:null!==a[h].floor_plan_id?"zone":void 0,sorters:[{property:d,direction:"asc"}],proxy:{type:"direct",api:{read:"PoolArea.getPoolAreaPatients"},extraParams:{area_id:a[h].id}}});b.stores.push(i),c.add({xtype:"grid",multiSelect:!0,title:a[h].title,action:a[h].id,store:i,floorPlanId:a[h].floor_plan_id,floorPlanConcept:a[h].concept,features:null!==a[h].floor_plan_id?[{ftype:"grouping"}]:[],collapsible:!0,collapseDirection:"left",animCollapse:!1,showAlertColor:!0,columns:[Ext.create("Ext.grid.RowNumberer"),{header:_("record")+" #",width:100,dataIndex:"pubpid",hidden:!0,renderer:function(a,b,c){return this.showAlertColor&&(b.style="background-color:"+c.get("alert_color")),a}},{header:_("patient_name"),flex:1,dataIndex:"lname",renderer:function(a,b,c){return this.showAlertColor&&(b.style="background-color:"+c.get("alert_color")),Ext.String.format("{0}{1}, {2} {3}",c.get("eid")?"*":"",c.get("lname"),c.get("fname"),c.get("mname"))}},{header:_("time_in"),width:65,dataIndex:"time_in",renderer:function(a,b,c){return this.showAlertColor&&(b.style="background-color:"+c.get("alert_color")),Ext.Date.format(a,g("time_display_format"))}},{header:_("schedule"),width:65,dataIndex:"appointment_time",renderer:function(a,b,c){return this.showAlertColor&&(b.style="background-color:"+c.get("alert_color")),Ext.Date.format(a,g("time_display_format"))
}},{header:_("timer"),width:65,dataIndex:"timer",renderer:function(a,b,c){return this.showAlertColor&&(b.style="background-color:"+c.get("alert_color")),a}}],viewConfig:{loadMask:!1,plugins:{ptype:"areasgridviewdragdrop",dragGroup:"patientPoolAreas",dropGroup:"patientPoolAreas"},listeners:{drop:b.onPatientDrop}},listeners:{scope:b,itemdblclick:b.onPatientDblClick}})}b.reloadStores()})},onPatientDblClick:function(a,b){var c=b.data;app.setPatient(c.pid,c.name,null,function(){app.openPatientSummary()})},reloadStores:function(){if(this.stores)for(var a=0;a<this.stores.length;a++)this.stores[a].load()},onActive:function(a){"function"==typeof a&&a(!0)}}),Ext.define("App.view.patient.encounter.EducationResourcesGrid",{extend:"Ext.grid.Panel",requires:["App.ux.grid.DeleteColumn","App.ux.LiveEducationResourceSearch"],xtype:"educationresourcesgrid",itemId:"EducationResourcesGrid",frame:!0,initComponent:function(){var a=this;a.columns=[{xtype:"griddeletecolumn",width:25,acl:"remove_encounter_education_resources"},{text:_("title"),dataIndex:"title",width:250},{text:_("organization"),dataIndex:"organization_name",flex:1}],a.callParent()},tbar:[_("education_resources"),{xtype:"educationresourcelivetsearch",itemId:"EducationResourcesGridSearchField",width:400,margin:"0 5 0 0"},"-",{xtype:"button",text:_("find_encounter_related_education"),itemId:"EducationResourcesGridFindEncounterRelatedBtn",margin:"0 5 0 5"},"-",{xtype:"combobox",width:150,labelWidth:50,fieldLabel:_("language"),queryMode:"local",displayField:"option",valueField:"value",editable:!1,value:"patient",stateful:!0,margin:"0 0 0 5",stateId:"EducationResourcesGridLanguageField",itemId:"EducationResourcesGridLanguageField",store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:_("patient"),value:"patient"},{option:_("english"),value:"en"},{option:_("spanish"),value:"es"}]})}]}),Ext.define("App.view.patient.ItemsToReview",{extend:"Ext.panel.Panel",requires:["App.view.patient.PainScale"],alias:"widget.itemstoreview",layout:{type:"vbox",align:"stretch"},frame:!0,bodyPadding:5,bodyBorder:!0,showRating:!0,autoScroll:!0,itemId:"ItemsToReviewPanel",items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{xtype:"grid",margin:"0 0 5 0"},items:[{title:_("immunizations"),frame:!0,height:180,flex:1,store:Ext.create("App.store.patient.PatientImmunization"),itemId:"ItemsToReviewImmuGrid",margin:"0 5 5 0",columns:[{header:_("immunization"),width:250,dataIndex:"vaccine_name"},{header:_("date"),width:90,xtype:"datecolumn",format:"Y-m-d",dataIndex:"administered_date"},{header:_("notes"),flex:1,dataIndex:"note"}]},{title:_("allergies"),frame:!0,height:180,flex:1,store:Ext.create("App.store.patient.Allergies"),itemId:"ItemsToReviewAllergiesGrid",columns:[{header:_("type"),width:100,dataIndex:"allergy_type"},{header:_("name"),width:100,dataIndex:"allergy"},{header:_("severity"),flex:1,dataIndex:"severity"}]}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},defaults:{xtype:"grid",margin:"0 0 5 0"},items:[{title:_("active_problems"),frame:!0,height:180,flex:1,margin:"0 5 5 0",store:Ext.create("App.store.patient.PatientActiveProblems"),itemId:"ItemsToReviewActiveProblemsGrid",columns:[{header:_("problem"),width:250,dataIndex:"code_text"},{xtype:"datecolumn",header:_("begin_date"),width:90,format:"Y-m-d",dataIndex:"begin_date"},{xtype:"datecolumn",header:_("end_date"),flex:1,format:"Y-m-d",dataIndex:"end_date"}]},{title:_("medications"),frame:!0,height:180,flex:1,store:Ext.create("App.store.patient.Medications"),itemId:"ItemsToReviewMedicationsGrid",columns:[{header:_("medication"),width:250,dataIndex:"STR"},{xtype:"datecolumn",header:_("begin_date"),width:90,format:"Y-m-d",dataIndex:"begin_date"},{xtype:"datecolumn",header:_("end_date"),flex:1,format:"Y-m-d",dataIndex:"end_date"}]}]},{xtype:"painscalepanel",itemId:"ItemsToReviewActivePainScaleGrid",margin:"0 0 5 0",frame:!0,bbar:null},{xtype:"container",layout:"hbox",items:[{xtype:"fieldset",title:_("social_history"),margin:"0 10 0 0",items:[{fieldLabel:_("smoking_status"),xtype:"mitos.smokingstatuscombo",itemId:"reviewsmokingstatuscombo",allowBlank:!1,labelWidth:100,width:325}]},{xtype:"fieldset",title:_("patient_summary"),layout:"hbox",items:[{xtype:"checkboxfield",checked:!1,padding:"0 0 5 10",itemId:"EncounterSummaryCareProvided",boxLabel:_("ccda_available"),name:"summary_care_provided",width:150}]}]}],buttons:[{text:_("review_all"),name:"review",itemId:"encounterRecordAdd"}]}),Ext.define("App.view.patient.encounter.MedicationsAdministeredGrid",{extend:"Ext.grid.Panel",requires:["App.ux.grid.DeleteColumn"],xtype:"medicationsadministeredgrid",itemId:"MedicationsAdministeredGrid",frame:!0,disableSelection:!0,store:Ext.create("App.store.patient.MedicationsAdministered"),columns:[{xtype:"actioncolumn",width:25,groupable:!1,items:[{icon:"resources/images/icons/blueInfo.png",tooltip:"Get Info",handler:function(a,b,c,d,e,f){App.app.getController("InfoButton").doGetInfo(f.data.rxcui,"RXCUI",f.data.description)}}]},{text:_("description"),flex:1,dataIndex:"description",renderer:function(a,b,c){return c.get("administered")||(b.style="background-color: #FFCCCC"),a}},{text:_("instructions"),flex:1,dataIndex:"instructions",renderer:function(a,b,c){return c.get("administered")||(b.style="background-color: #FFCCCC"),a}},{text:_("note"),flex:2,dataIndex:"note",renderer:function(a,b,c){return c.get("administered")||(b.style="background-color: #FFCCCC"),a}},{text:_("administered_by"),dataIndex:"administered_by",width:150,renderer:function(a,b,c){return c.get("administered")||(b.style="background-color: #FFCCCC"),a}},{text:_("adverse_reaction"),dataIndex:"adverse_reaction_text",width:150,renderer:function(a,b,c){return c.get("administered")||(b.style="background-color: #FFCCCC"),a}}],tbar:[_("medications_administered"),"->",{text:_("medication"),itemId:"MedicationsAdministeredGridAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}]}),Ext.define("App.ux.LiveSnomedProcedureSearch",{extend:"Ext.form.ComboBox",xtype:"snomedliveproceduresearch",hideLabel:!0,displayField:"Term",valueField:"ConceptId",emptyText:_("procedure_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,initComponent:function(){var a=this;Ext.define("liveSnomedProcedureSearchModel",{extend:"Ext.data.Model",fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string",defaultValue:"SNOMED-CT"},{name:"Occurrence",type:"int"}],idProperty:"ConceptId",proxy:{type:"direct",api:{read:"SnomedCodes.liveProcedureCodeSearch",update:"SnomedCodes.updateLiveProcedureCodeSearch"},reader:{totalProperty:"totals",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveSnomedProcedureSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{Term}<span style="font-weight: normal"> ({ConceptId}) </span></h3></div>'}},pageSize:25}),a.callParent(),a.on("select",function(a,b){b[0].set({Occurrence:b[0].data.Occurrence+1}),b[0].save()})}}),Ext.define("App.view.patient.encounter.EncounterAddendaGrid",{extend:"Ext.grid.Panel",requires:[],xtype:"encounteraddendagrid",frame:!0,initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.encounter.Addenda"),a.columns=[{xtype:"griddeletecolumn",width:25,acl:"remove_encounter_addendum"},{xtype:"datecolumn",text:_("date"),dataIndex:"create_date",width:80},{text:_("source"),dataIndex:"source"},{text:_("notes"),dataIndex:"notes",flex:1},{text:_("user"),dataIndex:"created_by"}],a.callParent()},tbar:[_("addenda"),"->"]}),Ext.define("App.model.patient.Intervention",{extend:"Ext.data.Model",table:{name:"patient_interventions"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"intervention_type",type:"string",index:!0,len:25},{name:"code",type:"string",len:80},{name:"code_text",type:"string",len:300},{name:"code_type",type:"string",len:20},{name:"dx_code",type:"string",len:80},{name:"dx_code_text",type:"string",len:300},{name:"dx_code_type",type:"string",len:20},{name:"not_performed_code",type:"string",len:10},{name:"not_performed_code_type",type:"string",len:15},{name:"not_performed_code_text",type:"string",len:255},{name:"notes",type:"string",dataTYpe:"text"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Interventions.getPatientInterventions",create:"Interventions.addPatientIntervention",update:"Interventions.updatePatientIntervention",destroy:"Interventions.destroyPatientIntervention"},reader:{root:"data"}}}),Ext.define("App.store.patient.Interventions",{extend:"Ext.data.Store",model:"App.model.patient.Intervention"}),Ext.define("App.view.patient.encounter.CarePlanGoalsNewWindow",{extend:"Ext.window.Window",requires:["App.ux.LiveSnomedProcedureSearch"],xtype:"careplangoalsnewwindow",title:_("new_goal"),closable:!1,constrain:!0,closeAction:"hide",layout:"fit",items:[{xtype:"form",itemId:"CarePlanGoalsNewForm",layout:{type:"vbox",align:"stretch"},bodyPadding:10,items:[{xtype:"fieldcontainer",layout:"hbox",itemId:"CarePlanGoalPlanDateContainer",fieldLabel:_("plan_date"),labelAlign:"top",defaults:{margin:"0 5 0 0"},items:[{xtype:"datefield",itemId:"CarePlanGoalPlanDateField",allowBlank:!1,format:"Y-m-d",name:"plan_date"},{xtype:"button",text:"+1 Day",action:"1D"},{xtype:"button",text:"+1 Week",action:"1W"},{xtype:"button",text:"+2 Week",action:"2W"},{xtype:"button",text:"+1 Month",action:"1M"},{xtype:"button",text:"+3 Month",action:"3M"},{xtype:"button",text:"+6 Month",action:"6M"},{xtype:"button",text:"+1 Year",action:"1Y"}]},{xtype:"snomedliveproceduresearch",itemId:"CarePlanGoalSearchField",fieldLabel:_("goal"),displayField:"Term",valueField:"Term",labelAlign:"top",allowBlank:!1,hideLabel:!1,name:"goal"},{xtype:"textareafield",fieldLabel:_("instructions"),labelAlign:"top",name:"instructions",flex:1}]}],buttons:[{text:_("cancel"),itemId:"CarePlanGoalsNewFormCancelBtn"},{text:_("save"),itemId:"CarePlanGoalsNewFormSaveBtn"}]}),Ext.define("App.view.patient.encounter.InterventionsGrid",{extend:"Ext.grid.Panel",requires:["App.ux.grid.DeleteColumn"],xtype:"interventionsgrid",itemId:"InterventionsGrid",frame:!0,disableSelection:!0,store:Ext.create("App.store.patient.Interventions"),columns:[{xtype:"griddeletecolumn",width:25},{text:_("type"),width:150,dataIndex:"intervention_type"},{text:_("description"),flex:1,dataIndex:"code_text"},{text:_("instructions"),flex:2,dataIndex:"notes"}],tbar:[_("interventions"),"->",{text:_("intervention"),itemId:"InterventionGridAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}]}),Ext.define("App.model.patient.HealthConcern",{extend:"Ext.data.Model",table:{name:"patient_health_concerns"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"health_concern_type",type:"string",index:!0,len:25},{name:"description",type:"string",len:300},{name:"instructions",type:"string",dataTYpe:"text"},{name:"active_from",type:"date",dateFormat:"Y-m-d"},{name:"active_to",type:"date",dateFormat:"Y-m-d"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"HealthConcerns.getPatientHealthConcerns",create:"HealthConcerns.addPatientHealthConcern",update:"HealthConcerns.updatePatientHealthConcern",destroy:"HealthConcerns.destroyPatientHealthConcern"},reader:{root:"data"}}}),Ext.define("App.store.patient.HealthConcerns",{extend:"Ext.data.Store",model:"App.model.patient.HealthConcern"}),Ext.define("App.view.patient.encounter.HealthConcernGrid",{extend:"Ext.grid.Panel",requires:["App.ux.grid.DeleteColumn"],xtype:"healthconcerngird",itemId:"HealthConcernGrid",frame:!0,disableSelection:!0,store:Ext.create("App.store.patient.HealthConcerns"),columns:[{xtype:"griddeletecolumn",width:25},{text:_("type"),width:170,dataIndex:"health_concern_type",editor:{xtype:"combobox",editable:!1,store:[["HealthConcernAct","Health Concern"],["Narrative","Narrative"]]}},{text:_("description"),flex:1,dataIndex:"description",editor:{xtype:"textfield"}},{text:_("instructions"),flex:2,dataIndex:"instructions",editor:{xtype:"textfield"}},{xtype:"datecolumn",text:_("from"),dataIndex:"active_from",editor:{xtype:"datefield"}},{xtype:"datecolumn",text:_("to"),dataIndex:"active_to",editor:{xtype:"datefield"}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing")],tbar:[_("health_concerns"),"->",{text:_("health_concern"),itemId:"HealthConcernGridAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}]}),Ext.define("App.ux.form.fields.plugin.FieldTab",{extend:"Ext.AbstractPlugin",alias:"plugin.fieldtab",loop_around:!0,SHIFT_DOWN:!1,ALT_DOWN:!1,CTRL_DOWN:!1,keys_down_time:{},keys_up_time:{},is_buffing:!1,start_index:-1,buff:"",properties:["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],tooltipConfig:{},init:function(a){var b=this;b.field=a,a.enableKeyEvents=!0,b.last_key_time=(new Date).getTime(),b.working_textfield=null,a.on("render",function(c){b.initTooltip(a),c.inputEl.on("keydown",b.onKeyDown,b),c.inputEl.on("keyup",b.onKeyUp,b),c.inputEl.on("click",b.onClick,b)}),a.on("beforedestroy",function(a){a.inputEl.un("keydown",b.onKeyDown,b),a.inputEl.un("keyup",b.onKeyUp,b),a.inputEl.un("click",b.onClick,b)}),b.speakCtrl=app.getController("App.controller.Speak"),app.on(b.field.id+"-optionclick",b.onOptionClick,b),b.field.on("destroy",function(){app.un(b.field.id+"-optionclick",b.onOptionClick,b)})},initTooltip:function(a){this.tip=Ext.create("Ext.tip.ToolTip",Ext.apply({target:a.id,anchor:"top",disabled:!0,autoShow:!1,autoHide:!1,closable:!0,listeners:{close:function(){this.disable()}}},this.tooltipConfig))},showTooltipOptions:function(a,b,c){var d,e,f,g=this;-1!==a.search(/|/)&&(d=a.replace(/\[|]/g,"").split("|").map(function(a){return a.replace(/^.*:/,"").trim()}),(1!==d.length||""!==d[0])&&(e=[],f=g.field.id+"-optionclick",d.forEach(function(a){""!==a&&e.push(Ext.String.format('<a href="#" data-option="{0}" data-start="{1}" data-end="{2}" onclick="app.fireEvent(\'{3}\', this)">{0}</a>',a,b,c,f))}),g.tip.update(e.join(" | ")),g.tip.enable(),g.tip.show()))},hideTooltipOptions:function(){this.tip.isVisible()&&(this.tip.update(""),this.tip.hide(),this.tip.disable())},onOptionClick:function(a){this.field.focus(!1),document.execCommand("insertText",!1,a.dataset.option),this.hideTooltipOptions(),this.hasFields(this.field.inputEl.dom)&&this.doNextField(this.field.inputEl.dom)},doPrevField:function(a){var b=this,c=b.getCursorPos(a);b.getPrevField(c,a)},doNextField:function(a){var b=this,c=b.getCursorPos(a);b.getNextField(c,a)},onKeyDown:function(a){var b=a.getKey();this.hideTooltipOptions(),this.is_buffing||(this.keys_down_time[b]=(new Date).getTime()),b==a.SHIFT?(a.preventDefault(),this.SHIFT_DOWN=!0):b==a.ALT?(a.preventDefault(),this.ALT_DOWN=!0):b==a.CTRL?(a.preventDefault(),this.CTRL_DOWN=!0):b==a.TAB&&a.preventDefault()},onKeyUp:function(a,b){{var c=a.getKey();a.getCharCode()}this.is_buffing||(this.keys_up_time[c]=(new Date).getTime()),c==a.SHIFT?(a.preventDefault(),this.SHIFT_DOWN=!1):c==a.ALT?(a.preventDefault(),this.ALT_DOWN=!1):c==a.CTRL?(a.preventDefault(),this.CTRL_DOWN=!1):c==a.TAB&&this.SHIFT_DOWN||c==a.F5?(a.preventDefault(),this.hasFields(b)&&this.doPrevField(b)):(c==a.TAB||c==a.F6)&&(a.preventDefault(),this.hasFields(b)&&this.doNextField(b))},onClick:function(){this.hideTooltipOptions()},hasFields:function(a){return-1!=a.value.search(/\[.*?]/)},getPrevField:function(a,b){var c,d,e=b.value.substr(0,a.start),f=e.match(/\[.*?]/g);if(null==f||0===f.length)return void(this.loop_around&&this.getPrevField({start:b.value.length,end:b.value.length},b));c=e.lastIndexOf(f[f.length-1]),d=e.substr(c).search(/(](?=([^\]])))|(]$)/)+c+1,this.setCursorPos(b,c,d),this.setScroll(b,c,d);var g=b.value.substr(c,d-c);this.speak(g),this.showTooltipOptions(g)},getNextField:function(a,b){var c=b.value.substr(a.end),d=c.search(/\[.*]/),e=c.substr(d).search(/(](?=([^\]])))|(]$)/)+1;if(-1==d)return void(this.loop_around&&this.getNextField({start:0,end:0},b));d=a.end+d,e=d+e,this.setCursorPos(b,d,e),this.setScroll(b,d,e);var f=b.value.substr(d,e-d);this.speak(f),this.showTooltipOptions(f)},setScroll:function(a,b){var c=this.getCaretCoordinates(a,b);a.scrollTop=c[3]-600},getCaretCoordinates:function(a,b){var c,d,e,f=a.getBoundingClientRect(),g=!(null==window.mozInnerScreenX);c=document.getElementById(a.nodeName+"--mirror-div"),c||(c=document.createElement("div"),c.id=a.nodeName+"--mirror-div",document.body.appendChild(c)),e=c.style,d=getComputedStyle(a),e.whiteSpace="pre-wrap","INPUT"!==a.nodeName&&(e.wordWrap="break-word"),e.position="absolute",e.top=a.offsetTop+parseInt(d.borderTopWidth)+"px",e.left="0",e.visibility="hidden",this.properties.forEach(function(a){e[a]=d[a]}),g?(e.width=parseInt(d.width)-2+"px",a.scrollHeight>parseInt(d.height)&&(e.overflowY="scroll")):e.overflow="hidden",c.textContent=a.value.substring(0,b),"INPUT"===a.nodeName&&(c.textContent=c.textContent.replace(/\s/g,""));var h=document.createElement("span");h.textContent=a.value.substring(b)||".",h.style.backgroundColor="lightgrey",c.appendChild(h);var i=h.offsetLeft+parseInt(d.borderLeftWidth)+f.left-20,j=h.offsetTop+parseInt(d.borderTopWidth)+f.top+30;return[i,j-a.scrollTop,i,j]},getCursorPos:function(a){if("selectionStart"in a&&document.activeElement==a)return{start:a.selectionStart,end:a.selectionEnd};if(a.createTextRange){var b=document.selection.createRange();if(b.parentElement()===a){var c=a.createTextRange();c.moveToBookmark(b.getBookmark());for(var d=0;c.compareEndPoints("EndToStart",c)>0;c.moveEnd("character",-1))d++;c.setEndPoint("StartToStart",a.createTextRange());for(var e={start:0,end:d};c.compareEndPoints("EndToStart",c)>0;c.moveEnd("character",-1))e.start++,e.end++;return e}}return-1},setCursorPos:function(a,b,c){if(arguments.length<3&&(c=b),"selectionStart"in a)setTimeout(function(){a.selectionStart=b,a.selectionEnd=c},1);else if(a.createTextRange){var d=a.createTextRange();d.moveStart("character",b),d.collapse(),d.moveEnd("character",c-b),d.select()}},speak:function(a){-1!==a.search(/^\[*#/)&&(a=a.replace(/^\[#([a-z 0-9]*).*/g,"$1"),say(a),this.speakCtrl.speak(a))}}),Ext.define("App.view.patient.encounter.DictationPanel",{extend:"Ext.form.Panel",requires:[],itemId:"DictationPanel",title:_("dictation"),layout:"fit",frame:!0,bodyPadding:10,initComponent:function(){var a=this;a.items=[{xtype:"textareafield",name:"dictation",allowBlank:!1}],a.buttons=[{text:_("save"),iconCls:"save",itemId:"DictationPanelSaveBtn"}],a.callParent(arguments)}}),Ext.define("App.model.patient.NursesNote",{extend:"Ext.data.Model",table:{name:"patient_nurses_notes"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:120,index:!0},{name:"pid",type:"int",index:!0},{name:"eid",type:"int",index:!0},{name:"note",type:"string",dataType:"TEXT"},{name:"in_error",type:"bool"},{name:"signer_uid",type:"int",index:!0},{name:"signer_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"create_uid",type:"int",comment:"create user ID"},{name:"update_uid",type:"int",comment:"update user ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"nurse_fname",type:"string",store:!1},{name:"nurse_mname",type:"string",store:!1},{name:"nurse_lname",type:"string",store:!1},{name:"nurse_name",type:"string",convert:function(a,b){return""!==a?a:Ext.String.format("{0}, {1} {2}",b.get("nurse_lname"),b.get("nurse_fname"),b.get("nurse_mname"))},store:!1}],proxy:{type:"direct",api:{read:"NursesNotes.getNursesNotes",create:"NursesNotes.addNursesNote",update:"NursesNotes.updateNursesNote",destroy:"NursesNotes.destroyNursesNote"},reader:{root:"data"},writer:{writeAllFields:!0},remoteGroup:!1}}),Ext.define("App.store.patient.NursesNotes",{extend:"Ext.data.Store",model:"App.model.patient.NursesNote"}),Ext.define("App.view.patient.encounter.SOAP",{extend:"Ext.panel.Panel",requires:["App.ux.combo.Specialties","App.ux.grid.RowFormEditing","App.ux.grid.RowFormEditing","App.view.patient.encounter.CarePlanGoals","App.view.patient.encounter.CarePlanGoalsNewWindow","App.ux.LiveSnomedProcedureSearch","App.view.patient.encounter.AppointmentRequestGrid","App.view.patient.encounter.EducationResourcesGrid","App.view.patient.encounter.EncounterAddendaGrid","App.view.patient.encounter.MedicationsAdministeredGrid","App.view.patient.encounter.InterventionsGrid","App.view.patient.encounter.HealthConcernGrid","App.ux.form.fields.plugin.FieldTab"],action:"patient.encounter.soap",itemId:"soapPanel",title:_("soap"),layout:"border",frame:!0,pid:null,eid:null,initComponent:function(){var me=this;me.snippetStore=Ext.create("App.store.administration.EncounterSnippets",{autoLoad:!1,pageSize:1e3,groupField:"category"}),me.procedureStore=Ext.create("App.store.patient.encounter.Procedures");var snippetCtrl=App.app.getController("administration.EncounterSnippets");me.snippets=Ext.create("Ext.grid.Panel",{title:_("snippets"),itemId:"SnippetsTreePanel",region:"west",width:300,split:!0,animate:!1,hideHeaders:!0,useArrows:!0,rootVisible:!1,singleExpand:!0,collapsed:!eval(g("enable_encounter_soap_templates")),stateful:!0,stateId:"SnippetsTreePanelState",collapsible:!0,animCollapse:!1,hideCollapseTool:!0,store:me.snippetStore,features:[{ftype:"grouping"}],tools:[{xtype:"button",text:_("snippet"),iconCls:"icoAdd",itemId:"SnippetAddBtn"}],columns:[{text:_("edit"),width:25,menuDisabled:!0,xtype:"actioncolumn",tooltip:"Edit Snippet",align:"center",icon:"resources/images/icons/edit.png",handler:function(a,b,c,d,e,f){snippetCtrl.onSnippetBtnEdit(a,b,c,d,e,f)}},{text:_("description"),dataIndex:"description",flex:1}],bbar:[{xtype:"specialtiescombo",itemId:"SoapTemplateSpecialtiesCombo",flex:1}],viewConfig:{disableSelection:!0,plugins:{ptype:"treeviewdragdrop",dragText:_("drag_and_drop_reorganize")},listeners:{scope:me,drop:function(a,b,c){snippetCtrl.onSnippetDrop(a,b,c)}}}}),me.form=Ext.create("Ext.form.Panel",{autoScroll:!0,action:"encounter",region:"center",itemId:"soapForm",cls:"encounter-soap-form",frame:!0,fieldDefaults:{msgTarget:"side"},plugins:{ptype:"advanceform",autoSync:g("autosave"),syncAcl:a("edit_encounters")},items:[{xtype:"fieldset",title:_("chief_complaint"),margin:10,items:[{xtype:"textarea",anchor:"100%",height:100,enableKeyEvents:!0,nusaEnabled:!0,margin:"5 0 10 0",name:"chief_complaint",plugins:[{ptype:"fieldtab"}]}]},{xtype:"fieldset",title:_("subjective"),margin:10,items:[me.sField=Ext.widget("textarea",{name:"subjective",anchor:"100%",height:200,enableKeyEvents:!0,nusaEnabled:!0,margin:"5 0 10 0",plugins:[{ptype:"fieldtab"}]})]},{xtype:"fieldset",title:_("objective"),margin:10,items:[me.oField=Ext.widget("textarea",{name:"objective",anchor:"100%",height:200,nusaEnabled:!0,plugins:[{ptype:"fieldtab"}]}),me.physicalExamForm=Ext.widget("form",{title:"Physical Exam",itemId:"EncounterPhysicalExamForm",layout:"fit"}),{xtype:"grid",frame:!0,name:"procedures",emptyText:_("no_procedures"),margin:"5 0 10 0",store:me.procedureStore,itemId:"EncounterProcedureGrid",minHeight:100,columns:[{text:_("code"),dataIndex:"code"},{text:_("description"),dataIndex:"code_text",flex:2},{text:_("body_site"),dataIndex:"target_site_code_text",flex:1}],dockedItems:[{xtype:"toolbar",items:[{xtype:"tbtext",text:_("procedures")},"->",{text:_("new_procedure"),itemId:"EncounterProcedureGridAddBtn",iconCls:"icoAdd"}]}]}]},{xtype:"fieldset",title:_("assessment"),margin:10,items:[me.aField=Ext.widget("textarea",{name:"assessment",anchor:"100%",height:200,nusaEnabled:!0,plugins:[{ptype:"fieldtab"}]}),me.dxField=Ext.widget("icdsfieldset",{name:"dxCodes",margin:"5 0 10 0",itemId:"SoapDxCodesField"}),{xtype:"gaiaehr.combo",itemId:"SoapHealthStatusCmb",editable:!1,loadStore:!0,queryMode:"local",listKey:"health_stat",name:"health_status",fieldLabel:_("health_status"),labelAlign:"top",margin:"0 0 10 0",width:300}]},{xtype:"fieldset",title:_("plan"),margin:10,items:[me.pField=Ext.widget("textarea",{fieldLabel:_("instructions"),labelAlign:"top",name:"instructions",height:200,margin:"0 0 10 0",anchor:"100%",nusaEnabled:!0,plugins:[{ptype:"fieldtab"}]}),{xtype:"medicationsadministeredgrid",minHeight:125,margin:"0 0 10 0"},{xtype:"appointmentrequestgrid",minHeight:125,margin:"0 0 10 0"},{xtype:"interventionsgrid",minHeight:125,margin:"0 0 10 0"},{xtype:"careplangoalsgrid",minHeight:125,margin:"0 0 10 0"},{xtype:"educationresourcesgrid",minHeight:125,margin:"0 0 10 0"},{xtype:"healthconcerngird",minHeight:125,margin:"0 0 10 0"}]},{xtype:"fieldset",title:_("addenda"),margin:10,itemId:"EncounterSoapAddendaFieldSet",items:[{xtype:"encounteraddendagrid",itemId:"EncounterSoapAddendaGrid",minHeight:125,margin:"0 0 10 0"}]}],buttons:[{xtype:"button",icon:"modules/worklist/resources/images/wand.png",itemId:"SoapFormReformatTextBtn",tooltip:"Reformat Text :: ALT-W",minWidth:null,hidden:!Ext.isWebKit},{xtype:"button",action:"speechBtn",iconCls:"speech-icon-inactive",enableToggle:!0,minWidth:null,hidden:!Ext.isWebKit},"->",{text:_("save"),iconCls:"save",action:"soapSave",scope:me,itemId:"encounterRecordAdd",handler:me.onSoapSave}],listeners:{scope:me,recordloaded:me.formRecordLoaded}}),Ext.apply(me,{items:[me.snippets,me.form]}),me.physicalExamForm.getFormItems(me.physicalExamForm,17,function(){}),me.callParent(arguments)},onShow:function(){var a=this;a.callParent(),a.sField.focus(),a.eid!=app.patient.eid&&(a.pid=app.patient.pid,a.eid=app.patient.eid,a.procedureStore.load({filters:[{property:"eid",value:a.eid}]}))},onSoapSave:function(a){this.enc.onEncounterUpdate(a)},formRecordLoaded:function(a,b){var c=b.dxCodes();c.on("write",function(){b.store.fireEvent("write")}),this.dxField.loadIcds(b.dxCodes())}}),Ext.define("App.view.patient.encounter.NursesNotesGrid",{extend:"Ext.grid.Panel",requires:[],xtype:"nursesnotesgrid",itemId:"NursesNotesGrid",title:_("nurse_notes"),frame:!0,disableSelection:!0,store:Ext.create("App.store.patient.NursesNotes"),columns:[{xtype:"datecolumn",text:_("date"),width:150,format:g("date_time_display_format"),dataIndex:"create_date"},{text:_("note"),flex:1,dataIndex:"note",renderer:function(a,b){return b.style="white-space: normal;",a}},{text:_("nurse"),width:200,dataIndex:"nurse_name"}],tbar:["->",{text:_("note"),itemId:"NursesNotesGridAddBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}]}),Ext.define("App.view.patient.DecisionSupportWarningPanel",{extend:"Ext.panel.Panel",xtype:"decisionsupportwarningpanel",cls:"decisionSupportWarning",header:!1,hidden:!0,margin:0,dockedItems:[{xtype:"toolbar",dock:"right",ui:"plain",items:[{xtype:"button",icon:"resources/images/icons/close_exit.png",itemId:"DecisionSupportWarningPanelCloseBtn"}]}]}),Ext.define("App.view.patient.Documents",{extend:"Ext.panel.Panel",requires:["App.ux.grid.LiveSearchGridPanel","App.ux.combo.Templates","Ext.grid.plugin.RowEditing","App.store.patient.PatientDocuments","App.ux.ManagedIframe","Ext.grid.feature.Grouping","Ext.form.ComboBox"],xtype:"patientdocumentspanel",title:_("documents"),layout:"border",orientation:"west",initComponent:function(){var b=this,c=Ext.create("App.store.patient.PatientDocuments",{autoLoad:!1,remoteFilter:!0,remoteSort:!1,autoSync:!1,pageSize:500,groupField:"docTypeCode",sorters:[{property:"date",direction:"DESC"},{property:"docTypeCode",direction:"ASC"}]}),d=App.app.getController("patient.Documents");b.items=[{xtype:"gridlivesearch",region:b.orientation,split:!0,flex:1,columnLines:!0,selType:"checkboxmodel",stateful:!0,stateId:"patientDocumentGridState",viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to move document to another category"}},features:[{ftype:"grouping",hideGroupedHeader:!0,startCollapsed:!0,groupHeaderTpl:Ext.create("Ext.XTemplate","{children:this.getGroupName}",{getGroupName:function(a){return d.getGroupName(a[0].store,a[0])}})}],itemId:"patientDocumentGrid",store:c,columns:[{xtype:"actioncolumn",width:23,icon:"resources/images/icons/icoLessImportant.png",tooltip:_("validate_file_integrity_hash"),stateId:"patientDocumentGridStateActionCol",handler:function(a,b){d.onDocumentHashCheckBtnClick(a,b)},getClass:function(){return"x-grid-icon-padding"}},{header:_("category"),dataIndex:"docTypeCode",itemId:"docTypeCode",editor:{xtype:"textfield"},stateId:"patientDocumentGridStateDocTypeCol",renderer:function(a,b,c){return c.get("entered_in_error")&&(b.tdCls+=" entered-in-error ",b.tdAttr='data-qtip="'+_("error_note")+": "+c.get("error_note")+'"'),c.get("docType")}},{xtype:"datecolumn",header:_("date"),dataIndex:"date",format:g("date_display_format"),itemId:"groupDate",stateId:"patientDocumentGridStateGroupDateCol",renderer:function(a,b,c){var d=null!=a?Ext.util.Format.date(a,g("date_display_format")):"-";return c.get("entered_in_error")&&(b.tdCls+=" entered-in-error ",b.tdAttr='data-qtip="'+_("error_note")+": "+c.get("error_note")+'"'),d}},{header:_("title"),dataIndex:"title",flex:1,editor:{xtype:"textfield",action:"title"},stateId:"patientDocumentGridStateTitleCol",renderer:function(a,b,c){return c.get("entered_in_error")&&(b.tdCls+=" entered-in-error ",b.tdAttr='data-qtip="'+_("error_note")+": "+c.get("error_note")+'"'),a.split("|").join("<br>")}}],plugins:Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!0,errorSummary:!1,clicksToEdit:2}),tbar:[_("group_by")+":",{xtype:"button",text:_("category"),enableToggle:!0,action:"docTypeCode",pressed:!0,disabled:!0,toggleGroup:"documentgridgroup"},{xtype:"button",text:_("date"),enableToggle:!0,action:"groupDate",toggleGroup:"documentgridgroup"},"->","-",{icon:"resources/images/icons/no.png",itemId:"PatientDocumentEnteredInErrorBtn",tooltip:_("entered_in_error"),acl:a("allow_document_enter_in_error")},"-",{icon:"resources/images/icons/icoScanner.png",itemId:"documentScanBtn",tooltip:_("scan")},"-",{icon:"resources/images/icons/upload.png",itemId:"documentUploadBtn",tooltip:_("upload")}],bbar:Ext.create("Ext.PagingToolbar",{pageSize:10,store:c,displayInfo:!0,items:[{text:"Show...",destroyMenu:!0,itemId:"PatientDocumentGridGroupBtn",menu:[]}]})},{xtype:"panel",region:"center",flex:2,layout:{type:"vbox",align:"stretch"},frame:!0,itemId:"patientDocumentViewerPanel",cls:"document-viewer-backgroud",items:[{xtype:"miframe",style:"document-viewer-backgroud",autoMask:!1,flex:1,itemId:"patientDocumentViewerFrame"}],bbar:[{xtype:"sliderfield",value:1,increment:.1,decimalPrecision:1,minValue:.1,maxValue:1,flex:1,margin:"0 10",stateId:"PatientDocumentViewerOpacityField",stateful:!0,itemId:"PatientDocumentViewerOpacityField",getState:function(){return{value:this.getValue()}},applyState:function(a){this.setValue(a.value)},stateEvents:["change"]}]}],b.callParent(arguments)}}),Ext.define("App.view.patient.CCD",{extend:"Ext.panel.Panel",requires:["Ext.ux.IFrame","App.ux.ManagedIframe"],xtype:"patientccdpanel",title:_("ccd"),columnLines:!0,itemId:"CcdPanel",layout:"fit",items:[{xtype:"miframe",style:"background-color:white",autoMask:!0,itemId:"patientDocumentViewerFrame"}],tbar:[{xtype:"fieldcontainer",border:1,layout:"vbox",defaults:{margin:"0 5 5 5"},items:[{xtype:"patientEncounterCombo",itemId:"PatientCcdPanelEncounterCmb",width:300,fieldLabel:_("filter_encounter"),hideLabel:!1,labelAlign:"top",includeAllSelection:!0}]},"-",{xtype:"checkboxgroup",fieldLabel:_("exclude"),columns:4,vertical:!0,labelWidth:80,itemId:"PatientCcdPanelExcludeCheckBoxGroup",flex:1,items:[{boxLabel:_("procedures"),name:"exclude",inputValue:"procedures"},{boxLabel:_("vitals"),name:"exclude",inputValue:"vitals"},{boxLabel:_("immunizations"),name:"exclude",inputValue:"immunizations"},{boxLabel:_("medications"),name:"exclude",inputValue:"medications"},{boxLabel:_("meds_administered"),name:"exclude",inputValue:"administered"},{boxLabel:_("problems"),name:"exclude",inputValue:"problems"},{boxLabel:_("allergies"),name:"exclude",inputValue:"allergies"},{boxLabel:_("social"),name:"exclude",inputValue:"social"},{boxLabel:_("results"),name:"exclude",inputValue:"results"},{boxLabel:_("provider_information"),name:"exclude",inputValue:"provider_information"},{boxLabel:_("clinical_instructions"),name:"exclude",inputValue:"clinical_instructions"},{boxLabel:_("plan_of_care"),name:"exclude",inputValue:"planofcare"},{boxLabel:_("visit_date_location"),name:"exclude",inputValue:"visit_date_location"},{boxLabel:_("reason_for_visit"),name:"exclude",inputValue:"reason_for_visit"},{boxLabel:_("patient_decision_aids"),name:"exclude",inputValue:"patient_decision_aids"},{boxLabel:_("future_appointments"),name:"exclude",inputValue:"future_appointments"},{boxLabel:_("future_schedule_test"),name:"exclude",inputValue:"future_schedule_test"},{boxLabel:_("diagnostic_test_pending"),name:"exclude",inputValue:"diagnostic_test_pending"},{boxLabel:_("patient_information"),name:"exclude",inputValue:"patient_information"},{boxLabel:_("patient_name"),name:"exclude",inputValue:"patient_name"},{boxLabel:_("patient_sex"),name:"exclude",inputValue:"patient_sex"},{boxLabel:_("patient_dob"),name:"exclude",inputValue:"patient_dob"},{boxLabel:_("patient_race"),name:"exclude",inputValue:"patient_race"},{boxLabel:_("patient_ethnicity"),name:"exclude",inputValue:"patient_ethnicity"},{boxLabel:_("patient_preferred_language"),name:"exclude",inputValue:"patient_preferred_language"},{boxLabel:_("patient_marital_status"),name:"exclude",inputValue:"patient_marital_status"},{boxLabel:_("patient_smoking_status"),name:"exclude",inputValue:"patient_smoking_status"}]},"-",{xtype:"button",text:_("refresh"),margin:"0 0 5 0",itemId:"viewCcdBtn",icon:"resources/images/icons/refresh.png"},"-",{xtype:"container",layout:"vbox",items:[{xtype:"button",text:_("upload"),margin:"0 0 5 0",itemId:"importCcdBtn",icon:"resources/images/icons/upload.png",width:100},{xtype:"button",text:_("download"),itemId:"exportCcdBtn",icon:"resources/images/icons/download.png",width:100}]},"-",{xtype:"container",layout:"vbox",items:[{xtype:"button",text:_("archive"),margin:"0 0 5 0",itemId:"archiveCcdBtn",icon:"resources/images/icons/archive_16.png",width:100},{xtype:"button",text:"Print",iconCls:"icon-print",itemId:"printCcdBtn",width:100}]}]}),Ext.define("App.view.patient.Amendments",{extend:"Ext.grid.Panel",requires:[],xtype:"patientamendmentspanel",title:_("amendments"),initComponent:function(){var a=this;
a.store=Ext.create("App.store.miscellaneous.Amendments",{remoteFilter:!0}),a.columns=[{text:_("type"),width:70,dataIndex:"amendment_type",renderer:function(a){var b;return b="P"===a?_("patient"):"G"===a?_("guardian"):"E"===a?_("emergency_contact"):"D"===a?_("doctor"):"O"===a?_("organization"):a}},{text:_("dates"),columns:[{text:_("received"),width:140,dataIndex:"create_date"},{text:_("appended"),width:140,dataIndex:"create_date"},{text:_("responded"),width:140,dataIndex:"response_date"}]},{text:_("message"),flex:1,dataIndex:"amendment_message"},{text:_("response_message"),flex:1,dataIndex:"response_message"},{text:_("status"),width:100,dataIndex:"amendment_status",renderer:function(a){var b;return b="W"===a?_("waiting_response"):"A"===a?_("approved"):"D"===a?_("denied"):"C"===a?_("canceled"):"E"===a?_("error"):a}},{text:_("approved_denied_by"),width:200,dataIndex:"responded_by"}],a.bbar={xtype:"pagingtoolbar",pageSize:25,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager},a.callParent()}}),Ext.define("App.model.patient.CareTeamMember",{extend:"Ext.data.Model",table:{name:"patient_care_team_members"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"npi",type:"string",len:10,index:!0},{name:"is_primary",type:"bool",index:!0},{name:"fname",type:"string",store:!1},{name:"mname",type:"string",store:!1},{name:"lname",type:"string",store:!1},{name:"create_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"CareTeamMember.getCareTeamMembers",create:"CareTeamMember.addCareTeamMember",update:"CareTeamMember.updateCareTeamMember",destroy:"CareTeamMember.destroyCareTeamMember"}}}),Ext.define("App.store.patient.CareTeamMembers",{extend:"Ext.data.Store",requires:["App.model.patient.CareTeamMember"],model:"App.model.patient.CareTeamMember"}),Ext.define("App.view.patient.CareTeamGrid",{extend:"Ext.grid.Panel",xtype:"patientcareteamgrid",requires:["Ext.grid.feature.Grouping","App.ux.LiveReferringPhysicianSearch"],title:"Care Team",hideHeaders:!0,store:Ext.create("App.store.patient.CareTeamMembers",{autoSync:!0,sorters:[{property:"is_primary",direction:"DESC"}]}),columns:[{xtype:"checkcolumn",dataIndex:"is_primary",width:25,itemId:"CareTeamGridIdPrimaryCheckColumn",tooltip:"Is Primary Provider"},{header:_("npi"),dataIndex:"npi",width:80},{header:_("name"),dataIndex:"lname",flex:1,renderer:function(a,b,c){return Ext.String.format("{0}, {1} {2}",c.get("lname"),c.get("fname"),c.get("mname"))}},{xtype:"griddeletecolumn",width:25,acl:!0}],tbar:[{xtype:"referringphysicianlivetsearch",itemId:"CareTeamGridReferringPhysicianSearch",flex:1}]}),Ext.define("App.view.patient.EncountersGrid",{extend:"Ext.grid.Panel",requires:["Ext.grid.feature.Grouping"],xtype:"encountersgrid",title:_("encounter_history"),itemId:"EncountersGrid",initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.Encounters",{remoteFilter:!0,pageSize:500}),a.columns=[{header:"eid",sortable:!1,dataIndex:"eid",hidden:!0},{width:180,header:_("service_date"),sortable:!0,dataIndex:"service_date",renderer:Ext.util.Format.dateRenderer("F j, Y, g:i a")},{flex:1,header:_("chief_complaint"),sortable:!0,dataIndex:"brief_description",renderer:function(a,b,c){var d=a;return c.isPrivate()&&(d='<i class="fas fa-shield-check" style="color: red"></i> '+d),c.isClose()&&(d='<i class="fas fa-shield-check" style="color: #1b9bfc"></i> '+d),d}},{width:200,header:_("provider"),sortable:!1,dataIndex:"provider_uid",renderer:function(a,b,c){return Ext.String.format("{0}, {1} {2}",c.get("provider_lname"),c.get("provider_fname"),c.get("provider_mname"))}},{width:200,header:_("facility"),sortable:!1,dataIndex:"facility_name"},{width:70,header:_("signed")+"?",sortable:!0,dataIndex:"close_date",renderer:function(a){return app.boolRenderer(null!==a)}}],a.tbar=Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,emptyMsg:"No Encounters Found",plugins:Ext.create("Ext.ux.SlidingPager",{}),items:["-",{text:_("new_encounter"),itemId:"EncountersGridNewEncounterBtn"},"-",{text:_("progress_report"),disabled:!0,itemId:"EncountersGridNewProgressReportsBtn"}]}),a.callParent(arguments)}}),Ext.define("App.view.patient.PatientNotesGrid",{extend:"Ext.grid.Panel",requires:["Ext.grid.feature.Grouping","App.ux.grid.RowFormEditing"],xtype:"patientnotesgrid",initComponent:function(){var b=this;b.store=Ext.create("App.store.patient.Notes",{autoSync:!1,remoteFilter:!0,pageSize:50}),b.columns=[{xtype:"griddeletecolumn",acl:a("delete_patient_notes"),width:20},{xtype:"datecolumn",text:_("date"),format:"Y-m-d",dataIndex:"date"},{text:_("type"),dataIndex:"type"},{text:_("note"),dataIndex:"body",flex:1},{text:_("user"),width:200,dataIndex:"user_name"},{text:_("update")+" "+_("user"),width:200,dataIndex:"update_user_name"},{xtype:"datecolumn",text:_("update")+" "+_("date"),format:"Y-m-d",dataIndex:"update_date"}],b.plugins=Ext.create("App.ux.grid.RowFormEditing",{clicksToEdit:2,items:[{xtype:"gaiaehr.combo",fieldLabel:_("type"),name:"type",emptyText:_("type"),queryMode:"local",listKey:"admin_note_types",width:300,margin:"0 0 5 0",loadStore:!0,editable:!1},{xtype:"textareafield",fieldLabel:_("note"),name:"body",height:50,anchor:"100%"}]}),b.tbar=["->",{text:_("add_note"),iconCls:"icoAdd",action:"note",itemId:"PatientNotesGridAddNotesBtn",acl:a("add_patient_notes")}],b.bbar={xtype:"pagingtoolbar",store:b.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager},b.callParent()}}),Ext.define("App.ux.combo.ServiceLocation",{extend:"Ext.form.ComboBox",xtype:"servicelocationcombo",typeAhead:!0,typeAheadDelay:50,queryMode:"local",displayField:"valueFieldText",valueField:"code",editable:!1,initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{fields:[{name:"code",type:"string"},{name:"displayName",type:"string"},{name:"valueFieldText",convert:function(a,b){return Ext.String.format("{0} - {1}",b.get("code"),b.get("displayName"))}}],autoLoad:!0,proxy:{type:"ajax",url:"resources/code_sets/PH_HealthcareServiceLoc_NHSN.json",reader:{type:"json"}}}),a.callParent(arguments)}}),Ext.define("App.view.patient.LegalLetters",{extend:"Ext.grid.Panel",requires:[],xtype:"patientlegalletters",title:_("legal_letters"),selType:"checkboxmodel",features:[{ftype:"grouping",groupHeaderTpl:'{columnName}: {name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})'}],initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.LegalLetterSignatures",{pageSize:100,remoteFilter:!0,groupField:"letter_title"}),a.columns=[{text:_("letter"),dataIndex:"letter_title",flex:1},{text:_("letter_version"),dataIndex:"letter_version",width:120},{text:_("ip_address"),dataIndex:"signature_ip",width:120},{xtype:"datecolumn",text:_("date_signed"),dataIndex:"signature_date",flex:1,format:g("date_time_display_format")},{text:_("signature"),dataIndex:"signature",width:200,renderer:function(a){return""===a?'<span style="color: red;">SIGNATURE REQUIRED</span>':Ext.String.format('<img src="{0}" style="width: 100%" alt="Document Signature"/>',a)}}],a.tbar=[{xtype:"button",text:"Preview Document",iconCls:"fal fa-file",itemId:"PatientLegalLettersPreviewDocumentBtn"},"->",{xtype:"button",text:"Sign Document",iconCls:"fal fa-file-signature",itemId:"PatientLegalLettersSignDocumentBtn"}],a.bbar={xtype:"pagingtoolbar",pageSize:100,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager},a.callParent()}}),Ext.define("App.ux.grid.ColumnSearchField",{extend:"Ext.form.field.Trigger",xtype:"columnsearchfield",triggerCls:"x-form-clear-trigger",operator:"=",prefix:"",suffix:"",enableKeyEvents:!0,initComponent:function(){var a=this;a.autoSearch!==!0&&(a.trigger2Cls="x-form-search-trigger"),a.setFilterBuffer=Ext.Function.createBuffered(a.setFilter,500,a),a.callParent(arguments),a.on("render",function(){var a=this;a.ownerCt.on("resize",function(){a.setWidth(this.getEl().getWidth())})}),a.on("change",function(){a.autoSearch&&a.setFilterBuffer(a.up().dataIndex,a.getSubmitValue())}),a.on("keyup",function(b,c){c.getKey()===c.ENTER&&a.setFilterBuffer(a.up().dataIndex,a.getSubmitValue())})},onTriggerClick:function(){this.setValue(""),this.setFilter(this.up().dataIndex,void 0)},onTrigger2Click:function(){this.setFilter(this.up().dataIndex,this.getValue())},setFilter:function(a,b){var c=this.up("grid").getStore();if(b){c.removeFilter(a,!1);var d={id:a,property:a,operator:this.operator,value:this.prefix+b+this.suffix};this.anyMatch&&(d.anyMatch=this.anyMatch),this.caseSensitive&&(d.caseSensitive=this.caseSensitive),this.exactMatch&&(d.exactMatch=this.exactMatch),this.operator&&(d.operator=this.operator),c.addFilter(d)}else c.filters.removeAtKey(a),c.reload()}}),Ext.define("App.ux.grid.Button",{extend:"Ext.grid.column.Column",alias:["widget.gridbutton"],header:"&#160;",sortable:!1,context:{},applicationProperties:{iconStore:""},constructor:function(a){var b,c,d,e=this;b=Ext.apply({},a),c=b.items||[e],e.callParent(arguments),e.items=c,e.context=b.scope,e.renderer=function(a,b,f){return Ext.Array.each(c,function(b){var c;d=b,c=Ext.id(),Ext.Function.defer(e.addButton,100,e,[c,f,d,e.context]),a?a+='<div id="'+c+'">&#160;</div>':a='<div id="'+c+'">&#160;</div>'}),a}},noHandler:function(){Ext.Msg.alert("Oops","No Handler set up")},addButton:function(a,b,c,d){var e,f,g,h,i,j=this,k=Ext.get(a);k&&(c.menu?(f=[],Ext.Array.each(c.menu,function(a){g=a.handler?Ext.bind(a.handler,j,[b,d]):j.noHandler,i=a.icon?j.applicationProperties.iconStore+a.icon:void 0;var c={text:a.text,handler:g,icon:i};f.push(c)}),h={text:c.text,icon:c.icon?j.applicationProperties.iconStore+c.icon:"",menu:f,renderTo:k.parent()}):(g=c.handler?Ext.bind(c.handler,j,[b,d]):j.noHandler,h={text:c.text,tooltip:c.tooltip,icon:c.icon?j.applicationProperties.iconStore+c.icon:"",handler:g,cls:c.cls||null,listeners:c.listeners||null,record:b,width:c.width||50,margin:c.margin||0,renderTo:k.parent()}),e=Ext.create("Ext.button.Button",h),Ext.get(a).remove())},destroy:function(){delete this.items,delete this.renderer,this.callParent(arguments)},cascade:function(a,b){a.call(b||this,this)},getRefItems:function(){return[]}}),Ext.define("App.view.administration.practice.DecisionAids",{extend:"Ext.grid.Panel",xtype:"decisionaidspanel",requires:["Ext.grid.plugin.RowEditing","Ext.ux.SlidingPager"],title:_("patient_decision_aids"),initComponent:function(){var a=this;Ext.apply(a,{store:a.store=Ext.create("App.store.administration.DecisionAids",{autoSync:!1}),columns:[{text:_("trigger_code"),dataIndex:"trigger_code",sortable:!0,width:150,editor:{xtype:"textfield",maxLength:40}},{text:_("description_code"),dataIndex:"instruction_code",width:150,editor:{xtype:"textfield",maxLength:40}},{text:_("description_code_type"),dataIndex:"instruction_code_type",width:150,editor:{xtype:"textfield",maxLength:40}},{text:_("description"),dataIndex:"instruction_code_description",flex:1,editor:{xtype:"textfield",maxLength:600}},{text:_("active"),sortable:!0,dataIndex:"active",renderer:a.boolRenderer,editor:{xtype:"checkboxfield"}}],plugins:[{ptype:"rowediting",clicksToEdit:1}],tbar:["->",{xtype:"button",text:_("decision_aid"),iconCls:"icoAdd",itemId:"DecisionAidsAddBtn"}],bbar:Ext.create("Ext.PagingToolbar",{pageSize:10,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{})})}),a.callParent(arguments)}}),Ext.define("App.ux.combo.XCombo",{extend:"Ext.form.field.ComboBox",xtype:"xcombo",trigger1Class:"x-form-select-trigger",trigger2Class:"x-form-add-trigger",trigger3Class:"x-form-update-trigger",editable:!1,addTooltip:"Add Item",saveText:"Save",cancelText:"Cancel",maskText:"Saving Data",windowConfig:{title:"New Record",modal:!0},formConfig:{width:400,height:240,border:!1,html:'Form placeholder, please add a formConfig property<br>Exmaple:<br><pre>{<br>   ptype: "comboadd",<br>   windowConfig: {<br>       title: "New Record"<br>       modal: true<br>   }<br>   formConfig: {<br>       width: 600,<br>       height: 400,<br>       border: false,<br>       items:[ {...},{...} ]<br>   }<br>}<br></pre>'},initComponent:function(){var a=this;a.addEvents("cancel","beforesync","sync","failure"),a.on("select",a.setUpdateTrigger,a),a.callParent(arguments)},onRender:function(){var a=this,b=a.getId();a.callParent(arguments),a.triggerWidth=51,a.triggerConfig={tag:"td",valign:"top",cls:"x-trigger-cell",style:"width:34px",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,id:"trigger1"+b,name:"trigger1"+b,style:"float:left",cls:"x-form-trigger "+this.trigger1Class,role:"button"},{tag:"img",src:Ext.BLANK_IMAGE_URL,id:"trigger2"+b,name:"trigger2"+b,style:"float:left",cls:"x-form-trigger "+this.trigger2Class,role:"button"},{tag:"img",src:Ext.BLANK_IMAGE_URL,id:"trigger3"+b,name:"trigger3"+b,style:"float:left;display:none",cls:"x-form-trigger "+this.trigger3Class,role:"button"}]},a.triggerCell.replaceWith(a.triggerConfig),a.trigger1=Ext.get("trigger1"+b),a.trigger2=Ext.get("trigger2"+b),a.trigger3=Ext.get("trigger3"+b),a.trigger1.on("mouseup",a.triggerClick,a),a.trigger2.on("mouseup",a.triggerClick,a),a.trigger3.on("mouseup",a.triggerClick,a),a.trigger1.addClsOnOver("x-form-trigger-over"),a.trigger2.addClsOnOver("x-form-trigger-over"),a.trigger3.addClsOnOver("x-form-trigger-over")},setUpdateTrigger:function(){this.trigger3.isVisible()||(this.setWidth(this.getWidth()+17),this.triggerCell.setWidth(51),this.trigger3.show())},triggerClick:function(a){var b=this.getId();a.target.name=="trigger1"+b?this.onTriggerClick():a.target.name=="trigger2"+b?this.onTriggerAddClick():a.target.name=="trigger3"+b&&this.onTriggerUpdateClick()},onTriggerAddClick:function(){var a=this;a.reset(),a.getWindow().show(),a.uWindow.down("form").getForm().loadRecord(a.getNewRecord())},onTriggerUpdateClick:function(){var a=this;a.getWindow().show(),a.uWindow.down("form").getForm().loadRecord(a.getSelectedRecord())},getSelectedRecord:function(){return this.findRecordByValue(this.getValue())},getNewRecord:function(){return Ext.create(this.getStore().model)},getWindow:function(){var a=this;return a.uWindow=Ext.widget("window",{items:[Ext.widget("form",a.formConfig)],buttons:[{text:a.cancelText,scope:a,handler:a.doCancelRecord},{text:a.saveText,scope:a,handler:a.doSaveRecord}]}),Ext.apply(a.uWindow,a.windowConfig)},doSaveRecord:function(){var a=this,b=a.uWindow.down("form"),c=b.getForm(),d=c.getRecord(),e=c.getValues(),f=a.store.indexOf(d);d.set(e),-1==f&&a.store.add(d),a.store.getNewRecords().length||a.store.getUpdatedRecords().length?(b.el.mask(a.maskText),a.fireEvent("beforesync",a.store,d),a.store.sync({success:function(b,c){a.select(d),a.fireEvent("sync",a.store,d,b,c)},failure:function(){a.fireEvent("failure",a.store,d,batch,options)},callback:function(){b.el.unmask(),c.reset(),a.uWindow.close()}})):(c.reset(),a.uWindow.close())},doCancelRecord:function(){var a=this,b=a.uWindow.down("form").getForm();a.fireEvent("cancel",a,a.form,a.store),b.reset(),a.uWindow.close()}}),Ext.define("App.ux.form.fields.plugin.PasswordStrength",{extend:"Ext.AbstractPlugin",alias:"plugin.passwordstrength",colors:["ffcccc","ffcc99","ffff99","99ccff","99ff99"],init:function(a){var b=this;a.on("change",b.onFieldChange,b)},onFieldChange:function(a,b){if(""===b)return a.inputEl.setStyle({"background-color":null,"background-image":null}),void(a.score=0);var c=this,d=c.scorePassword(b);a.score=d,c.processValue(a,d)},processValue:function(a,b){var c,d=this,e=d.colors;c=16>b?e[0]:b>15&&25>b?e[1]:b>24&&35>b?e[2]:b>34&&45>b?e[3]:e[4],a.inputEl.setStyle({"background-color":"#"+c,"background-image":"none"})},scorePassword:function(a){var b=0;return a.length<5?b+=3:a.length>4&&a.length<8?b+=6:a.length>7&&a.length<13?b+=12:a.length>12&&(b+=18),a.match(/[a-z]/)&&(b+=1),a.match(/[A-Z]/)&&(b+=5),a.match(/\d+/)&&(b+=5),a.match(/(.*[0-9].*[0-9].*[0-9])/)&&(b+=5),a.match(/.[!,@,#,$,%,^,&,*,?,_,~]/)&&(b+=7),a.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)&&(b+=7),a.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(b+=3),a.match(/([a-zA-Z])/)&&a.match(/([0-9])/)&&(b+=3),a.match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~])|([!,@,#,$,%,^,&,*,?,_,~].*[a-zA-Z0-9])/)&&(b+=3),b}}),Ext.define("App.ux.combo.ActiveSpecialties",{extend:"Ext.form.ComboBox",xtype:"activespecialtiescombo",displayField:"title",valueField:"id",editable:!1,emptyText:_("select"),queryMode:"local",includeAllOption:!1,initComponent:function(){var a=this;this.store=Ext.create("App.store.administration.Specialties",{pageSize:500,autoLoad:!0,listeners:{load:function(){a.includeAllOption&&(a.store.insert(0,{id:-1,title:"ALL",combo_text:"ALL",active:!0}),a.setValue(-1))}}}),this.store.clearFilter(!0),this.store.filter([{property:"active",value:!0}]),this.callParent()}}),Ext.define("App.ux.combo.Departments",{extend:"Ext.form.ComboBox",xtype:"depatmentscombo",editable:!1,queryMode:"local",valueField:"id",displayField:"title",emptyText:_("select"),store:Ext.create("App.store.administration.Departments",{autoLoad:!0})}),Ext.define("App.ux.grid.exporter.Exporter",{uses:["App.ux.grid.exporter.ExporterButton","App.ux.grid.exporter.csvFormatter.CsvFormatter","App.ux.grid.exporter.excelFormatter.ExcelFormatter","App.ux.grid.exporter.FileSaver"],statics:{exportAny:function(a,b,c){var d="export";a.is?a.is("gridpanel")?d+="Grid":a.is("treepanel")?d+="Tree":(d+="Store",a=a.getStore()):d+="Store";var e=this.getFormatterByName(b);return this[d](a,e,c)},exportGrid:function(a,b,c){c=c||{},b=this.getFormatterByName(b);var d,e,f,g,h=a.getStore()||c.store,i=Ext.Array.filter(a.view.headerCt.getVisibleGridColumns(),function(a){return!(a.hidden||a.xtype&&"actioncolumn"===a.xtype&&"rownumberer"===a.xtype&&"templatecolumn"===a.xtype||a.isCheckerHd===!0)}),j=h.isGrouped?h.isGrouped():!1,k=this.getFeature(a,"summary");return j&&(g=this.getFeature(a,"grouping"),g?(f=g.getGroupField(),e="groupingsummary"===g.ftype):j=!1),k&&(d=!0),Ext.apply(c,{title:a.title,columns:i,isGrouped:j,hasGroupingSummary:e,hasSummary:d,groupField:f,grouping:g,summary:k}),{data:b.format(h,c),mimeType:b.mimeType,charset:b.charset,ext:b.extension}},exportStore:function(a,b,c){return c=c||{},b=this.getFormatterByName(b),Ext.applyIf(c,{columns:a.fields?a.fields.items:a.model.prototype.fields.items}),{data:b.format(a,c),mimeType:b.mimeType,charset:b.charset,ext:b.extension}},exportTree:function(a,b,c){c=c||{},b=this.getFormatterByName(b);var d=a.getStore()||c.store;return Ext.applyIf(c,{title:a.title}),{data:b.format(d,c),mimeType:b.mimeType,charset:b.charset,ext:b.extension}},getFormatterByName:function(a){return a=a?a:"excel",a=Ext.isString(a)?Ext.create("App.ux.grid.exporter."+a+"Formatter."+Ext.String.capitalize(a)+"Formatter"):a},getFeature:function(a,b){var c,d=a.getView();if(d.features?c=d.features:d.featuresMC?c=d.featuresMC.items:d.normalView.featuresMC&&(c=d.normalView.featuresMC.items),c)for(var e=0;e<c.length;e++){if("grouping"==b&&("grouping"==c[e].ftype||"groupingsummary"==c[e].ftype))return c[e];if("groupingsummary"==b&&"groupingsummary"==c[e].ftype)return c[e];if("summary"==b&&"summary"==c[e].ftype)return c[e]}return void 0}}}),Ext.define("App.model.administration.AclGroupPerm",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"group_id",type:"int"},{name:"category",type:"string"}],proxy:{type:"direct",api:{read:"ACL.getGroupPerms",create:"ACL.updateGroupPerms",update:"ACL.updateGroupPerms"},reader:{type:"json",root:"data"}}}),Ext.define("App.view.patient.windows.ArchiveDocument",{extend:"Ext.window.Window",xtype:"patientarchivedocumentwindow",draggable:!1,modal:!0,autoShow:!0,closeAction:"hide",title:_("archive_document"),items:[{xtype:"form",bodyPadding:10,width:400,defaults:{xtype:"textfield",anchor:"100%",labelWidth:70},items:[{name:"id",hidden:!0},{xtype:"gaiaehr.combo",fieldLabel:_("category"),list:102,name:"docTypeCode",editable:!1,allowBlank:!1},{fieldLabel:_("title"),name:"title"},{xtype:"textareafield",name:"note",fieldLabel:_("notes")},{xtype:"fieldset",itemId:"ArchiveDocumentOptionalFieldSet",title:"Print ("+_("optional")+")",margin:"0 0 0 10",items:[{xtype:"numberfield",itemId:"archiveDocumentNumberOfJobCopies",name:"number_of_copies",fieldLabel:_("number_of_copies"),value:1,maxValue:10,minValue:1,hideLabel:!1,allowBlank:!1,width:300},{xtype:"combobox",fieldLabel:_("priority"),name:"priority",store:Ext.create("Ext.data.Store",{fields:["value","display"],data:[{value:1,display:"High"},{value:2,display:"Med"},{value:3,display:"Low"}]}),value:2,displayField:"display",valueField:"value",editable:!1,width:300}]}]}],buttons:[{text:_("cancel"),handler:function(a){a.up("window").close()}},{text:_("archive"),itemId:"archiveBtn"}]}),Ext.define("App.view.notifications.Grid",{extend:"Ext.grid.Panel",xtype:"notificationsgrid",width:400,header:!1,hideHeaders:!0,columns:[{text:_("description"),dataIndex:"description",flex:1}]}),Ext.define("App.ux.grid.Printer",{requires:"Ext.XTemplate",statics:{print:function(a){var b,c=a.store.isGrouped?a.store.isGrouped():!1;if(c){var d=this.getFeature(a,"grouping");d?b=d.getGroupField():c=!1}var e;a.columnManager?e=a.view.headerCt.getVisibleGridColumns():(e=[],Ext.each(a.columns,function(a){a.items&&a.items.length>0?e=e.concat(a.items.items):e.push(a)}));var f=[];if(Ext.each(e,function(a){a&&(Ext.isEmpty(a.dataIndex)||a.hidden||c?"rownumberer"===a.xtype?(a.text||(a.text="Row"),f.push(a)):"templatecolumn"===a.xtype?f.push(a):c&&a.dataIndex!==b&&"actioncolumn"!==a.xtype&&f.push(a):f.push(a))}),e=f,null===this.stylesheetPath){var g=Ext.Loader.getPath("App.ux.grid.Printer");this.stylesheetPath=g.substring(0,g.indexOf("Printer.js"))+"gridPrinterCss/print.css"}var h,i=Ext.create("Ext.XTemplate",this.headerTpl).apply(e),j=this.generateBody(a,e,d),k=[];Ext.each(a.plugins,function(a){"rowexpander"==a.ptype&&(h=a.rowBodyTpl)}),h&&(k=['<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}"><td colspan="'+e.length+'">',"{[ this.applyTpl(values) ]}","</td></tr>"]);var l,m=a.title?a.title:this.pageTitle,n=this.getFeature(a,"summary"),o=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html class="'+Ext.baseCSSPrefix+'ux-grid-printer">',"<head>",'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />','<link href="'+this.stylesheetPath+'" rel="stylesheet" type="text/css" />',"<title>"+m+"</title>",'<script type="text/javascript">','function printOnload() {["{"]}',"if ("+this.printAutomatically+') {["{"]}',"window.print();","if ("+this.closeAutomaticallyAfterPrint+') {["{"]}',"window.close();",'{["}"]}','{["}"]}','{["}"]}',"</script>","</head>",'<body class="'+Ext.baseCSSPrefix+'ux-grid-printer-body" onload="printOnload();">','<div class="'+Ext.baseCSSPrefix+"ux-grid-printer-noprint "+Ext.baseCSSPrefix+'ux-grid-printer-links">','<a class="'+Ext.baseCSSPrefix+'ux-grid-printer-linkprint" href="javascript:void(0);" onclick="window.print();">'+this.printLinkText+"</a>",'<a class="'+Ext.baseCSSPrefix+'ux-grid-printer-linkclose" href="javascript:void(0);" onclick="window.close();">'+this.closeLinkText+"</a>","</div>",'<img src="'+this.mainLogo+'" style="height: 75px; padding-bottom: 10px;">','<h1 style="padding-bottom: 5px;">'+this.mainTitle+"</h1>",'<div cllass="rep-filters-class">'+this.filtersHtml+"</div>","<table>","<tr>",i,"</tr>",'<tpl for=".">','<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}">',j,"</tr>",k.join(""),"{% if (this.isGrouped && xindex > 0) break; %}","</tpl>",'<tpl if="this.hasSummary">',"<tr>",'<tpl for="this.columns">',"{[ this.renderSummary(values, xindex) ]}","</tpl>","</tr>","</tpl>","</table>","</body>","</html>",{isGrouped:c,grid:a,columns:e,hasSummary:Ext.isObject(n),summaryFeature:n,expanderTemplate:h,renderColumn:function(b,c,d,e){var f={align:b.align,cellIndex:e,classes:[],column:b,css:"",innerCls:"",record:d,recordIndex:a.store.indexOf?a.store.indexOf(d):void 0,style:"",tdAttr:"",tdCls:"",unselectableAttr:'unselectable="on"',value:c};return"templatecolumn"==b.xtype?c=b.tpl?b.tpl.apply(d.data):c:b.renderer&&(c=b instanceof Ext.tree.Column?b.renderer.call(b,c,f,d,-1,e-1,this.grid.store,this.grid.view):b.renderer.call(this.grid,c,f,d,-1,e-1,this.grid.store,this.grid.view)),this.getHtml(c,f)},applyTpl:function(a){var b=this.expanderTemplate.apply(a.data);return b},renderSummary:function(a,b){var c;if(this.summaryFeature.remoteRoot){var d=this.summaryFeature.summaryRecord||new this.grid.view.store.model(null,this.grid.view.id+"-summary-record");this.grid.view.store.proxy.reader.rawData&&d.set(Ext.isArray(this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot])?this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot][0]:this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot]),c=d.get(a.dataIndex)}else c=this.getSummary(this.grid.store,a.summaryType,a.dataIndex,!1);if(a.summaryRenderer){var e;if(Ext.getVersion().isLessThan("4.2.0"))return e=this.getSummaryObject(a.align),c=a.summaryRenderer.call(a,c,e,a.dataIndex),this.getHtml(c,e);var f=this.getSummaryRecord42();return e=this.getSummaryObject42(c,a,b,f),c=a.summaryRenderer.call(this.grid,c,e,f,-1,b,this.grid.store,this.grid.view),this.getHtml(c,e)}var g=this.getSummaryObject42(a,b);return void 0===c||0==c?this.getHtml("&nbsp;",g):this.getHtml(c,g)},getSummaryObject:function(a){for(var b={},c=0;c<e.length;c++){var d=this.getSummary(this.grid.store,this.columns[c].summaryType,this.columns[c].dataIndex,!1);void 0===d||(b[e[c].id]=d)}return b.style="text-align:"+a+";",b},getSummaryRecord42:function(){if(this.summaryFeature.remoteRoot){var a=this.summaryFeature.summaryRecord||new this.grid.view.store.model(null,this.grid.view.id+"-summary-record");return this.grid.view.store.proxy.reader.rawData&&a.set(Ext.isArray(this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot])?this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot][0]:this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot]),a}for(var b=Ext.create(this.grid.store.model),c=0;c<this.columns.length;c++){var d=this.getSummary(this.grid.store,this.columns[c].summaryType,this.columns[c].dataIndex,!1);void 0===d||b.set(this.columns[c].dataIndex,d)}return b},getSummaryObject42:function(a,b,c,d){return{align:b.align,cellIndex:c,column:b,classes:[],css:"",innerCls:"",record:d,recordIndex:-1,style:"",tdAttr:"",tdCls:"",unselectableAttr:'unselectable="on"',value:a}},getSummary:function(a,b,c,d){if(b){if(Ext.isFunction(b))return a.aggregate(b,null,d,[c]);switch(b){case"count":return a.count(d);case"min":return a.min(c,d);case"max":return a.max(c,d);case"sum":return a.sum(c,d);case"average":return a.average(c,d);default:return d?{}:""}}},getHtml:function(a,b){void 0==a&&(a="&nbsp;");var c="<td ",d="";return b.tdCls&&(d=b.tdCls),b.css&&(d.length>0?d+=" "+b.css:d=b.css),d.length>0&&(c+='class="'+d+'"'),b.tdAttr&&(c+=" "+b.tdAttr),c+="><div ",b.innerCls&&(c+='class="'+b.innerCls+'"'),c+=' style="text-align: '+b.align+";",b.style&&(c+=b.style),c+='" ',b.unselectableAttr&&(c+=b.unselectableAttr),c+=">"+a+"</div></td>"}}];a.store instanceof Ext.data.TreeStore?(l=[],a.store.getRootNode().cascadeBy(function(b){(!b.isRoot()||a.rootVisible)&&b.isVisible()&&l.push(b)},this)):l=a.store.getRange();var p=Ext.create("Ext.XTemplate",o).apply(l),q=window.open("","printgrid");q.document.open(),q.document.write(p),q.document.close()},getFeature:function(a,b){var c,d=a.getView();if(d.features?c=d.features:d.featuresMC?c=d.featuresMC.items:d.normalView.featuresMC&&(c=d.normalView.featuresMC.items),c)for(var e=0;e<c.length;e++){if("grouping"==b&&("grouping"==c[e].ftype||"groupingsummary"==c[e].ftype))return c[e];if("groupingsummary"==b&&"groupingsummary"==c[e].ftype)return c[e];if("summary"==b&&"summary"==c[e].ftype)return c[e]}return void 0},generateBody:function(a,b,c){var d,e,f=[],g=a.store.getProxy().getModel().getFields(),h=!0,i=this.getFeature(a,"groupingsummary");if(a instanceof Ext.grid.Panel&&(f=a.store.getGroups()),a.store.isGrouped()&&f&&f.length&&c){h=c.hideGroupedHeader,d=c.getGroupField();var j;if(Ext.each(a.columns,function(a){a.dataIndex==d&&(j=a)}),!c||!g||!d)return;if(h){var k=function(a){return a.name!=d};g=g.filter(k)}{c.groupHeaderTpl.html||""}if(Ext.getVersion().isGreaterThanOrEqual("5.0.0")){for(var l=[],m=0;m<f.getCount();m++){var n=f.getAt(m);l.push({name:n.getGroupKey(),children:n.getRange()})}f=l}var o=['<tpl for=".">','<tr class="group-header">','<td colspan="{[this.colSpan]}">',"{[ this.applyGroupTpl(values) ]}","</td>","</tr>",'<tpl for="children">','<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}">','<tpl for="this.columns">',"{[ this.renderColumn(values, parent.get(values.dataIndex), parent, xindex) ]}","</tpl>","</tr>","</tpl>",'<tpl if="this.hasSummary">',"<tr>",'<tpl for="this.columns">',"{[ this.renderSummary(values, xindex) ]}","</tpl>","</tr>","</tpl>","</tpl>",{columns:b,groupColumn:j,colSpan:b.length,grid:a,groupName:"",groupTpl:c.groupHeaderTpl,hasSummary:Ext.isObject(i)&&i.showSummaryRow,summaryFeature:i,childCount:function(a){return a.length},renderColumn:function(b,c,d,e){var f={align:b.align,cellIndex:e,classes:[],column:b,css:"",innerCls:"",record:d,recordIndex:a.store.indexOf(d),style:"",tdAttr:"",tdCls:"",unselectableAttr:'unselectable="on"',value:c};return b.renderer&&(c=b.renderer.call(this.grid,c,f,d,-1,e-1,this.grid.store,this.grid.view)),this.getHtml(c,f)},getHtml:function(a,b){void 0==a&&(a="&nbsp;");var c="<td ",d="";return b.tdCls&&(d=b.tdCls),b.css&&(d.length>0?d+=" "+b.css:d=b.css),d.length>0&&(c+='class="'+d+'"'),b.tdAttr&&(c+=" "+b.tdAttr),c+="><div ",b.innerCls&&(c+='class="'+b.innerCls+'"'),c+=' style="text-align: '+b.align+";",b.style&&(c+=b.style),c+='" ',b.unselectableAttr&&(c+=b.unselectableAttr),c+=">"+a+"</div></td>"},renderSummary:function(a,b){var c,d;if(this.summaryFeature.remoteRoot){var e=this.summaryFeature.summaryRecord||new this.grid.view.store.model(null,this.grid.view.id+"-summary-record");this.grid.view.store.proxy.reader.rawData&&e.set(Ext.isArray(this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot])?this.getSummaryRcd(this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot],this.grid.store.groupField,this.groupName):this.grid.view.store.proxy.reader.rawData[this.summaryFeature.remoteRoot]),c=e.get(a.dataIndex)}else c=this.getSummary(this.grid.store,a.summaryType,a.dataIndex,this.grid.store.isGrouped());if(Ext.isObject(c)&&(c=c[this.groupName]),a.summaryRenderer){if(!Ext.getVersion().isLessThan("4.2.0"))return d=this.getSummaryObject42(a,b),c=a.summaryRenderer.call(this.grid,c,this.getSummaryObject42(a,b),this.getSummaryRecord42(),-1,b,this.grid.store,this.grid.view),this.getHtml(c,d);c=a.summaryRenderer.call(a,c,this.getSummaryObject(a.align),a.dataIndex)}else(void 0==c||0==c)&&(c="&nbsp;");return"<td><div>"+c+"</div></td>"},applyGroupTpl:function(a){this.groupName=a.name,a.groupField=this.grid.store.groupField;var b={align:"",cellIndex:-1,classes:[],column:this.groupColumn,css:"",innerCls:"",record:a.children[0],recordIndex:this.grid.store.indexOf(a.children[0]),style:"",tdAttr:"",tdCls:"",unselectableAttr:'unselectable="on"',value:a.name};return a.columnName=this.groupColumn?this.groupColumn.text:this.groupField,a.groupValue=a.name,a.renderedGroupValue=this.groupColumn&&this.groupColumn.renderer?this.groupColumn.renderer.call(this.grid,a.name,b,a.children[0],-1,-1,this.grid.store,this.grid.view):a.name,this.groupTpl.apply(a)},getSummaryObject:function(a){for(var c={},d=0;d<this.columns.length;d++){var e=this.getSummary(this.grid.store,this.columns[d].summaryType,this.columns[d].dataIndex,this.grid.store.isGrouped());void 0===e||(c[b[d].id]=Ext.isObject(e)?e[this.groupName]:e)}return c.style="text-align:"+a+";",c},getSummaryRecord42:function(){for(var a=Ext.create(this.grid.store.model),b=0;b<this.columns.length;b++){var c=this.getSummary(this.grid.store,this.columns[b].summaryType,this.columns[b].dataIndex,this.grid.store.isGrouped());void 0===c||(Ext.isObject(c)?a.set(this.columns[b].dataIndex,c[this.groupName]):a.set(this.columns[b].dataIndex,c))
}return a},getSummaryObject42:function(a,b){return{align:a.align,cellIndex:b,classes:[],css:"",innerCls:"",record:this.getSummaryRecord42(),recordIndex:-1,style:"",tdAttr:"",tdCls:"",unselectableAttr:'unselectable="on"',value:"&#160;"}},getSummary:function(a,b,c,d){if(b){if(Ext.isFunction(b))return a.aggregate(b,null,d,[c]);switch(b){case"count":return a.count(d);case"min":return a.min(c,d);case"max":return a.max(c,d);case"sum":return a.sum(c,d);case"average":return a.average(c,d);default:return d?{}:""}}},getSummaryRcd:function(a,b,c){if(Ext.isArray(a)){for(var d=0;d<a.length;d++)if(a[d][b]&&a[d][b]==c)return a[d];return void 0}return a.data[b]?a:void 0}}];e=Ext.create("Ext.XTemplate",o).apply(f)}else{var o=['<tpl for="this.columns">',"{[ this.renderColumn(values, parent.get(values.dataIndex), parent, xindex) ]}","</tpl>"];e=o.join("")}return e},filtersHtml:"",stylesheetPath:null,printAutomatically:!1,closeAutomaticallyAfterPrint:!1,pageTitle:"Print View",mainTitle:"",mainLogo:"sites/default/logo-email.png",printLinkText:"Print",closeLinkText:"Close",headerTpl:['<tpl for=".">','<th style="text-align: {align}">{text}</th>',"</tpl>"],bodyTpl:['<tpl for="columns">',"{[ this.renderColumn(values, parent.get(values.dataIndex), parent, xindex) ]}","</tpl>"]}}),Ext.define("App.view.documents.windows.UploadAdministrativeDocument",{extend:"Ext.window.Window",xtype:"uploadadministrativedocumentwindow",draggable:!1,modal:!0,autoShow:!0,title:_("new_document"),items:[{xtype:"form",bodyPadding:10,width:400,defaults:{xtype:"textfield",anchor:"100%",labelWidth:70},items:[{fieldLabel:_("title"),name:"title"},{xtype:"gaiaehr.combo",listKey:"doc_type_admin_cat",fieldLabel:_("type"),name:"docTypeCode",allowBlank:!1,itemId:"adminDocTypeCatCombo"},{xtype:"container",layout:"hbox",items:[{xtype:"fileuploadfield",labelWidth:70,name:"document",buttonText:_("select"),fieldLabel:_("file"),allowBlank:!1,flex:1,itemId:"fileUploadField",margin:"0 5 0 0"},{xtype:"button",text:_("scan"),itemId:"scanBtn",hidden:!0}]},{xtype:"textareafield",name:"note",fieldLabel:_("notes")}]}],buttons:[{text:_("cancel"),handler:function(a){a.up("window").close()}},{text:_("upload"),itemId:"uploadBtn"}]}),Ext.define("App.model.administration.ReviewOfSystemSettings",{extend:"Ext.data.Model",table:{name:"review_of_system_settings"},fields:[{name:"id",type:"int"},{name:"user_id",type:"int",index:!0},{name:"settings_data",type:"array"}],proxy:{type:"direct",api:{read:"Encounter.getReviewOfSystemSettingsByUserId",create:"Encounter.saveReviewOfSystemSettings",update:"Encounter.saveReviewOfSystemSettings"},remoteGroup:!1}}),Ext.define("App.ux.LiveSnomedProblemSearch",{extend:"Ext.form.ComboBox",alias:"widget.snomedliveproblemsearch",hideLabel:!0,displayField:"Term",valueField:"ConceptId",emptyText:_("problem_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,initComponent:function(){var a=this;Ext.define("liveSnomedProblemSearchModel",{extend:"Ext.data.Model",fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string",defaultValue:"SNOMEDCT"},{name:"OCCURRENCE",type:"int"}],idProperty:"ConceptId",proxy:{type:"direct",api:{read:"SnomedCodes.liveProblemCodeSearch",update:"SnomedCodes.updateLiveProblemCodeSearch"},reader:{totalProperty:"totals",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveSnomedProblemSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{Term}<span style="font-weight: normal"> ({ConceptId}) </span></h3></div>'}},pageSize:25}),a.callParent(),a.on("select",function(a,b){b[0].set({OCCURRENCE:b[0].data.OCCURRENCE+1}),b[0].save()})}}),Ext.define("App.view.administration.HL7MessageViewer",{xtype:"hl7messageviewer",extend:"Ext.window.Window",title:_("hl7_viewer"),itemId:"HL7MessageViewerWindow",width:1200,maximizable:!0,modal:!0,layout:"fit",items:[{xtype:"form",itemId:"HL7MessageViewerForm",bodyPadding:10,border:!1,fieldDefaults:{labelAlign:"top",readOnly:!0,anchor:"100%"},items:[{xtype:"hiddenfield",name:"id"},{xtype:"hiddenfield",name:"isOutbound"},{xtype:"hiddenfield",name:"reference"},{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("type"),xtype:"textfield",name:"msg_type",margin:"0 5 0 0",flex:1},{fieldLabel:_("date"),xtype:"textfield",name:"date_processed",flex:1}]},{xtype:"fieldcontainer",layout:"hbox",items:[{fieldLabel:_("facility"),xtype:"textfield",name:"foreign_facility",margin:"0 5 0 0",flex:1},{fieldLabel:_("application"),xtype:"textfield",name:"foreign_application",flex:1}]},{xtype:"button",text:"Edit Message",itemId:"HL7MessageViewerMessageEditBtn",enableToggle:!0},{xtype:"textareafield",fieldLabel:"Editable Message",name:"raw_message",readOnly:!1,height:250,hidden:!0,itemId:"HL7MessageViewerRawMessageField"},{xtype:"htmleditor",fieldLabel:_("message"),name:"message",height:250,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableLists:!1,enableSourceEdit:!1,itemId:"HL7MessageViewerMessageField"},{xtype:"htmleditor",fieldLabel:_("acknowledge"),name:"response",readOnly:!0,height:100,enableAlignments:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableFormat:!1,enableLinks:!1,enableLists:!1,enableSourceEdit:!1},{xtype:"textareafield",fieldLabel:_("error"),name:"error",readOnly:!0,height:60}]}],buttons:[{text:_("resend"),itemId:"HL7MessageViewerWindowResendBtn"},{text:"<",itemId:"HL7MessageViewerWindowPreviousBtn"},{text:">",itemId:"HL7MessageViewerWindowNextBtn"},{text:_("close"),itemId:"HL7MessageViewerWindowCloseBtn"}]}),Ext.define("App.view.patient.windows.UploadDocument",{extend:"Ext.window.Window",xtype:"patientuploaddocumentwindow",draggable:!1,modal:!0,autoShow:!0,title:_("new_document"),items:[{xtype:"form",bodyPadding:10,width:400,defaults:{xtype:"textfield",anchor:"100%",labelWidth:70},items:[{fieldLabel:_("title"),name:"title"},{xtype:"gaiaehr.combo",fieldLabel:_("type"),list:102,name:"docTypeCode",allowBlank:!1},{xtype:"container",layout:"hbox",items:[{xtype:"fileuploadfield",labelWidth:70,name:"document",buttonText:_("select"),fieldLabel:_("file"),allowBlank:!1,flex:1,itemId:"fileUploadField",margin:"0 5 0 0"},{xtype:"button",text:_("scan"),itemId:"scanBtn",hidden:!0}]},{xtype:"textareafield",name:"note",fieldLabel:_("notes")}]}],buttons:[{text:_("cancel"),handler:function(a){a.up("window").close()}},{text:_("upload"),itemId:"uploadBtn"}]}),Ext.define("App.view.scanner.Window",{extend:"Ext.window.Window",xtype:"scannerwindow",itemId:"ScannerWindow",width:900,height:500,closeAction:"hide",title:_("scanner"),layout:"border",modal:!0,items:[{xtype:"panel",region:"west",width:150,split:!0,itemId:"ScannerImageDataViewPanel",autoScroll:!0,items:[{xtype:"dataview",itemId:"ScannerImageThumbsDataView",store:Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"src",type:"string"},{name:"archived",type:"bool"},{name:"style",type:"string"}]}),tpl:new Ext.XTemplate('<tpl for="."><div style="margin-bottom:10px;" class="thumb-wrap"><img width="100%" src="{src}" style="padding:10px;{style}" /></div></tpl>'),trackOver:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"No images to display"}],tbar:[{xtype:"combobox",itemId:"ScannerSourceCombo",editable:!1,queryMode:"local",displayField:"name",valueField:"id",flex:1,margin:1,store:Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"name",type:"string"}]})}]},{xtype:"panel",region:"center",itemId:"ScannerImageViewerPanel",layout:"anchor",autoScroll:!0,frame:!0,items:[{xtype:"image",anchor:"100%",style:"background-color:white",itemId:"ScannerImageViewer"}],tbar:[{text:_("scan"),itemId:"ScannerImageScanBtn",scale:"medium",width:100},"-","->","-",{text:_("edit"),enableToggle:!0,toggleGroup:"ScannerImageEditGroup",itemId:"ScannerImageEditBtn",scale:"medium",width:100}]}],buttons:[{text:_("close"),itemId:"ScannerImageCloseBtn"}]}),Ext.define("App.ux.LiveSnomedBodySiteSearch",{extend:"Ext.form.ComboBox",xtype:"snomedlivebodysitesearch",hideLabel:!0,displayField:"Term",valueField:"ConceptId",emptyText:_("body_site_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,initComponent:function(){var a=this;Ext.define("liveSnomedBodySiteSearchModel",{extend:"Ext.data.Model",fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string",defaultValue:"SNOMEDCT"},{name:"OCCURRENCE",type:"int"}],idProperty:"ConceptId",proxy:{type:"direct",api:{read:"SnomedCodes.liveBodySiteCodeSearch",update:"SnomedCodes.updateLiveBodySiteCodeSearch"},reader:{totalProperty:"totals",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveSnomedBodySiteSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{Term}<span style="font-weight: normal"> ({ConceptId}) </span></h3></div>'}},pageSize:25}),a.callParent(),a.on("select",function(a,b){b[0].set({OCCURRENCE:b[0].data.OCCURRENCE+1}),b[0].save()})}}),Ext.define("App.ux.LiveImmunizationNdcSearch",{extend:"Ext.form.ComboBox",xtype:"immunizationndclivesearch",hideLabel:!0,displayField:"UseUnitPropName",valueField:"NDC11",emptyText:_("immunization_search")+"...",typeAhead:!0,minChars:1,initComponent:function(){var a=this;Ext.define("liveImmunizationNdcSearchModel",{extend:"Ext.data.Model",fields:[{name:"NDCInnerID",type:"string"},{name:"CVXCode",type:"string"},{name:"CVXShortDescription",type:"string"},{name:"UseUnitPropName",type:"string"},{name:"UseUnitGenericName",type:"string"},{name:"UseUnitLabelerName",type:"string"},{name:"NoInner",type:"string"},{name:"NDC11",type:"string"},{name:"status",type:"string"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],idProperty:"NDCInnerID",proxy:{type:"direct",api:{read:"Immunizations.getImmunizationNDCLiveSearch"},reader:{totalProperty:"total",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveImmunizationNdcSearchModel",pageSize:10,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">NDC - {NDC11}: <span style="font-weight: normal;" class="list-status-{status}">{UseUnitPropName} ({CVXShortDescription})</span></div>'}},pageSize:10}),a.callParent()}}),Ext.define("App.view.patient.SmokingStatus",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","App.store.patient.SmokeStatus","App.ux.combo.SmokingStatus","App.ux.grid.DeleteColumn"],xtype:"patientsmokingstatusgrid",itemId:"PatientSmokingStatusGrid",columnLines:!0,store:Ext.create("App.store.patient.SmokeStatus",{remoteFilter:!0}),plugins:[{ptype:"rowediting"}],columns:[{xtype:"griddeletecolumn",acl:a("delete_smoking_status"),width:25},{text:_("status"),dataIndex:"status",width:250,renderer:function(a,b,c){return a+" ("+c.data.status_code+")"}},{text:_("counseling_given"),dataIndex:"counseling",width:120,editor:{xtype:"checkbox"},renderer:function(a){return app.boolRenderer(a)}},{text:_("cessation_counseling_type"),flex:1,dataIndex:"counseling_text",editor:{xtype:"gaiaehr.combo",listKey:"tobacco_use_cessation_counseling",displayField:"option_name",valueField:"option_name",itemId:"PatientSmokingStatusGridCounselingField",loadStore:!0}},{text:_("note"),dataIndex:"note",flex:1,editor:{xtype:"textfield"}},{xtype:"datecolumn",format:"Y-m-d",text:_("start_date"),dataIndex:"start_date",width:120,editor:{xtype:"datefield",format:g("date_display_format"),submitFormat:"Y-m-d"}},{xtype:"datecolumn",format:"Y-m-d",text:_("end_date"),dataIndex:"end_date",width:120,editor:{xtype:"datefield",format:g("date_display_format"),submitFormat:"Y-m-d"}}],tbar:[{xtype:"tbtext",text:_("smoking_status"),width:100},{xtype:"mitos.smokingstatuscombo",itemId:"socialsmokingstatuscombo",width:250}]}),Ext.define("App.ux.LiveSnomedSearch",{extend:"Ext.form.ComboBox",alias:"widget.snomedlivesearch",hideLabel:!0,displayField:"Term",valueField:"ConceptId",initComponent:function(){var a=this;Ext.define("liveSnomedSearchModel",{extend:"Ext.data.Model",fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string",defaultValue:"SNOMED"}],proxy:{type:"direct",api:{read:"SnomedCodes.liveCodeSearch"},reader:{totalProperty:"totals",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"liveSnomedSearchModel",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,emptyText:_("search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{Term}<span style="font-weight: normal"> ({ConceptId}) </span></h3></div>'}},pageSize:25}),a.callParent()}}),Ext.define("App.store.administration.MedicationInstructions",{extend:"Ext.data.Store",model:"App.model.administration.MedicationInstruction"}),Ext.define("App.view.administration.practice.Facilities",{extend:"Ext.grid.Panel",xtype:"facilitiespanel",title:_("facilities"),requires:["App.ux.combo.ServiceLocation","App.ux.form.fields.InputTextMask"],initComponent:function(){var a=this;Ext.apply(a,{store:a.store=Ext.create("App.store.administration.Facility"),columns:[{text:_("name"),flex:1,sortable:!0,dataIndex:"name"},{text:_("region"),width:100,sortable:!0,dataIndex:"region"},{text:_("phone"),width:100,sortable:!0,dataIndex:"phone"},{text:_("fax"),width:100,sortable:!0,dataIndex:"fax"},{text:_("city"),width:100,sortable:!0,dataIndex:"city"},{text:_("pos_code"),width:100,sortable:!0,dataIndex:"pos_code"},{text:_("ein"),width:100,sortable:!0,dataIndex:"ein"},{text:_("clia"),width:100,sortable:!0,dataIndex:"clia"},{text:_("fda"),width:100,sortable:!0,dataIndex:"fda"},{text:_("npi"),width:100,sortable:!0,dataIndex:"npi"},{text:_("tin"),width:100,sortable:!0,dataIndex:"ess"},{text:_("active"),sortable:!0,dataIndex:"active",renderer:function(a){return app.boolRenderer(a)},editor:{xtype:"checkboxfield"}}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,items:[{xtype:"container",layout:"column",defaults:{xtype:"container",padding:5,labelWidth:100,layout:"anchor",defaultType:"textfield"},items:[{defaults:{anchor:"100%"},columnWidth:.4,items:[{xtype:"textfield",fieldLabel:_("name"),name:"name",allowBlank:!1},{xtype:"textfield",fieldLabel:_("phone"),name:"phone",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")]},{xtype:"textfield",fieldLabel:_("fax"),name:"fax"},{xtype:"textfield",fieldLabel:_("address"),name:"address"},{xtype:"textfield",fieldLabel:_("address"),name:"address_cont"},{xtype:"textfield",fieldLabel:_("city"),name:"city"},{xtype:"textfield",fieldLabel:_("state"),name:"state"},{xtype:"textfield",fieldLabel:_("postal_code"),name:"postal_code"},{xtype:"textfield",fieldLabel:_("country_code"),name:"country_code"},{xtype:"textfield",name:"facility_entity",width:100,fieldLabel:_("entity")},{xtype:"gaiaehr.combo",fieldLabel:_("region"),editable:!1,listKey:"regions",name:"region"}]},{defaults:{anchor:"100%"},columnWidth:.4,items:[{xtype:"fieldcontainer",layout:"hbox",items:[{xtype:"textfield",fieldLabel:_("contact")+" "+_("name"),flex:2,name:"lname",margin:"0 10 0 0"},{xtype:"textfield",name:"fname",labelWidth:30,fieldLabel:_("first"),flex:1,margin:"0 10 0 0"},{xtype:"textfield",name:"mname",flex:1,labelWidth:40,fieldLabel:_("middle"),width:20}]},{xtype:"textfield",fieldLabel:_("ess"),name:"ess"},{xtype:"textfield",fieldLabel:_("ein"),name:"ein"},{fieldLabel:"PO "+_("address"),name:"postal_address"},{fieldLabel:"PO "+_("address"),name:"postal_address_cont"},{fieldLabel:"PO "+_("city"),name:"postal_city"},{fieldLabel:"PO "+_("state"),name:"postal_state"},{fieldLabel:"PO "+_("postal_code"),name:"postal_zip_code"},{fieldLabel:"PO "+_("country_code"),name:"postal_country_code"}]},{defaults:{anchor:"100%"},columnWidth:.2,items:[{fieldLabel:_("billing_attn"),name:"attn",anchor:"100%"},{xtype:"mitos.poscodescombo",fieldLabel:_("pos_code"),name:"pos_code",anchor:"100%"},{xtype:"servicelocationcombo",fieldLabel:_("service_location"),name:"service_loc_code",anchor:"100%"},{fieldLabel:_("clia_number"),name:"clia",anchor:"100%"},{fieldLabel:_("npi"),name:"npi",anchor:"100%"},{fieldLabel:_("fda_number"),name:"fda",anchor:"100%"},{xtype:"checkbox",fieldLabel:_("active"),name:"active"},{xtype:"checkbox",fieldLabel:_("billing_location"),name:"billing_location"},{xtype:"textfield",fieldLabel:_("external_id"),name:"external_id"},{xtype:"textfield",fieldLabel:_("global_id"),name:"global_id"}]}]}]}),tbar:Ext.create("Ext.PagingToolbar",{pageSize:30,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager",{}),items:["-",{text:_("add_new_facility"),iconCls:"save",scope:a,handler:a.addFacility},"-",{text:_("show_active_facilities"),action:"active",scope:a,handler:a.filterFacilitiesby},"-",{text:_("show_inactive_facilities"),action:"inactive",scope:a,handler:a.filterFacilitiesby}]})}),a.callParent(arguments)},filterFacilitiesby:function(a){this.store.load({filters:[{property:"active",value:"active"==a.action?1:0}]})},addFacility:function(){var a=this,b=a,c=b.store;b.editingPlugin.cancelEdit(),c.insert(0,{active:1,service_location:1,billing_location:0,accepts_assignment:0}),b.editingPlugin.startEdit(0,0)}}),Ext.define("App.view.administration.practice.ReferringProviders",{extend:"Ext.grid.Panel",xtype:"referringproviderspanel",requires:["Ext.ux.SlidingPager","App.ux.grid.ColumnSearchField"],title:_("referring_providers"),initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.ReferringProviders",{autoSync:!1,remoteSort:!0,remoteFilter:!0,sorters:[{property:"lname",direction:"ASC"}]}),Ext.apply(a,{columns:[{width:200,text:_("name"),sortable:!0,dataIndex:"lname",renderer:function(a,b,c){return c.data.title+" "+c.data.lname+", "+c.data.fname+" "+c.data.mname},items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{width:200,text:_("email"),sortable:!0,dataIndex:"email",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{width:100,text:_("npi"),sortable:!0,dataIndex:"npi",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{flex:1,text:_("cell_number"),sortable:!0,dataIndex:"cel_number",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{flex:1,text:_("fax_number"),sortable:!0,dataIndex:"fax_number",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{flex:1,text:_("aditional_info"),sortable:!0,dataIndex:"notes"},{flex:1,text:_("authy_id"),sortable:!0,dataIndex:"authy_id"},{text:_("authorized"),sortable:!0,dataIndex:"authorized",renderer:a.boolRenderer},{text:_("active"),sortable:!0,dataIndex:"active",renderer:a.boolRenderer}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:_("referring_provider"),iconCls:"icoAdd",itemId:"referringProviderAddBtn"},"->",{xtype:"button",text:_("authy_register"),itemId:"ReferringProviderAuthyRegisterBtn"},"-",{xtype:"button",text:_("referring_provider"),iconCls:"icoAdd",itemId:"referringProviderAddBtn"}]},{xtype:"pagingtoolbar",dock:"bottom",pageSize:25,store:a.store,displayInfo:!0,plugins:Ext.create("Ext.ux.SlidingPager")}]}),a.callParent(arguments)}}),Ext.define("App.view.administration.practice.Practice",{extend:"App.ux.RenderPanel",xtype:"practicepanel",pageTitle:_("practice_settings"),requires:["App.view.administration.practice.Facilities","App.view.administration.practice.FacilityConfig","App.view.administration.practice.Laboratories","App.view.administration.practice.Pharmacies","App.view.administration.practice.ReferringProviders","App.view.administration.practice.DecisionAids"],pageBody:[{xtype:"tabpanel",activeTab:0,items:[{xtype:"pharmaciespanel"},{xtype:"laboratoriespanel"},{xtype:"insurancecompaniespanel"},{xtype:"referringproviderspanel"},{xtype:"facilitiespanel"},{xtype:"facilityconfigpanel"},{xtype:"decisionaidspanel"}]}]}),Ext.define("App.view.administration.Documents",{extend:"App.ux.RenderPanel",pageTitle:_("document_template_editor"),pageLayout:"border",requires:["App.ux.grid.Button","Ext.grid.Panel"],itemId:"AdministrationDocuments",initComponent:function(){var a=this;a.templatesDocumentsStore=Ext.create("App.store.administration.DocumentsTemplates"),a.defaultsDocumentsStore=Ext.create("App.store.administration.DefaultDocuments"),a.DocumentsDefaultsGrid=Ext.create("Ext.grid.Panel",{title:_("documents_defaults"),frame:!0,store:a.defaultsDocumentsStore,hideHeaders:!0,flex:1,itemId:"AdministrationDocumentsDefaultsGrid",columns:[{flex:1,sortable:!0,dataIndex:"title",editor:{xtype:"textfield",allowBlank:!1}},{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveDocument}],listeners:{scope:a,itemclick:a.onDocumentsGridItemClick},tbar:["->",{text:_("add"),scope:a,handler:a.newDefaultTemplates,itemId:"AdministrationDocumentsNewDefaulTemplateBtn"}],plugins:[a.rowEditor3=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:2})]}),a.DocumentsGrid=Ext.create("Ext.grid.Panel",{title:_("document_templates"),frame:!0,store:a.templatesDocumentsStore,hideHeaders:!0,flex:1,itemId:"AdministrationDocumentsTemplatesGrid",columns:[{flex:1,sortable:!0,dataIndex:"title",editor:{xtype:"textfield",allowBlank:!1}},{icon:"resources/images/icons/delete.png",tooltip:_("remove"),scope:a,handler:a.onRemoveDocument}],listeners:{scope:a,itemclick:a.onDocumentsGridItemClick},tbar:["->",{text:_("add"),scope:a,itemId:"AdministrationDocumentsNewTemplateBtn"}],plugins:[a.rowEditor=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:2})]}),a.LeftCol=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},region:"west",width:250,border:!1,split:!0,items:[a.DocumentsDefaultsGrid,a.DocumentsGrid,{xtype:"grid",title:_("pdf_templates"),itemId:"AdministrationDocumentsPdfTemplatesGrid",store:Ext.create("App.store.administration.DocumentsPdfTemplates"),flex:1,frame:!0,hideHeaders:!0,columns:[{flex:1,dataIndex:"template"}],tbar:["->",{xtype:"button",text:_("add"),itemId:"AdministrationDocumentsPdfTemplatesAddBtn"}]}]}),a.TeamplateEditor=Ext.create("Ext.form.Panel",{title:_("document_editor"),region:"center",layout:"fit",autoScroll:!1,border:!0,split:!0,hideHeaders:!0,itemId:"AdministrationDocumentsTemplatesEditorForm",items:{xtype:"htmleditor",enableFontSize:!1,name:"body",margin:5},buttons:[{text:_("save"),scope:a,handler:a.onSaveEditor},{text:_("cancel"),scope:a,handler:a.onCancelEditor}]}),a.TokensGrid=Ext.create("Ext.grid.Panel",{title:_("available_tokens"),region:"east",width:250,border:!0,split:!0,hideHeaders:!0,store:Ext.create("App.store.administration.DocumentToken"),disableSelection:!0,itemId:"AdministrationDocumentsTokensGrid",viewConfig:{stripeRows:!1},plugins:[{ptype:"cellediting"}],columns:[{flex:1,sortable:!1,dataIndex:"token",editor:{xtype:"textfield",editable:!1,itemId:"AdministrationDocumentsTokenTextField"}},{xtype:"actioncolumn",width:50,items:[{icon:"resources/images/icons/copy.png",tooltip:_("copy"),margin:"0 5 0 0",handler:function(a,b,c,d,e,f){app.getController("administration.Documents").doCopy(a,f)}}]}]}),a.pageBody=[a.LeftCol,a.TeamplateEditor,a.TokensGrid],a.callParent()},onDelete:function(){},onTokensGridItemClick:function(){},onSaveEditor:function(){var a=this,b=a.down("form").getForm(),c=b.getRecord(),d=b.getValues();c.set(d),app.msg(_("sweet"),_("record_saved"))},onCancelEditor:function(){var a=this,b=a.down("form").getForm(),c=a.DocumentsGrid;b.reset(),c.getSelectionModel().deselectAll()},onDocumentsGridItemClick:function(a,b){var c=this,d=c.down("form").getForm();d.loadRecord(b)},newDocumentTemplate:function(){var a=this,b=a.templatesDocumentsStore;a.rowEditor.cancelEdit(),b.insert(0,{title:_("new_document"),template_type:"documenttemplate",date:new Date,type:1}),a.rowEditor.startEdit(0,0)},newDefaultTemplates:function(){var a=this,b=a.defaultsDocumentsStore;a.rowEditor3.cancelEdit(),b.insert(0,{title:_("new_defaults"),template_type:"defaulttemplate",date:new Date,type:1}),a.rowEditor3.startEdit(0,0)},copyToClipBoard:function(a,b){{var c=a.getStore().getAt(b);c.get("token")}},onRemoveDocument:function(){},onActive:function(a){var b=this;b.templatesDocumentsStore.load(),b.defaultsDocumentsStore.load(),a(!0)}}),Ext.define("App.view.administration.Roles",{extend:"App.ux.RenderPanel",requires:["App.ux.combo.XCombo","Ext.grid.plugin.CellEditing","Ext.ux.DataTip"],itemId:"AdministrationRolePanel",pageTitle:_("roles_and_permissions"),pageBody:[{xtype:"gridlivesearch",bodyStyle:"background-color:white",itemId:"AdministrationRoleGrid",frame:!0,columnLines:!0,searchBuffer:500,filterStore:!0,tbar:[{xtype:"xcombo",emptyText:_("select"),labelWidth:50,width:250,valueField:"id",displayField:"title",queryMode:"local",store:Ext.create("App.store.administration.AclGroups"),itemId:"AdministrationRoleGroupCombo",windowConfig:{title:_("add_group")},formConfig:{border:!1,bodyPadding:10,items:[{xtype:"textfield",fieldLabel:_("group_name"),name:"title"},{xtype:"checkbox",fieldLabel:_("active"),name:"active"}]}},"-","->",{xtype:"button",text:_("print"),itemId:"AdministrationRoleGridPrintBtn"},"-",{xtype:"button",text:_("add_role"),iconCls:"icoAdd",action:"adminAclAddRole"},"-"],features:[{ftype:"grouping"}],plugins:[{ptype:"cellediting",clicksToEdit:1},{ptype:"datatip",tpl:_("click_to_edit")}],columns:[{text:"Permission",width:250}]}],pageButtons:[{text:_("refresh"),itemId:"AdministrationRoleRefreshBtn"},"->",{text:_("cancel"),cls:"cancelBtn",action:"adminAclCancel"},"-",{text:_("save"),cls:"saveBtn",action:"adminAclSave"}]}),Ext.define("App.view.administration.Users",{extend:"App.ux.RenderPanel",requires:["App.ux.form.fields.plugin.PasswordStrength","App.ux.combo.ActiveSpecialties","App.ux.combo.Departments","App.ux.grid.exporter.Exporter","App.ux.form.fields.InputTextMask"],pageTitle:_("users"),itemId:"AdminUsersPanel",initComponent:function(){var a=this;a.userStore=Ext.create("App.store.administration.User",{remoteFilter:!0,remoteSort:!0,autoSync:!1,pageSize:100}),a.userGrid=Ext.create("Ext.grid.Panel",{itemId:"AdminUserGridPanel",store:a.userStore,columns:[{text:"id",sortable:!1,dataIndex:"id",width:50},{width:150,text:_("code"),sortable:!0,dataIndex:"code",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{width:150,text:_("username"),sortable:!0,dataIndex:"username",items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{width:200,text:_("name"),sortable:!0,dataIndex:"lname",renderer:function(a,b,c){return c.get("fullname")},items:[{xtype:"columnsearchfield",autoSearch:!0,operator:"LIKE",suffix:"%"}]},{flex:1,text:_("role"),sortable:!1,dataIndex:"role"},{flex:1,text:_("department"),sortable:!1,dataIndex:"department"},{flex:1,text:_("aditional_info"),sortable:!0,dataIndex:"notes"},{text:_("authy_id"),sortable:!0,dataIndex:"authy_id"},{text:_("active"),sortable:!0,dataIndex:"active",renderer:a.boolRenderer},{text:_("authorized"),sortable:!0,dataIndex:"authorized",renderer:a.boolRenderer},{text:_("is_attending"),sortable:!0,dataIndex:"is_attending",renderer:a.boolRenderer},{text:_("is_resident"),sortable:!0,dataIndex:"is_resident",renderer:a.boolRenderer}],plugins:[a.formEditing=Ext.create("App.ux.grid.RowFormEditing",{clicksToEdit:2,items:[{xtype:"tabpanel",items:[{title:_("general"),itemId:"UserGridEditFormContainer",layout:"hbox",items:[{xtype:"container",itemId:"UserGridEditFormContainerLeft",items:[{width:250,xtype:"textfield",fieldLabel:_("code"),name:"code",allowBlank:!1,validateOnBlur:!0,margin:"0 0 5 0",labelAlign:"right"},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldDefaults:{labelAlign:"right"},items:[{width:250,xtype:"textfield",fieldLabel:_("username"),name:"username",allowBlank:!1,validateOnBlur:!0,vtype:"usernameField"},{width:200,labelWidth:60,xtype:"textfield",fieldLabel:_("password"),name:"password",inputType:"password",vtype:"strength",strength:24,plugins:{ptype:"passwordstrength"}},{width:100,xtype:"checkbox",boxLabel:_("force_reset"),name:"password_force_reset"},{width:125,labelWidth:40,xtype:"textfield",fieldLabel:_("pin"),name:"pin",inputType:"password"}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldDefaults:{labelAlign:"right"},fieldLabel:_("name"),items:[{width:50,xtype:"mitos.titlescombo",name:"title"},{width:145,xtype:"textfield",name:"fname",allowBlank:!1},{width:100,xtype:"textfield",name:"mname"},{width:175,xtype:"textfield",name:"lname"}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldDefaults:{labelAlign:"right"},items:[{width:125,xtype:"checkbox",fieldLabel:_("active"),name:"active"},{width:100,labelWidth:85,xtype:"checkbox",fieldLabel:_("authorized"),name:"authorized"},{width:100,labelWidth:85,xtype:"checkbox",fieldLabel:_("calendar_q"),name:"calendar"},{width:250,labelWidth:50,xtype:"gaiaehr.combo",fieldLabel:_("type"),name:"doctor_type",list:121,loadStore:!0}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldDefaults:{labelAlign:"right"},items:[{width:280,xtype:"mitos.facilitiescombo",fieldLabel:_("default_facility"),name:"facility_id",allowBlank:!1}]},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldDefaults:{labelAlign:"right"},items:[{width:280,xtype:"depatmentscombo",fieldLabel:_("department"),name:"department_id",allowBlank:!1},{width:300,xtype:"mitos.rolescombo",fieldLabel:_("access_control"),name:"role_id",allowBlank:!1}]}]},{xtype:"container",itemId:"UserGridEditFormContainerRight",items:[]}]},{xtype:"panel",title:_("contact_info"),itemId:"UserGridEditFormContactInfoPanel",layout:"column",bodyPadding:10,items:[{xtype:"fieldset",title:_("address"),margin:"0 10 0 0",padding:5,defaults:{margin:"0 0 5 0",width:300},items:[{xtype:"textfield",fieldLabel:_("address"),name:"street"},{xtype:"textfield",fieldLabel:_("address_cont"),name:"street_cont"},{xtype:"textfield",fieldLabel:_("city"),name:"city"},{xtype:"textfield",fieldLabel:_("state"),name:"state"},{xtype:"textfield",fieldLabel:_("postal_code"),name:"postal_code"},{xtype:"textfield",fieldLabel:_("country_code"),name:"country_code"}]},{xtype:"fieldset",title:_("phone")+" / "+_("email"),padding:5,defaults:{margin:"0 0 5 0",width:300},items:[{xtype:"textfield",fieldLabel:_("home"),name:"phone",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")]},{xtype:"textfield",fieldLabel:_("mobile"),name:"mobile"},{xtype:"textfield",fieldLabel:_("email"),name:"email",vtype:"email"}]}]},{xtype:"panel",title:_("provider"),itemId:"UserGridEditFormProviderPanel",layout:"hbox",items:[{xtype:"fieldcontainer",itemId:"UserGridEditFormProviderPanelLeft",fieldDefaults:{labelAlign:"right",width:500,margin:"0 0 5 0"},margin:"20 10 0 0",items:[{xtype:"checkbox",fieldLabel:_("is_attending"),name:"is_attending"},{xtype:"checkbox",fieldLabel:_("is_resident"),name:"is_resident"},{xtype:"textfield",fieldLabel:_("federal_tax_id"),name:"fedtaxid"},{xtype:"textfield",fieldLabel:_("fed_drug_id"),name:"feddrugid"},{xtype:"textfield",fieldLabel:_("state_drug_id"),name:"statedrugid"},{xtype:"textfield",fieldLabel:_("lic"),name:"lic"},{xtype:"textfield",fieldLabel:_("npi"),name:"npi",maxLength:10,vtype:"npi"},{xtype:"textfield",fieldLabel:_("tin"),name:"ess"},{xtype:"activespecialtiescombo",fieldLabel:_("specialties"),name:"specialty",margin:"5 0",labelAlign:"right",multiSelect:!0},{xtype:"textfield",fieldLabel:_("additional_info"),name:"notes",labelAlign:"right"},{xtype:"textfield",fieldLabel:_("signature"),name:"signature",labelAlign:"right"}]},{xtype:"grid",title:_("provider_credentialization"),itemId:"UserGridEditFormProviderCredentializationGrid",flex:1,maxHeight:210,frame:!0,store:Ext.create("App.store.administration.ProviderCredentializations",{pageSize:1e3}),plugins:[{ptype:"cellediting"}],tools:[{xtype:"button",text:_("active_all"),icon:"resources/images/icons/yes.png",margin:"0 5 0 0",itemId:"UserGridEditFormProviderCredentializationActiveBtn"},{xtype:"button",text:_("inactive_all"),icon:"resources/images/icons/no.png",itemId:"UserGridEditFormProviderCredentializationInactiveBtn"}],columns:[{text:_("insurance"),width:150,dataIndex:"insurance_company_id",renderer:function(a,b,c){return c.data.insurance_company_id+": "+c.data.insurance_company_name
}},{xtype:"datecolumn",format:g("date_display_format"),text:_("start"),dataIndex:"start_date",editor:{xtype:"datefield"}},{xtype:"datecolumn",format:g("date_display_format"),text:_("end"),dataIndex:"end_date",editor:{xtype:"datefield"}},{text:_("note"),dataIndex:"credentialization_notes",flex:1,editor:{xtype:"textfield"}},{text:_("active"),dataIndex:"active",renderer:app.boolRenderer}]}]}]}]})],tbar:[{xtype:"button",text:_("user"),iconCls:"icoAdd",scope:a,handler:a.onNewUser},"-",{xtype:"button",text:"LDAP Sync",itemId:"AdminUserGridPanelLDAPSyncBtn",acl:g("ldap_enabled")},"-","->","-",{xtype:"button",text:_("authy_register"),itemId:"AdminUserGridPanelAuthyRegisterBtn"},"-",{xtype:"button",text:_("print"),iconCls:"icoPrint",itemId:"AdminUserGridPanelPrintBtn"},"-",{xtype:"exporterbutton",text:"Save As CSV"},"-",{xtype:"exporterbutton",text:"Save As XLS",format:"excel"}],bbar:{xtype:"pagingtoolbar",pageSize:1e3,store:a.userStore,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.userGrid],a.callParent(arguments)},onNewUser:function(){var a=this;a.formEditing.cancelEdit(),a.userStore.insert(0,{create_date:new Date,update_date:new Date,create_uid:app.user.id,update_uid:app.user.id,active:1,authorized:0,calendar:0}),a.formEditing.startEdit(0,0)},onActive:function(a){this.userStore.load(),a(!0)}}),Ext.define("App.view.miscellaneous.MyAccount",{extend:"App.ux.RenderPanel",pageTitle:_("my_account"),requires:["App.ux.combo.Titles","App.ux.window.Window","App.ux.combo.Facilities","App.ux.combo.ActiveSpecialties","App.ux.form.fields.plugin.PasswordStrength"],initComponent:function(){var a=this;a.store=Ext.create("App.store.miscellaneous.Users"),a.myAccountForm=Ext.create("App.ux.form.Panel",{cls:"form-white-bg",frame:!0,hideLabels:!0,defaults:{labelWidth:89,layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"fieldset",title:_("personal_info"),defaultType:"textfield",layout:"anchor",defaults:{labelWidth:89,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{xtype:"fieldcontainer",defaults:{hideLabel:!0},msgTarget:"under",items:[{width:110,xtype:"displayfield",value:"First, Middle, Last: "},{width:55,xtype:"mitos.titlescombo",name:"title"},{width:105,xtype:"textfield",name:"fname"},{width:100,xtype:"textfield",name:"mname"},{width:175,xtype:"textfield",name:"lname"}]}]},{xtype:"fieldset",title:_("login_info"),defaultType:"textfield",layout:"anchor",defaults:{labelWidth:89,anchor:"100%",layout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}}},items:[{xtype:"fieldcontainer",defaults:{hideLabel:!0},msgTarget:"under",items:[{width:110,xtype:"displayfield",value:"Username: "},{width:170,xtype:"textfield",name:"username"},{width:100,xtype:"displayfield",value:"Password: "},{width:175,xtype:"textfield",name:"password",inputType:"password",disabled:!0},{width:50,xtype:"displayfield",value:"PIN: "},{width:50,xtype:"textfield",name:"pin"}]}]}],tbar:[{text:_("change_password"),iconCls:"save",scope:a,handler:a.onPasswordChange}],buttons:[{text:_("save"),iconCls:"save",scope:a,handler:a.onSaveClick}]}),a.win=Ext.create("App.ux.window.Window",{width:420,title:_("change_you_password"),items:[{xtype:"form",bodyPadding:15,defaultType:"textfield",defaults:{labelWidth:130,width:380,inputType:"password"},items:[{name:"id",hidden:!0},{fieldLabel:_("old_password"),name:"oPassword",allowBlank:!1},{fieldLabel:_("new_password"),name:"nPassword",allowBlank:!1,id:"myAccountPage_nPassword",vtype:"strength",strength:24,plugins:{ptype:"passwordstrength"}},{fieldLabel:_("re_type_password"),name:"vPassword",allowBlank:!1,vtype:"password",initialPassField:"myAccountPage_nPassword",validateOnChange:!0}]}],buttons:[{text:_("save"),scope:a,handler:a.onPasswordSave},{text:_("cancel"),scope:a,handler:a.onCancel}],listeners:{scope:a,close:a.onClose}}),a.pageBody=[a.myAccountForm],a.callParent(arguments)},onPasswordSave:function(){var a,b=this,c=b.win.down("form").getForm(),d=c.getValues(),e=b.myAccountForm.getForm().getRecord().data.id;return d.nPassword!=d.vPassword?void app.msg(_("oops"),_("password_does_not_match"),!0):void(c.isValid()&&(a={id:e,old_password:d.oPassword,new_password:d.nPassword},User.updatePassword(a,function(a,c){c.result.success?(app.msg(_("sweet"),_("record_updated")),b.win.close()):app.msg(_("oops"),_(c.result.message),!0)})))},onPasswordChange:function(){this.win.show()},onCancel:function(){this.win.close()},onClose:function(){this.win.down("form").getForm().reset()},onSaveClick:function(){var a=this,b=a.myAccountForm.getForm(),c=b.getRecord(),d=b.getValues();c.set(d),c.save({callback:function(){app.msg(_("sweet"),_("record_update"))}})},onActive:function(a){var b=this,c=b.myAccountForm.getForm();this.store.load({callback:function(a){c.loadRecord(a[0])}}),a(!0)}}),Ext.define("App.controller.administration.Roles",{extend:"Ext.app.Controller",requires:["App.model.administration.AclGroupPerm","App.ux.grid.Printer"],refs:[{ref:"AdministrationRoleGroupCombo",selector:"#AdministrationRoleGroupCombo"},{ref:"AdministrationRoleGrid",selector:"#AdministrationRoleGrid"}],init:function(){this.control({"#AdministrationRolePanel":{render:this.onAdministrationRolePanelRender},"#AdministrationRoleGrid":{beforeedit:this.beforeCellEdit},"#AdministrationRoleGroupCombo":{select:this.doAdministrationRoleGridReconfigure},"button[action=adminAclAddRole]":{click:this.doAddRole},"button[action=adminAclSave]":{click:this.doSaveAcl},"button[action=adminAclCancel]":{click:this.doCancelAcl},"#AdministrationRoleGridPrintBtn":{click:this.onAdministrationRoleGridPrintBtnClick},"#AdministrationRoleRefreshBtn":{click:this.onAdministrationRoleRefreshBtnClick}})},onAdministrationRoleRefreshBtnClick:function(){var a=this.getAdministrationRoleGrid(),b=a.getStore();a.view.el.mask("Loading"),ACL.getGroupPerms({group_id:a.group_id},function(c){b.loadRawData(c.data),a.view.el.unmask()})},onAdministrationRoleGridPrintBtnClick:function(){App.ux.grid.Printer.print(this.getAdministrationRoleGrid())},onAdministrationRolePanelRender:function(){var a=this,b=a.getAdministrationRoleGroupCombo(),c=b.getStore();c.load({callback:function(c){b.select(c[0]),a.doAdministrationRoleGridReconfigure()}})},doSaveAcl:function(){var a=this,b=this.getAdministrationRoleGrid().getStore();b.getUpdatedRecords().length>0&&a.getAdministrationRoleGrid().el.mask(_("saving")),b.sync({callback:function(){app.msg(_("sweet"),_("record_saved")),a.getAdministrationRoleGrid().el.unmask()}})},doCancelAcl:function(){this.getAdministrationRoleGrid().getStore().rejectChanges()},beforeCellEdit:function(a,b){return"title"!=b.field},doAdministrationRoleGridReconfigure:function(){var a,b=this,c=b.getAdministrationRoleGroupCombo(),d=c.getValue(),e=b.getAdministrationRoleGrid(),f=[{name:"id",type:"int"},{name:"title",type:"string"},{name:"group_id",type:"int"},{name:"category",type:"string"}];e.view.el.mask("Loading"),e.group_id=d,ACL.getGroupPerms({group_id:d},function(c){a=c.columns,f=f.concat(c.fields),b.getModel("administration.AclGroupPerm").setFields(f);var d=Ext.create("Ext.data.Store",{model:"App.model.administration.AclGroupPerm",groupField:"category"});d.loadRawData(c.data);for(var g=0;g<a.length;g++)a[g].editor={xtype:"checkbox"},a[g].renderer=app.boolRenderer;a.push({flex:1}),e.reconfigure(d,a),e.view.el.unmask()})},doAddRole:function(){var a=this,b=Ext.create("App.model.administration.AclRoles",{group_id:a.getAdministrationRoleGroupCombo().getValue()});a.getRoleWindow().show(),a.roleWindow.down("form").getForm().loadRecord(b)},doSaveRole:function(){var a=this,b=a.roleWindow.down("form"),c=b.getForm(),d=c.getRecord(),e=c.getValues();c.isValid()&&(b.el.mask(_("be_right_back")),d.set(e),d.save({callback:function(){a.doAdministrationRoleGridReconfigure(),b.el.unmask(),a.roleWindow.close()}}))},doCancelRole:function(){this.roleWindow.close()},getRoleWindow:function(){var a=this;return a.roleWindow=Ext.widget("window",{title:_("new_role"),items:[{xtype:"form",border:!1,bodyPadding:10,items:[{xtype:"textfield",fieldLabel:_("role_name"),name:"role_name",allowBlank:!1},{xtype:"checkbox",fieldLabel:_("active"),name:"active"}]}],buttons:[{text:_("cancel"),cls:"cancelBtn",scope:a,handler:a.doCancelRole,action:"adminAclRoleCancel"},{text:_("save"),cls:"saveBtn",scope:a,handler:a.doSaveRole,action:"adminAclRoleSave"}]}),a.roleWindow}}),Ext.define("App.controller.documents.AdministrativeDocuments",{extend:"Ext.app.Controller",requires:["App.view.documents.windows.UploadAdministrativeDocument"],refs:[{ref:"AdministrativeDocumentPanel",selector:"administrativedocumentspanel"},{ref:"AdministrativeDocumentGrid",selector:"administrativedocumentspanel #AdministrativeDocumentGrid"},{ref:"AdministrativeDocumentViewerFrame",selector:"administrativedocumentspanel #AdministrativeDocumentViewerFrame"},{ref:"AdministrativeDocumentUploadWindow",selector:"#AdministrativeDocumentUploadWindow"},{ref:"AdministrativeDocumentUploadScanBtn",selector:"#AdministrativeDocumentUploadWindow #scanBtn"},{ref:"AdministrativeDocumentUploadFileUploadField",selector:"#AdministrativeDocumentUploadWindow #fileUploadField"},{ref:"AdministrativeDocumentHashCheckBtn",selector:"#AdministrativeDocumentHashCheckBtn"},{ref:"AdministrativeDocumentHashCheckBtn",selector:"#AdministrativeDocumentHashCheckBtn"},{ref:"AddAdministrativeDocumentBtn",selector:"administrativedocumentspanel #AddAdministrativeDocumentBtn"},{ref:"AdministrativeDocumentUploadBtn",selector:"administrativedocumentspanel #AdministrativeDocumentUploadBtn"},{ref:"AdministrativeDocumentUploadBtn",selector:"administrativedocumentspanel #AdministrativeDocumentUploadBtn"},{ref:"AdministrativeDocumentScanBtn",selector:"administrativedocumentspanel #AdministrativeDocumentScanBtn"},{ref:"AdministrativeDocumentErrorNoteWindow",selector:"administrativedocumenterrornotewindow"},{ref:"AdministrativeDocumentViewerOpacityField",selector:"AdministrativeDocumentViewerOpacityField"},{ref:"AdministrativeDocumentWindow",selector:"#AdministrativeDocumentWindow"}],scannedDocument:null,init:function(){var a=this;a.control({viewport:{browserhelperopen:a.onBrowserHelperOpen,browserhelperclose:a.onBrowserHelperClose,documentedit:a.onAdministrativeDocumentEdit},administrativedocumentspanel:{activate:a.onAdministrativeDocumentPanelActive,beforerender:a.onAdministrativeDocumentBeforeRender},"administrativedocumentspanel #AdministrativeDocumentGrid":{selectionchange:a.onAdministrativeDocumentGridSelectionChange,afterrender:a.onAdministrativeDocumentGridAfterRender,beforerender:a.onAdministrativeDocumentGridBeforeRender,beforeitemcontextmenu:a.onAdministrativeDocumentGridBeforeItemContextMenu},"administrativedocumentspanel #administrativeDocumentGrid gridview":{beforedrop:a.onAdministrativeDocumentGridViewBeforeDrop,drop:a.onAdministrativeDocumentGridViewDrop},"administrativedocumentspanel [toggleGroup=administrativedocumentgridgroup]":{toggle:a.onAdministrativeDocumentGroupBtnToggle},"administrativedocumentspanel #AdministrativeDocumentGroupBtn":{toggle:a.onAdministrativeDocumentGroupBtnToggle},"administrativedocumentspanel #AdministrativeDocumentUploadBtn":{click:a.onAdministrativeDocumentUploadBtnClick},"administrativedocumentspanel #AdministrativeDocumentScanBtn":{click:a.onAdministrativeDocumentScanBtnClick},"#AdministrativeDocumentUploadWindow":{show:a.onAdministrativeDocumentUploadWindowShow},"#AdministrativeDocumentUploadWindow #uploadBtn":{click:a.onAdministrativeDocumentUploadSaveBtnClick},"#AdministrativeDocumentGridGroupBtn":{beforerender:a.onAdministrativeDocumentGridGroupBtnBeforeRender},"#AdministrativeDocumentGridGroupBtn menucheckitem":{checkchange:a.onAdministrativeDocumentGridGroupBtnCheckChange},"#AdministrativeDocumentErrorNoteSaveBtn":{click:a.onAdministrativeDocumentErrorNoteSaveBtnClick},"#AdministrativeDocumentViewerOpacityField":{afterrender:a.onAdministrativeDocumentViewerOpacityFieldAfterRender,change:a.onAdministrativeDocumentViewerOpacityFieldChange},"#AdministrativeDocumentViewerFrame":{render:a.onAdministrativeDocumentViewerFrameRender},"#AdministrativeDocumentEnteredInErrorBtn":{click:a.onAdministrativeDocumentEnteredInErrorBtnClick},"#AdministrativeDocumentWindow":{show:a.onAdministrativeDocumentWindowShow}}),a.nav=this.getController("Navigation"),a.document_group_menu=[],a.document_groups={}},onAdministrativeDocumentHashCheckBtnClick:function(a,b){var c=a.getStore().getAt(b);DocumentHandler.checkDocHash(c.data,function(a,b){var c=Ext.String.htmlDecode(b.result.msg);Ext.Msg.show({title:_("document_hash"),msg:c,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})})},onAdministrativeDocumentEdit:function(a){var b=this.getAdministrativeDocumentGrid().getStore(),c=b.getById(a.save.id);if(c){var d,e=a.save.document.split(","),f=e[1]||e[0];c.set({document:f}),d=c.data,d.edit_document=!0,DocumentHandler.updateAdministrativeDocument(d,function(){c.commit(),window.dual?dual.msg("sweet",_("record_saved")):app.msg("sweet",_("record_saved"))})}},onBrowserHelperOpen:function(){this.getAdministrativeDocumentScanBtn()&&this.getAdministrativeDocumentScanBtn().show()},onBrowserHelperClose:function(){this.getAdministrativeDocumentScanBtn()&&this.getAdministrativeDocumentScanBtn().hide()},onAdministrativeDocumentPanelActive:function(a,b){var c=this,d=a.down("grid"),e=d.getStore(),f=c.nav.getExtraParams();c.activePanel=a,f&&f.document&&e.on("load",c.doSelectDocument,c),a.defereOnActiveReload||c.doAdministrativeDocumentReload(a,b)},doSelectDocument:function(a){var b=this,c=b.activePanel.down("grid"),d=b.nav.getExtraParams(),e=a.getById(d.document);e?c.getSelectionModel().select(e):app.msg(_("oops"),_("unable_to_find_document"),!0),a.un("load",b.doSelectDocument,b)},onAdministrativeDocumentBeforeRender:function(a){this.setViewerSite(app.user.site),a.defereOnActiveReload=!1},doAdministrativeDocumentReload:function(a,b){var c=a.down("grid"),d=c.getStore();d.clearFilter(!0),d.filter([{property:"belongs_to_id",value:b.belongs_to_id},{property:"belongs_to",value:b.belongs_to}])},onAdministrativeDocumentGridSelectionChange:function(a,b){var c=a.view.panel.up("panel").query("#AdministrativeDocumentViewerFrame")[0];c.setSrc(0===b.length||b[b.length-1].get("disabled_selection")?"about:blank":"dataProvider/DocumentViewer.php?site="+this.site+"&token="+app.user.token+"&id="+b[b.length-1].data.id+"&_dc="+Ext.Date.now()+"&doctype=claimdoc")},onAdministrativeDocumentGridAfterRender:function(container){eval(a("allow_document_drag_drop_upload"))&&this.initDocumentDnD(container)},onAdministrativeDocumentGridBeforeRender:function(a){a.store.on("load",function(b){this.onAdministrativeDocumentGridBeforeRefresh(a,b)},this)},onAdministrativeDocumentGridBeforeItemContextMenu:function(a,b,c,d,e){{var f=this;this.getController("Navigation").getUrlCls()}e.preventDefault(),Ext.Msg.show({title:"C-CDA",msg:"Would you like to view the raw xml data?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){if("yes"===c){var d=a.up("panel").up("panel").query("#AdministrativeDocumentViewerFrame")[0];b&&d.setSrc("dataProvider/DocumentViewer.php?site="+f.site+"&token="+app.user.token+"&id="+b.data.id+"&rawXml")}}})},onAdministrativeDocumentGridBeforeRefresh:function(){},initDocumentDnD:function(a){var b=this;b.dnding=!1,a.on({drop:{element:"el",fn:b.documentDrop,scope:b},dragstart:{element:"el",fn:b.documentAddDropZone},dragenter:{element:"el",fn:b.documentAddDropZone},dragover:{element:"el",fn:b.documentAddDropZone},dragleave:{element:"el",fn:b.documentRemoveDropZone},dragexit:{element:"el",fn:b.documentRemoveDropZone}})},documentDrop:function(a){var b=this;a.stopEvent();var c=Ext.Array.from(a.browserEvent.dataTransfer.files);b.fileHandler(c[0]),Ext.get(a.target).removeCls("drag-over")},documentAddDropZone:function(a){a.browserEvent.dataTransfer&&-1!==Ext.Array.from(a.browserEvent.dataTransfer.types).indexOf("Files")&&(a.stopEvent(),this.addCls("drag-over"))},documentRemoveDropZone:function(a){var b=a.getTarget(),c=this.el;if(a.stopEvent(),b===c.dom)return void this.removeCls("drag-over");for(;b!==c.dom&&b&&b.parentNode;)b=b.parentNode;b!==c.dom&&this.removeCls("drag-over")},onAdministrativeDocumentGridViewBeforeDrop:function(b,c,d){return 0===c.records.length?!1:a("allow_document_drag_drop")?c.records[0].get("id")<=0?(app.msg(_("oops"),"Unable to Edit, Document is not a stored document",!0),!1):"ZZZ"===c.records[0].get("docTypeCode")?(app.msg(_("oops"),"Unable to Edit, Document entered in error",!0),!1):""===c.records[0].get("docType")?(app.msg(_("oops"),"Unable to Edit, Please drop the document inside group",!0),!1):c.records[0].get("docTypeCode")===d.get("docTypeCode")?(app.msg(_("oops"),"Please drop the document inside a different group",!0),!1):void 0:(app.msg(_("oops"),"Unable to Edit, Not Authorized to Drag & Drop Document",!0),!1)},onAdministrativeDocumentGridViewDrop:function(a,b,c){b.records[0].set({docTypeCode:c.get("docTypeCode"),docType:c.get("docType"),date:b.records[0].get("date")}),b.records[0].store.sync()},getGroupName:function(a,b){var c=a.groupers.items[0].property;return"docTypeCode"===c?Ext.String.capitalize(b.get("docTypeCode")+" - "+b.get("docType")):b.get("groupDate")},onAdministrativeDocumentGroupBtnToggle:function(a,b){var c=a.up("grid"),d="#"+a.action,e=c.headerCt.down(d);b?(c.getStore().group(a.action),e.hide(),a.disable()):(e.show(),a.enable())},onAdministrativeDocumentUploadBtnClick:function(a){this.setAdministrativeDocumentUploadWindow(a,"click")},setAdministrativeDocumentUploadWindow:function(a,b){var c=a.up("window"),d=this.getNewAdministrativeDocumentRecord(c),e=this.getUploadWindow(b),f=e.down("form").down("#adminDocTypeCatCombo").getStore();return f.clearFilter(!0),f.filter([{property:"code",value:c.doc_type_code}]),f.load(),e.down("form").getForm().loadRecord(d),e},getUploadWindow:function(a){return Ext.create("App.view.documents.windows.UploadAdministrativeDocument",{action:a,itemId:"AdministrativeDocumentUploadWindow"})},getNewAdministrativeDocumentRecord:function(a){return Ext.create("App.model.documents.AdministrativeDocuments",{belongs_to:a.belongs_to,belongs_to_id:a.belongs_to_id,uid:app.user.id,date:new Date})},onAdministrativeDocumentScanBtnClick:function(a){var b=a.up("grid");this.getController("Scanner").showDocumentScanWindow(void 0,function(a){a&&b.add(a)})},onAdministrativeDocumentUploadWindowShow:function(){this.scannedDocument=null,this.getAdministrativeDocumentUploadFileUploadField().enable(),this.getAdministrativeDocumentUploadScanBtn().setVisible(this.getController("Scanner").conencted)},onAdministrativeDocumentUploadSaveBtnClick:function(){var a=this,b=a.getAdministrativeDocumentUploadWindow(),c=b.down("form").getForm(),d=c.getRecord(),e=c.getValues(),f=new FileReader,g=c.findField("document");if(c.isValid())if(d.set(e),"click"==b.action){var h=g.getValue();d.set({name:h}),a.scannedDocument?(d.set({document:a.scannedDocument}),a.doNewAdministrativeDocumentRecordSave(d)):(f.onload=function(b){d.set({document:b.target.result}),a.doNewAdministrativeDocumentRecordSave(d)},f.readAsDataURL(g.extractFileInput().files[0]))}else a.doNewAdministrativeDocumentRecordSave(d)},doNewAdministrativeDocumentRecordSave:function(a){var b=this,c=b.getAdministrativeDocumentGrid().getStore(),d=c.indexOf(a);-1==d&&c.add(a),c.sync({success:function(){app.msg(_("sweet"),_("document_added")),b.getAdministrativeDocumentUploadWindow().close(),b.getAdministrativeDocumentGrid().getSelectionModel().select(a)},failure:function(){c.rejectChanges(),window.dual?dual.msg(_("oops"),_("document_error"),!0):app.msg(_("oops"),_("document_error"),!0)}})},onAdministrativeDocumentGridGroupBtnBeforeRender:function(a){var b=this,c=a.up("window"),d=c.doc_type_code;CombosData.getAdministrativeDocumentsOptionsByListId({list_key:"doc_type_admin_cat",code:d},function(c){c.forEach(function(c){var d=(c.option_value+"-"+c.option_name+"_").replace(" ","_")+app.user.id,e=Ext.state.Manager.get(d,{});b.document_groups[c.option_value]=e.checked||!1,b.document_group_menu.push({xtype:"menucheckitem",text:c.option_value+" - "+c.option_name,stateful:!0,stateId:d,_document_group:c.option_value}),a.menu.add({xtype:"menucheckitem",text:c.option_value+" - "+c.option_name,stateful:!0,stateId:d,_document_group:c.option_value})})})},onAdministrativeDocumentGridGroupBtnCheckChange:function(a){var b=this;b.document_groups[a._document_group]=a.checked},onAdministrativeDocumentErrorNoteSaveBtnClick:function(){var a=this,b=a.getAdministrativeDocumentErrorNoteWindow(),c=b.down("form").getForm(),d=c.getValues(),e=c.getRecord(),f=e.site?e.site:null;c.isValid()&&(d.entered_in_error=!0,d.site=f,e.set(d),e.save({success:function(){b.close(),e.set({groupDate:""}),e.commit()}}))},onAdministrativeDocumentViewerOpacityFieldAfterRender:function(a){a.el.set({"data-qtip":_("document_brightness")})},onAdministrativeDocumentViewerOpacityFieldChange:function(a,b){var c=a.up("panel").query("#AdministrativeDocumentViewerFrame")[0];c&&this.setOpacity(c,b)},setOpacity:function(a,b){a.el.applyStyles({opacity:b})},onAdministrativeDocumentViewerFrameRender:function(a){var b=a.up("panel").query("#AdministrativeDocumentViewerOpacityField")[0];b&&this.setOpacity(a,b.getValue())},onAdministrativeDocumentEnteredInErrorBtnClick:function(a){var b=this,c=a.up("grid").getSelectionModel(),d=c.getSelection();if(0!==d.length){var e=d[0];if(app.fireEvent("beforeadministrativedocumententeredinerror",b,e)!==!1)return e.get("entered_in_error")?void app.msg(_("oops"),_("document_entered_in_error"),!0):void b.setAdministrativeDocumentInError(e)}},setAdministrativeDocumentInError:function(a){var b=this;Ext.Msg.show({title:_("wait"),msg:_("document_entered_in_error_message"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){if("yes"==c){var d=b.showAdministrativeDocumentErrorNoteWindow();d.down("form").getForm().loadRecord(a)}}})},showAdministrativeDocumentErrorNoteWindow:function(){return this.getAdministrativeDocumentErrorNoteWindow()||Ext.create("App.view.documents.windows.AdministrativeDocumentErrorNote"),this.getAdministrativeDocumentErrorNoteWindow().show()},onAdministrativeDocumentWindowShow:function(a){var b=a.down("panel");this.onAdministrativeDocumentPanelActive(b,a)},showAdministrativeDocumentWindow:function(a){return this.getAdministrativeDocumentWindow()||(a=a||{},Ext.create("App.view.documents.windows.AdministrativeDocumentWindow",a)),this.getAdministrativeDocumentWindow().show()},setViewerSite:function(a){this.site=a}}),Ext.define("App.controller.DocumentViewer",{extend:"Ext.app.Controller",requires:["App.view.patient.windows.ArchiveDocument"],refs:[{ref:"DocumentViewerWindow",selector:"documentviewerwindow"},{ref:"DocumentViewerWindow",selector:"documentviewerwindow > form"},{ref:"ArchiveDocumentBtn",selector:"documentviewerwindow #archiveDocumentBtn"},{ref:"#documentViewerAddToPrintJobBtn",selector:"documentViewerAddToPrintJobBtn"},{ref:"ArchiveWindow",selector:"patientarchivedocumentwindow"},{ref:"ArchiveForm",selector:"patientarchivedocumentwindow > form"},{selector:"#ArchiveDocumentOptionalFieldSet",ref:"ArchiveDocumentOptionalFieldSet"}],init:function(){var a=this;a.control({documentviewerwindow:{close:a.onViewerDocumentsWinClose},"documentviewerwindow #archiveDocumentBtn":{click:a.onArchiveDocumentBtnClick},"#documentViewerAddToPrintJobBtn":{click:a.onDocumentViewerAddToPrinterJobBtn},"patientarchivedocumentwindow #archiveBtn":{click:a.onArchiveBtnClick}})},onArchiveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getValues(),e=c.findField("docTypeCode");if(c.isValid()){d.pid=app.patient.pid,d.eid=app.patient.eid,d.uid=app.user.id;var f=e.findRecordByValue(d.docTypeCode);if(d.docType=f.get("option_name"),"App.view.scanner.Window"===Ext.getClassName(b.documentWindow)){var g=app.getController("Scanner");g.doArchive(d,function(a){a&&b.close()})}else DocumentHandler.transferTempDocument(d,function(a){a.success?(window.dual?window.dual.msg(_("sweet"),"document_transferred"):window.app.msg(_("sweet"),"document_transferred"),b.doAddPrintJobCallback&&b.doAddPrintJobCallback(a.record,null,0,void 0,void 0),b.documentWindow.close(),b.close()):(say(a),window.dual?window.dual.msg(_("oops"),"document_transfer_failed",!0):window.app.msg(_("oops"),"document_transfer_failed",!0))})}},onArchiveDocumentBtnClick:function(a){var b=a.up("window"),c={id:b.documentId,docType:b.documentType,title:b.documentType+" "+_("order")},d=Ext.widget("patientarchivedocumentwindow",{documentWindow:b,doAddPrintJobCallback:void 0}),e=d.down("form").getForm();e.setValues(c),d.down("fieldset").setVisible(!1)},onDocumentViewerAddToPrinterJobBtn:function(a){var b=a.up("window"),c={id:b.documentId,docType:b.documentType,title:b.documentType+" "+_("order")},d=Ext.widget("patientarchivedocumentwindow",{documentWindow:b,doAddPrintJobCallback:this.doAddPrintJob});d.down("form").getForm().setValues(c)},doAddPrintJob:function(a,b,c,d,e){app.getController("PrintJob").addPrintJob(a.id,b,c,d,e)},onViewerDocumentsWinClose:function(a){DocumentHandler.destroyTempDocument({id:a.documentId})},doDocumentView:function(a,b,c,d){var e,f=Ext.ComponentQuery.query("documentviewerwindow"),g="dataProvider/DocumentViewer.php?site="+(c||app.user.site)+"&id="+a+"&token="+app.user.token,h="undefined"!=typeof b;if(h&&(g+="&temp="+b),g+="&_dc="+Ext.Date.now(),e=Ext.create("App.view.patient.windows.DocumentViewer",{documentType:b,documentId:a,closable:void 0!==d?d:!0,items:[{xtype:"miframe",autoMask:!1,src:g}]}),h||(e.down("#documentViewerAddToPrintJobBtn").hide(),e.down("#archiveDocumentBtn").hide()),f.length>0){for(var i=f[f.length-1],j=0;j<f.length;j++)f[j].toFront();e.showAt(i.x+25,i.y+5)}else e.show();return e}}),Ext.define("App.controller.Notification",{extend:"Ext.app.Controller",requires:["App.view.notifications.Grid"],refs:[{ref:"UserSplitButton",selector:"#userSplitButton"},{ref:"NotificationsGrid",selector:"notificationsgrid"}],init:function(){var a=this;a.control({viewport:{beforerender:a.onViewportBeforeRender},"#userSplitButton":{badgeclick:a.onUserSplitButtonBadgeClick},notificationsgrid:{itemclick:a.onNotificationsGridItemClick},"notificationsgrid > header":{click:a.onNotificationsGridHeaderClick}}),a.store=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"description",type:"string"},{name:"data",type:"auto"},{name:"controller",type:"string"},{name:"method",type:"string"}]}),a.store.on("add",a.onNotificationAdd,a),a.store.on("remove",a.onNotificationRemove,a)},onNotificationAdd:function(a){this.setBadgeText(a.count())},onNotificationRemove:function(a){this.setBadgeText(a.count())},onNotificationsGridItemClick:function(a,b){var c=this,d=App.app.getController(b.data.controller),e=b.data.method,f=b.data.data;"object"==typeof d&&"function"==typeof d[e]?f?d[e](f,function(a){a&&c.store.remove(b),c.doHideNotifications()}):d[e](function(a){a&&c.store.remove(b),c.doHideNotifications()}):(c.store.remove(b),c.doHideNotifications(),app.msg(_("oops"),_("notification_handler_error"),!0))},onNotificationsGridHeaderClick:function(){this.doHideNotifications()},onUserSplitButtonBadgeClick:function(){this.doShowNotifications()},onViewportBeforeRender:function(a){var b=this;b.grid=a.add(Ext.widget("notificationsgrid",{floatable:!0,floating:!0,store:b.store}))},setBadgeText:function(a){this.getUserSplitButton().setBadgeText(a)},getBadgeText:function(){this.getUserSplitButton().getBadgeText()},doHideNotifications:function(){this.getNotificationsGrid().collapse(Ext.Component.DIRECTION_TOP,!0),this.getNotificationsGrid().hide(),Ext.getBody().un("click",this.doHideNotifications,this)},doShowNotifications:function(){this.grid.showBy(this.getUserSplitButton(),"tr-br",[-1,4]),this.grid.expand(!0),this.grid.toFront(),Ext.getBody().on("click",this.doHideNotifications,this)},add:function(a,b,c,d,e){var f;return this.store.getById(a)?(f=this.store.getById(a),f.set({description:b,data:c,controller:d,method:e}),f.commit(),f):(f=this.store.add({id:a,description:b,data:c,controller:d,method:e})[0],app.msg(_("new_notification"),b,"yellow"),f)},remove:function(a){this.store.getById(a)&&this.store.remove(this.store.getById(a))},testNotification:function(a,b){"function"==typeof b&&b(!0)}}),Ext.define("App.controller.Scanner",{extend:"Ext.app.Controller",requires:["App.view.scanner.Window","App.view.patient.windows.ArchiveDocument"],refs:[{ref:"DocumentScanWindow",selector:"#DocumentScanWindow"},{ref:"DocumentScanDataViewPanel",selector:"#DocumentScanDataViewPanel"},{ref:"DocumentScanThumbsDataView",selector:"#DocumentScanThumbsDataView"},{ref:"DocumentScanForm",selector:"#DocumentScanForm"},{ref:"DocumentScanSourceCombo",selector:"#DocumentScanSourceCombo"},{ref:"DocumentScanDocTypeCombo",selector:"#DocumentScanDocTypeCombo"},{ref:"DocumentScanProgressBar",selector:"#DocumentScanProgressBar"},{ref:"DocumentScanRemoveDocumentBtn",selector:"#DocumentScanRemoveDocumentBtn"},{ref:"BasicScanWindow",selector:"#BasicScanWindow"},{ref:"BasicScanSourceCombo",selector:"#BasicScanSourceCombo"},{ref:"ScannerImageThumbsDataView",selector:"#ScannerImageThumbsDataView"},{ref:"ScannerImageViewer",selector:"#ScannerImageViewer"},{ref:"ScannerImageViewerPanelImage",selector:"#ScannerImageViewerPanel image"},{ref:"ScannerSourceCombo",selector:"#ScannerSourceCombo"},{ref:"ScannerImageScanBtn",selector:"#ScannerImageScanBtn"},{ref:"ScannerImageScanBtn",selector:"#ScannerImageScanBtn"},{ref:"ScannerImageArchiveBtn",selector:"#ScannerImageArchiveBtn"}],init:function(){var a=this;a.documents_defautls={},a.is_chrome_scan=window.chrome&&window.chrome.documentScan,a.control({"#DocumentScanWindow":{show:a.onDocumentScanWindowShow,close:a.onDocumentScanWindowClose,beforeclose:a.onDocumentScanWindowBeforeClose},"#DocumentScanThumbsDataView":{beforeitemcontextmenu:a.onDocumentScanThumbsDataViewBeforeContextMenu,selectionchange:a.onDocumentScanThumbsDataViewSelectionChange},"#DocumentScanSaveBtn":{click:a.onDocumentScanSaveBtnClick},"#DocumentScanCancelBtn":{click:a.onDocumentScanCancelBtnClick},"#DocumentScanStartScanBtn":{click:a.onDocumentScanStartScanBtnClick},"#DocumentScanRemoveDocumentBtn":{click:a.onDocumentScanRemoveDocumentBtnClick},"#BasicScanWindow":{show:a.onBasicScanWindowShow},"#BasicScanCancelBtn":{click:a.onBasicScanCancelBtnClick},"#BasicScanScanBtn":{click:a.onBasicScanScanBtnClick}}),a.helperCtrl=a.getController("App.controller.BrowserHelper")},onBasicScanWindowShow:function(a){var b=a.down("progressbar");b.reset(),b.updateProgress(0),b.updateText(""),this.doScannerComboLoad(a.down("#BasicScanSourceCombo"))},onBasicScanCancelBtnClick:function(){this.getBasicScanWindow().close()},onBasicScanScanBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("#BasicScanSourceCombo"),e=c.down("#BasicScanLandscapeCheckbox").getValue(),f=[];d.isValid()&&(e&&f.push("CAP_ORIENTATION_LANDSCAPE"),c.scan_options&&c.scan_options.length>0&&(f=Ext.Array.merge(f,c.scan_options)),b.doScan(c,d.getValue(),f,c.scan_callback))},doScan:function(a,b,c,d){var e=this;if(e.is_chrome_scan)chrome.documentScan.scan({maxImages:10},function(a){d?d(a.dataUrls):e.loadDocuments(a.dataUrls,!0)});else{var f=a.down("progressbar");f.wait({interval:100,duration:6e4,increment:10,text:_("scanning")+"...",fn:function(){progrss_bar.updateText(_("no_document_scanned"))}}),e.helperCtrl.sendMessage({action:"scan",data:b,options:c.join("|")},function(b){return f.reset(),b.documents&&b.documents.length>0?(d?(a.close(),d(b.documents)):e.loadDocuments(b.documents,!1),f.updateProgress(1,b.documents.length+" "+_("documents_scanned")),void(b.error&&""!=b.error&&(f.reset(),f.updateProgress(0,b.error),say(b.error)))):(b.error&&""!=b.error?(app.msg(_("oops"),b.error,!0),say(b.error),f.updateProgress(0,b.error)):f.updateProgress(0,_("no_document_scanned")),void(b.stacktrace&&""!=b.stacktrace&&say(b.stacktrace)))})}},loadDocuments:function(a,b){var c=this,d=c.getDocumentScanForm().getForm(),e=d.getValues(),f=c.getDocumentScanDocTypeCombo(),g=c.getDocumentScanThumbsDataView(),h=g.getStore(),i=[];
a.forEach(function(a){Ext.Array.push(i,{pubpid:app.patient.pubpid,pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,global_id:app.uuidv4(),facility_id:app.user.facility,docType:f.findRecordByValue(e.docTypeCode).get("option_name"),docTypeCode:e.docTypeCode,date:app.getDate(),title:e.title,error_note:"",document:b?a:"data:image/jpeg;base64,"+a})}),h.loadData(i,!0),g.refresh()},onDocumentScanStartScanBtnClick:function(a){var b=this,c=a.up("window"),d=this.getDocumentScanForm().getForm(),e=d.getValues(),f=[];d.isValid()&&("1"==e.duplex&&f.push("CAP_DUPLEX_ENABLED"),"1"==e.color&&f.push("CAP_PIXEL_TYPE_RBG"),"1"==e.landscape&&f.push("CAP_ORIENTATION_LANDSCAPE"),"1"==e.resolution&&f.push("CAP_RESOLUTION_NORMAL"),"2"==e.resolution&&f.push("CAP_RESOLUTION_HIGH"),b.doScan(c,e.scannerId,f))},onDocumentScanWindowShow:function(a){if(!this.is_chrome_scan){var b=this.getDocumentScanProgressBar();b.reset(),b.updateProgress(0),b.updateText(""),this.doScannerComboLoad(a.down("#DocumentScanSourceCombo"))}},onDocumentScanWindowClose:function(a){a.skip_validation=!1,this.getDocumentScanThumbsDataView().store.removeAll(),this.getDocumentScanThumbsDataView().store.commitChanges()},onDocumentScanWindowBeforeClose:function(a){return a.skip_validation===!0||this.allArchived()?!0:(Ext.Msg.show({title:_("wait"),msg:_("document_not_archived_error"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"==b&&(a.skip_validation=!0,a.close())}}),!1)},onDocumentScanSaveBtnClick:function(){var a=this,b=a.getDocumentScanWindow(),c=a.getDocumentScanThumbsDataView(),d=c.getStore(),e=d.data.items;return a.allArchived()?void app.msg(_("oops"),"Nothing to save",!0):(b.default_values&&e.forEach(function(a){a.set(b.default_values)}),void(app.fireEvent("beforescandocumentssave",this,e)!==!1&&(b.mask(_("please_wait")),d.sync({success:function(){app.fireEvent("scandocumentssave",this,e),d.removeAll(),d.commitChanges(),b.unmask(),b.close()},failure:function(){app.msg(_("oops"),_("record_error"),!0),b.unmask(),b.close()}}))))},onDocumentScanCancelBtnClick:function(){this.getDocumentScanWindow().close()},onDocumentScanThumbsDataViewBeforeContextMenu:function(a,b,c,d,e){e.preventDefault()},onDocumentScanThumbsDataViewSelectionChange:function(a,b){this.getDocumentScanRemoveDocumentBtn().setDisabled(0===b.length)},onDocumentScanRemoveDocumentBtnClick:function(){var a=this,b=a.getDocumentScanThumbsDataView(),c=b.getStore(),d=b.getSelectionModel().getLastSelected();c.remove(d)},showDocumentScanWindow:function(a,b){return this.is_chrome_scan||this.helperCtrl.connected?(this.getDocumentScanWindow()||Ext.create("App.view.scanner.DocumentScanWindow"),this.getDocumentScanWindow().default_values=a,this.getDocumentScanWindow().scan_callback=b,this.getDocumentScanWindow().skip_validation=!1,this.getDocumentScanWindow().show()):(app.msg(_("oops"),_("browser_helper_not_connected"),!0),!1)},showBasicScanWindow:function(a,b){return this.helperCtrl.connected?(this.getBasicScanWindow()||Ext.create("App.view.scanner.BasicScanWindow"),this.getBasicScanWindow().scan_options=a,this.getBasicScanWindow().scan_callback=b,this.getBasicScanWindow().show()):(app.msg(_("oops"),_("browser_helper_not_connected"),!0),!1)},doScannerComboLoad:function(a){var b=this;b.helperCtrl.sendMessage({action:"scanner/list"},function(b){b&&(say(b),a.store.loadRawData(b),a.getValue()||a.select(a.store.getAt(0)))})},allArchived:function(){var a=this.getDocumentScanThumbsDataView().store;return 0==a.data.items.length}}),Ext.define("App.controller.patient.Documents",{extend:"Ext.app.Controller",requires:["App.view.patient.windows.UploadDocument"],refs:[{ref:"PatientDocumentPanel",selector:"patientdocumentspanel"},{ref:"PatientDocumentGrid",selector:"patientdocumentspanel #patientDocumentGrid"},{ref:"PatientDocumentViewerFrame",selector:"patientdocumentspanel #patientDocumentViewerFrame"},{ref:"PatientDocumentUploadWindow",selector:"#patientDocumentUploadWindow"},{ref:"PatientDocumentUploadScanBtn",selector:"#patientDocumentUploadWindow #scanBtn"},{ref:"PatientDocumentUploadFileUploadField",selector:"#patientDocumentUploadWindow #fileUploadField"},{ref:"DocumentHashCheckBtn",selector:"#documentHashCheckBtn"},{ref:"DocumentHashCheckBtn",selector:"#documentHashCheckBtn"},{ref:"AddDocumentBtn",selector:"patientdocumentspanel #addDocumentBtn"},{ref:"DocumentUploadBtn",selector:"patientdocumentspanel #documentUploadBtn"},{ref:"DocumentUploadBtn",selector:"patientdocumentspanel #documentUploadBtn"},{ref:"DocumentScanBtn",selector:"patientdocumentspanel #documentScanBtn"},{ref:"PatientDocumentErrorNoteWindow",selector:"patientdocumenterrornotewindow"},{ref:"PatientDocumentViewerOpacityField",selector:"PatientDocumentViewerOpacityField"},{ref:"DocumentWindow",selector:"#DocumentWindow"}],scannedDocument:null,init:function(){var a=this;a.control({viewport:{browserhelperopen:a.onBrowserHelperOpen,browserhelperclose:a.onBrowserHelperClose,documentedit:a.onDocumentEdit},patientdocumentspanel:{activate:a.onPatientDocumentPanelActive,beforerender:a.onPatientDocumentBeforeRender},"patientdocumentspanel #patientDocumentGrid":{selectionchange:a.onPatientDocumentGridSelectionChange,afterrender:a.onPatientDocumentGridAfterRender,beforerender:a.onPatientDocumentGridBeforeRender,beforeitemcontextmenu:a.onPatientDocumentGridBeforeItemContextMenu},"patientdocumentspanel #patientDocumentGrid gridview":{beforedrop:a.onPatientDocumentGridViewBeforeDrop,drop:a.onPatientDocumentGridViewDrop},"patientdocumentspanel [toggleGroup=documentgridgroup]":{toggle:a.onDocumentGroupBtnToggle},"patientdocumentspanel #documentGroupBtn":{toggle:a.onDocumentGroupBtnToggle},"patientdocumentspanel #documentUploadBtn":{click:a.onDocumentUploadBtnClick},"patientdocumentspanel #documentScanBtn":{click:a.onDocumentScanBtnClick},"#patientDocumentUploadWindow":{show:a.onPatientDocumentUploadWindowShow},"#patientDocumentUploadWindow #uploadBtn":{click:a.onDocumentUploadSaveBtnClick},"#PatientDocumentGridGroupBtn":{beforerender:a.onPatientDocumentGridGroupBtnBeforeRender},"#PatientDocumentGridGroupBtn menucheckitem":{checkchange:a.onPatientDocumentGridGroupBtnCheckChange},"#DocumentErrorNoteSaveBtn":{click:a.onDocumentErrorNoteSaveBtnClick},"#PatientDocumentViewerOpacityField":{afterrender:a.onPatientDocumentViewerOpacityFieldAfterRender,change:a.onPatientDocumentViewerOpacityFieldChange},"#patientDocumentViewerFrame":{render:a.onPatientDocumentViewerFrameRender},"#PatientDocumentEnteredInErrorBtn":{click:a.onPatientDocumentEnteredInErrorBtnClick},"#EncounterPatientDocumentsBtn":{click:a.onEncounterPatientDocumentsBtnClick},"#DocumentWindow":{show:a.onDocumentWindowShow}}),a.nav=this.getController("Navigation"),a.document_group_menu=[],a.document_groups={},CombosData.getOptionsByListId({list_key:"doc_type_cat"},function(b){b.forEach(function(b){var c=(b.option_value+"-"+b.option_name+"_").replace(" ","_")+app.user.id,d=Ext.state.Manager.get(c,{});a.document_groups[b.option_value]=d.checked||!1,a.document_group_menu.push({xtype:"menucheckitem",text:b.option_value+" - "+b.option_name,stateful:!0,stateId:c,_document_group:b.option_value})})})},onPatientDocumentGridViewBeforeDrop:function(b,c,d){return 0===c.records.length?!1:a("allow_document_drag_drop")?c.records[0].get("id")<=0?(app.msg(_("oops"),"Unable to Edit, Document is not a stored document",!0),!1):"ZZZ"===c.records[0].get("docTypeCode")?(app.msg(_("oops"),"Unable to Edit, Document entered in error",!0),!1):""===c.records[0].get("docType")?(app.msg(_("oops"),"Unable to Edit, Please drop the document inside group",!0),!1):c.records[0].get("docTypeCode")===d.get("docTypeCode")?(app.msg(_("oops"),"Please drop the document inside a different group",!0),!1):void 0:(app.msg(_("oops"),"Unable to Edit, Not Authorized to Drag & Drop Document",!0),!1)},onPatientDocumentGridViewDrop:function(a,b,c){b.records[0].set({docTypeCode:c.get("docTypeCode"),docType:c.get("docType"),date:b.records[0].get("date")}),b.records[0].store.sync()},onPatientDocumentGridBeforeRefresh:function(a){var b=this,c=a.store.getGroups(),d=a.view;0!==c.length&&c.forEach(function(a){try{b.document_groups[a.name]?d.summaryFeature.expand(a.name):d.summaryFeature.collapse(a.name)}catch(c){say("Document Group Collapse/Expand Error"),say(c)}})},onPatientDocumentGridGroupBtnBeforeRender:function(a){a.menu.add(Ext.clone(this.document_group_menu))},onPatientDocumentGridGroupBtnCheckChange:function(a){this.document_groups[a._document_group]=a.checked},onEncounterPatientDocumentsBtnClick:function(){this.showDocumentWindow()},onDocumentWindowShow:function(a){var b=a.down("panel");this.onPatientDocumentPanelActive(b)},showDocumentWindow:function(a){return this.getDocumentWindow()||(a=a||{},Ext.create("App.view.patient.windows.DocumentWindow",a)),this.getDocumentWindow().show()},onPatientDocumentEnteredInErrorBtnClick:function(a){var b=this,c=a.up("grid").getSelectionModel(),d=c.getSelection();if(0!==d.length){var e=d[0];if(app.fireEvent("beforedocumententeredinerror",b,e)!==!1)return e.get("entered_in_error")?void app.msg(_("oops"),_("document_entered_in_error"),!0):void b.setDocumentInError(e)}},onPatientDocumentViewerFrameRender:function(a){var b=a.up("panel").query("#PatientDocumentViewerOpacityField")[0];b&&this.setOpacity(a,b.getValue())},onPatientDocumentViewerOpacityFieldAfterRender:function(a){a.el.set({"data-qtip":_("document_brightness")})},onPatientDocumentViewerOpacityFieldChange:function(a,b){var c=a.up("panel").query("#patientDocumentViewerFrame")[0];c&&this.setOpacity(c,b)},setOpacity:function(a,b){a.el.applyStyles({opacity:b})},onPatientDocumentGridBeforeItemContextMenu:function(a,b,c,d,e){var f=this,g=this.getController("Navigation").getUrlCls();"App.view.patient.Summary"===g&&(e.preventDefault(),Ext.Msg.show({title:"C-CDA",msg:"Would you like to view the raw xml data?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){if("yes"===c){var d=a.up("panel").up("panel").query("#patientDocumentViewerFrame")[0];b&&d.setSrc("dataProvider/DocumentViewer.php?site="+f.site+"&token="+app.user.token+"&id="+b.data.id+"&rawXml")}}}))},setDocumentInError:function(a){var b=this;Ext.Msg.show({title:_("wait"),msg:_("document_entered_in_error_message"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(c){if("yes"==c){var d=b.showPatientDocumentErrorNoteWindow();d.down("form").getForm().loadRecord(a)}}})},onDocumentErrorNoteSaveBtnClick:function(){var a=this,b=a.getPatientDocumentErrorNoteWindow(),c=b.down("form").getForm(),d=c.getValues(),e=c.getRecord(),f=e.site?e.site:null;c.isValid()&&(d.entered_in_error=!0,d.site=f,e.set(d),e.save({success:function(){b.close(),e.set({groupDate:""}),e.commit()}}))},showPatientDocumentErrorNoteWindow:function(){return this.getPatientDocumentErrorNoteWindow()||Ext.create("App.view.patient.windows.DocumentErrorNote"),this.getPatientDocumentErrorNoteWindow().show()},onPatientDocumentBeforeRender:function(a){this.setViewerSite(app.user.site),a.defereOnActiveReload=!1},onDocumentEdit:function(a){var b=this.getPatientDocumentGrid().getStore(),c=b.getById(a.save.id);if(c){var d,e=a.save.document.split(","),f=e[1]||e[0];c.set({document:f}),d=c.data,d.edit_document=!0,DocumentHandler.updatePatientDocument(d,function(){c.commit(),window.dual?dual.msg("sweet",_("record_saved")):app.msg("sweet",_("record_saved"))})}},onBrowserHelperOpen:function(){this.getDocumentScanBtn()&&this.getDocumentScanBtn().show()},onBrowserHelperClose:function(){this.getDocumentScanBtn()&&this.getDocumentScanBtn().hide()},onPatientDocumentUploadWindowShow:function(){this.scannedDocument=null,this.getPatientDocumentUploadFileUploadField().enable(),this.getPatientDocumentUploadScanBtn().setVisible(this.getController("Scanner").conencted)},onPatientDocumentGridSelectionChange:function(a,b){var c=a.view.panel.up("panel").query("#patientDocumentViewerFrame")[0];c.setSrc(0===b.length||b[b.length-1].get("disabled_selection")?"about:blank":"dataProvider/DocumentViewer.php?site="+this.site+"&token="+app.user.token+"&id="+b[b.length-1].data.id+"&_dc="+Ext.Date.now())},onPatientDocumentGridAfterRender:function(container){eval(a("allow_document_drag_drop_upload"))&&this.initDocumentDnD(container)},onPatientDocumentGridBeforeRender:function(a){a.store.on("load",function(b){this.onPatientDocumentGridBeforeRefresh(a,b)},this)},onPatientDocumentPanelActive:function(a){var b=this,c=a.down("grid"),d=c.getStore(),e=b.nav.getExtraParams();b.activePAnel=a,e&&e.document&&d.on("load",b.doSelectDocument,b),a.defereOnActiveReload||b.doPatientDocumentReload(a)},doPatientDocumentReload:function(a,b){var c=a.down("grid"),d=c.getStore();d.clearFilter(!0),d.filter([{property:"pid",value:b||app.patient.pid}])},doSelectDocument:function(a){var b=this,c=b.activePAnel.down("grid"),d=b.nav.getExtraParams(),e=a.getById(d.document);e?c.getSelectionModel().select(e):app.msg(_("oops"),_("unable_to_find_document"),!0),a.un("load",b.doSelectDocument,b)},onDocumentGroupBtnToggle:function(a,b){var c=a.up("grid"),d="#"+a.action,e=c.headerCt.down(d);b?(c.getStore().group(a.action),e.hide(),a.disable()):(e.show(),a.enable())},onDocumentScanBtnClick:function(a){var b=a.up("grid");this.getController("Scanner").showDocumentScanWindow(void 0,function(a){a&&b.add(a)})},onDocumentUploadBtnClick:function(){this.setDocumentUploadWindow("click")},setDocumentUploadWindow:function(a){var b=this.getNewPatientDocumentRecord(),c=this.getUploadWindow(a);return c.down("form").getForm().loadRecord(b),c},getNewPatientDocumentRecord:function(){return Ext.create("App.model.patient.PatientDocuments",{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,facility_id:app.user.facility,date:new Date})},getGroupName:function(a,b){var c=a.groupers.items[0].property;return"docTypeCode"===c?Ext.String.capitalize(b.get("docTypeCode")+" - "+b.get("docType")):b.get("groupDate")},onDocumentHashCheckBtnClick:function(a,b){var c=a.getStore().getAt(b);DocumentHandler.checkDocHash(c.data,function(a,b){var c=Ext.String.htmlDecode(b.result.msg);Ext.Msg.show({title:_("document_hash"),msg:c,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO})})},getUploadWindow:function(a){return Ext.create("App.view.patient.windows.UploadDocument",{action:a,itemId:"patientDocumentUploadWindow"})},onDocumentUploadSaveBtnClick:function(){var a=this,b=a.getPatientDocumentUploadWindow(),c=b.down("form").getForm(),d=c.getRecord(),e=c.getValues(),f=new FileReader,g=c.findField("document");if(c.isValid())if(d.set(e),"click"==b.action){var h=g.getValue();d.set({name:h}),a.scannedDocument?(d.set({document:a.scannedDocument}),a.doNewDocumentRecordSave(d)):(f.onload=function(b){d.set({document:b.target.result}),a.doNewDocumentRecordSave(d)},f.readAsDataURL(g.extractFileInput().files[0]))}else a.doNewDocumentRecordSave(d)},onDocumentUploadScanBtnClick:function(){var a=this,b=this.getController("Scanner");b.initScan(),app.on("scancompleted",this.onScanCompleted,a)},onScanCompleted:function(a,b){var c=this,d=c.getPatientDocumentUploadWindow(),e=d.down("form").getForm(),f=e.findField("document");f.disable(),c.scannedDocument=b,app.un("scancompleted",this.onScanCompleted,c)},doNewDocumentRecordSave:function(a){var b=this,c=b.getPatientDocumentGrid().getStore(),d=c.indexOf(a);a.set({facility_id:app.user.facility}),-1==d&&c.add(a),c.sync({success:function(){app.msg(_("sweet"),_("document_added")),b.getPatientDocumentUploadWindow().close(),b.getPatientDocumentGrid().getSelectionModel().select(a)},failure:function(){c.rejectChanges(),window.dual?dual.msg(_("oops"),_("document_error"),!0):app.msg(_("oops"),_("document_error"),!0)}})},initDocumentDnD:function(a){var b=this;b.dnding=!1,a.on({drop:{element:"el",fn:b.documentDrop,scope:b},dragstart:{element:"el",fn:b.documentAddDropZone},dragenter:{element:"el",fn:b.documentAddDropZone},dragover:{element:"el",fn:b.documentAddDropZone},dragleave:{element:"el",fn:b.documentRemoveDropZone},dragexit:{element:"el",fn:b.documentRemoveDropZone}})},documentDrop:function(a){var b=this;a.stopEvent();var c=Ext.Array.from(a.browserEvent.dataTransfer.files);b.fileHandler(c[0]),Ext.get(a.target).removeCls("drag-over")},documentAddDropZone:function(a){a.browserEvent.dataTransfer&&-1!==Ext.Array.from(a.browserEvent.dataTransfer.types).indexOf("Files")&&(a.stopEvent(),this.addCls("drag-over"))},documentRemoveDropZone:function(a){var b=a.getTarget(),c=this.el;if(a.stopEvent(),b===c.dom)return void this.removeCls("drag-over");for(;b!==c.dom&&b&&b.parentNode;)b=b.parentNode;b!==c.dom&&this.removeCls("drag-over")},fileHandler:function(a){var b=this,c=b.setDocumentUploadWindow("drop"),d=c.down("form").getForm(),e=d.getRecord(),f=new FileReader,g=d.findField("document");g.hide(),g.disable(),f.onload=function(b){e.set({document:b.target.result,name:a.name})},f.readAsDataURL(a)},setViewerSite:function(a){this.site=a}}),Ext.define("App.controller.patient.LabOrders",{extend:"Ext.app.Controller",requires:["App.view.patient.windows.UploadDocument"],refs:[{ref:"LabOrdersGrid",selector:"patientlaborderspanel"},{ref:"ElectronicLabOrderBtn",selector:"patientlaborderspanel #electronicLabOrderBtn"},{ref:"NewLabOrderBtn",selector:"patientlaborderspanel #newLabOrderBtn"},{ref:"PrintLabOrderBtn",selector:"patientlaborderspanel #printLabOrderBtn"}],init:function(){var a=this;a.control({patientlaborderspanel:{activate:a.onLabOrdersGridActive,selectionchange:a.onLabOrdersGridSelectionChange,beforerender:a.onLabOrdersGridBeforeRender,validateedit:a.onLabOrdersGridValidateEdit},"#rxLabOrderLabsLiveSearch":{select:a.onLoincSearchSelect},"patientlaborderspanel #electronicLabOrderBtn":{click:a.onElectronicLabOrderBtnClick},"patientlaborderspanel #newLabOrderBtn":{click:a.onNewLabOrderBtnClick},"patientlaborderspanel #printLabOrderBtn":{click:a.onPrintLabOrderBtnClick},"#LabOrdersUnableToPerformField":{select:a.onLabOrdersUnableToPerformFieldSelect,fieldreset:a.onLabOrdersUnableToPerformFieldReset}}),a.encounterCtl=a.getController("patient.encounter.Encounter")},onOrdersDeleteActionHandler:function(b,c,d,e,f,g){if(!a("remove_patient_order"))return void app.msg(_("oops"),_("not_authorized"),!0);var h=b.getStore();Ext.Msg.show({title:_("wait"),msg:"<b>"+g.get("description")+"</b><br><br>"+_("delete_this_record"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&Ext.Msg.show({title:_("wait"),msg:_("this_action_can_not_be_undone_continue"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&(h.remove(g),h.sync({callback:function(){h.remove(g),h.sync({callback:function(){}})}}))}})}})},onLabOrdersGridValidateEdit:function(a,b){var c=a.editor.getForm(),d=c.findField("description"),e=d.getValue(),f=d.findRecordByValue(e);null===e?b.record.set({code:null,description:null}):f&&b.record.set({code:f.get("loinc_number"),code_type:"LOINC",description:f.get("loinc_name")})},onLabOrdersUnableToPerformFieldSelect:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=a.findRecordByValue(a.getValue());c.set({not_performed_code:d.get("code"),not_performed_code_type:d.get("code_type"),not_performed_code_text:d.get("option_name")})},onLabOrdersUnableToPerformFieldReset:function(a){var b=a.up("form").getForm(),c=b.getRecord();a.setValue(null),c.set({not_performed_code:null,not_performed_code_type:null,not_performed_code_text:null})},onLabOrdersGridBeforeRender:function(a){app.on("patientunset",function(){a.editingPlugin.cancelEdit(),a.getStore().removeAll()})},onLabOrdersGridSelectionChange:function(a,b){this.getPrintLabOrderBtn().setDisabled(0===b.length)},onLoincSearchSelect:function(a,b){var c=a.up("form").getForm();c.getRecord().set({code:b[0].data.loinc_number}),c.findField("code")&&c.findField("code").setValue(b[0].data.loinc_number),c.findField("note")&&c.findField("note").focus(!1,200)},onElectronicLabOrderBtnClick:function(){},onNewLabOrderBtnClick:function(){var a=this,b=a.getLabOrdersGrid(),c=b.getStore();b.editingPlugin.cancelEdit(),c.insert(0,{pid:app.patient.pid,eid:app.patient.eid,uid:app.user.id,date_ordered:new Date,order_type:"lab",status:"Pending",priority:"Normal"}),b.editingPlugin.startEdit(0,0)},onPrintLabOrderBtnClick:function(a,b){var c=this,d=c.getLabOrdersGrid(),e=Ext.isArray(a)?a:d.getSelectionModel().getSelection(),f={};e.forEach(function(a){var b=Ext.Date.format(a.get("date_ordered"),"Y-m-d"),c=g("order_pdf_format")||null,d="_"+a.get("eid")+a.get("pid")+a.get("uid")+b;return a.get("void")?void app.msg(_("oops"),Ext.String.format("Unable to print voided order #{0}",a.get("id")),!0):(f[d]||(f[d]={},f[d].pid=a.get("pid"),f[d].eid=a.get("eid"),f[d].date_ordered=b,f[d].provider_uid=a.get("uid"),f[d].orderItems=[],f[d].docType="Lab",f[d].templateId=4,f[d].pdf_format=c,f[d].dx_required=!1,f[d].orderItems.push(["Description","Notes"])),void f[d].orderItems.push([a.get("description")+" ["+a.get("code_type")+":"+a.get("code")+"]",a.get("note")]))}),Ext.Object.isEmpty(f)||Ext.Object.each(f,function(a,c){DocumentHandler.createTempDocument(c,function(a){return Ext.isString(a)?void app.msg(_("oops"),a,!0):void(b===!0?Printer.doTempDocumentPrint(1,a.id):window.dual?dual.onDocumentView(a.id,"Lab"):app.onDocumentView(a.id,"Lab"))})})},onLabOrdersGridActive:function(a){var b=a.getStore();a.editingPlugin.editing||(b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid},{property:"order_type",value:"lab"},{property:"is_external_order",value:0}]))},labOrdersGridStatusColumnRenderer:function(a){var b="black";switch(a){case"Canceled":b="red";break;case"Pending":b="orange";break;case"Routed":b="blue";break;case"Complete":b="green";break;default:b=""}return'<div style="color:'+b+'">'+a+"</div>"},doAddOrderByTemplate:function(a){var b=this,c=b.getLabOrdersGrid(),d=c.getStore();a.pid=app.patient.pid,a.eid=app.patient.eid,a.uid=app.user.id,a.date_ordered=new Date,a.order_type="lab",a.status="Pending",a.priority="Normal";var e=d.add(a)[0];e.save({success:function(){app.msg(_("sweet"),a.description+" "+_("added"))}})}}),Ext.define("App.controller.patient.ReviewOfSystem",{extend:"Ext.app.Controller",requires:["App.model.administration.ReviewOfSystemSettings"],refs:[{ref:"ReviewOfSystemSetupBtn",selector:"#ReviewOfSystemSetupBtn"},{ref:"ReviewOfSystemForm",selector:"#ReviewOfSystemForm"}],reviewOfSystemSetupWindow:void 0,reviewOfSystemSetup:{id:null,user_id:0,settings_data:{}},init:function(){var a=this;a.control({viewport:{render:a.onViewportRender},"#ReviewOfSystemForm":{beforerender:a.onReviewOfSystemFormBeforeRender},"#ReviewOfSystemSetupBtn":{click:a.onReviewOfSystemSetupBtnClick},"#ReviewOfSystemSetupCancelBtn":{click:a.onReviewOfSystemSetupCancelBtnClick},"#ReviewOfSystemSetupSaveBtn":{click:a.onReviewOfSystemSetupSaveBtnClick}})},onViewportRender:function(){var b=this;a("access_review_of_systems")&&Encounter.getReviewOfSystemSettingsByUserId(app.user.id,function(a){a!==!1&&(b.reviewOfSystemSetup=a)})},onReviewOfSystemSetupCancelBtnClick:function(){this.reviewOfSystemSetupWindow.close()},onReviewOfSystemSetupSaveBtnClick:function(){var a=this,b=a.reviewOfSystemSetupWindow.down("form").getForm().getValues();a.reviewOfSystemSetup.user_id=app.user.id,Ext.apply(a.reviewOfSystemSetup.settings_data,b),Encounter.saveReviewOfSystemSettings(a.reviewOfSystemSetup,function(b){b!==!1&&(a.reviewOfSystemSetup=b,a.setReviewOfSystemFormField(),a.reviewOfSystemSetupWindow.close())})},onReviewOfSystemSetupBtnClick:function(a){this.showReviewOfSystemSetup(a.up("form"))},onReviewOfSystemFormBeforeRender:function(){this.setReviewOfSystemFormField()},setReviewOfSystemFormField:function(){var me=this,fields=this.getReviewOfSystemForm().getForm().getFields();fields.each(function(field){void 0!==me.reviewOfSystemSetup.settings_data[field.name]&&field.setVisible(eval(me.reviewOfSystemSetup.settings_data[field.name]))})},getReviewOfSystemSetupFields:function(a){var b=[];return a.items.each(function(a){var c={xtype:"fieldset",title:a.title,items:[]};a.items.each(function(a){c.items.push({xtype:"checkbox",boxLabel:a.fieldLabel,checked:!0,name:a.name})}),b.push(c)}),b},showReviewOfSystemSetup:function(a){if(this.reviewOfSystemSetupWindow)return this.reviewOfSystemSetupWindow.show();var b=this.getReviewOfSystemSetupFields(a);return this.reviewOfSystemSetupWindow=Ext.create("Ext.window.Window",{title:"Review Of System Setup",height:600,width:400,layout:"fit",bodyPadding:5,closeAction:"hide",items:[{xtype:"form",bodyPadding:5,autoScroll:!0,items:b}],buttons:[{text:_("cancel"),itemId:"ReviewOfSystemSetupCancelBtn"},{text:_("save"),itemId:"ReviewOfSystemSetupSaveBtn"}]}).show(),this.reviewOfSystemSetupWindow.down("form").getForm().setValues(this.reviewOfSystemSetup.settings_data),this.reviewOfSystemSetup}}),Ext.define("App.controller.patient.Results",{extend:"Ext.app.Controller",requires:["App.view.administration.HL7MessageViewer"],refs:[{ref:"ResultsPanel",selector:"patientresultspanel"},{ref:"ResultsOrdersGrid",selector:"#ResultsOrdersGrid"},{ref:"ResultsCardPanel",selector:"#ResultsCardPanel"},{ref:"ResultsOrderSignBtn",selector:"#ResultsOrderSignBtn"},{ref:"ResultsOrderNewBtn",selector:"#ResultsOrderNewBtn"},{ref:"ResultsOrderResetBtn",selector:"#ResultsOrderResetBtn"},{ref:"ResultsOrderSaveBtn",selector:"#ResultsOrderSaveBtn"},{ref:"ResultsLaboratoryPanel",selector:"#ResultsLaboratoryPanel"},{ref:"ResultsLaboratoryForm",selector:"#ResultsLaboratoryForm"},{ref:"ResultsLaboratoryFormUploadField",selector:"#ResultsLaboratoryFormUploadField"},{ref:"ResultsLaboratoryObservationsGrid",selector:"#ResultsLaboratoryObservationsGrid"},{ref:"ResultsRadiologyPanel",selector:"#ResultsRadiologyPanel"},{ref:"ResultsRadiologyForm",selector:"#ResultsRadiologyForm"},{ref:"ResultsRadiologyFormUploadField",selector:"#ResultsRadiologyFormUploadField"},{ref:"ResultsRadiologyFormViewStudyBtn",selector:"#ResultsRadiologyFormViewStudyBtn"},{ref:"ResultsRadiologyDocumentIframe",selector:"#ResultsRadiologyDocumentIframe"},{ref:"ResultsRadiologyReportBody",selector:"#ResultsRadiologyReportBody"}],init:function(){var a=this;a.control({patientresultspanel:{activate:a.onResultPanelActive},"#ResultsOrdersGrid":{render:a.onResultsOrdersGridRender,selectionchange:a.onOrderSelectionChange},"#ResultsLaboratoryFormUploadField":{change:a.onOrderDocumentChange},"#ResultsOrderResetBtn":{click:a.onResultsOrderResetBtnClick},"#ResultsOrderSaveBtn":{click:a.onResultsOrderSaveBtnClick},"#ResultsLabsLiveSearchField":{select:a.onResultsLabsLiveSearchFieldSelect},"#ResultsRadsLiveSearchField":{select:a.onResultsRadsLiveSearchFieldSelect},"#ResultsLaboratoryPanelDocumentViewBtn":{click:a.onOrderDocumentViewBtnClicked},"#ResultsLabOrderNewBtn":{click:a.onNewOrderLabResultBtnClick},"#ResultsRadOrderNewBtn":{click:a.onNewOrderRadResultBtnClick},"#ResultsOrderSignBtn":{click:a.onOrderResultSignBtnClick},"#ResultsOrdersGridOrderTypeCombo":{change:a.onOrderTypeSelect},"#ResultsOrdersGridRowEditor":{beforeedit:a.onOrderResultGridRowEdit},"#ResultsOrdersGridOrderVoidCheckbox":{change:a.onResultsOrdersGridOrderVoidCheckboxChange},"#ResultsRadiologyFormViewStudyBtn":{click:a.onResultsRadiologyFormViewStudyBtnClick},"#ResultsCardPanel referringphysicianlivetsearch":{select:a.onResultsCardPanelReferringPhysicianLiveSearchSelect}})},onResultsCardPanelReferringPhysicianLiveSearchSelect:function(a,b){var c=a.up("form").getForm(),d=c.getRecord();d.set({performer_id:b[0].get("id")}),c.setValues({performer_name:b[0].get("fullname")})},onResultsLabsLiveSearchFieldSelect:function(a,b){a.up("form").getRecord().set({code:b[0].get("loinc_number"),code_text:b[0].get("loinc_name"),code_type:"LOINC"})},onResultsRadsLiveSearchFieldSelect:function(a,b){a.up("form").getRecord().set({code:b[0].get("loinc_number"),code_text:b[0].get("loinc_name"),code_type:"LOINC"})},onResultsOrdersGridOrderVoidCheckboxChange:function(){},onOrderResultSignBtnClick:function(){var a,b=this;app.passwordVerificationWin(function(c,d){"ok"===c&&User.verifyUserPass(d,function(c){c?(a=b.getActiveForm().getForm().getRecord(),a.set({signed_uid:app.user.id}),a.save({success:function(){app.msg(_("sweet"),_("result_signed"))},failure:function(){app.msg(_("sweet"),_("record_error"),!0)}})):b.onOrderResultSignBtnClick()})})},onResultsOrdersGridRender:function(a){a.store.on("write",this.onResultsOrdersGridStoreWrite,this)},onResultsOrdersGridStoreWrite:function(a,b){var c=this,d=c.getResultsOrdersGrid().getSelectionModel(),e=d.getLastSelected();"create"===b.action&&("lab"===e.data.order_type?this.getLabOrderResult(e):"lab"===e.data.order_type&&this.getRadOrderResult(e))},onOrderSelectionEdit:function(a,b){this.getLabOrderResult(b.record)},onNewOrderLabResultBtnClick:function(){this.doNewOrderResult("lab")},onNewOrderRadResultBtnClick:function(){this.doNewOrderResult("rad")},doNewOrderResult:function(a){var b,c=this.getResultsOrdersGrid(),d=c.getStore();c.editingPlugin.cancelEdit(),b=d.add({pid:app.patient.pid,uid:app.user.id,eid:app.patient.eid,is_external_order:1,order_type:a,status:"Pending"}),c.getPlugin("ResultsOrdersGridRowEditor").startEdit(b[0],0),this.setEditor(c,a),this.onOrderSelectionChange(null,b)},onOrderResultGridRowEdit:function(){},onOrderTypeSelect:function(a,b){var c=a.up("grid");this.setEditor(c,b)},setEditor:function(a,b){"lab"===b&&(this.getResultsCardPanel().getLayout().setActiveItem("ResultsLaboratoryPanel"),a.columns[4].setEditor({xtype:"labslivetsearch",itemId:"ResultsLabsLiveSearchField",allowBlank:!1,flex:1,value:""})),"rad"===b&&(this.getResultsCardPanel().getLayout().setActiveItem("ResultsRadiologyPanel"),a.columns[4].setEditor({xtype:"radslivetsearch",itemId:"ResultsRadsLiveSearchField",allowBlank:!1,flex:1,value:""}))},onResultPanelActive:function(){this.setResultPanel()},setResultPanel:function(){var a=this,b=a.getResultsOrdersGrid().getStore();app.patient?(b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])):(b.clearFilter(!0),b.load())},onOrderSelectionChange:function(a,b){var c=this.getResultsCardPanel();c.isVisible()||c.setVisible(!0),b.length>0?"lab"===b[0].data.order_type?(c.getLayout().setActiveItem("ResultsLaboratoryPanel"),b.length>0&&this.getLabOrderResult(b[0])):"rad"===b[0].data.order_type?(c.getLayout().setActiveItem("ResultsRadiologyPanel"),b.length>0&&this.getRadOrderResult(b[0])):this.resetOrderResultForm():this.resetOrderResultForm()},getLabOrderResult:function(a){var b,c,d,e=this,f=e.getResultsLaboratoryForm(),g=a.results(),h=e.getResultsLaboratoryObservationsGrid();h.editingPlugin.cancelEdit(),0!==a.get("id")&&g.load({callback:function(i){if(i.length>0){var j=i.length-1;i[j].order_record=a,f.loadRecord(i[j]),e.getResultsOrderSignBtn().setDisabled(i[j].data.signed_uid>0),b=i[j].observations(),h.reconfigure(b),b.load()}else c=g.add({pid:a.data.pid,code:a.data.code,code_text:a.data.description,code_type:a.data.code_type,order_id:a.data.id,ordered_uid:a.data.uid,create_date:new Date}),c[0].order_record=a,c[0].set({order_id:a.data.id}),f.loadRecord(c[0]),e.getResultsOrderSignBtn().setDisabled(!0),b=c[0].observations(),h.reconfigure(b),b.load({params:{loinc:a.data.code},callback:function(a){for(d=0;d<a.length;d++)a[d].phantom=!0}})}})},getRadOrderResult:function(a){var b=this,c=b.getResultsRadiologyForm().getForm(),d=a.results();d.load({callback:function(e){if(e.length>0){var f=e.length-1;e[f].order_record=a,c.loadRecord(e[f]),b.getResultsOrderSignBtn().setDisabled(e[f].data.signed_uid>0),b.getResultsRadiologyReportBody().setValue(e[f].get("report_body")),b.loadRadiologyDocument(e[f]),b.setViewStudyBtn(e[f])}else{var g=d.add({pid:a.data.pid,code:a.data.code,code_text:a.data.description,code_type:a.data.code_type,order_id:a.data.id,report_body:"",ordered_uid:a.data.uid,create_date:new Date});g[0].order_record=a,g[0].set({order_id:a.data.id}),c.loadRecord(g[0]),b.getResultsRadiologyReportBody().setValue(g[0].get("report_body")),b.loadRadiologyDocument(g[0]),b.setViewStudyBtn(g[0])}}})},setViewStudyBtn:function(a){this.getResultsRadiologyFormViewStudyBtn().setDisabled(""==a.get("study_link"))},onResultsRadiologyFormViewStudyBtnClick:function(){var a=this.getActiveForm().getForm().getRecord(),b=window.open(a.get("study_link"),"dicom_viewer");
b?b.focus():app.msg(_("oops"),_("unable_to_open_new_tab"),!0)},onResultsOrderSaveBtnClick:function(){var a=this.getActiveForm();"ResultsLaboratoryForm"==a.itemId?this.saveLabOrderResultForm(a.getForm()):"ResultsRadiologyForm"==a.itemId&&this.saveRadOrderResultForm(a.getForm())},saveLabOrderResultForm:function(a){var b=this,c=a.getRecord(),d=b.getResultsOrdersGrid().getSelectionModel(),e=d.getSelection(),f=a.getValues();if(a.isValid()){var g=c.observations(),h=g.tree.flatten();f.order_id=c.order_record.get("id"),c.set(f),c.save({success:function(a){for(var b=1;b<h.length;b++)h[b].set({result_id:a.data.id});g.sync({callback:function(){}}),e[0].set({status:"Received"}),e[0].save(),app.msg(_("sweet"),_("record_saved"))}})}},saveRadOrderResultForm:function(a){if(a.isValid()){var b=this,c=a.getRecord(),d=a.getValues(),e=new FileReader,f=b.getResultsRadiologyFormUploadField().extractFileInput().files;d.order_id=c.order_record.get("id"),d.code=c.order_record.get("code"),d.code_text=c.order_record.get("description"),d.code_type=c.order_record.get("code_type"),d.report_body=b.getResultsRadiologyReportBody().getValue(),f[0]?(e.onload=function(a){d.upload=a.target.result,c.set(d),c.save({callback:function(){b.loadRadiologyDocument(c),app.msg(_("sweet"),_("record_saved"))}})},e.readAsDataURL(b.getResultsRadiologyFormUploadField().extractFileInput().files[0])):(c.set(d),c.save({callback:function(){b.loadRadiologyDocument(c),app.msg(_("sweet"),_("record_saved"))}}))}},loadRadiologyDocument:function(a){var b=a.get("documentId"),c=this.getResultsRadiologyDocumentIframe();if(""!=b){var d=b.split("|");2==d.length&&c.setSrc(Ext.String.format("dataProvider/DocumentViewer.php?site={0}&token={1}&id={2}",app.user.site,app.user.token,d[1]))}else c.setSrc("about:blank")},onResultsOrderResetBtnClick:function(){this.resetOrderResultForm()},resetOrderResultForm:function(){var a=this.getActiveForm();"ResultsLaboratoryForm"==a.itemId?this.resetLabOrderResultForm(a.getForm()):"ResultsRadiologyForm"==a.itemId&&this.resetRadOrderResultForm(a.getForm());var b=this.getResultsCardPanel();b.isVisible()&&b.setVisible(!1)},resetLabOrderResultForm:function(a){var b=this,c=b.getResultsLaboratoryObservationsGrid(),d=Ext.create("App.store.patient.PatientsOrderObservations");a.reset(),c.editingPlugin.cancelEdit(),c.reconfigure(d)},resetRadOrderResultForm:function(a){a.reset(),this.getResultsRadiologyDocumentIframe().setSrc("about:blank")},getActiveForm:function(){return this.getResultsCardPanel().getLayout().getActiveItem().down("form")},onOrderDocumentViewBtnClicked:function(){var a,b,c=this,d=c.getResultsLaboratoryForm(),e=d.getRecord(),f=e.data.documentId.split("|");f[0]&&(a=f[0]),f[1]&&(b=f[1]),a&&b?"hl7"==a?app.getController("administration.HL7").viewHL7MessageDetailById(b):"doc"==a&&app.onDocumentView(b):app.msg(_("oops"),_("no_document_found"),!0)},onOrderDocumentChange:function(){}}),Ext.define("App.controller.patient.encounter.Encounter",{extend:"Ext.app.Controller",requires:["App.ux.combo.ActiveSpecialties"],refs:[{ref:"EncounterPanel",selector:"#encounterPanel"},{ref:"EncounterProgressNotePanel",selector:"#EncounterProgressNotePanel"},{ref:"EncounterDetailWindow",selector:"#EncounterDetailWindow"},{ref:"EncounterProviderCmb",selector:"#EncounterProviderCmb"},{ref:"EncounterSpecialtyCmb",selector:"#EncounterSpecialtyCmb"},{ref:"EncounterDetailForm",selector:"#EncounterDetailForm"},{ref:"EncounterTransferWindow",selector:"#EncounterTransferWindow"},{ref:"EncounterTransferPatientSearchField",selector:"#EncounterTransferPatientSearchField"},{ref:"PatientSummaryEncountersPanel",selector:"#PatientSummaryEncountersPanel"},{ref:"EncounterMedicalToolbarSignBtn",selector:"#EncounterMedicalToolbarSignBtn"},{ref:"EncounterMedicalToolbarAddendumAddBtn",selector:"#EncounterMedicalToolbarAddendumAddBtn"}],init:function(){var a=this;this.control({viewport:{patientunset:a.onPatientUnset,encounterload:a.onEncounterLoad},"#EncounterDetailForm combobox[name=visit_category]":{select:a.onEncounterDetailFormVisitCategoryComboSelect},"#EncounterDetailForm combobox[name=referring_physician]":{beforerender:a.onEncounterDetailFormReferringComboSelect},"#EncounterDetailWindow":{show:a.onEncounterDetailWindowShow},"#EncounterProviderCmb":{beforerender:a.onEncounterProviderCmbBeforeRender,select:a.onEncounterProviderCmbSelect},"#EncounterCDAImportBtn":{click:a.onEncounterCDAImportBtnClick},"#EncounterDeletetBtn":{click:a.onEncounterDeleteBtnClick},"#EncounterTransferBtn":{click:a.onEncounterTransferBtnClick},"#EncounterTransferWindowCancelBtn":{click:a.onEncounterTransferWindowCancelBtnClick},"#EncounterTransferWindowTransferBtn":{click:a.onEncounterTransferWindowTransferBtnlick},"#EncounterNewProgressNoteBtn":{click:a.onEncounterNewProgressNoteBtnClick},"#PatientSummeryNewProgressNoteBtn":{click:a.onPatientSummeryNewProgressNoteBtnClick}}),a.importCtrl=this.getController("patient.CCDImport"),a.auditLogCtrl=this.getController("administration.AuditLog")},doNewEncounterWindow:function(b){var c=this,d=c.getEncounterDetailWindow(),e=d.down("form").getForm();b=b||{},a("add_encounters")?(d.show(),e.loadRecord(Ext.create("App.model.patient.Encounter",b))):app.accessDenied()},onEncounterNewProgressNoteBtnClick:function(){var a=this.getEncounterPanel().encounter,b={pid:app.patient.pid,parent_eid:app.patient.eid,brief_description:Ext.String.format("FOLLOW-UP: {0}",a.get("brief_description")),open_uid:app.user.id,service_date:app.getDate(),onset_date:a.get("onset_date"),patient_class:a.get("patient_class"),specialty_id:a.get("specialty_id"),provider_uid:a.get("provider_uid"),provider_title:a.get("provider_title"),provider_fname:a.get("provider_fname"),provider_mname:a.get("provider_mname"),provider_lname:a.get("provider_lname"),priority:a.get("priority"),facility:a.get("facility"),referring_physician:a.get("referring_physician")};this.doNewEncounterWindow(b)},onPatientSummeryNewProgressNoteBtnClick:function(){var a,b=this,c=b.getPatientSummaryEncountersPanel().getSelectionModel().getSelection();if(0===c.length)return void app.msg(_("oops"),_("no_encounter_selected"),!0);var a=c[0],d={pid:app.patient.pid,parent_eid:app.patient.eid,brief_description:Ext.String.format("FOLLOW-UP: {0}",a.get("brief_description")),open_uid:app.user.id,service_date:app.getDate(),onset_date:a.get("onset_date"),patient_class:a.get("patient_class"),specialty_id:a.get("specialty_id"),provider_uid:a.get("provider_uid"),provider_title:a.get("provider_title"),provider_fname:a.get("provider_fname"),provider_mname:a.get("provider_mname"),provider_lname:a.get("provider_lname"),priority:a.get("priority"),facility:a.get("facility"),referring_physician:a.get("referring_physician")};this.doNewEncounterWindow(d)},onEncounterDeleteBtnClick:function(){},onEncounterTransferBtnClick:function(){this.showEncounterTransferWindow()},onEncounterTransferWindowCancelBtnClick:function(){this.getEncounterTransferPatientSearchField().reset(),this.getEncounterTransferWindow().close()},onEncounterTransferWindowTransferBtnlick:function(){var a=this,b=a.getEncounterTransferPatientSearchField(),c=b.getValue(),d=app.patient.eid,e=b.findRecordByValue(c);if(b.isValid()){a.getEncounterTransferPatientSearchField().reset(),a.getEncounterTransferWindow().close();var f=app.patient.name,g=e.get("fullname");Ext.Msg.show({title:_("wait"),msg:Ext.String.format(_("encounter_transfer_from_x_to_x_msg"),f,g),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"===b&&(a.getEncounterDetailWindow().close(),Ext.getBody().mask(_("be_right_back")),Encounter.TransferEncounter(d,c,function(b){Ext.getBody().unmask(),b&&(a.auditLogCtrl.addLog(c,app.user.id,d,d,"encounters","ENCOUNTER_TRANSFER",Ext.String.format("Encounter trasnfer from {0} to {1}",f,g)),app.setPatient(c,d,app.user.site,function(){app.openEncounter(d)}))}))}})}},showEncounterTransferWindow:function(){return this.getEncounterTransferWindow()||Ext.create("App.view.patient.windows.EncounterTransferWindow"),this.getEncounterTransferWindow().show()},onEncounterLoad:function(a,b){app.onMedicalWin(),this.setEncounterState(a,b)},setEncounterState:function(a,b){var c=this;app.patient.encounterIsClose=a.isClose(),app.patient.encounterAllowEdit=app.user.id==a.get("provider_uid")||!app.patient.encounterIsClose||null==app.patient.eid,c.setEncounterEditState(app.patient.encounterAllowEdit),c.setEncounterSignAddendumState(app.patient.encounterIsClose),c.setEncounterSayDayWarningState(a,b)},setEncounterEditState:function(a){var b=Ext.ComponentQuery.query("#encounterRecordAdd, button[action=encounterRecordAdd]"),c=Ext.ComponentQuery.query("#encounterPanel form[advanceFormPlugin]");b.forEach(function(b){b.setDisabled(!a)}),c.forEach(function(b){b.advanceFormPlugin.enabled=a})},setEncounterSignAddendumState:function(a){var b=this.getEncounterMedicalToolbarSignBtn(),c=this.getEncounterMedicalToolbarAddendumAddBtn();b&&b.setVisible(!a),c&&c.setVisible(a)},setEncounterSayDayWarningState:function(a,b){a.get("service_date").toLocaleDateString()!==(new Date).toLocaleDateString()?(b.encounterTabPanel.ownerCt.addBodyCls("encounter-not-same-day"),b.getPageBodyContainer().addCls("encounter-not-same-day"),app.msg(_("warning"),_("encounter_service_date_error_msg"),!0)):(b.encounterTabPanel.ownerCt.removeBodyCls("encounter-not-same-day"),b.getPageBodyContainer().removeCls("encounter-not-same-day"))},getProgressNote:function(){var a=this,b=a.getEncounterPanel();Encounter.getProgressNoteByEid(b.eid,function(a,c){b.progressNote.tpl.overwrite(b.progressNote.body,c.result)})},onPatientUnset:function(){this.getEncounterPanel()&&(this.getEncounterPanel().encounter=null)},onEncounterDetailFormVisitCategoryComboSelect:function(a,b){var c=a.up("form").getForm().getRecord();c.set({visit_category_code:b[0].get("code"),visit_category_code_type:b[0].get("code_type")})},getEncounterRecord:function(){return Ext.isEmpty(this.getEncounterPanel())?null:this.getEncounterPanel().encounter},onEncounterProviderCmbBeforeRender:function(a){var b=a.up("container");b.setFieldLabel(""),b.insert(b.items.indexOf(a)+1,{xtype:"activespecialtiescombo",itemId:"EncounterSpecialtyCmb",fieldLabel:_("specialty"),labelWidth:a.labelWidth,width:a.width,name:"specialty_id",allowBlank:!1})},onEncounterDetailFormReferringComboSelect:function(){},onEncounterProviderCmbSelect:function(a,b){var c=this;User.getUser(b[0].data.option_value,function(a){c.setSpecialtyCombo(a)})},onEncounterDetailWindowShow:function(){var a=this,b=a.getEncounterDetailForm().getForm().getRecord();0===b.data.provider_uid?a.getEncounterSpecialtyCmb()&&a.getEncounterSpecialtyCmb().setVisible(!1):User.getUser(b.data.provider_uid,function(c){a.setSpecialtyCombo(c,b.data.specialty_id)})},setSpecialtyCombo:function(a,b){var c=this.reloadSpecialityCmbBySpecialty(a.specialty,b);this.getEncounterSpecialtyCmb().setVisible(c),this.getEncounterSpecialtyCmb().setDisabled(!c)},reloadSpecialityCmbBySpecialty:function(specialties,specialty){var me=this,show=!1;if(me.getEncounterSpecialtyCmb().setValue(Ext.isNumeric(specialty)&&specialty>0?eval(specialty):Ext.isArray(specialties)&&1==specialties.length?eval(specialties[0]):null),Ext.isArray(specialties)){for(var store=this.getEncounterSpecialtyCmb().getStore(),filters=[],show=!0,i=0;i<specialties.length;i++)Ext.Array.push(filters,specialties[i]);store.clearFilter(!0),store.filter([{property:"active",value:!0},{property:"id",value:new RegExp(filters.join("|"))}])}return show},onEncounterCDAImportBtnClick:function(){var a=this,b=Ext.create("App.ux.form.fields.UploadString");b.allowExtensions=["xml","ccd","cda","ccda"],b.on("uploadready",function(b,c){a.getDocumentData(c)}),b.show()},getDocumentData:function(a){var b=this;CDA_Parser.parseDocument(a,function(c){b.importCtrl.validatePosibleDuplicates=!1,b.importCtrl.CcdImport(c,app.patient.pid,a),b.importCtrl.validatePosibleDuplicates=!0,b.promptCcdScore(a,c)})},promptCcdScore:function(a,b){var c=this;Ext.Msg.show({title:"C-CDA Score",msg:"Would you like to see this C-CDA score?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"===d&&c.doCcdScore(a,b)}})},doCcdScore:function(a,b){CDA_ScoreCard.getScoreDocument(a,Ext.String.format("{0}, {1} {3} (C-CDA)",b.patient.lname,b.patient.fname,b.patient.title),function(a){a&&app.getController("DocumentViewer").doDocumentView(a.id,"temp")})}}),Ext.define("App.controller.reports.Reports",{extend:"Ext.app.Controller",requires:["App.ux.grid.Printer"],refs:[{ref:"ReportsPanel",selector:"#ReportsPanel"},{ref:"ReportsGrid",selector:"#ReportsGrid"},{ref:"ReportWindow",selector:"#ReportWindow"},{ref:"ReportWindowForm",selector:"#ReportWindowForm"},{ref:"ReportWindowGrid",selector:"#ReportWindowGrid"},{ref:"AdministrationReportWindow",selector:"#AdministrationReportWindow"},{ref:"ReportWindowReloadBtn",selector:"#ReportWindowReloadBtn"}],init:function(){if(a("access_reports")){var b=this;b.nav=b.getController("Navigation"),b.nav.addNavigationNodes("reports",{text:_("reports"),leaf:!0,cls:"file",id:"App.view.reports.ReportsPanel"},0),b.control({"#ReportsGrid":{beforerender:b.onReportsGridBeforeRender,itemdblclick:b.onReportsGridItemDblClick,beforeitemcontextmenu:b.onReportsGridBeforeItemContextMenu},"#ReportWindowReloadBtn":{click:b.onReportWindowReloadBtnClick},"#ReportWindowGridPrintBtn":{click:b.onReportWindowGridPrintBtnClick},"#AdministrationReportsAddBtn":{click:b.onAdministrationReportsAddBtnClick},"#AdministrationReportCancelBtn":{click:b.onAdministrationReportCancelBtnClick},"#AdministrationReportSaveBtn":{click:b.onAdministrationReportSaveBtnClick},"#ReportWindowGroupByCmb":{select:b.onReportWindowGroupByCmbSelect}})}},showAdministrationReportWindow:function(){return this.getAdministrationReportWindow()||Ext.create("Ext.window.Window",{title:_("report"),layout:"fit",bodyPadding:5,width:800,itemId:"AdministrationReportWindow",items:[{xtype:"form",bodyPadding:10,items:[{xtype:"textfield",fieldLabel:_("title"),name:"title",anchor:"100%",allowBlank:!1},{xtype:"textfield",fieldLabel:_("description"),name:"description",anchor:"100%",allowBlank:!1},{xtype:"textfield",fieldLabel:_("store_procedure_name"),name:"store_procedure_name",anchor:"100%",allowBlank:!1},{xtype:"textfield",fieldLabel:_("group_fields"),name:"group_fields",anchor:"100%"},{xtype:"aclpermissions",fieldLabel:_("permission"),name:"report_perm",anchor:"100%"},{xtype:"textareafield",fieldLabel:_("columns"),name:"columns",height:500,anchor:"100%",allowBlank:!1,enableKeyEvents:!0,fieldStyle:{fontFamily:"Courier",fontSize:"12px"},listeners:{specialkey:function(a,b){if(b.getKey()==b.TAB){b.stopEvent();var c=a.inputEl.dom;if(c.setSelectionRange){var d=c.value.substring(0,c.selectionStart)+"    ",e=d.length;c.value=d+c.value.substring(c.selectionEnd,c.value.length),c.setSelectionRange(e,e)}else document.selection&&(document.selection.createRange().text="    ")}}}}]}],buttons:[{xtype:"button",text:_("cancel"),itemId:"AdministrationReportCancelBtn"},{xtype:"button",text:_("save"),itemId:"AdministrationReportSaveBtn"}]}),this.getAdministrationReportWindow().show()},onReportsGridBeforeItemContextMenu:function(b,c,d,e,f){if(f.preventDefault(),a("access_admin_reports")){var g=this.showAdministrationReportWindow();g.down("form").getForm().loadRecord(c)}},onAdministrationReportsAddBtnClick:function(){var a=this.showAdministrationReportWindow(),b=this.getReportsGrid().getStore().add({workflow:"PRE-REGISTRATION",days_valid_for:365,version:"1.0",active:!1});a.down("form").getForm().loadRecord(b[0])},onAdministrationReportCancelBtnClick:function(a){var b=a.up("window");b.down("form").getForm().reset(!0),this.getReportsGrid().getStore().rejectChanges(),b.close()},onAdministrationReportSaveBtnClick:function(a){var b=a.up("window"),c=b.down("form").getForm(),d=c.getRecord(),e=c.getValues();c.isValid()&&(d.set(e),d.store.getModifiedRecords().length>0?d.store.sync({callback:function(){b.close()}}):b.close())},onReportWindowGridPrintBtnClick:function(a){var b=a.up("grid"),c=b.up("window"),d=(c.down("form").getForm(),[]);return b.filters?(Ext.Object.each(b.filters,function(a,b){var c=b?b:"None";d.push(Ext.String.format("<b>{0}</b>: {1}",_(a),c))}),App.ux.grid.Printer.mainTitle=Ext.String.format("{0} Report",c.title),App.ux.grid.Printer.filtersHtml="Filters: "+d.join(", "),void App.ux.grid.Printer.print(b)):void app.msg(_("oops"),"No Filters Found",!0)},onReportsGridBeforeRender:function(a){a.store.load()},onReportsGridItemDblClick:function(grid,record){var me=this,win=me.showReportsWindow(),form=win.down("form"),report_grid=win.down("grid"),group_fields=record.get("group_fields"),model_fields=[],search_fields=[],columns,group_by;report_grid.filters=void 0,win.setTitle("Report Viewer"),win.el.mask("Getting Things Ready"),report_grid.setTitle(record.get("title")),Reports.getReport(record.get("id"),function(response){if(win.el.unmask(),response===!1)return void win.close();if(response.parameters.forEach(function(a){return app.fireEvent("beforereportfilteradd",me,a,search_fields)!==!1?"date"===a.DATA_TYPE||"datetime"===a.DATA_TYPE?void search_fields.push({xtype:"datefield",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",name:a.PARAMETER_NAME}):"facility_id"===a.PARAMETER_NAME?void search_fields.push({xtype:"mitos.facilitiescombo",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,name:a.PARAMETER_NAME}):"specialty_id"===a.PARAMETER_NAME?void search_fields.push({xtype:"specialtiescombo",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,name:a.PARAMETER_NAME}):"department_id"===a.PARAMETER_NAME?void search_fields.push({xtype:"depatmentscombo",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,name:a.PARAMETER_NAME}):"insurance_id"===a.PARAMETER_NAME?void search_fields.push({xtype:"insurancescombo",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,name:a.PARAMETER_NAME}):-1!==a.PARAMETER_NAME.search(/_uid$/)?void search_fields.push({xtype:"userlivetsearch",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",hideLabel:!1,name:a.PARAMETER_NAME}):-1!==a.PARAMETER_NAME.search(/^pid$|_pid$/)?void search_fields.push({xtype:"patienlivetsearch",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",hideLabel:!1,name:a.PARAMETER_NAME}):"insurance_type"===a.PARAMETER_NAME?void search_fields.push({xtype:"gaiaehr.combo",listKey:"ins_type",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,editable:!1,name:a.PARAMETER_NAME}):"claim_payment_type"===a.PARAMETER_NAME?void search_fields.push({xtype:"gaiaehr.combo",listKey:"clm_pay",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",multiSelect:!0,editable:!1,name:a.PARAMETER_NAME}):void search_fields.push({xtype:"textfield",fieldLabel:_(a.PARAMETER_NAME),labelAlign:"top",margin:"0 5 0 0",name:a.PARAMETER_NAME}):void 0}),""!==group_fields){group_fields=group_fields.split(",");var data=[];group_fields.forEach(function(a){null==group_by&&(group_by=a),data.push([a,_(a)])}),search_fields.push({xtype:"combo",fieldLabel:_("group_by"),labelAlign:"top",margin:"0 5 0 0",itemId:"ReportWindowGroupByCmb",submitValue:!1,value:group_by,store:data})}form.add(search_fields),columns=eval("("+response.columns+")"),columns.forEach(function(a){model_fields.push({type:a.dataType,name:a.dataIndex})}),group_by?report_grid.reconfigure(Ext.create("Ext.data.Store",{fields:model_fields,groupField:group_by}),columns):report_grid.reconfigure(Ext.create("Ext.data.Store",{fields:model_fields}),columns)})},onReportWindowGroupByCmbSelect:function(){},onReportWindowReloadBtnClick:function(a){var b=this,c=a.up("window"),d=c.down("form").getForm(),e=c.down("form").down("#ReportWindowGroupByCmb"),f=c.down("grid"),g=f.getStore(),h=d.getValues(),i=b.getReportsGrid().getSelectionModel().getSelection()[0],j=b.getReportWindowReloadBtn();Ext.Object.each(h,function(a,b){Ext.isArray(b)&&(h[a]=b.join(","))}),f.el.mask("Loading!!!"),f.filters=h,g.removeAll(),e&&g.group(e.getValue()),j.setDisabled(!0),Reports.runReportByIdAndFilters(i.get("id"),h,function(a){g.loadRawData(a),f.el.unmask(),j.setDisabled(!1)})},showReportsWindow:function(){return this.getReportWindow()||Ext.create("App.view.reports.ReportWindow"),this.getReportWindow().show()}}),Ext.define("App.view.patient.ActiveProblems",{extend:"Ext.grid.Panel",requires:["App.ux.grid.RowFormEditing","App.ux.LiveSnomedProblemSearch","App.ux.combo.CodesTypes","App.ux.combo.Occurrence","App.ux.combo.Outcome2"],xtype:"patientactiveproblemspanel",title:_("act_prob"),columnLines:!0,store:Ext.create("App.store.patient.PatientActiveProblems",{remoteFilter:!0,autoSync:!1}),columns:[{xtype:"griddeletecolumn",acl:a("delete_active_problem"),width:25},{xtype:"actioncolumn",width:25,items:[{icon:"resources/images/icons/blueInfo.png",tooltip:"Get Info",handler:function(a,b,c,d,e,f){App.app.getController("InfoButton").doGetInfo(f.data.code,f.data.code_type,f.data.code_text)}}]},{header:_("type"),width:150,dataIndex:"problem_type"},{header:_("problem"),flex:1,dataIndex:"code_text",renderer:function(a,b,c){return a+" ("+c.data.code+")"}},{header:_("occurrence"),width:200,dataIndex:"occurrence"},{xtype:"datecolumn",header:_("begin_date"),width:100,format:"Y-m-d",dataIndex:"begin_date"},{xtype:"datecolumn",header:_("end_date"),width:100,format:"Y-m-d",dataIndex:"end_date"},{header:_("status"),groupable:!1,width:60,dataIndex:"status"}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:2,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",padding:10,layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0"},items:[{xtype:"gaiaehr.combo",listKey:"problems_types",name:"problem_type_code",itemId:"ActiveProblemTypeCmb",labelWidth:70,width:250,fieldLabel:_("type"),editable:!1},{xtype:"liveicdxsearch",fieldLabel:_("problem"),name:"code_text",hideLabel:!1,itemId:"activeProblemLiveSearch",enableKeyEvents:!0,displayField:"code_text",valueField:"code_text",width:460,labelWidth:70,margin:"0 10 0 0",allowBlank:!1}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0"},items:[{fieldLabel:_("occurrence"),width:250,labelWidth:70,xtype:"mitos.occurrencecombo",name:"occurrence",allowBlank:!1},{xtype:"textfield",width:460,labelWidth:70,fieldLabel:_("referred_by"),name:"referred_by"}]},{fieldLabel:_("note"),xtype:"textfield",width:720,labelWidth:70,name:"note"}]},{xtype:"container",padding:10,layout:"vbox",defaults:{labelWidth:70,margin:"0 0 5 0",width:200},items:[{fieldLabel:_("status"),xtype:"gaiaehr.combo",name:"status",itemId:"ActiveProblemStatusCombo",list:112},{fieldLabel:_("begin_date"),xtype:"datefield",format:"Y-m-d",name:"begin_date"},{fieldLabel:_("end_date"),xtype:"datefield",format:"Y-m-d",name:"end_date"}]}]}]}),tbar:["->",{text:_("add_new"),action:"encounterRecordAdd",itemId:"addActiveProblemBtn",iconCls:"icoAdd"}],bbar:["-",{text:_("reconciled"),itemId:"PatientProblemsReconciledBtn",enableToggle:!0,pressed:!0},"-",{text:_("active"),itemId:"PatientProblemsActiveBtn",enableToggle:!0,pressed:!1},"->",{text:_("review"),itemId:"ActiveProblemsReviewBtn",action:"encounterRecordAdd"}]}),Ext.define("App.view.patient.ProceduresHistoryGrid",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","App.ux.LiveSnomedProcedureSearch","App.ux.LiveReferringPhysicianSearch","App.ux.LiveSnomedBodySiteSearch"],xtype:"patientprocedureshistorygrid",title:_("proc_hx"),columnLines:!0,store:Ext.create("App.store.patient.ProcedureHistory",{remoteFilter:!0}),plugins:[{ptype:"rowediting",clicksToEdit:2}],columns:[{xtype:"griddeletecolumn",acl:a("delete_procedures_history"),width:25},{xtype:"datecolumn",header:_("performed_date"),width:150,dataIndex:"performed_date",format:"Y-m-d",editor:{xtype:"datefield"}},{header:_("procedure"),width:300,dataIndex:"procedure",editor:{xtype:"snomedliveproceduresearch",itemId:"ProceduresHistoryGridProcedureField",valueField:"Term"}},{header:_("body_site"),width:200,dataIndex:"target_site_code_text",editor:{xtype:"snomedlivebodysitesearch",itemId:"ProceduresHistoryGridTargetSiteField",valueField:"Term"}},{header:_("performer"),width:200,dataIndex:"performer",editor:{xtype:"referringphysicianlivetsearch",itemId:"ProceduresHistoryGridPerformerField",valueField:"fullname"}},{header:_("service_location"),width:200,dataIndex:"service_location",editor:{xtype:"referringphysicianlivetsearch",itemId:"ProceduresHistoryGridServiceLocationField",valueField:"fullname"}},{header:_("notes"),flex:1,dataIndex:"notes",editor:{xtype:"textfield"}}],tbar:["->",{text:_("procedure"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"ProceduresHistoryGridAddBtn"}]}),Ext.define("App.view.patient.CognitiveAndFunctionalStatus",{extend:"Ext.grid.Panel",requires:["App.ux.grid.RowFormEditing","App.ux.LiveSnomedSearch","App.store.patient.CognitiveAndFunctionalStatus"],xtype:"patientcognitiveandfunctionalstatuspanel",title:_("func_stat"),columnLines:!0,store:Ext.create("App.store.patient.CognitiveAndFunctionalStatus",{remoteFilter:!0}),plugins:[{ptype:"rowediting",errorSummary:!1}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove")}]},{header:_("category"),width:150,dataIndex:"category",editor:{xtype:"gaiaehr.combo",list:117,itemId:"functionalStatusCategoryCombo",allowBlank:!1}},{header:_("description"),flex:1,dataIndex:"code_text",editor:{xtype:"snomedlivesearch",itemId:"functionalStatusCodeCombo",displayField:"Term",valueField:"Term",allowBlank:!1}},{header:_("note"),flex:2,dataIndex:"note",editor:{xtype:"textfield"}},{xtype:"datecolumn",header:_("begin_date"),dataIndex:"begin_date",format:"Y-m-d",editor:{xtype:"datefield",format:"Y-m-d"}},{xtype:"datecolumn",header:_("end_date"),dataIndex:"end_date",format:"Y-m-d",editor:{xtype:"datefield",format:"Y-m-d"}},{header:_("status"),dataIndex:"status",editor:{xtype:"gaiaehr.combo",list:118,itemId:"functionalStatusSatausCombo",allowBlank:!1}}],tbar:["->","-",{text:_("add_new"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"newFunctionalStatusBtn"}]}),Ext.define("App.view.patient.SocialPanel",{extend:"Ext.panel.Panel",requires:["App.view.patient.SmokingStatus","App.view.patient.SocialHistory"],xtype:"patientsocialpanel",title:_("soc_hx"),border:!1,bodyBorder:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"patientsmokingstatusgrid",margin:"0 0 5 0",flex:1},{xtype:"patientsocialhistorypanel",flex:2}]}),Ext.define("App.ux.combo.MedicationInstructions",{extend:"Ext.form.ComboBox",xtype:"medicationinstructionscombo",queryMode:"local",displayField:"instruction",valueField:"instruction",store:Ext.create("App.store.administration.MedicationInstructions")}),Ext.define("App.ux.form.fields.plugin.HelpIcon",{extend:"Ext.AbstractPlugin",alias:"plugin.helpicon",iconSrc:"resources/images/icons/icohelp.png",iconHeight:16,iconWidth:16,iconMargin:"0 5",init:function(a){a.on("render",this.addHelpIcon,this)},addHelpIcon:function(a){var b,c=this,d='<td><img src="'+c.iconSrc+'" height="'+c.iconHeight+'" width="'+c.iconWidth+'" style="margin:'+c.iconMargin+'"></td>';b=Ext.DomHelper.append(a.inputRow,d,!0),Ext.create("Ext.tip.ToolTip",{target:b,dismissDelay:0,html:c.helpMsg||a.helpMsg||"Help Message..."})}}),Ext.define("App.ux.combo.AllergiesReaction",{extend:"Ext.form.ComboBox",alias:"widget.mitos.allergiesreactioncombo",initComponent:function(){var a=this;Ext.define("allergiesreactionModel",{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"}}}),Ext.apply(this,{editable:!1,queryMode:"local",displayField:"option_name",valueField:"option_value",emptyText:_("select"),store:Ext.create("Ext.data.Store",{model:"allergiesreactionModel",autoLoad:!1})}),a.callParent(arguments)}}),Ext.define("App.ux.combo.Insurances",{extend:"App.ux.combo.ComboResettable",alias:"widget.insurancescombo",displayField:"combo_text",valueField:"id",emptyText:_("select"),editable:!1,store:Ext.create("App.store.administration.InsuranceCompanies",{autoLoad:!0,pageSize:500})}),Ext.define("App.ux.combo.Burners",{extend:"Ext.form.ComboBox",xtype:"burnerscombo",editable:!1,queryMode:"local",valueField:"id",displayField:"description",emptyText:_("select_burner"),initComponent:function(){var a=this;Ext.define("BurnersComboModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"facility_id",type:"int"},{name:"description",type:"string"},{name:"aet",type:"string"},{name:"ip",type:"string"},{name:"port",type:"string"},{name:"path",type:"string"},{name:"url",type:"string"}],proxy:{type:"direct",api:{read:"WorkListPacs.getFacilityBurners"}}}),a.store=Ext.create("Ext.data.Store",{model:"BurnersComboModel",autoLoad:!0}),app.on("appfacilitychanged",function(){a.store.load(function(){a.setValue(a.store.getCount()>0?a.store.first():null)})}),a.callParent(arguments)}}),Ext.define("App.ux.TopazSignature",{extend:"Ext.Img",xtype:"topazsignature",signatureObj:void 0,extensionDataElement:void 0,signatureEvt:void 0,style:"background-color:white;border:solid 1px #1a9bfc",firstName:"",lastName:"",eMail:"",initComponent:function(){var a=this;a.callParent(),a.on("afterrender",function(){Ext.Function.defer(function(){Ext.create("Ext.tip.ToolTip",{target:a.imgEl,html:"Double Click to Capture Signature",showDelay:10,hideDelay:10,trackMouse:!0})},250,a),a.el.on("dblclick",a.StartSignature,a)},a)},onDestroy:function(){delete this.signatureObj,delete this.extensionDataElement,delete this.signatureEvt,this.callParent()},StartSignature:function(){if(this.fireEvent("beforesignature",this)!==!1){var a=this,b={firstName:a.firstName||"",lastName:a.lastName||"",eMail:a.email||"",location:"",imageFormat:1,imageX:a.getWidth(),imageY:a.getHeight(),imageTransparency:!1,imageScaling:!1,maxUpScalePercent:0,rawDataFormat:"ENC",minSigPoints:25};document.addEventListener("SignResponse",function(b){a.SignResponse(b)},!1);var c=JSON.stringify(b);a.imgEl.dom.setAttribute("messageAttribute",c),a.signatureEvt=document.createEvent("Events"),a.signatureEvt.initEvent("SignStartEvent",!0,!1),a.imgEl.dom.dispatchEvent(a.signatureEvt)}},SignResponse:function(a){var b=a.target.getAttribute("msgAttribute"),c=JSON.parse(b);this.SetValues(c)},SetValues:function(a){var b=this,c=JSON.parse(JSON.stringify(a));if(null!=c.errorMsg&&""!=c.errorMsg&&"undefined"!=c.errorMsg)app.msg(_("oops"),c.errorMsg,!0);else if(c.isSigned&&(b.signatureObj=c,b.setSrc("data:image/png;base64,"+c.imageData),this.fireEvent("signature",b,b.signatureObj)===!1))return}}),Ext.define("App.ux.form.SearchField",{extend:"Ext.form.field.Trigger",alias:"widget.gaiasearchfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",hasSearch:!1,paramName:"query",filterFn:null,autoSearch:!1,autoSearchDelay:500,initComponent:function(){var a=this;a.callParent(arguments),a.autoSearch?a.initAutoSearch():a.initSpecialKey(),a.store.remoteFilter=null===a.filterFn,a.store.remoteFilter&&(a.store.proxy.hasOwnProperty("filterParam")||(a.store.proxy.filterParam=a.paramName),a.store.proxy.encodeFilters=function(a){return a[0].value})},initSpecialKey:function(){this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},initAutoSearch:function(){var a=Ext.Function.createBuffered(function(){this.onTrigger2Click()},this.autoSearchDelay,this);this.enableKeyEvents=!0,this.on("keyup",function(){a()},this)},afterRender:function(){this.callParent(),this.triggerCell.item(0).setDisplayed(!1)},updateLayout:function(){say("updateLayout"),say(this),this.inputEl.applyStyles(this.hasSearch?{backgroundColor:"yellow",backgroundImage:"none",color:"black"}:{backgroundColor:null,backgroundImage:null,color:null}),this.callParent()},onTrigger1Click:function(){var a=this;a.hasSearch&&(a.setValue(""),a.store.clearFilter(),a.hasSearch=!1,a.triggerCell.item(0).setDisplayed(!1),a.updateLayout())
},onTrigger2Click:function(){var a=this,b=a.getValue();b.length>0?(a.store.filter(a.store.remoteFilter?{id:a.paramName,property:a.paramName,value:b}:{id:a.paramName,filterFn:function(c){return a.filterFn(c,b)}}),a.hasSearch=!0,a.triggerCell.item(0).setDisplayed(!0),a.updateLayout()):a.onTrigger1Click()}}),Ext.define("App.model.administration.EducationResource",{extend:"Ext.data.Model",table:{name:"education_resources"},fields:[{name:"id",type:"int"},{name:"code",type:"string",len:40},{name:"code_text",type:"string",len:300},{name:"code_type",type:"string",len:10},{name:"title",type:"string",len:180},{name:"publication_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"publication_date_formatted",type:"string",store:!1,convert:function(a,b){return Ext.Date.format(b.get("publication_date"),g("date_display_format"))}},{name:"version",type:"string",len:10},{name:"path",type:"string",len:600},{name:"activve",type:"bool"}],proxy:{type:"direct",api:{read:"EducationResources.getEducationResources"}}}),Ext.define("App.model.administration.Allergies",{extend:"Ext.data.Model",table:{name:"allergies",comment:"Allergies"},fields:[{name:"id",type:"int"},{name:"allergy",type:"string",len:500,comment:"Allergy Name"},{name:"allergy_term",type:"string"},{name:"allergy_code",type:"string",len:20},{name:"allergy_code_type",type:"string",len:15},{name:"allergy_type",type:"string",len:5,comment:"PT = Preferred Term, SN = Systematic Name, SY = Synonym, CD = Code, TR = Trade"}],proxy:{type:"direct",api:{read:"Allergies.searchAllergiesData"},reader:{root:"data"}}}),Ext.define("App.model.administration.CPT",{extend:"Ext.data.Model",table:{name:"cpt_codes"},fields:[{name:"id",type:"int"},{name:"ConceptID",type:"int",dataType:"bigint"},{name:"code",type:"string",len:50},{name:"code_text",type:"string",dataType:"text"},{name:"code_text_medium",type:"string",dataType:"text"},{name:"code_text_short",type:"string",dataType:"text"},{name:"code_type",type:"string",store:!1},{name:"isRadiology",type:"bool"},{name:"modality",type:"string"},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"CPT.getCPTs",create:"CPT.addCPT",update:"CPT.updateCPT",destroy:"CPT.deleteCPT"},reader:{root:"data"}}}),Ext.define("App.view.patient.RxOrders",{extend:"Ext.grid.Panel",requires:["App.ux.grid.RowFormEditing","Ext.grid.feature.Grouping","Ext.selection.CheckboxModel","App.ux.combo.PrescriptionHowTo","App.ux.combo.PrescriptionTypes","App.ux.combo.EncounterICDS","App.ux.combo.MedicationInstructions","App.ux.LiveRXNORMSearch","App.ux.form.fields.plugin.HelpIcon"],xtype:"patientrxorderspanel",title:_("rx_orders"),columnLines:!0,tabConfig:{cls:"order-tab"},itemId:"RxOrderGrid",store:Ext.create("App.store.patient.RxOrders",{storeId:"RxOrderStore",remoteFilter:!0,pageSize:200,sorters:[{property:"date_ordered",direction:"DESC"}]}),selModel:Ext.create("Ext.selection.CheckboxModel",{showHeaderCheckbox:!1}),plugins:[{ptype:"rowformediting",clicksToEdit:2,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},itemId:"RxOrderGridFormContainer",items:[{xtype:"container",layout:"anchor",itemId:"RxOrderGridFormContainerOne",items:[{xtype:"container",margin:"5 0",layout:{type:"hbox"},items:[{xtype:"datefield",fieldLabel:_("order_date"),format:"Y-m-d",name:"date_ordered",width:200,allowBlank:!1,margin:"0 10 0 0"},{xtype:"gaiaehr.combo",fieldLabel:_("unable_to_perform"),labelWidth:120,width:310,editable:!1,labelAlign:"right",listKey:"unable_to_perform_rx",name:"not_performed_code",itemId:"RxOrderGridFormUnableToPerformField",resetable:!0},{xtype:"checkboxfield",fieldLabel:_("administer_in_house"),tooltip:_("administer_in_house"),labelWidth:120,labelAlign:"right",name:"administer_in_house"}]},{xtype:"rxnormlivetsearch",itemId:"RxNormOrderLiveSearch",hideLabel:!1,fieldLabel:_("medication"),width:700,name:"STR",maxLength:255,displayField:"STR",valueField:"STR",vtype:"nonspecialcharactersrequired",allowBlank:!1},{xtype:"container",margin:"5 0",layout:{type:"hbox"},items:[{xtype:"numberfield",width:170,fieldLabel:_("dispense"),minValue:0,maxValue:99999,name:"dispense",decimalPrecision:3,maxLength:10,allowBlank:!1,fixPrecision:function(a){var b,c,d=this,e=isNaN(a),f=d.decimalPrecision;return e||!a?e?"":a:((!d.allowDecimals||0>=f)&&(f=0),b=String(a),-1!==b.indexOf(".")?(c=b.split("."),Number(1==c.length?b:c[0]+"."+c[1].charAt(0)+c[1].charAt(1)+c[1].charAt(2))):Number(b))}},{xtype:"numberfield",width:120,fieldLabel:_("days_supply"),labelAlign:"right",labelWidth:75,minValue:1,maxValue:630,allowDecimals:!1,name:"days_supply"},{xtype:"numberfield",width:90,fieldLabel:_("refill"),labelAlign:"right",labelWidth:40,maxValue:99,minValue:0,name:"refill",vtype:"numeric",allowBlank:!1},{xtype:"numberfield",width:90,fieldLabel:_("dose"),labelAlign:"right",labelWidth:40,maxValue:99,minValue:0,name:"dose",vtype:"numeric"},{xtype:"combobox",width:222,fieldLabel:_("route"),labelAlign:"right",labelWidth:40,name:"route",editable:!1,store:[["C38238","Intradermal"],["C28161","Intramuscular"],["C38276","Intravenous"],["C38284","Nasal"],["C38288","Oral"],["C38676","Percutaneous"],["C38299","Subcutaneous"],["C38305","Transdermal"]]}]},{xtype:"encountericdscombo",itemId:"RxEncounterDxCombo",fieldLabel:_("dx"),labelAlign:"right",labelWidth:30,width:295,name:"dxs"},{xtype:"medicationinstructionscombo",itemId:"RxOrderMedicationInstructionsCombo",width:700,fieldLabel:_("instructions"),name:"directions",maxLength:255,validateOnBlur:!0,vtype:"nonspecialcharactersrequired",allowBlank:!1},{xtype:"textfield",width:680,fieldLabel:"*"+_("notes_to_pharmacist"),itemId:"RxOrderGridFormNotesField",name:"notes",plugins:[{ptype:"helpicon",helpMsg:_("rx_notes_to_pharmacist_warning")}],maxLength:210},{xtype:"container",html:" *"+_("rx_notes_to_pharmacist_warning"),margin:"0 0 0 100"}]},{xtype:"container",layout:"anchor",itemId:"RxOrderGridFormContainerTwo",padding:"25 0 0 0",items:[{xtype:"container",layout:"hbox",items:[{xtype:"checkboxfield",fieldLabel:_("daw"),tooltip:_("dispensed_as_written"),width:90,labelWidth:70,labelAlign:"right",name:"daw",margin:"0 0 5 0"},{xtype:"checkboxfield",fieldLabel:_("is_comp"),tooltip:_("is_compound"),width:85,labelWidth:65,labelAlign:"right",name:"is_compound",itemId:"RxOrderCompCheckBox",margin:"0 0 5 0"},{xtype:"checkboxfield",fieldLabel:_("is_sply"),tooltip:_("is_supply"),width:85,labelWidth:65,labelAlign:"right",name:"is_supply",itemId:"RxOrderSplyCheckBox",margin:"0 0 5 0"}]},{xtype:"datefield",fieldLabel:_("begin_date"),labelWidth:70,labelAlign:"right",width:258,format:"Y-m-d",name:"begin_date",margin:"0 0 5 0",allowBlank:!1},{xtype:"datefield",fieldLabel:_("end_date"),labelWidth:70,labelAlign:"right",format:"Y-m-d",width:258,name:"end_date",itemId:"RxOrderEndDateField"}]},{xtype:"fieldset",title:_("active_drug_allergies"),html:_("none"),margin:"25 0 5 10",flex:1,itemId:"RxOrderActiveDrugAllergyFieldset"}]}]}],columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/cross.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("patient.RxOrders").onRxOrdersDeleteActionHandler(a,b,c,d,e,f)}}]},{xtype:"datecolumn",header:_("date_ordered"),dataIndex:"date_ordered",format:"Y-m-d"},{header:_("medication"),flex:1,dataIndex:"STR"},{header:_("daw"),width:40,dataIndex:"daw",tooltip:_("dispensed_as_written"),renderer:function(a){return app.boolRenderer(a)}},{header:_("dispense"),width:60,dataIndex:"dispense"},{header:_("refill"),width:50,dataIndex:"refill"},{header:_("instructions"),flex:1,dataIndex:"directions"},{header:_("related_dx"),width:200,dataIndex:"dxs",renderer:function(a){return 0==a||"false"==a||0==a[0]?"":a}},{xtype:"datecolumn",format:"Y-m-d",header:_("begin_date"),width:75,dataIndex:"begin_date"},{xtype:"datecolumn",header:_("end_date"),width:75,format:"Y-m-d",dataIndex:"end_date"},{header:_("active?"),width:60,dataIndex:"is_active",renderer:function(a){return app.boolRenderer(a)}}],dockedItems:[{xtype:"toolbar",dock:"top",itemId:"RxOrdersGridTopToolbar",items:["Show: ",{text:_("all"),action:"rx_show",action2:"all",pressed:!0,enableToggle:!0,toggleGroup:"rxshowgroup"},"-",{text:_("last_6_months"),action:"rx_show",action2:"last_6_months",enableToggle:!0,toggleGroup:"rxshowgroup"},"-",{text:_("last_year"),action:"rx_show",action2:"last_year",enableToggle:!0,toggleGroup:"rxshowgroup"},"-","->","-",{text:_("new_order"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"newRxOrderBtn"},"-",{text:_("clone_order"),iconCls:"icoAdd",disabled:!0,margin:"0 5 0 0",action:"encounterRecordAdd",itemId:"cloneRxOrderBtn"},"-",{text:_("print"),iconCls:"icoPrint",disabled:!0,margin:"0 5 0 0",itemId:"printRxOrderBtn"}]},{xtype:"toolbar",dock:"bottom",itemId:"RxOrdersGridBottomToolbar",items:[{xtype:"button",text:_("show_all_medicatios"),enableToggle:!0,stateful:!0,stateEvents:["press"],stateId:"RxOrdersShowAllMedicationsBtnState",itemId:"RxOrdersShowAllMedicationsBtn",getState:function(){return{pressed:this.pressed}},applyState:function(a){this.toggle(a.pressed)},listeners:{toggle:function(){this.fireEvent("press")}}}]}]}),Ext.define("App.view.patient.encounter.ProgressNotesHistory",{extend:"Ext.tree.Panel",requires:["App.ux.form.SearchField"],xtype:"progressnoteshistory",title:_("history"),hideHeaders:!0,cls:"progress-motes-history-grid",useArrows:!0,lines:!0,rootVisible:!1,multiSelect:!1,singleExpand:!1,initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.ProgressNotesHistory",{sorters:[{property:"service_date",direction:"desc"}]}),a.columns=[{xtype:"treecolumn",dataIndex:"progress",flex:1,renderer:function(a){return a}}],a.tbar=[{xtype:"gaiasearchfield",emptyText:_("search"),flex:1,itemId:"ProgressNotesHistorySearchField",store:a.store,filterFn:function(a,b){return-1!==a.data.progress.search(new RegExp(b,"ig"))}},"-",{xtype:"button",text:_("provider"),tooltip:_("show_only_same_provider_notes"),itemId:"ProgressNotesHistoryMineBtn",enableToggle:!0,toggleGroup:"ProgressNotesHistoryMineBtnGroup"},"-",{xtype:"button",text:_("specialty"),tooltip:_("show_only_same_specialty_notes"),itemId:"ProgressNotesHistorySpecialtyBtn",enableToggle:!0,toggleGroup:"ProgressNotesHistorySpecialtyBtnGroup"}],a.callParent()}}),Ext.define("App.view.patient.Encounter",{extend:"App.ux.RenderPanel",pageTitle:_("encounter"),pageLayout:"border",itemId:"encounterPanel",requires:["App.store.patient.Encounters","App.store.patient.Vitals","App.store.administration.EncounterEventHistory","App.view.patient.encounter.SOAP","App.view.patient.encounter.HealthCareFinancingAdministrationOptions","App.view.patient.encounter.CurrentProceduralTerminology","App.view.patient.encounter.ProgressNotesHistory","App.view.patient.encounter.DictationPanel","App.view.patient.encounter.NursesNotesGrid","App.view.patient.ProgressNote","App.view.patient.DecisionSupportWarningPanel","App.ux.combo.EncounterPriority","App.ux.combo.ActiveProviders"],enableCPT:eval(g("enable_encounter_cpt")),enableHCFA:eval(g("enable_encounter_hcfa")),enableSOAP:eval(g("enable_encounter_soap")),enableNurseNotes:!0,enableVitals:eval(g("enable_encounter_vitals")),enableEncHistory:eval(g("enable_encounter_history")),enableFamilyHistory:eval(g("enable_encounter_family_history")),enableItemsToReview:eval(g("enable_encounter_items_to_review")),enableReviewOfSystem:eval(g("enable_encounter_review_of_systems")),enableReviewOfSystemChecks:eval(g("enable_encounter_review_of_systems_cks")),enableClinicalDecisionSupport:eval(g("enable_clinical_decision_support")),showRating:!0,conversionMethod:"english",pid:null,eid:null,encounter:null,timerStartTime:null,timerWarning:5,encounterServiceDate:null,initComponent:function(){var b=this;say("ReviewOfSystems"),say(App.model.patient.ReviewOfSystems),App.model.patient.ReviewOfSystems.getFields().forEach(function(a){a.useNull=!0}),b.renderAdministrative=a("access_enc_hcfa")||a("access_enc_cpt")||a("access_enc_history"),b.encounterCtrl=app.getController("patient.encounter.Encounter"),b.timerTask={scope:b,run:b.encounterTimer,interval:1e3},b.encounterStore=Ext.create("App.store.patient.Encounters",{listeners:{scope:b,datachanged:b.getProgressNote}}),b.encounterEventHistoryStore=Ext.create("App.store.administration.EncounterEventHistory"),b.centerPanel=b.renderAdministrative?Ext.create("Ext.tab.Panel",{region:"center",margin:"1 0 0 0",activeTab:0,bodyPadding:5,listeners:{render:function(){this.items.each(function(a){a.tab.on("click",function(){b.onTapPanelChange(this)})})}}}):Ext.create("Ext.panel.Panel",{region:"center",margin:"1 0 0 0",layout:"fit",bodyPadding:5}),b.encounterTabPanel=b.centerPanel.add(Ext.create("Ext.tab.Panel",{title:b.renderAdministrative?_("encounter"):!1,itemId:"encounter",plain:!0,activeItem:0,border:!1,action:"encounterTabPanel",defaults:{bodyStyle:"padding:15px",bodyBorder:!0,layout:"fit"}})),b.enableClinicalDecisionSupport&&a("access_clinical_decision_support")&&b.encounterTabPanel.addDocked({xtype:"decisionsupportwarningpanel",itemId:"DecisionSupportWarningPanel",dock:"top"}),b.enableVitals&&a("access_patient_vitals")&&(b.vitalsPanel=b.encounterTabPanel.add(Ext.create("App.view.patient.Vitals"))),b.encounterTabPanel.add(Ext.create("App.view.patient.encounter.NursesNotesGrid",{padding:0,bodyPadding:0})),b.enableReviewOfSystem&&a("access_review_of_systems")&&(b.reviewSysPanel=b.encounterTabPanel.add(Ext.create("Ext.form.Panel",{autoScroll:!0,action:"encounter",itemId:"ReviewOfSystemForm",title:_("review_of_systems"),frame:!0,bodyPadding:5,fieldDefaults:{msgTarget:"side"},plugins:{ptype:"advanceform",autoSync:g("autosave"),syncAcl:a("edit_encounters")},buttons:[{xtype:"button",icon:"resources/images/icons/gear.png",itemId:"ReviewOfSystemSetupBtn",minWidth:null},"->",{text:_("save"),iconCls:"save",action:"reviewOfSystems",scope:b,itemId:"encounterRecordAdd",handler:b.onEncounterUpdate}]}))),b.enableReviewOfSystemChecks&&a("access_review_of_systems_checks")&&(b.reviewSysCkPanel=b.encounterTabPanel.add(Ext.create("Ext.form.Panel",{autoScroll:!0,action:"encounter",title:_("review_of_systems_checks"),frame:!0,bodyPadding:5,bodyStyle:"background-color:white",fieldDefaults:{msgTarget:"side"},plugins:{ptype:"advanceform",autoSync:g("autosave"),syncAcl:a("edit_encounters")},buttons:[{text:_("save"),iconCls:"save",action:"reviewOfSystemsChecks",scope:b,itemId:"encounterRecordAdd",handler:b.onEncounterUpdate}]}))),b.enableItemsToReview&&a("access_itmes_to_review")&&(b.itemsToReview=b.encounterTabPanel.add(Ext.create("App.view.patient.ItemsToReview",{title:_("items_to_review"),bodyPadding:"7 5 2 5"}))),a("access_patient_psy_behavioral")&&b.encounterTabPanel.add(Ext.create("App.view.patient.SocialPsychologicalBehavioral",{itemId:"SocialPsychologicalBehavioralPanel",bodyPadding:"7 5 2 5"})),a("access_patient_mini_mental_state_exam")&&b.encounterTabPanel.add(Ext.create("App.view.patient.MiniMentalStateExam",{padding:0,bodyPadding:0})),b.enableSOAP&&a("access_soap")&&(b.soapPanel=b.encounterTabPanel.add(Ext.create("App.view.patient.encounter.SOAP",{bodyStyle:"padding:0",enc:b}))),b.enableSOAP&&a("access_dictation")&&(b.dicatationPanel=b.encounterTabPanel.add(Ext.create("App.view.patient.encounter.DictationPanel",{bodyStyle:"padding:0",enc:b}))),(b.enableHCFA&&a("access_enc_hcfa")||b.enableCPT&&a("access_enc_cpt")||b.enableEncHistory&&a("access_enc_history"))&&(b.administrativeTabPanel=b.centerPanel.add(Ext.create("Ext.tab.Panel",{title:_("administrative"),itemId:"administrative",plain:!0,activeItem:0,defaults:{bodyStyle:"padding:15px",bodyBorder:!0,layout:"fit"}}))),b.enableHCFA&&a("access_enc_hcfa")&&(b.MiscBillingOptionsPanel=b.administrativeTabPanel.add(Ext.create("App.view.patient.encounter.HealthCareFinancingAdministrationOptions",{autoScroll:!0,title:_("misc_billing_options_HCFA_1500"),frame:!0,bodyPadding:5,bodyStyle:"background-color:white",fieldDefaults:{msgTarget:"side"},plugins:{ptype:"advanceform",autoSync:g("autosave"),syncAcl:a("edit_enc_hcfa")},buttons:[{text:_("save"),iconCls:"save",action:"soap",scope:b,handler:b.onEncounterUpdate}]}))),b.enableCPT&&a("access_enc_cpt")&&(b.CurrentProceduralTerminology=b.administrativeTabPanel.add(Ext.create("App.view.patient.encounter.CurrentProceduralTerminology",{title:_("current_procedural_terminology")}))),b.enableEncHistory&&a("access_enc_history")&&(b.EncounterEventHistory=b.administrativeTabPanel.add(Ext.create("App.ux.grid.EventHistory",{bodyStyle:0,title:_("encounter_history"),store:b.encounterEventHistoryStore}))),b.rightPanel=Ext.create("Ext.tab.Panel",{title:_("encounter_progress_note"),width:500,region:"east",split:!0,collapsible:!0,animCollapse:!1,collapsed:!0,deferredRender:!1,bodyPadding:0,margin:0,padding:0,stateful:!0,stateId:"EncounterProgressNotesPanel",itemId:"EncounterProgressNotesPanel",listeners:{scope:this,collapse:b.progressNoteCollapseExpand,expand:b.progressNoteCollapseExpand},items:[{xtype:"progressnoteshistory",itemId:"EncounterProgressNotesHistoryGrid"},b.progressNote=Ext.create("App.view.patient.ProgressNote",{title:_("progress_note"),itemId:"EncounterProgressNotePanel",autoScroll:!0,bodyPadding:0,margin:0,padding:0,cls:"progress-motes-history",tbar:["->",{xtype:"button",type:"print",text:_("print"),icon:"resources/images/icons/printer.png",tooltip:_("print_progress_note"),scope:b,handler:function(){var a=window.open("print.html","win","left=20,top=20,width=700,height=700,toolbar=0,resizable=1,location=1,scrollbars=1,menubar=0,directories=0"),c=b.progressNote.body.dom,d=document.createElement("div"),e=d.appendChild(c.cloneNode(!0));a.document.write(e.innerHTML),Ext.Function.defer(function(){a.print()},1e3)}}]}),{xtype:"patientdocumentspanel",orientation:"east"}]});var c=app.getController("patient.Medical").getMedicalTabButtons();Ext.Array.push(c,["-","->","-",{xtype:"button",action:"ccda",itemId:"EncounterCDAImportBtn",tooltip:_("ccda_import"),icon:"resources/images/icons/icoOutbox.png"},"-",{xtype:"button",itemId:"EncounterNewProgressNoteBtn",text:_("new_progress_note")},"-",{xtype:"button",action:"encounter",text:_("encounter_details")},"-",b.priorityCombo=Ext.create("App.ux.combo.EncounterPriority",{listeners:{scope:b,select:b.prioritySelect}}),"-"]),b.panelToolBar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",itemId:"EncounterMedicalToolbar",defaults:{scope:b,handler:b.onToolbarBtnHandler},items:c}),a("access_encounter_checkout")&&b.panelToolBar.add({text:_("sign"),icon:"resources/images/icons/edit.png",itemId:"EncounterMedicalToolbarSignBtn",handler:b.onSignEncounter},"-"),a("access_encounter_addenda")&&b.panelToolBar.add({text:_("addendum"),iconCls:"far fa-plus-circle",cls:"btnRedBackground",itemId:"EncounterMedicalToolbarAddendumAddBtn"},"-"),b.panelToolBar.add({xtype:"combobox",tooltip:"Timer Warning",value:b.timerWarning,editable:!1,width:75,store:[[5,"5 min"],[10,"10 min"],[15,"15 min"],[20,"20 min"],[30,"30 min"],[45,"45 min"],[60,"60 min"]],listeners:{change:function(a,c){b.timerWarning=c}}},"-"),b.pageBody=[b.centerPanel,b.rightPanel],b.listeners={beforerender:b.beforePanelRender},b.callParent(),b.down("panel").addDocked(b.panelToolBar)},onToolbarBtnHandler:function(a){"encounter"===a.action?app.updateEncounter(this.encounter):"ccda"===a.action||"EncounterPatientDocumentsBtn"===a.itemId||app.onMedicalWin(a.action)},onChartWindowShow:function(){app.onChartsWin()},prioritySelect:function(a,b){this.changeEncounterPriority(b[0].data.option_value)},changeEncounterPriority:function(a){var b=this,c={pid:b.pid,eid:b.eid,priority:a};Encounter.updateEncounterPriority(c,function(){app.patientButtonRemoveCls(),app.patientBtn.addCls(a)}),b.getProgressNote()},onEncounterUpdate:function(b){var c,d,e,f,g=this;c="encounter"===b.action?g.newEncounterWindow.down("form").getForm():b.up("form").getForm(),c.isValid()&&(d=c.getValues(!1,!0),"encounter"===b.action?a("add_encounters")?(f=c.getRecord(),f.set(d),f.save({callback:function(a){var c=a.data;app.patientButtonRemoveCls(),app.patientBtn.addCls(c.priority),g.openEncounter(c.eid),b.up("window").hide()}})):(b.up("window").close(),app.accessDenied()):a("edit_encounters")?(f=c.getRecord(),e=f.store,d=g.addDefaultData(d),f.set(d),app.fireEvent("encounterbeforesync",g,e,c,f),e.sync({callback:function(){app.fireEvent("encountersync",g,e,c,f),g.msg(_("sweet"),_("encounter_updated"))}}),g.encounterEventHistoryStore.load({filters:[{property:"eid",value:g.eid}]})):app.accessDenied())},addDefaultData:function(a){return a.pid=this.pid,a.eid=this.eid,a.uid=user.id,a.date=Ext.Date.format(new Date,"Y-m-d H:i:s"),a},openEncounter:function(b){var c,d=this;d.el.mask(_("loading...")+" "+_("encounter")+" - "+b),d.resetTabs(),d.encounter&&delete d.encounter,App.model.patient.Encounter.load(b,{scope:d,callback:function(b){var e;if(b.get("is_private")&&b.get("provider_uid")!==app.user.id&&!a("global_private_encounter_access"))return app.msg("Private Encounter",Ext.String.format("Encounter can only be accessed by {0}, {1}",b.get("provider_lname"),b.get("provider_fname")),!0),void app.getController("Navigation").goBack();d.encounter=b,e=d.encounter.data,d.pid=e.pid,d.eid=e.eid,d.encounterServiceDate=e.service_date,app.fireEvent("beforeencounterload",d.encounter,d),d.getProgressNote();var f=app.patient;d.pageTitle=_("encounter"),e.close_date?(d.stopTimer(),d.pageTitle=f.name+" - "+f.sexSymbol+" - "+f.age.str+" - "+Ext.Date.format(e.service_date,"F j, Y, g:i:s a")+" ("+_("closed_encounter")+")",d.encounter.get("is_private")&&(d.pageTitle+=' <img src="resources/images/icons/icoShield.png">'),d.updateTitle(d.pageTitle,app.patient.readOnly,""),d.setButtonsDisabled(d.getButtonsToDisable(),!0)):(d.pageTitle=f.name+" - "+f.sexSymbol+" - "+f.age.str+" - "+Ext.Date.format(e.service_date,"F j, Y, g:i:s a"),d.encounter.get("is_private")&&(d.pageTitle+=' <img height="20px" src="resources/images/icons/icoShield.png" data-qtip="Private Encounter">'),d.updateTitle(d.pageTitle,app.patient.readOnly,""),d.askStartTimer(),d.setButtonsDisabled(d.getButtonsToDisable())),d.reviewSysPanel&&(c=d.encounter.reviewofsystems(),c.on("write",d.getProgressNote,d),d.reviewSysPanel.getForm().loadRecord(c.getAt(0))),d.reviewSysCkPanel&&(c=d.encounter.reviewofsystemschecks(),c.on("write",d.getProgressNote,d),d.reviewSysCkPanel.getForm().loadRecord(c.getAt(0))),d.soapPanel&&(c=d.encounter.soap(),c.on("write",d.getProgressNote,d),d.soapPanel.down("form").getForm().loadRecord(c.getAt(0))),d.MiscBillingOptionsPanel&&(c=d.encounter.hcfaoptions(),d.MiscBillingOptionsPanel.getForm().loadRecord(c.getAt(0))),d.priorityCombo.setValue(e.priority),d.encounterEventHistoryStore.load({filters:[{property:"eid",value:d.eid}]}),d.CurrentProceduralTerminology&&d.CurrentProceduralTerminology.encounterCptStoreLoad(d.pid,d.eid,function(){d.CurrentProceduralTerminology.setDefaultQRCptCodes()}),app.fireEvent("encounterload",d.encounter,d),d.el.unmask()}})},doSignEncounter:function(b){var c,d,e=this;app.fireEvent("beforeecountersign",e,e.encounter)!==!1&&e.passwordVerificationWin(function(f,g){if("ok"===f){if(c=app.checkoutWindow.down("form").getForm(),d=c.getValues(),d.eid=e.eid,d.close_date=new Date,d.signature=g,d.isSupervisor=b,a("require_enc_supervisor")||b){var h=app.checkoutWindow.query("#EncounterCoSignSupervisorCombo")[0];d.requires_supervisor=!0,d.supervisor_uid=h.getValue()}else b||a("require_enc_supervisor")||(d.requires_supervisor=!1);Encounter.signEncounter(d,function(a,b){var c;b.result.success?(app.fireEvent("aferecountersign",e,e.encounter),e.stopTimer(),c={pid:e.pid,eid:e.eid,uid:app.user.id,type:"checkout",date:new Date},c.body=d.note,""!==c.body&&Ext.create("App.model.patient.Notes",c).save(),c.body=d.reminder,""!==c.body&&Ext.create("App.model.patient.Reminders",c).save(),e.msg(_("sweet"),_("encounter_closed")),app.checkoutWindow.close(),app.stowPatientRecord(),app.getController("areas.PatientPoolAreas").doSendPatientToNextArea(e.pid)):Ext.Msg.show({title:_("oops"),msg:_(b.result.error),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})})}})},onSignEncounter:function(){var a=app.patient.name+" #"+app.patient.pid+" - "+Ext.Date.format(this.encounterServiceDate,"F j, Y, g:i:s a")+" ("+_("checkout")+")";app.checkoutWindow.enc=this,app.checkoutWindow.setTitle(a),app.checkoutWindow.show()},isClose:function(){return"undefined"!=typeof this.encounter.data.close_date&&null!=this.encounter.data.close_date},isPrivate:function(){return this.encounter.get("is_private")},isSigned:function(){return"undefined"!=typeof this.encounter.data.provider_uid&&null!=this.encounter.data.provider_uid&&0!=this.encounter.data.provider_uid},progressNoteCollapseExpand:function(){this.centerPanel.doLayout()},getProgressNote:function(){var a=this;Encounter.getProgressNoteByEid(a.eid,function(b,c){a.progressNote.tpl.overwrite(a.progressNote.body,c.result)})},onTapPanelChange:function(){},askStartTimer:function(){var b=this;a("use_encounter_timer")&&Ext.Msg.show({title:"Encounter Timer",msg:"Would you like to start encounter timer?",buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(a){"yes"===a&&b.startTimer()}})},startTimer:function(){return this.timerStartTime=app.getDate(),Ext.TaskManager.start(this.timerTask),!0},stopTimer:function(){return Ext.TaskManager.stop(this.timerTask),!0},encounterTimer:function(){var a=this,b=a.timer(a.timerStartTime,app.getDate());null!==app.patient.pid?a.updateTitle(a.pageTitle,app.patient.readOnly,b):a.stopTimer()},timer:function(a,b){function c(a){return a>=10?a:"0"+a}var d,e=Ext.Date.getElapsed(a,b),f=Math.floor(e/1e3),g=Math.floor(f/60);f%=60,d=c(f);var h=Math.floor(g/60);g>=this.timerWarning&&f%10===0&&app.msg("INFO","Encounter Time Expired","yellow"),g%=60,d=c(g)+":"+d;var i=Math.floor(h/24);return h%=24,d=c(h)+":"+d,d=0===i?'<span class="time">'+d+"</span>":'<span class="day">'+i+" "+_("day_s")+'</span><span class="time">'+d+"</span>"},beforePanelRender:function(){var a=this,b=function(){return[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"uid",type:"int"}]};a.reviewSysPanel&&a.getFormItems(a.reviewSysPanel,8,function(){}),a.reviewSysCkPanel&&a.getFormItems(a.reviewSysCkPanel,9,function(){for(var c=a.reviewSysCkPanel.getForm().getFields(),d=new b,e=0;e<c.items.length;e++)d.push({name:c.items[e].name,type:"auto"});Ext.define("App.model.patient.ReviewOfSystemsCheck",{extend:"Ext.data.Model",fields:d,proxy:{type:"direct",api:{update:"Encounter.updateReviewOfSystemsChecks"}},belongsTo:{model:"App.model.patient.Encounter",foreignKey:"eid"}})})},getButtonsToDisable:function(){var a=this,b=[];return(null===a.ButtonsToDisable||"undefined"==typeof a.ButtonsToDisable)&&(a.vitalsPanel&&b.concat(b,a.vitalsPanel.query("button")),a.reviewSysPanel&&b.concat(b,a.reviewSysPanel.query("button")),a.reviewSysCkPanel&&b.concat(b,a.reviewSysCkPanel.query("button")),a.soapPanel&&b.concat(b,a.soapPanel.down("form").query("button")),a.MiscBillingOptionsPanel&&b.concat(b,a.MiscBillingOptionsPanel.query("button")),a.CurrentProceduralTerminology&&b.concat(b,a.CurrentProceduralTerminology.query("button")),a.EncounterEventHistory&&b.concat(b,a.EncounterEventHistory.query("button")),a.newEncounterWindow&&b.concat(b,a.newEncounterWindow.query("button")),app.checkoutWindow&&b.concat(b,app.checkoutWindow.query("button")),a.ButtonsToDisable=b),a.ButtonsToDisable},resetTabs:function(){var a=this;a.renderAdministrative&&a.centerPanel.setActiveTab(0),a.encounterTabPanel&&a.encounterTabPanel.setActiveTab(0),a.administrativeTabPanel&&a.administrativeTabPanel.setActiveTab(0),a.rightPanel&&a.rightPanel.setActiveTab(0)},onDocumentView:function(a,b){var c=a.getStore().getAt(b),d=c.data.url;app.onDocumentView(d)},onActive:function(a){var b=this,c=app.patient;if(c.pid&&c.eid)b.updateTitle(c.name+" ("+_("visits")+")",c.readOnly,null),b.setReadOnly(c.readOnly),a(!0);else{a(!1);var d=null===c.eid?"Please create a new encounter or select one from the patient encounter history":null;b.currPatientError(d)}}}),Ext.define("App.view.patient.DisclosuresGrid",{extend:"Ext.grid.Panel",requires:["App.ux.TopazSignature","App.ux.combo.Burners"],xtype:"patientdisclosuresgrid",selType:"checkboxmodel",title:_("disclosures"),itemId:"PatientDisclosuresGrid",bodyPadding:0,tbar:[{xtype:"container",items:[{xtype:"printerscombo",itemId:"PatientDisclosuresPrinterCmb",emptyText:"Select Printer",fieldLabel:"Printer",labelWidth:45,width:250,margin:"0 5 0 5"}]},{xtype:"container",items:[{xtype:"burnerscombo",itemId:"PatientDisclosuresBurnersCmb",fieldLabel:"Burner",forceSelection:!0,autoSelect:!0,labelWidth:45,width:250}]},"->",{xtype:"button",text:_("print"),itemId:"PatientDisclosuresPrintBtn"},{xtype:"button",text:_("download"),itemId:"PatientDisclosuresDownloadBtn"},{xtype:"button",text:_("burn"),itemId:"PatientDisclosuresBurnBtn"},"-",{text:_("disclosure"),iconCls:"icoAdd",itemId:"PatientDisclosuresGridAddBtn"}],columns:[{text:_("description"),dataIndex:"description",flex:1},{header:_("recipient"),dataIndex:"recipient",flex:1},{xtype:"datecolumn",format:"F j, Y",text:_("request_date"),dataIndex:"request_date",flex:1},{xtype:"datecolumn",format:"F j, Y",text:_("fulfil_date"),dataIndex:"fulfil_date",flex:1},{xtype:"datecolumn",format:"F j, Y",text:_("pickup_date"),dataIndex:"pickup_date",flex:1},{text:_("signature"),dataIndex:"signature",flex:1,renderer:function(a,b,c){b.tdCls=c.data.rowClasses;var d=c.get("signature");return d?(d='<img src="'+d+'" height="30" >',Ext.String.format("<div><b>Signature By:</b></div> {0}",d)):""}},{xtype:"numbercolumn",text:_("document_attached"),dataIndex:"document_inventory_count",flex:1,format:"0"}],initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.Disclosures",{autoSync:!1,autoLoad:!1}),a.callParent()}}),Ext.define("App.ux.combo.EducationResources",{extend:"Ext.form.ComboBox",xtype:"educationresourcescombo",editable:!1,queryMode:"local",displayField:"title",valueField:"id",emptyText:_("select"),loadStore:!0,triggerAction:"all",requires:["App.model.administration.EducationResource"],codeType:void 0,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{title} - {publication_date_formatted}</div>',"</tpl>"),initComponent:function(){var a,b=this;b.codeType&&(a=[{property:"code_type",value:b.codeType}]),b.store=Ext.create("App.store.administration.EducationResources",{autoLoad:b.loadStore,filters:a}),b.callParent(arguments)}}),Ext.define("App.view.patient.Immunizations",{extend:"Ext.panel.Panel",requires:["App.ux.combo.CVXManufacturersForCvx","App.ux.LiveImmunizationSearch","App.ux.LiveImmunizationNdcSearch","App.ux.grid.RowFormEditing","App.store.patient.CVXCodes","App.ux.form.fields.DateTime","App.ux.LiveUserSearch","App.ux.combo.EducationResources"],xtype:"patientimmunizationspanel",title:_("vaccs"),layout:"border",border:!1,items:[{xtype:"grid",region:"center",itemId:"patientImmunizationsGrid",selModel:Ext.create("Ext.selection.CheckboxModel"),columnLines:!0,store:this.store=Ext.create("App.store.patient.PatientImmunization",{groupField:"vaccine_name",sorters:["vaccine_name","administered_date"],remoteFilter:!0,autoSync:!1}),features:Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:_("immunization")+': {name} ({rows.length} Item{[values.rows.length > 1 ? "s" : ""]})'}),columns:[{xtype:"griddeletecolumn",acl:a("delete_patient_immunizations"),width:25},{text:_("code"),dataIndex:"code",width:50,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("immunization_name"),dataIndex:"vaccine_name",flex:1,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("lot_number"),dataIndex:"lot_number",width:100,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("amount"),dataIndex:"administer_amount",width:100,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("units"),dataIndex:"administer_units",width:100,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("notes"),dataIndex:"note",flex:1,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a
}},{text:_("status"),dataIndex:"status",width:100,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{text:_("administered_by"),dataIndex:"administered_by",width:150,renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}},{xtype:"datecolumn",text:_("date"),format:"Y-m-d",width:100,dataIndex:"administered_date",renderer:function(a,b,c){return c.data.is_error?'<span class="is_error_data">'+a+"</span>":a}}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:2,items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",layout:"vbox",margin:"0 0 10 0",items:[{xtype:"gaiaehr.combo",itemId:"ImmunizationsInformationSourceCombo",list:138,width:475,name:"information_source_code",fieldLabel:_("source"),margin:"0 0 5 0",loadStore:!0,editable:!1},{xtype:"immunizationlivesearch",itemId:"ImmunizationsImmunizationSearch",fieldLabel:_("name"),name:"vaccine_name",valueField:"name",hideLabel:!1,allowBlank:!1,enableKeyEvents:!0,width:475},{xtype:"immunizationndclivesearch",itemId:"ImmunizationsImmunizationNdcSearch",fieldLabel:_("name"),name:"vaccine_name",valueField:"UseUnitPropName",hideLabel:!1,allowBlank:!1,enableKeyEvents:!0,width:475},{xtype:"gaiaehr.combo",fieldLabel:_("disorder"),itemId:"ImmunizationsDisorderCombo",width:475,list:140,queryMode:"local",loadStore:!0,editable:!1,allowBlank:!1,name:"presumed_immunity_code"}]},{xtype:"combobox",margin:"0 0 0 10",emptyText:_("status"),displayField:"option",valueField:"value",name:"status",store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:_("completed"),value:"complete"},{option:_("cancelled"),value:"cancelled"}]})}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",xtype:"textfield"},items:[{xtype:"numberfield",fieldLabel:_("amount"),name:"administer_amount",width:160},{xtype:"gaiaehr.listcombo",fieldLabel:_("units"),name:"administer_units",labelWidth:30,width:150,loadStore:!0,queryMode:"local",list:131},{xtype:"gaiaehr.combo",fieldLabel:_("administration_site"),width:295,labelWidth:110,listKey:"admin_sites",queryMode:"local",loadStore:!0,name:"administration_site"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",xtype:"textfield"},items:[{fieldLabel:_("route"),xtype:"gaiaehr.combo",listKey:"route_of_administration",queryMode:"local",loadStore:!0,width:295,name:"route"},{xtype:"mitos.datetime",fieldLabel:_("date_administered"),width:320,labelWidth:115,dateTimeFormat:"Y-m-d H:i:s",name:"administered_date",vtype:"date"}]},{fieldLabel:_("administered_by"),xtype:"userlivetsearch",itemId:"patientImmunizationsEditFormAdministeredByField",name:"administered_by",margin:"0 10 5 0",width:625,hideLabel:!1,forceSelection:!1,acl:"administer_patient_immunizations"},{fieldLabel:_("notes"),xtype:"textfield",name:"note",width:625}]},{xtype:"container",items:[{xtype:"fieldset",title:_("substance_data"),defaults:{margin:"0 0 5 0",width:250},margin:"0 15 5 0",items:[{fieldLabel:_("lot_number"),xtype:"textfield",name:"lot_number"},{fieldLabel:_("exp_date"),xtype:"datefield",format:"Y-m-d",name:"exp_date"},{xtype:"cvxmanufacturersforcvxcombo",fieldLabel:_("manufacturer"),margin:"0 0 8 0",name:"manufacturer"}]},{xtype:"checkbox",name:"is_presumed_immunity",fieldLabel:"Presumed Immunity",width:145,itemId:"ImmunizationsPresumedImmunityCheckbox",labelAlign:"right",labelWidth:125},{xtype:"checkboxfield",fieldLabel:_("entered_in_error"),name:"is_error"}]},{xtype:"container",items:[{xtype:"gaiaehr.combo",list:139,width:550,name:"refusal_reason_code",fieldLabel:_("refusal_reason"),margin:"0 0 5 0",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",fieldLabel:_("unable_to_perform"),width:550,margin:"0 0 5 0",loadStore:!0,editable:!1,listKey:"unable_to_perform_vac",name:"not_performed_code",itemId:"ImmunizationsUnableToPerformField"},{xtype:"gaiaehr.combo",fieldLabel:_("vfc"),name:"vfc_code",list:135,width:550,margin:"0 0 5 0",loadStore:!0,editable:!1},{xtype:"container",layout:"hbox",items:[{xtype:"container",items:[{xtype:"educationresourcescombo",width:250,margin:"0 5 5 0",fieldLabel:_("publication"),name:"education_resource_1_id",codeType:"cdcgs1vis"},{xtype:"datefield",width:250,margin:"0 5 5 0",fieldLabel:_("given_date"),name:"education_presented_1_date",submitFormat:"Y-m-d H:i:s"}]},{xtype:"container",items:[{xtype:"educationresourcescombo",width:145,margin:"0 5 5 0",name:"education_resource_2_id",codeType:"cdcgs1vis"},{xtype:"datefield",width:145,margin:"0 5 5 0",name:"education_presented_2_date",submitFormat:"Y-m-d H:i:s"}]},{xtype:"container",items:[{xtype:"educationresourcescombo",width:145,margin:"0 0 5 0",name:"education_resource_3_id",codeType:"cdcgs1vis"},{xtype:"datefield",width:145,margin:"0 0 5 0",name:"education_presented_3_date",submitFormat:"Y-m-d H:i:s"}]}]}]}]}]}),tbar:["->",{xtype:"button",text:_("quick"),iconCls:"icoAdd",margin:"0 3 0 0",acl:a("add_patient_immunizations"),itemId:"ImmunizationPanelQuickAddBtn"},"-",{text:_("add_new"),action:"encounterRecordAdd",itemId:"addImmunizationBtn",iconCls:"icoAdd"}],bbar:["-",{xtype:"button",text:_("submit_hl7_vxu"),disabled:!0,itemId:"submitVxuBtn"},{xtype:"button",text:_("immunization_registry_history"),itemId:"ImmunizationHistorySearchBtn"},"-","->",{text:_("review"),itemId:"reviewImmunizationsBtn",action:"encounterRecordAdd"}]},{xtype:"grid",title:_("immunization_list"),itemId:"cvxGrid",collapseMode:"mini",region:"east",collapsible:!0,collapsed:!0,width:300,split:!0,store:Ext.create("App.store.patient.CVXCodes"),columns:[{text:_("code"),dataIndex:"cvx_code",width:50},{text:_("immunization_name"),dataIndex:"name",flex:1}]}]}),Ext.define("App.ux.LiveAllergiesSearch",{extend:"Ext.form.ComboBox",alias:"widget.allergieslivesearch",requires:["App.model.administration.Allergies"],hideLabel:!0,displayField:"allergy",valueField:"allergy",initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{model:"App.model.administration.Allergies",pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,emptyText:_("allergy_search")+"...",typeAhead:!1,hideTrigger:!0,minChars:3,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{allergy}<span style="font-weight: normal"> ({allergy_code}) </span></h3></div>'}},pageSize:25}),a.callParent()}}),Ext.define("App.view.patient.Allergies",{extend:"Ext.grid.Panel",requires:["App.store.patient.Allergies","App.ux.grid.RowFormEditing","App.ux.LiveRXNORMAllergySearch","App.ux.LiveAllergiesSearch","App.ux.LiveImmunizationSearch","App.ux.combo.Allergies","App.ux.combo.AllergiesReaction","App.ux.combo.AllergiesTypes","App.ux.combo.AllergiesLocation","App.ux.combo.AllergiesSeverity"],xtype:"patientallergiespanel",title:_("al"),columnLines:!0,store:Ext.create("App.store.patient.Allergies",{remoteFilter:!0,autoSync:!1}),columns:[{xtype:"griddeletecolumn",acl:a("delete_patient_allergy"),width:25},{text:_("type"),width:100,dataIndex:"allergy_type"},{text:_("name"),flex:1,dataIndex:"allergy",renderer:function(a,b,c){var d="";return""!=c.data.allergy_code&&(d+=" ( <b>"+c.data.allergy_code_type+":</b> "+c.data.allergy_code+" )"),a+d}},{text:_("location"),width:220,dataIndex:"location"},{text:_("reaction"),width:220,dataIndex:"reaction"},{text:_("severity"),width:220,dataIndex:"severity"},{text:_("status"),width:55,dataIndex:"status"}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,itemId:"allergiesGridRowEditor",errorSummary:!1,clicksToEdit:2,items:[{title:_("general"),xtype:"container",padding:"0 10",layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0"},items:[{xtype:"gaiaehr.combo",fieldLabel:_("type"),itemId:"allergyTypeCombo",name:"allergy_type",allowBlank:!1,labelWidth:70,width:700,list:85,enableKeyEvents:!0},{xtype:"gaiaehr.combo",fieldLabel:_("status"),name:"status",list:113,itemId:"allergyStatusCombo",labelWidth:80,allowBlank:!1}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0"},items:[{xtype:"allergieslivesearch",fieldLabel:_("allergy"),itemId:"allergySearchCombo",name:"allergy",hideLabel:!1,enableKeyEvents:!0,width:700,labelWidth:70,allowBlank:!1},{xtype:"immunizationlivesearch",fieldLabel:_("allergy"),itemId:"allergyCvxLiveSearch",name:"allergy",valueField:"name",hideLabel:!1,enableKeyEvents:!0,width:700,labelWidth:70,multiSelect:!1,allowBlank:!1},{xtype:"rxnormallergylivetsearch",fieldLabel:_("allergy"),itemId:"allergyMedicationCombo",name:"allergy",hideLabel:!1,hidden:!0,disabled:!0,enableKeyEvents:!0,width:700,labelWidth:70,allowBlank:!1},{xtype:"gaiaehr.combo",fieldLabel:_("allergy"),itemId:"allergyFoodCombo",name:"allergy",hideLabel:!1,hidden:!0,disabled:!0,enableKeyEvents:!0,width:700,labelWidth:70,allowBlank:!1,listKey:"food_aller"},{xtype:"allergiesmetalcombo",fieldLabel:_("allergy"),itemId:"allergyMetalCombo",name:"allergy",hideLabel:!1,displayField:"Term",valueField:"Term",hidden:!0,disabled:!0,enableKeyEvents:!0,width:700,labelWidth:70,allowBlank:!1},{fieldLabel:_("begin_date"),xtype:"datefield",format:"Y-m-d",name:"begin_date",labelWidth:80}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0"},items:[{xtype:"gaiaehr.combo",fieldLabel:_("location"),name:"location",action:"location",itemId:"allergyLocationCombo",addUnknownOption:!0,width:225,list:79,labelWidth:70},{xtype:"gaiaehr.combo",fieldLabel:_("reaction"),itemId:"allergyReactionCombo",addUnknownOption:!0,name:"reaction",width:230,queryMode:"local",labelWidth:70,allowBlank:!0},{xtype:"gaiaehr.combo",fieldLabel:_("severity"),name:"severity",itemId:"allergySeverityCombo",addUnknownOption:!0,width:225,list:84,labelWidth:70,allowBlank:!0},{fieldLabel:_("end_date"),xtype:"datefield",format:"Y-m-d",name:"end_date",labelWidth:80}]}]}]}),tbar:["->",{text:_("add_new"),itemId:"addAllergyBtn",action:"encounterRecordAdd",iconCls:"icoAdd"}],bbar:[{text:_("reconciled"),itemId:"PatientAllergyReconciledBtn",enableToggle:!0,pressed:!0},{text:_("only_active"),enableToggle:!0,itemId:"activeAllergyBtn"},"->",{text:_("no_known_allergies")+"/"+_("review"),action:"encounterRecordAdd",itemId:"reviewAllergiesBtn"}]}),Ext.define("App.view.patient.windows.Medical",{extend:"App.ux.window.Window",title:_("medical_window"),itemId:"MedicalWindow",closeAction:"hide",modal:!0,requires:["App.view.patient.Results","App.view.patient.Referrals","App.view.patient.Immunizations","App.view.patient.Medications","App.view.patient.ActiveProblems","App.view.patient.ProceduresHistoryGrid","App.view.patient.SocialPanel","App.view.patient.Allergies","App.view.patient.AdvanceDirectives","App.view.patient.CognitiveAndFunctionalStatus","App.view.patient.LabOrders","App.view.patient.RadOrders","App.view.patient.RxOrders","App.view.patient.DoctorsNotes","App.view.patient.FamilyHistory","App.view.patient.ImplantableDevice","App.view.patient.SocialPsychologicalBehavioral","App.view.patient.PainScale"],initComponent:function(){var b=this,c=app.getController("patient.Medical").getMedicalTabPanelItems();a("access_clinical_decision_support")&&(b.tbar=[{xtype:"decisionsupportwarningpanel",itemId:"MedicalDecisionSupportWarningPanel",flex:1}]),b.items=[{xtype:"tabpanel",border:!1,bodyBorder:!1,plain:!0,margin:5,itemId:"MedicalWindowTabPanel",tabBar:{plugins:Ext.create("Ext.ux.BoxReorderer",{listeners:{Drop:function(a,b,c,d,e,f){app.getController("patient.Medical").onMedicalWindowTabPanelDrop(a,b,c,d,e,f)}}})},width:Ext.getBody().getWidth()<1550?Ext.getBody().getWidth()-50:1500,height:Ext.getBody().getHeight()<1050?Ext.getBody().getHeight()-50:1e3,items:c}],b.buttons=[{text:_("close"),scope:b,handler:function(){b.close()}}],b.listeners={scope:b,close:b.onMedicalWinClose,show:b.onMedicalWinShow},b.callParent(arguments)},cardSwitch:function(a){var b=this,c=b.down("tabpanel"),d=c.getActiveTab(),e=c.query("#"+a)[0];d==e?d.fireEvent("activate",d):(c.setActiveTab(e),b.setWindowTitle(e.title))},setWindowTitle:function(a){this.setTitle(a)},onMedicalWinShow:function(){var a=this.down("tabpanel"),b=Ext.getBody().getWidth()<1550?Ext.getBody().getWidth()-50:1500,c=Ext.getBody().getHeight()<850?Ext.getBody().getHeight()-50:800;a.setSize(b,c),this.alignTo(Ext.getBody(),"c-c")},onMedicalWinClose:function(){var a=app.getActivePanel();"App.view.patient.Summary"===a.$className?a.loadStores():"App.view.patient.Encounter"===a.$className&&a.getProgressNote()}}),Ext.define("App.store.administration.CPT",{extend:"Ext.data.Store",model:"App.model.administration.CPT"}),Ext.define("App.view.administration.CPT",{extend:"Ext.grid.Panel",requires:["Ext.grid.plugin.RowEditing","App.store.administration.CPT"],xtype:"cptadmingrid",title:_("cpt4"),columns:[{width:60,header:_("code"),dataIndex:"code"},{header:_("short_name"),dataIndex:"code_text_short",width:100,flex:1,editor:{xtype:"textfield"}},{header:_("long_name"),dataIndex:"code_text",flex:2,editor:{xtype:"textfield"}},{header:_("radiology"),dataIndex:"isRadiology",editor:{xtype:"checkbox"},renderer:function(a){return this.boolRenderer(a)}},{width:60,header:_("active"),dataIndex:"active",editor:{xtype:"checkbox"},renderer:function(a){return this.boolRenderer(a)}}],plugins:[{ptype:"rowediting",errorSummary:!1,clicksToEdit:1}],initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.CPT",{remoteSort:!0}),a.tbar=Ext.create("Ext.PagingToolbar",{store:a.store,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager"),items:["-",{xtype:"textfield",emptyText:_("search"),width:200,enableKeyEvents:!0,itemId:"adminCpt4CodeSearchField"},"-",{xtype:"button",text:_("only_active"),enableToggle:!0,itemId:"adminCpt4CodeOnlyActiveBtn"},"-"]}),a.callParent()}}),Ext.define("App.view.administration.DataManager",{extend:"App.ux.RenderPanel",pageTitle:"Data Manager",requires:["App.view.administration.CPT","App.view.administration.ICD10","App.ux.combo.CodesTypes","App.ux.combo.Titles"],initComponent:function(){function a(a){return"1"==a?"CPT4":"3"==a?"HCPCS":"100"==a?"CVX":a}var b=this;b.active=1,b.dataQuery="",b.code_type="LOINC",b.store=Ext.create("App.store.administration.Services"),b.activeProblemsStore=Ext.create("App.store.administration.ActiveProblems"),b.medicationsStore=Ext.create("App.store.administration.Medications"),b.ImmuRelationStore=Ext.create("App.store.administration.ImmunizationRelations"),b.labObservationsStore=Ext.create("App.store.administration.LabObservations"),b.cptContainer=Ext.create("Ext.container.Container",{layout:"column",action:"CPT4",items:[{xtype:"fieldcontainer",msgTarget:"under",defaults:{action:"field"},items:[{fieldLabel:"Type",xtype:"mitos.codestypescombo",name:"code_type"},{fieldLabel:"Code",xtype:"textfield",name:"code"}]},{xtype:"fieldcontainer",margin:"0 0 0 10",defaults:{action:"field"},items:[{fieldLabel:_("description"),xtype:"textfield",name:"code_text",width:500}]},{xtype:"fieldcontainer",margin:"0 0 0 20",defaults:{action:"field"},items:[{boxLabel:_("radiology"),xtype:"checkboxfield",name:"isRadiology"},{boxLabel:_("active"),labelWidth:75,xtype:"checkboxfield",name:"active"}]}]}),b.hpccsContainer=Ext.create("Ext.container.Container",{layout:"column",action:"HCPCS",items:[{xtype:"fieldcontainer",msgTarget:"under",defaults:{action:"field"},items:[{fieldLabel:_("type"),xtype:"mitos.codestypescombo",name:"code_type"},{fieldLabel:_("code"),xtype:"textfield",name:"code"},{fieldLabel:_("modifier"),xtype:"textfield",name:"mod"}]},{xtype:"fieldcontainer",margin:"0 0 0 10",defaults:{action:"field"},items:[{fieldLabel:_("description"),xtype:"textfield",name:"code_text"},{fieldLabel:_("category"),xtype:"mitos.titlescombo",name:"title"}]},{xtype:"fieldcontainer",margin:"0 0 0 20",defaults:{action:"field"},items:[{boxLabel:_("reportable"),xtype:"checkboxfield",name:"reportable"},{boxLabel:_("active"),labelWidth:75,xtype:"checkboxfield",name:"active"}]}]}),b.cvxCintainer=Ext.create("Ext.container.Container",{action:_("immunizations"),layout:"fit",items:[{}]}),b.labContainer=Ext.create("Ext.container.Container",{action:_("laboratories"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 5 0",action:"field"},items:[{xtype:"textfield",fieldLabel:_("short_name_alias"),name:"code_text_short",labelWidth:130,width:500},{xtype:"checkbox",fieldLabel:_("active"),name:"active",anchor:"100%",labelWidth:50}]},{xtype:"grid",frame:!0,title:_("children"),store:b.labObservationsStore,plugins:Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2}),columns:[{header:_("label_alias"),dataIndex:"code_text_short",width:150,editor:{xtype:"textfield"}},{header:_("loinc_name"),dataIndex:"loinc_name",flex:1},{header:_("loinc_number"),dataIndex:"loinc_number",width:100},{header:_("default_unit"),dataIndex:"default_unit",width:100,editor:{xtype:"mitos.unitscombo"}},{header:_("req_opt"),dataIndex:"required_in_panel",width:75},{header:_("range_start"),dataIndex:"range_start",width:100,editor:{xtype:"numberfield"}},{header:_("range_end"),dataIndex:"range_end",width:100,editor:{xtype:"numberfield"}},{header:_("description"),dataIndex:"description",flex:1,editor:{xtype:"textfield"}},{width:60,header:_("active"),dataIndex:"active",renderer:b.boolRenderer,editor:{xtype:"checkbox"}}]}]}),b.dataManagerGrid=Ext.create("Ext.grid.Panel",{title:"Codes",region:"center",store:b.store,viewConfig:{loadMask:!0},columns:[{width:50,sortable:!1,dataIndex:"code_type",renderer:a},{width:60,header:_("code"),sortable:!0,dataIndex:"code"},{header:_("short_name"),dataIndex:"code_text_short",width:100,flex:1},{header:_("long_name"),sortable:!0,dataIndex:"code_text",flex:2},{width:60,header:_("active"),sortable:!0,dataIndex:"active",renderer:b.boolRenderer}],plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:1,listeners:{scope:b,beforeedit:b.beforeServiceEdit}}),tbar:this.bar=Ext.create("Ext.PagingToolbar",{store:b.store,displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager"),items:["-",{xtype:"mitos.codestypescombo",width:150,listeners:{scope:b,select:b.onCodeTypeSelect}},"-",{text:_("add"),iconCls:"icoAddRecord",scope:b,handler:b.onAddData},"-",{xtype:"textfield",emptyText:_("search"),width:200,enableKeyEvents:!0,listeners:{scope:b,keyup:b.onSearch,buffer:500}},"-",{xtype:"button",text:_("show_inactive_codes_only"),enableToggle:!0,listeners:{scope:b,toggle:b.onActivePressed}}]})}),b.tabPanel=Ext.widget("tabpanel",{items:[{xtype:"cptadmingrid"},{xtype:"icd10admingrid"},b.dataManagerGrid]}),b.pageBody=[b.tabPanel],b.callParent()},onAddData:function(){var a=this;"Laboratories"==a.code_type?Ext.Msg.alert("Opps!",_("ops_laboratories")):(a.dataManagerGrid.plugins[0].cancelEdit(),a.store.add({code_type:a.code_type}),a.dataManagerGrid.plugins[0].startEdit(0,0))},beforeServiceEdit:function(a,b){var c,d,e=this,f=a.editor,g=b.record.data.code_type;if("CPT4"==g?d=e.cptContainer:"HCPCS"==g?d=e.hpccsContainer:"CVX"==g?d=e.cvxCintainer:"LOINC"==g&&(e.labContainer.down("grid").setTitle(_(b.record.data.has_children?"observations":"observation")),e.labContainer.down("grid").setVisible("RAD"!=b.record.data.class),d=e.labContainer),f.items.length?this.currForm!=d&&(f.remove(0,!1),f.add(d),f.setFields()):(f.add(d),f.setFields()),d){c=d.query("grid");for(var h=0;h<c.length;h++)c[h].getStore().load({params:{selectedId:e.getSelectId()}});this.currForm=d}},onSearch:function(a){var b=this,c=b.store;b.dataQuery=a.getValue(),c.proxy.extraParams={active:b.active,code_type:b.code_type,query:b.dataQuery},b.store.loadPage(1)},onCodeTypeSelect:function(a,b){var c=this,d=c.store;c.code_type=b[0].data.option_value,d.proxy.extraParams={active:c.active,code_type:c.code_type,query:c.dataQuery},c.store.loadPage(1)},onActivePressed:function(a,b){var c=this,d=c.store;c.active=!b,d.proxy.extraParams={active:c.active,code_type:c.code_type,query:c.dataQuery},c.store.load()},getSelectId:function(){var a=this.dataManagerGrid.getSelectionModel().getLastSelected();return a.data.id},onActive:function(a){this.bar.query("combobox")[0].setValue("CPT4"),this.store.proxy.extraParams={active:this.active,code_type:this.code_type,query:this.dataQuery},this.store.load(),a(!0)}}),Ext.define("App.view.patient.InsuranceForm",{extend:"Ext.form.Panel",requires:["Ext.grid.plugin.RowEditing","App.ux.grid.RowFormEditing","Ext.grid.plugin.CellEditing","App.ux.combo.Insurances","App.ux.combo.Combo","App.ux.form.fields.InputTextMask","Modules.billing.view.patient.BillingPatientInsuranceCoverInformation"],xtype:"patientinsuranceform",border:!1,bodyBorder:!1,closable:!0,fieldDefaults:{labelAlign:"top"},initComponent:function(){var a=this;a.dateFormat=Ext.Date.defaultFormat,a.today=new Date,a.todaysDate=Ext.util.Format.date(a.today,"m/d/Y"),a.oneHour=36e5,a.days=0,a.colorEqualZero="color: #000000;",a.colorLessThanZero="color: #FF4500;",a.colorGreaterThanZero="color: #000000;",a.textRight="text-align:right;",a.textLeft="text-align:left;",a.textCenter="text-align:center;",a.stateful=!0,a.stateId=a.itemId+"_State_"+app.user.id,a.items=[{xtype:"container",padding:"0 0 0 0",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",title:_("card_information"),itemId:"PatientInsurancesForm",padding:"0 0 10 0",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",cls:"highlight_fieldset",layout:{type:"hbox",align:"stretch"},width:1100,margin:"0 5 5 5",items:[{xtype:"fieldcontainer",layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 10 0 2"},items:[{xtype:"fieldcontainer",layout:"hbox",enableKeyEvents:!0,width:650,defaults:{margin:"0 10 0 2"},items:[{xtype:"insurancescombo",name:"insurance_id",fieldLabel:_("insurance"),labelWidth:120,width:410,queryMode:"local",editable:!0,allowBlank:!1,forceSelection:!0,typeAhead:!0},{xtype:"gaiaehr.combo",emptyText:_("type"),fieldLabel:_("type"),labelWidth:100,flex:1,name:"insurance_type",listKey:"ins_type",queryMode:"local",allowBlank:!1,editable:!1,loadStore:!0}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"bottom"},hideLabel:!1,width:650,defaults:{margin:"0 10 0 2"},items:[{xtype:"textfield",name:"policy_number",itemId:"PatientInsuranceID",emptyText:_("policy_number"),fieldLabel:_("id"),allowBlank:!1,width:200},{xtype:"textfield",name:"group_number",emptyText:_("group_number"),fieldLabel:_("group"),width:200},{xtype:"datefield",name:"effective_date",itemId:"PatientInsurancesFormEffectiveDate",labelAlign:"top",emptyText:_("effective")+" "+_("date"),fieldLabel:_("effective"),labelWidth:60,allowBlank:!1,width:100},{xtype:"checkboxfield",name:"active",checked:!1,itemId:"PatientInsurancesFormIsActiveCkBox",fieldLabel:_("active"),margin:"0 0 0 25",labelAlign:"right",labelWidth:60}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"bottom"},width:650,defaults:{margin:"0 10 0 2"},items:[{xtype:"textfield",name:"card_first_name",emptyText:_("first_name"),fieldLabel:_("card_name"),itemId:"InsuranceCardFirstNameField",allowBlank:!1,width:120},{xtype:"textfield",name:"card_middle_name",emptyText:_("middle_name"),itemId:"InsuranceCardMiddleNameField",width:70},{xtype:"textfield",name:"card_last_name",emptyText:_("last_name"),itemId:"InsuranceCardLastNameField",allowBlank:!1,width:200},{xtype:"datefield",name:"subscriber_dob",emptyText:_("dob"),fieldLabel:_("dob"),allowBlank:!1,flex:1},{xtype:"gaiaehr.combo",name:"subscriber_sex",emptyText:_("sex"),fieldLabel:_("sex"),labelWidth:30,listKey:"sex",queryMode:"local",flex:1,loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:{type:"hbox"},width:650,defaults:{margin:"0 10 0 2"},items:[{xtype:"textfield",name:"rx_group",fieldLabel:_("rx_group"),flex:1},{xtype:"textfield",name:"rx_bin",fieldLabel:_("rx_bin"),flex:1},{xtype:"textfield",name:"rx_pcn",fieldLabel:_("rx_pcn"),flex:1},{xtype:"textfield",name:"rx_member_id",fieldLabel:_("rx_member_id"),flex:1}]},{xtype:"billingpatientinsurancecoverinformation",itemId:"BillingPatientInsuranceCoverInformationxtype",margin:"5 0 0 2",flex:1}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},margin:"10 0 5 15",items:[{xtype:"panel",cls:"highlight_fieldset",margin:"0 0 0 0",width:380,height:250,layout:"fit",itemId:"PatientInsuranceFormCardContainer",items:[{xtype:"image",action:"insImage",src:"data:image/jpeg;base64,/9j/4QtvRXhpZgAATU0AKgAAAAgADAEAAAMAAAABAOYAAAEBAAMAAAABAIIAAAECAAMAAAADAAAAngEGAAMAAAABAAIAAAESAAMAAAABAAEAAAEVAAMAAAABAAMAAAEaAAUAAAABAAAApAEbAAUAAAABAAAArAEoAAMAAAABAAIAAAExAAIAAAAeAAAAtAEyAAIAAAAUAAAA0odpAAQAAAABAAAA6AAAASAACAAIAAgACvyAAAAnEAAK/IAAACcQQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykAMjAxMzowOToxNiAxMTowMTozMAAAAAAEkAAABwAAAAQwMjIxoAEAAwAAAAEAAQAAoAIABAAAAAEAAAD9oAMABAAAAAEAAACZAAAAAAAAAAYBAwADAAAAAQAGAAABGgAFAAAAAQAAAW4BGwAFAAAAAQAAAXYBKAADAAAAAQACAAACAQAEAAAAAQAAAX4CAgAEAAAAAQAACekAAAAAAAAASAAAAAEAAABIAAAAAf/Y/+0ADEFkb2JlX0NNAAH/7gAOQWRvYmUAZIAAAAAB/9sAhAAMCAgICQgMCQkMEQsKCxEVDwwMDxUYExMVExMYEQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAQ0LCw0ODRAODhAUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCABhAKADASIAAhEBAxEB/90ABAAK/8QBPwAAAQUBAQEBAQEAAAAAAAAAAwABAgQFBgcICQoLAQABBQEBAQEBAQAAAAAAAAABAAIDBAUGBwgJCgsQAAEEAQMCBAIFBwYIBQMMMwEAAhEDBCESMQVBUWETInGBMgYUkaGxQiMkFVLBYjM0coLRQwclklPw4fFjczUWorKDJkSTVGRFwqN0NhfSVeJl8rOEw9N14/NGJ5SkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2N0dXZ3eHl6e3x9fn9xEAAgIBAgQEAwQFBgcHBgU1AQACEQMhMRIEQVFhcSITBTKBkRShsUIjwVLR8DMkYuFygpJDUxVjczTxJQYWorKDByY1wtJEk1SjF2RFVTZ0ZeLys4TD03Xj80aUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9ic3R1dnd4eXp7fH/9oADAMBAAIRAxEAPwD1VJJQtuppbvusbWyY3PIaJPaXJKZpKt+0unf9yqf+3G/+SS/aXTv+5VP/AG43/wAkkpspKt+0unf9yqf+3G/+SR2Pa9oewhzXAFrgZBB4IKSmSSSSSlJJJJKUkkkkpSSSSSlJJJJKUkkkkpSSSSSn/9D1VZ/Vq67fsddrWvY7JaHMcAQfZby1y0FR6n/OYP8A4ab/ANRakpn+yul/9w6P+2mf+RS/ZXS/+4dH/bTP/Iq2kkpqfsrpf/cOj/tpn/kU3R/+SMH/AML1f9Q1XFT6P/yRg/8Aher/AKhqSmzdX6tL6tzq97S3eww5siNzHfmvb+as39gn/wAss7/t4f8ApNaVzrG1PdUz1LGtJZWTt3OA9rN+uzd+8s37f17/AMqmf+xLf/SSSlfsE/8Allnf9vD/ANJpfsE/+WWd/wBvD/0mn+39e/8AKpn/ALEt/wDSSX2/r3/lUz/2Jb/6SSUt+wT/AOWWd/28P/SaX7BP/llnf9vD/wBJp/t/Xv8AyqZ/7Et/9JJfb+vf+VTP/Ylv/pJJS37BP/llnf8Abw/9JpfsE/8Allnf9vD/ANJp/t/Xv/Kpn/sS3/0kl9v69/5VM/8AYlv/AKSSUt+wT/5ZZ3/bw/8ASaX7BP8A5ZZ3/bw/9Jp/t/Xv/Kpn/sS3/wBJJfb+vf8AlUz/ANiW/wDpJJS37BP/AJZZ3/bw/wDSaX7BP/llnf8Abw/9Jp/t/Xv/ACqZ/wCxLf8A0kl9v69/5VM/9iW/+kklNzCxPslJq9e3Ilxdvvdvdr+buhvtVhV8K3LtpLsvHGNZuIFYeLNOzt7WsVhJT//R9VVHqf8AOYP/AIab/wBRaryrZ2E3MrYw22UOreLGWVEBwIBb+e2xv5ySmyksz9jW/wDlnm/59f8A6QS/Y1v/AJZ5v+fX/wCkElOmqfR/+SMH/wAL1f8AUNQP2Nb/AOWeb/n1/wDpBXsahmNjVYzCSylja2l0SQ0bBu27fBJSRzmtaXOIa1okk6AAdyg/bsL/ALkVf57f70Wytltbq7Gh9bwWvY4SCDo5rmn95VP2J0b/ALgY3/bTP/IpKTfbsL/uRV/nt/vS+3YX/cir/Pb/AHoP7E6N/wBwMb/tpn/kUv2J0b/uBjf9tM/8ikpN9uwv+5FX+e3+9L7dhf8Acir/AD2/3oP7E6N/3Axv+2mf+RS/YnRv+4GN/wBtM/8AIpKTfbsL/uRV/nt/vS+3YX/cir/Pb/eg/sTo3/cDG/7aZ/5FL9idG/7gY3/bTP8AyKSk327C/wC5FX+e3+9L7dhf9yKv89v96D+xOjf9wMb/ALaZ/wCRS/YnRv8AuBjf9tM/8ikpN9uwv+5FX+e3+9L7dhf9yKv89v8Aeg/sTo3/AHAxv+2mf+RS/YnRv+4GN/20z/yKSm1XbVa3dU9tjZiWkET/AGVNCx8XGxa/TxqmUVklxZW0NEnl21kIqSn/0vVUHKyBjUOvNdlobHsqaXvMkM9tbfc76SMkkpy/2/X/ANwc7/2Gel+36/8AuDnf+wz1qJJKcv8Ab9f/AHBzv/YZ6X7fr/7g53/sM9aiSSnL/b9f/cHO/wDYZ6X7fr/7g53/ALDPWokkpy/2/X/3Bzv/AGGel+36/wDuDnf+wz1qJJKcv9v1/wDcHO/9hnpft+v/ALg53/sM9aiSSnL/AG/X/wBwc7/2Gel+36/+4Od/7DPWokkpy/2/X/3Bzv8A2Gel+36/+4Od/wCwz1qJJKcv9v1/9wc7/wBhnpft+v8A7g53/sM9aiSSmvh5Yy6jaKraQHFuy9hrdp+dsf8Amqwkkkp//9P1VBy8THzMd2Nks9Sl8bmyRO0h7dWFrvpNRkHKdlNoccRjLL9NjbHFrTqN+5zWvd9Dd+akpof81+hf9xf+nZ/6US/5r9C/7i/9Oz/0on9b6y/9xsT/ALes/wDSKXrfWX/uNif9vWf+kUlLf81+hf8AcX/p2f8ApRL/AJr9C/7i/wDTs/8ASif1vrL/ANxsT/t6z/0il631l/7jYn/b1n/pFJS3/NfoX/cX/p2f+lEv+a/Qv+4v/Ts/9KJ/W+sv/cbE/wC3rP8A0il631l/7jYn/b1n/pFJS3/NfoX/AHF/6dn/AKUS/wCa/Qv+4v8A07P/AEon9b6y/wDcbE/7es/9Ipet9Zf+42J/29Z/6RSUt/zX6F/3F/6dn/pRL/mv0L/uL/07P/Sif1vrL/3GxP8At6z/ANIpet9Zf+42J/29Z/6RSUt/zX6F/wBxf+nZ/wClEv8Amv0L/uL/ANOz/wBKJ/W+sv8A3GxP+3rP/SKXrfWX/uNif9vWf+kUlLf81+hf9xf+nZ/6US/5r9C/7i/9Oz/0on9b6y/9xsT/ALes/wDSKXrfWX/uNif9vWf+kUlLf81+hf8AcX/p2f8ApRL/AJr9C/7i/wDTs/8ASif1vrL/ANxsT/t6z/0il631l/7jYn/b1n/pFJTcwsHEwKTTiM9OsuLi2S7U8n3lysKvhOznVE5zK67dxhtTi9u3807ntr9ysJKf/9T1VJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJT//V9VSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp//Z/+0TXFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAPHAFaAAMbJUccAgAAAgAAADhCSU0EJQAAAAAAEM3P+n2ox74JBXB2rq8Fw044QklNBDoAAAAAAOUAAAAQAAAAAQAAAAAAC3ByaW50T3V0cHV0AAAABQAAAABQc3RTYm9vbAEAAAAASW50ZWVudW0AAAAASW50ZQAAAABDbHJtAAAAD3ByaW50U2l4dGVlbkJpdGJvb2wAAAAAC3ByaW50ZXJOYW1lVEVYVAAAAAEAAAAAAA9wcmludFByb29mU2V0dXBPYmpjAAAADABQAHIAbwBvAGYAIABTAGUAdAB1AHAAAAAAAApwcm9vZlNldHVwAAAAAQAAAABCbHRuZW51bQAAAAxidWlsdGluUHJvb2YAAAAJcHJvb2ZDTVlLADhCSU0EOwAAAAACLQAAABAAAAABAAAAAAAScHJpbnRPdXRwdXRPcHRpb25zAAAAFwAAAABDcHRuYm9vbAAAAAAAQ2xicmJvb2wAAAAAAFJnc01ib29sAAAAAABDcm5DYm9vbAAAAAAAQ250Q2Jvb2wAAAAAAExibHNib29sAAAAAABOZ3R2Ym9vbAAAAAAARW1sRGJvb2wAAAAAAEludHJib29sAAAAAABCY2tnT2JqYwAAAAEAAAAAAABSR0JDAAAAAwAAAABSZCAgZG91YkBv4AAAAAAAAAAAAEdybiBkb3ViQG/gAAAAAAAAAAAAQmwgIGRvdWJAb+AAAAAAAAAAAABCcmRUVW50RiNSbHQAAAAAAAAAAAAAAABCbGQgVW50RiNSbHQAAAAAAAAAAAAAAABSc2x0VW50RiNQeGxAUgAAAAAAAAAAAAp2ZWN0b3JEYXRhYm9vbAEAAAAAUGdQc2VudW0AAAAAUGdQcwAAAABQZ1BDAAAAAExlZnRVbnRGI1JsdAAAAAAAAAAAAAAAAFRvcCBVbnRGI1JsdAAAAAAAAAAAAAAAAFNjbCBVbnRGI1ByY0BZAAAAAAAAAAAAEGNyb3BXaGVuUHJpbnRpbmdib29sAAAAAA5jcm9wUmVjdEJvdHRvbWxvbmcAAAAAAAAADGNyb3BSZWN0TGVmdGxvbmcAAAAAAAAADWNyb3BSZWN0UmlnaHRsb25nAAAAAAAAAAtjcm9wUmVjdFRvcGxvbmcAAAAAADhCSU0D7QAAAAAAEABIAAAAAQABAEgAAAABAAE4QklNBCYAAAAAAA4AAAAAAAAAAAAAP4AAADhCSU0D8gAAAAAACgAA////////AAA4QklNBA0AAAAAAAQAAAB4OEJJTQQZAAAAAAAEAAAAHjhCSU0D8wAAAAAACQAAAAAAAAAAAQA4QklNJxAAAAAAAAoAAQAAAAAAAAABOEJJTQP1AAAAAABIAC9mZgABAGxmZgAGAAAAAAABAC9mZgABAKGZmgAGAAAAAAABADIAAAABAFoAAAAGAAAAAAABADUAAAABAC0AAAAGAAAAAAABOEJJTQP4AAAAAABwAAD/////////////////////////////A+gAAAAA/////////////////////////////wPoAAAAAP////////////////////////////8D6AAAAAD/////////////////////////////A+gAADhCSU0EAAAAAAAAAgAIOEJJTQQCAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAOEJJTQQwAAAAAAAJAQEBAQEBAQEBADhCSU0ELQAAAAAAAgAAOEJJTQQIAAAAAAAQAAAAAQAAAkAAAAJAAAAAADhCSU0EHgAAAAAABAAAAAA4QklNBBoAAAAAA0cAAAAGAAAAAAAAAAAAAACZAAAA/QAAAAkAaQBuAHMAdQByAGEAbgBjAGUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAP0AAACZAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAABudWxsAAAAAgAAAAZib3VuZHNPYmpjAAAAAQAAAAAAAFJjdDEAAAAEAAAAAFRvcCBsb25nAAAAAAAAAABMZWZ0bG9uZwAAAAAAAAAAQnRvbWxvbmcAAACZAAAAAFJnaHRsb25nAAAA/QAAAAZzbGljZXNWbExzAAAAAU9iamMAAAABAAAAAAAFc2xpY2UAAAASAAAAB3NsaWNlSURsb25nAAAAAAAAAAdncm91cElEbG9uZwAAAAAAAAAGb3JpZ2luZW51bQAAAAxFU2xpY2VPcmlnaW4AAAANYXV0b0dlbmVyYXRlZAAAAABUeXBlZW51bQAAAApFU2xpY2VUeXBlAAAAAEltZyAAAAAGYm91bmRzT2JqYwAAAAEAAAAAAABSY3QxAAAABAAAAABUb3AgbG9uZwAAAAAAAAAATGVmdGxvbmcAAAAAAAAAAEJ0b21sb25nAAAAmQAAAABSZ2h0bG9uZwAAAP0AAAADdXJsVEVYVAAAAAEAAAAAAABudWxsVEVYVAAAAAEAAAAAAABNc2dlVEVYVAAAAAEAAAAAAAZhbHRUYWdURVhUAAAAAQAAAAAADmNlbGxUZXh0SXNIVE1MYm9vbAEAAAAIY2VsbFRleHRURVhUAAAAAQAAAAAACWhvcnpBbGlnbmVudW0AAAAPRVNsaWNlSG9yekFsaWduAAAAB2RlZmF1bHQAAAAJdmVydEFsaWduZW51bQAAAA9FU2xpY2VWZXJ0QWxpZ24AAAAHZGVmYXVsdAAAAAtiZ0NvbG9yVHlwZWVudW0AAAARRVNsaWNlQkdDb2xvclR5cGUAAAAATm9uZQAAAAl0b3BPdXRzZXRsb25nAAAAAAAAAApsZWZ0T3V0c2V0bG9uZwAAAAAAAAAMYm90dG9tT3V0c2V0bG9uZwAAAAAAAAALcmlnaHRPdXRzZXRsb25nAAAAAAA4QklNBCgAAAAAAAwAAAACP/AAAAAAAAA4QklNBBQAAAAAAAQAAAAOOEJJTQQMAAAAAAoFAAAAAQAAAKAAAABhAAAB4AAAteAAAAnpABgAAf/Y/+0ADEFkb2JlX0NNAAH/7gAOQWRvYmUAZIAAAAAB/9sAhAAMCAgICQgMCQkMEQsKCxEVDwwMDxUYExMVExMYEQwMDAwMDBEMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMAQ0LCw0ODRAODhAUDg4OFBQODg4OFBEMDAwMDBERDAwMDAwMEQwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCABhAKADASIAAhEBAxEB/90ABAAK/8QBPwAAAQUBAQEBAQEAAAAAAAAAAwABAgQFBgcICQoLAQABBQEBAQEBAQAAAAAAAAABAAIDBAUGBwgJCgsQAAEEAQMCBAIFBwYIBQMMMwEAAhEDBCESMQVBUWETInGBMgYUkaGxQiMkFVLBYjM0coLRQwclklPw4fFjczUWorKDJkSTVGRFwqN0NhfSVeJl8rOEw9N14/NGJ5SkhbSVxNTk9KW1xdXl9VZmdoaWprbG1ub2N0dXZ3eHl6e3x9fn9xEAAgIBAgQEAwQFBgcHBgU1AQACEQMhMRIEQVFhcSITBTKBkRShsUIjwVLR8DMkYuFygpJDUxVjczTxJQYWorKDByY1wtJEk1SjF2RFVTZ0ZeLys4TD03Xj80aUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm9ic3R1dnd4eXp7fH/9oADAMBAAIRAxEAPwD1VJJQtuppbvusbWyY3PIaJPaXJKZpKt+0unf9yqf+3G/+SS/aXTv+5VP/AG43/wAkkpspKt+0unf9yqf+3G/+SR2Pa9oewhzXAFrgZBB4IKSmSSSSSlJJJJKUkkkkpSSSSSlJJJJKUkkkkpSSSSSn/9D1VZ/Vq67fsddrWvY7JaHMcAQfZby1y0FR6n/OYP8A4ab/ANRakpn+yul/9w6P+2mf+RS/ZXS/+4dH/bTP/Iq2kkpqfsrpf/cOj/tpn/kU3R/+SMH/AML1f9Q1XFT6P/yRg/8Aher/AKhqSmzdX6tL6tzq97S3eww5siNzHfmvb+as39gn/wAss7/t4f8ApNaVzrG1PdUz1LGtJZWTt3OA9rN+uzd+8s37f17/AMqmf+xLf/SSSlfsE/8Allnf9vD/ANJpfsE/+WWd/wBvD/0mn+39e/8AKpn/ALEt/wDSSX2/r3/lUz/2Jb/6SSUt+wT/AOWWd/28P/SaX7BP/llnf9vD/wBJp/t/Xv8AyqZ/7Et/9JJfb+vf+VTP/Ylv/pJJS37BP/llnf8Abw/9JpfsE/8Allnf9vD/ANJp/t/Xv/Kpn/sS3/0kl9v69/5VM/8AYlv/AKSSUt+wT/5ZZ3/bw/8ASaX7BP8A5ZZ3/bw/9Jp/t/Xv/Kpn/sS3/wBJJfb+vf8AlUz/ANiW/wDpJJS37BP/AJZZ3/bw/wDSaX7BP/llnf8Abw/9Jp/t/Xv/ACqZ/wCxLf8A0kl9v69/5VM/9iW/+kklNzCxPslJq9e3Ilxdvvdvdr+buhvtVhV8K3LtpLsvHGNZuIFYeLNOzt7WsVhJT//R9VVHqf8AOYP/AIab/wBRaryrZ2E3MrYw22UOreLGWVEBwIBb+e2xv5ySmyksz9jW/wDlnm/59f8A6QS/Y1v/AJZ5v+fX/wCkElOmqfR/+SMH/wAL1f8AUNQP2Nb/AOWeb/n1/wDpBXsahmNjVYzCSylja2l0SQ0bBu27fBJSRzmtaXOIa1okk6AAdyg/bsL/ALkVf57f70Wytltbq7Gh9bwWvY4SCDo5rmn95VP2J0b/ALgY3/bTP/IpKTfbsL/uRV/nt/vS+3YX/cir/Pb/AHoP7E6N/wBwMb/tpn/kUv2J0b/uBjf9tM/8ikpN9uwv+5FX+e3+9L7dhf8Acir/AD2/3oP7E6N/3Axv+2mf+RS/YnRv+4GN/wBtM/8AIpKTfbsL/uRV/nt/vS+3YX/cir/Pb/eg/sTo3/cDG/7aZ/5FL9idG/7gY3/bTP8AyKSk327C/wC5FX+e3+9L7dhf9yKv89v96D+xOjf9wMb/ALaZ/wCRS/YnRv8AuBjf9tM/8ikpN9uwv+5FX+e3+9L7dhf9yKv89v8Aeg/sTo3/AHAxv+2mf+RS/YnRv+4GN/20z/yKSm1XbVa3dU9tjZiWkET/AGVNCx8XGxa/TxqmUVklxZW0NEnl21kIqSn/0vVUHKyBjUOvNdlobHsqaXvMkM9tbfc76SMkkpy/2/X/ANwc7/2Gel+36/8AuDnf+wz1qJJKcv8Ab9f/AHBzv/YZ6X7fr/7g53/sM9aiSSnL/b9f/cHO/wDYZ6X7fr/7g53/ALDPWokkpy/2/X/3Bzv/AGGel+36/wDuDnf+wz1qJJKcv9v1/wDcHO/9hnpft+v/ALg53/sM9aiSSnL/AG/X/wBwc7/2Gel+36/+4Od/7DPWokkpy/2/X/3Bzv8A2Gel+36/+4Od/wCwz1qJJKcv9v1/9wc7/wBhnpft+v8A7g53/sM9aiSSmvh5Yy6jaKraQHFuy9hrdp+dsf8Amqwkkkp//9P1VBy8THzMd2Nks9Sl8bmyRO0h7dWFrvpNRkHKdlNoccRjLL9NjbHFrTqN+5zWvd9Dd+akpof81+hf9xf+nZ/6US/5r9C/7i/9Oz/0on9b6y/9xsT/ALes/wDSKXrfWX/uNif9vWf+kUlLf81+hf8AcX/p2f8ApRL/AJr9C/7i/wDTs/8ASif1vrL/ANxsT/t6z/0il631l/7jYn/b1n/pFJS3/NfoX/cX/p2f+lEv+a/Qv+4v/Ts/9KJ/W+sv/cbE/wC3rP8A0il631l/7jYn/b1n/pFJS3/NfoX/AHF/6dn/AKUS/wCa/Qv+4v8A07P/AEon9b6y/wDcbE/7es/9Ipet9Zf+42J/29Z/6RSUt/zX6F/3F/6dn/pRL/mv0L/uL/07P/Sif1vrL/3GxP8At6z/ANIpet9Zf+42J/29Z/6RSUt/zX6F/wBxf+nZ/wClEv8Amv0L/uL/ANOz/wBKJ/W+sv8A3GxP+3rP/SKXrfWX/uNif9vWf+kUlLf81+hf9xf+nZ/6US/5r9C/7i/9Oz/0on9b6y/9xsT/ALes/wDSKXrfWX/uNif9vWf+kUlLf81+hf8AcX/p2f8ApRL/AJr9C/7i/wDTs/8ASif1vrL/ANxsT/t6z/0il631l/7jYn/b1n/pFJTcwsHEwKTTiM9OsuLi2S7U8n3lysKvhOznVE5zK67dxhtTi9u3807ntr9ysJKf/9T1VJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJSkkkklKSSSSUpJJJJT//V9VSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp+qkl8qpJKfqpJfKqSSn6qSXyqkkp//ZADhCSU0EIQAAAAAAVQAAAAEBAAAADwBBAGQAbwBiAGUAIABQAGgAbwB0AG8AcwBoAG8AcAAAABMAQQBkAG8AYgBlACAAUABoAG8AdABvAHMAaABvAHAAIABDAFMANgAAAAEAOEJJTQQGAAAAAAAHAAgAAAABAQD/4Q7caHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAxMy0wNi0wNlQyMzo1OTo1NS0wNDowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxMy0wOS0xNlQxMTowMTozMC0wNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMTMtMDktMTZUMTE6MDE6MzAtMDQ6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6Rjg2RjNEOTVEQjFFRTMxMThBNTM5OTE5MTgzMjBCMEUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RkE5ODgwNUMyNUNGRTIxMUEzM0FBQ0U5MEZCMDc0MTUiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGQTk4ODA1QzI1Q0ZFMjExQTMzQUFDRTkwRkIwNzQxNSIgZGM6Zm9ybWF0PSJpbWFnZS9qcGVnIiBwaG90b3Nob3A6TGVnYWN5SVBUQ0RpZ2VzdD0iMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEiIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6RkE5ODgwNUMyNUNGRTIxMUEzM0FBQ0U5MEZCMDc0MTUiIHN0RXZ0OndoZW49IjIwMTMtMDYtMDZUMjM6NTk6NTUtMDQ6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDUzYgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpGQjk4ODA1QzI1Q0ZFMjExQTMzQUFDRTkwRkIwNzQxNSIgc3RFdnQ6d2hlbj0iMjAxMy0wNi0wNlQyMzo1OTo1NS0wNDowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOkY4NkYzRDk1REIxRUUzMTE4QTUzOTkxOTE4MzIwQjBFIiBzdEV2dDp3aGVuPSIyMDEzLTA5LTE2VDExOjAxOjMwLTA0OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0idyI/Pv/iDFhJQ0NfUFJPRklMRQABAQAADEhMaW5vAhAAAG1udHJSR0IgWFlaIAfOAAIACQAGADEAAGFjc3BNU0ZUAAAAAElFQyBzUkdCAAAAAAAAAAAAAAABAAD21gABAAAAANMtSFAgIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEWNwcnQAAAFQAAAAM2Rlc2MAAAGEAAAAbHd0cHQAAAHwAAAAFGJrcHQAAAIEAAAAFHJYWVoAAAIYAAAAFGdYWVoAAAIsAAAAFGJYWVoAAAJAAAAAFGRtbmQAAAJUAAAAcGRtZGQAAALEAAAAiHZ1ZWQAAANMAAAAhnZpZXcAAAPUAAAAJGx1bWkAAAP4AAAAFG1lYXMAAAQMAAAAJHRlY2gAAAQwAAAADHJUUkMAAAQ8AAAIDGdUUkMAAAQ8AAAIDGJUUkMAAAQ8AAAIDHRleHQAAAAAQ29weXJpZ2h0IChjKSAxOTk4IEhld2xldHQtUGFja2FyZCBDb21wYW55AABkZXNjAAAAAAAAABJzUkdCIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAEnNSR0IgSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABYWVogAAAAAAAA81EAAQAAAAEWzFhZWiAAAAAAAAAAAAAAAAAAAAAAWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPZGVzYwAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAWSUVDIGh0dHA6Ly93d3cuaWVjLmNoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRlc2MAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAALklFQyA2MTk2Ni0yLjEgRGVmYXVsdCBSR0IgY29sb3VyIHNwYWNlIC0gc1JHQgAAAAAAAAAAAAAAAAAAAAAAAAAAAABkZXNjAAAAAAAAACxSZWZlcmVuY2UgVmlld2luZyBDb25kaXRpb24gaW4gSUVDNjE5NjYtMi4xAAAAAAAAAAAAAAAsUmVmZXJlbmNlIFZpZXdpbmcgQ29uZGl0aW9uIGluIElFQzYxOTY2LTIuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAdmlldwAAAAAAE6T+ABRfLgAQzxQAA+3MAAQTCwADXJ4AAAABWFlaIAAAAAAATAlWAFAAAABXH+dtZWFzAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAACjwAAAAJzaWcgAAAAAENSVCBjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADcAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8ApACpAK4AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23////uAA5BZG9iZQBkQAAAAAH/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQECAgICAgICAgICAgMDAwMDAwMDAwMBAQEBAQEBAQEBAQICAQICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDA//AABEIAJkA/QMBEQACEQEDEQH/3QAEACD/xAGiAAAABgIDAQAAAAAAAAAAAAAHCAYFBAkDCgIBAAsBAAAGAwEBAQAAAAAAAAAAAAYFBAMHAggBCQAKCxAAAgEDBAEDAwIDAwMCBgl1AQIDBBEFEgYhBxMiAAgxFEEyIxUJUUIWYSQzF1JxgRhikSVDobHwJjRyChnB0TUn4VM2gvGSokRUc0VGN0djKFVWVxqywtLi8mSDdJOEZaOzw9PjKThm83UqOTpISUpYWVpnaGlqdnd4eXqFhoeIiYqUlZaXmJmapKWmp6ipqrS1tre4ubrExcbHyMnK1NXW19jZ2uTl5ufo6er09fb3+Pn6EQACAQMCBAQDBQQEBAYGBW0BAgMRBCESBTEGACITQVEHMmEUcQhCgSORFVKhYhYzCbEkwdFDcvAX4YI0JZJTGGNE8aKyJjUZVDZFZCcKc4OTRnTC0uLyVWV1VjeEhaOzw9Pj8ykalKS0xNTk9JWltcXV5fUoR1dmOHaGlqa2xtbm9md3h5ent8fX5/dIWGh4iJiouMjY6Pg5SVlpeYmZqbnJ2en5KjpKWmp6ipqqusra6vr/2gAMAwEAAhEDEQA/AN/j37r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvdf//Q3+Pfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691//9Hf49+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3X//0t/j37r3XvfuvdEX+d+zMP2Ltn4/bD3A1YmD3d8n+vdv5VsfOlNXLQZPa3YFLUmkqJIaiOGoEch0sUcA/g+/de6Qv/DWXxl/5Xezv/QqxX/2M+/de69/w1l8Zf8Ald7O/wDQqxX/ANjPv3Xuvf8ADWXxl/5Xezv/AEKsV/8AYz7917r3/DWXxl/5Xezv/QqxX/2M+/de6RXZX8tL46bT653/ALqxdX2O2T21srdW4MctVubGTUrV+GwVfkaMVMSbdieWnNRTLrUMpZbgEfX37r3R7fjZ/wBk69Bf+IV6s/8AeGwXv3Xuhq9+690l971W6qHZe767YuNoszvej2vn6rZ2HyUiRY7Lbqp8TVzbexuQlkyGJjjoq7LpDFKzVVMBG5JljHrHuvdV0/6U/wCad/3jZ0r/AOf3D/8A2/ffuvde/wBKf807/vGzpX/z+4f/AO377917r3+lP+ad/wB42dK/+f3D/wD2/ffuvde/0p/zTv8AvGzpX/z+4f8A+377917r3+lP+ad/3jZ0r/5/cP8A/b99+6917/Sn/NO/7xs6V/8AP7h//t++/de69/pT/mnf942dK/8An9w//wBv337r3Xv9Kf8ANO/7xs6V/wDP7h//ALfvv3Xuvf6U/wCad/3jZ0r/AOf3D/8A2/ffuvde/wBKf807/vGzpX/z+4f/AO377917r3+lP+ad/wB42dK/+f3D/wD2/ffuvde/0p/zTv8AvGzpX/z+4f8A+377917r3+lP+ad/3jZ0r/5/cP8A/b99+6917/Sn/NO/7xs6V/8AP7h//t++/de69/pT/mnf942dK/8An9w//wBv337r3Xv9Kf8ANO/7xs6V/wDP7h//ALfvv3Xuvf6U/wCad/3jZ0r/AOf3D/8A2/ffuvde/wBKf807/vGzpX/z+4f/AO377917qz737r3Xvfuvde9+691//9Pf49+691737r3RRPln/wADvit/4t31Z/7z2/ffuvdG79+691737r3Xvfuvde9+690F3eH/ADJXt/8A8Rd2B/7yeW9+690zfGz/ALJ16C/8Qr1Z/wC8NgvfuvdDV7917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuv/1N/j37r3XvfuvdFE+Wf/AAO+K3/i3fVn/vPb99+690bv37r3Xvfuvde9+691737r3QXd4f8AMle3/wDxF3YH/vJ5b37r3TN8bP8AsnXoL/xCvVn/ALw2C9+690NXv3XukvvfPZHa2y937nw+363duX25tfP57F7VxpnGR3NkcRiavIUO38eaWiyVSK3M1NOtNF46aok8kg0xubKfde6rp/2e35Ff96++6v8Aqfvn/wC0r7917r3+z2/Ir/vX33V/1P3z/wDaV9+6917/AGe35Ff96++6v+p++f8A7Svv3Xuvf7Pb8iv+9ffdX/U/fP8A9pX37r3Xv9nt+RX/AHr77q/6n75/+0r7917r3+z2/Ir/AL1991f9T98//aV9+6917/Z7fkV/3r77q/6n75/+0r7917r3+z2/Ir/vX33V/wBT98//AGlffuvde/2e35Ff96++6v8Aqfvn/wC0r7917r3+z2/Ir/vX33V/1P3z/wDaV9+6917/AGe35Ff96++6v+p++f8A7Svv3Xuvf7Pb8iv+9ffdX/U/fP8A9pX37r3Xv9nt+RX/AHr77q/6n75/+0r7917r3+z2/Ir/AL1991f9T98//aV9+6917/Z7fkV/3r77q/6n75/+0r7917r3+z2/Ir/vX33V/wBT98//AGlffuvde/2e35Ff96++6v8Aqfvn/wC0r7917r3+z2/Ir/vX33V/1P3z/wDaV9+691Z97917r3v3Xuve/de6/9Xf49+691737r3RRPln/wADvit/4t31Z/7z2/ffuvdG79+691737r3Xvfuvde9+690F3eH/ADJXt/8A8Rd2B/7yeW9+690zfGz/ALJ16C/8Qr1Z/wC8NgvfuvdDV7917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuve/de697917r3v3Xuv/1t/j37r3XvfuvdFE+Wf/AAO+K3/i3fVn/vPb99+690bv37r3Xvfuvde9+691737r3QXd4f8AMle3/wDxF3YH/vJ5b37r3TN8bP8AsnXoL/xCvVn/ALw2C9+690NXv3XumXcu4sPtDbmf3ZuKs/h239r4TK7izuQ+3qqv7HD4ShnyWTrPtaGCpran7aipnfxwxySvpsisxAPuvdFF/wCHEPh3/wA/f/8AYf8AaP8A9hPv3Xuvf8OIfDv/AJ+//wCw/wC0f/sJ9+6917/hxD4d/wDP3/8A2H/aP/2E+/de69/w4h8O/wDn7/8A7D/tH/7Cffuvde/4cQ+Hf/P3/wD2H/aP/wBhPv3Xuvf8OIfDv/n7/wD7D/tH/wCwn37r3Xv+HEPh3/z9/wD9h/2j/wDYT7917r3/AA4h8O/+fv8A/sP+0f8A7Cffuvde/wCHEPh3/wA/f/8AYf8AaP8A9hPv3Xuvf8OIfDv/AJ+//wCw/wC0f/sJ9+6917/hxD4d/wDP3/8A2H/aP/2E+/de69/w4h8O/wDn7/8A7D/tH/7Cffuvde/4cQ+Hf/P3/wD2H/aP/wBhPv3Xuvf8OIfDv/n7/wD7D/tH/wCwn37r3Xv+HEPh3/z9/wD9h/2j/wDYT7917r3/AA4h8O/+fv8A/sP+0f8A7Cffuvde/wCHEPh3/wA/f/8AYf8AaP8A9hPv3Xuvf8OIfDv/AJ+//wCw/wC0f/sJ9+690dT37r3Xvfuvde9+691//9ff49+691737r3Rdfkt0XmO+9pbTwO3+xazq7ObP7Cw3YOK3Xj8I+drqevwuG3FiqaGkgjz23pKOoEmeEy1AnYoYdOg6tS+690Wf/ZM/k1/3n52d/6COV/+2p7917r3+yZ/Jr/vPzs7/wBBHK//AG1Pfuvde/2TP5Nf95+dnf8AoI5X/wC2p7917r3+yZ/Jr/vPzs7/ANBHK/8A21PfuvdQsl8IvkXmMdX4nKfPHsfIYzKUVVjsjQVWzcnNS1tBWwSU1ZSVML9plJaepp5WR1PDKxB9+690frrXZ/8Ao8662DsD+I/xf+4+ytq7P/i32n8P/in92cFQYX+I/YfdVv2X3v2Xl8Pmm8erTre2o+690tffuvdQsljcdmcdkMPmMfRZbEZaiqsblMXkqWCux2Sx1dBJS12PyFDVRy01ZRVlNK0csUitHJGxVgQSPfuvdBF/stnx1/58F0r/AOis2N/9Yvfuvde/2Wz46/8APgulf/RWbG/+sXv3Xuvf7LZ8df8AnwXSv/orNjf/AFi9+6917/ZbPjr/AM+C6V/9FZsb/wCsXv3Xuvf7LZ8df+fBdK/+is2N/wDWL37r3Xv9ls+Ov/Pgulf/AEVmxv8A6xe/de69/stnx1/58F0r/wCis2N/9Yvfuvde/wBls+Ov/Pgulf8A0Vmxv/rF7917r3+y2fHX/nwXSv8A6KzY3/1i9+6917/ZbPjr/wA+C6V/9FZsb/6xe/de69/stnx1/wCfBdK/+is2N/8AWL37r3Xv9ls+Ov8Az4LpX/0Vmxv/AKxe/de69/stnx1/58F0r/6KzY3/ANYvfuvde/2Wz46/8+C6V/8ARWbG/wDrF7917r3+y2fHX/nwXSv/AKKzY3/1i9+6917/AGWz46/8+C6V/wDRWbG/+sXv3Xuvf7LZ8df+fBdK/wDorNjf/WL37r3Xv9ls+Ov/AD4LpX/0Vmxv/rF7917oavfuvde9+691737r3X//0N/j37r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvdf//R3+Pfuvde9+690GHc2+9x9Z9bbk3vtPr7N9p7gwn8H/h+w9utXLmM7/Es9i8RVfZtjcLuKtH8Loq+Ssk0Uc37VO19C3dfde6Ih/s9vyK/71991f8AU/fP/wBpX37r3Xv9nt+RX/evvur/AKn75/8AtK+/de69/s9vyK/71991f9T98/8A2lffuvde/wBnt+RX/evvur/qfvn/AO0r7917r3+z2/Ir/vX33V/1P3z/APaV9+6917/Z7fkV/wB6++6v+p++f/tK+/de69/s9vyK/wC9ffdX/U/fP/2lffuvde/2e35Ff96++6v+p++f/tK+/de69/s9vyK/71991f8AU/fP/wBpX37r3Xv9nt+RX/evvur/AKn75/8AtK+/de69/s9vyK/71991f9T98/8A2lffuvde/wBnt+RX/evvur/qfvn/AO0r7917r3+z2/Ir/vX33V/1P3z/APaV9+6917/Z7fkV/wB6++6v+p++f/tK+/de69/s9vyK/wC9ffdX/U/fP/2lffuvde/2e35Ff96++6v+p++f/tK+/de69/s9vyK/71991f8AU/fP/wBpX37r3Xv9nt+RX/evvur/AKn75/8AtK+/de69/s9vyK/71991f9T98/8A2lffuvde/wBnt+RX/evvur/qfvn/AO0r7917r3+z2/Ir/vX33V/1P3z/APaV9+6917/Z7fkV/wB6++6v+p++f/tK+/de69/s9vyK/wC9ffdX/U/fP/2lffuvde/2e35Ff96++6v+p++f/tK+/de69/s9vyK/71991f8AU/fP/wBpX37r3Xv9nt+RX/evvur/AKn75/8AtK+/de6s+9+691737r3Xvfuvdf/S3+Pfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691//9Pf49+691737r3QYdzds7c6N623J2luyizeR2/tf+D/AMQo9u01DV5ib+N57F7dpfs6fJZLEUUnjrcvG0muojtErEamAU+690RD/h2P46/88X3V/wCg7sb/AO2N7917r3/Dsfx1/wCeL7q/9B3Y3/2xvfuvde/4dj+Ov/PF91f+g7sb/wC2N7917r3/AA7H8df+eL7q/wDQd2N/9sb37r3Xv+HY/jr/AM8X3V/6Duxv/tje/de69/w7H8df+eL7q/8AQd2N/wDbG9+6917/AIdj+Ov/ADxfdX/oO7G/+2N7917r3/Dsfx1/54vur/0Hdjf/AGxvfuvde/4dj+Ov/PF91f8AoO7G/wDtje/de69/w7H8df8Ani+6v/Qd2N/9sb37r3Xv+HY/jr/zxfdX/oO7G/8Atje/de69/wAOx/HX/ni+6v8A0Hdjf/bG9+6917/h2P46/wDPF91f+g7sb/7Y3v3Xuvf8Ox/HX/ni+6v/AEHdjf8A2xvfuvde/wCHY/jr/wA8X3V/6Duxv/tje/de69/w7H8df+eL7q/9B3Y3/wBsb37r3Xv+HY/jr/zxfdX/AKDuxv8A7Y3v3Xuvf8Ox/HX/AJ4vur/0Hdjf/bG9+6917/h2P46/88X3V/6Duxv/ALY3v3Xuvf8ADsfx1/54vur/ANB3Y3/2xvfuvde/4dj+Ov8AzxfdX/oO7G/+2N7917r3/Dsfx1/54vur/wBB3Y3/ANsb37r3Xv8Ah2P46/8APF91f+g7sb/7Y3v3Xuvf8Ox/HX/ni+6v/Qd2N/8AbG9+6917/h2P46/88X3V/wCg7sb/AO2N7917r3/Dsfx1/wCeL7q/9B3Y3/2xvfuvdWfe/de697917r3v3Xuv/9Tf49+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3X//1d/j37r3XvfuvdMu4ty7c2hh6zcW7M/hNr7fx32/8Qzu4srQ4TD0P3dVBQ0v3mTyU9NRU33NbUxwx63XXLIqC7MAfde6C/8A2ZP46/8AP/elf/Rp7G/+vvv3Xuvf7Mn8df8An/vSv/o09jf/AF99+6917/Zk/jr/AM/96V/9Gnsb/wCvvv3Xuvf7Mn8df+f+9K/+jT2N/wDX337r3Xv9mT+Ov/P/AHpX/wBGnsb/AOvvv3Xuvf7Mn8df+f8AvSv/AKNPY3/199+6917/AGZP46/8/wDelf8A0aexv/r77917r3+zJ/HX/n/vSv8A6NPY3/199+6917/Zk/jr/wA/96V/9Gnsb/6++/de69/syfx1/wCf+9K/+jT2N/8AX337r3Xv9mT+Ov8Az/3pX/0aexv/AK++/de69/syfx1/5/70r/6NPY3/ANfffuvde/2ZP46/8/8Aelf/AEaexv8A6++/de69/syfx1/5/wC9K/8Ao09jf/X337r3Xv8AZk/jr/z/AN6V/wDRp7G/+vvv3Xuvf7Mn8df+f+9K/wDo09jf/X337r3Xv9mT+Ov/AD/3pX/0aexv/r77917r3+zJ/HX/AJ/70r/6NPY3/wBfffuvde/2ZP46/wDP/elf/Rp7G/8Ar77917r3+zJ/HX/n/vSv/o09jf8A199+6917/Zk/jr/z/wB6V/8ARp7G/wDr77917r3+zJ/HX/n/AL0r/wCjT2N/9fffuvde/wBmT+Ov/P8A3pX/ANGnsb/6++/de69/syfx1/5/70r/AOjT2N/9fffuvde/2ZP46/8AP/elf/Rp7G/+vvv3Xuvf7Mn8df8An/vSv/o09jf/AF99+690NXv3Xuve/de697917r//1t/j37r3XvfuvdIrsTrvZ3a+zsxsDf8Ah/4/tLP/AMP/AItif4hlMX93/C8pQ5qg/wAvwtdjsnB4MnjoZf2pk1aNLXQsp917osH/AA3f8O/+fQf+xA7R/wDs29+6917/AIbv+Hf/AD6D/wBiB2j/APZt7917r3/Dd/w7/wCfQf8AsQO0f/s29+6917/hu/4d/wDPoP8A2IHaP/2be/de69/w3f8ADv8A59B/7EDtH/7Nvfuvde/4bv8Ah3/z6D/2IHaP/wBm3v3Xuvf8N3/Dv/n0H/sQO0f/ALNvfuvde/4bv+Hf/PoP/Ygdo/8A2be/de69/wAN3/Dv/n0H/sQO0f8A7Nvfuvde/wCG7/h3/wA+g/8AYgdo/wD2be/de69/w3f8O/8An0H/ALEDtH/7Nvfuvde/4bv+Hf8Az6D/ANiB2j/9m3v3Xuvf8N3/AA7/AOfQf+xA7R/+zb37r3Xv+G7/AId/8+g/9iB2j/8AZt7917r3/Dd/w7/59B/7EDtH/wCzb37r3Xv+G7/h3/z6D/2IHaP/ANm3v3Xuvf8ADd/w7/59B/7EDtH/AOzb37r3Xv8Ahu/4d/8APoP/AGIHaP8A9m3v3Xuvf8N3/Dv/AJ9B/wCxA7R/+zb37r3Xv+G7/h3/AM+g/wDYgdo//Zt7917r3/Dd/wAO/wDn0H/sQO0f/s29+6917/hu/wCHf/PoP/Ygdo//AGbe/de69/w3f8O/+fQf+xA7R/8As29+6917/hu/4d/8+g/9iB2j/wDZt7917r3/AA3f8O/+fQf+xA7R/wDs29+6917/AIbv+Hf/AD6D/wBiB2j/APZt7917o6nv3Xuve/de697917r/19/j37r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvdf//Q3+Pfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691//9Hf49+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3X//0t/j37r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvde9+691737r3Xvfuvdf//Z"},{xtype:"textareafield",action:"insImage",name:"image",hidden:!0}],bbar:["-",{text:"OCR",itemId:"PatientInsuranceFormScannerOcrBtn"},"-","->","-",{text:_("scan_image"),itemId:"PatientInsuranceFormScannerBtn"},"-"]},{xtype:"textareafield",fieldLabel:_("notes"),grow:!1,height:160,name:"notes"}]}]},{xtype:"fieldset",title:_("subscriber"),cls:"highlight_fieldset",layout:{type:"vbox"},width:1100,margin:"0 5 0 5",items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"bottom"},defaults:{margin:"0 5 0 2"},items:[{xtype:"gaiaehr.combo",name:"subscriber_relationship",itemId:"PatientInsuranceFormSubscribeRelationshipCmb",fieldLabel:_("relationship"),emptyText:_("relationship"),queryMode:"local",listKey:"relationship_ins",loadStore:!0,editable:!1,width:100,allowBlank:!1},{xtype:"gaiaehr.combo",name:"subscriber_title",fieldLabel:_("name"),emptyText:_("title"),queryMode:"local",listKey:"titles",width:50,loadStore:!0,editable:!1},{xtype:"textfield",name:"subscriber_given_name",emptyText:_("first_name"),width:120,allowBlank:!1},{xtype:"textfield",name:"subscriber_middle_name",emptyText:_("middle_name"),width:30},{xtype:"textfield",name:"subscriber_surname",emptyText:_("last_name"),flex:2,allowBlank:!1},{xtype:"textfield",name:"subscriber_ss",fieldLabel:_("ssn"),emptyText:_("ssn"),labelWidth:90,width:100},{xtype:"textfield",name:"subscriber_policy_number",emptyText:_("policy_number"),fieldLabel:_("id"),flex:1},{xtype:"textfield",name:"subscriber_phone",emptyText:"000-000-0000",fieldLabel:_("phone"),plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],labelWidth:40,width:100},{xtype:"textfield",name:"subscriber_employer",emptyText:_("employer"),fieldLabel:_("employer"),labelWidth:60,flex:1}]},{xtype:"fieldcontainer",layout:{type:"hbox",align:"bottom"},defaults:{margin:"5 5 0 2"},items:[{xtype:"textfield",emptyText:_("street"),fieldLabel:_("street"),labelWidth:40,width:500,itemId:"InsuranceSubscriberStreetField",name:"subscriber_street"},{xtype:"textfield",name:"subscriber_city",emptyText:_("city"),fieldLabel:_("city"),itemId:"InsuranceSubscriberCityField",width:120},{xtype:"gaiaehr.combo",name:"subscriber_state",emptyText:_("state"),queryMode:"local",itemId:"InsuranceSubscriberStatetField",listKey:"state",width:120,loadStore:!0,editable:!1},{xtype:"textfield",name:"subscriber_postal_code",emptyText:_("postal_code"),itemId:"InsuranceSubscriberPostalField",width:90},{xtype:"gaiaehr.combo",name:"subscriber_country",emptyText:_("country"),itemId:"InsuranceSubscriberCountryField",queryMode:"local",listKey:"country",width:100,loadStore:!0,editable:!1},{xtype:"button",text:_("copy_from_patient"),itemId:"InsuranceAddressSameAsPatientBtn"}]}]}]}]}],a.callParent()
}}),Ext.define("App.view.patient.Patient",{extend:"Ext.panel.Panel",requires:["App.ux.AddTabButton","App.ux.form.fields.InputTextMask","App.view.patient.InsuranceForm"],layout:"fit",xtype:"patientdeomgraphics",itemId:"PatientDemographicsPanel",newPatient:!0,pid:null,defaultPatientImage:"resources/images/patientPhotoPlaceholder.jpg",defaultQRCodeImage:"resources/images/QRCodeImage.png",initComponent:function(){var me=this,configs,bodyWidth=Ext.getBody().getWidth();me.store=Ext.create("App.store.patient.Patient"),me.patientAlertsStore=Ext.create("App.store.patient.MeaningfulUseAlert"),me.compactDemographics=eval(g("compact_demographics")),me.containersWidth=1300>bodyWidth?720:1e3,configs={items:[me.demoForm=Ext.widget("form",{action:"demoFormPanel",itemId:"PatientDemographicForm",border:!1,padding:me.compactDemographics?0:10,fieldDefaults:{labelAlign:"right",msgTarget:"side"},layout:"fit",items:[{xtype:"tabpanel",itemId:"Demographics",border:!1,defaults:{autoScroll:!0},items:[{xtype:"panel",title:_("patient_info"),layout:{type:"column"},action:"DemographicWhoFieldSet",border:!1,bodyBorder:!1,bodyPadding:10,items:[{xtype:"panel",action:"patientImage",layout:"vbox",style:"float:right;",bodyPadding:10,width:180,itemId:"PatientSummaryImagesPanel",items:[{xtype:"image",itemId:"PatientSummaryPatientImage",imageAlign:"center",width:150,height:120,margin:"0 5 10 5",src:me.defaultPatientImage},{xtype:"textareafield",name:"image",hidden:!0},{xtype:"image",itemId:"PatientSummaryQrcodeImage",imageAlign:"center",width:150,height:150,margin:"0 5 10 5",src:me.defaultQRCodeImage}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{text:_("take_picture"),action:"onWebCam",flex:1},"-",{text:_("print_qrcode"),flex:1,itemId:"PatientSummaryQrcodeImagePrintBtn"}]}]},{xtype:"fieldcontainer",layout:"vbox",items:[{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"pubpid",fieldLabel:_("medical"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"pubaccount",fieldLabel:_("account"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"interface_number",fieldLabel:_("interface_number"),flex:1,enableKeyEvents:!0}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 5 0 0",labelWidth:50,labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"title",fieldLabel:_("title"),width:75,listKey:"titles",loadStore:!0,editable:!1},{xtype:"textfield",name:"fname",fieldLabel:_("first_name"),flex:1,allowBlank:!1,maxLength:20},{xtype:"textfield",name:"mname",fieldLabel:_("init"),width:50,enableKeyEvents:!0,maxLength:20},{xtype:"textfield",name:"lname",fieldLabel:_("last_name"),flex:2,allowBlank:!1,maxLength:40},{xtype:"textfield",name:"suffix",fieldLabel:_("suffix"),width:50,maxLength:35},{xtype:"gaiaehr.combo",name:"marital_status",fieldLabel:_("marital_status"),flex:1,listKey:"marital_stat",loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:"hbox",labelWidth:50,defaults:{margin:"0 5 0 0",labelWidth:50,labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"sex",fieldLabel:_("sex_at_birth"),flex:1,enableKeyEvents:!0,allowBlank:!1,listKey:"sex",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",name:"identity",fieldLabel:_("identity"),flex:2,listKey:"identity",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",name:"orientation",fieldLabel:_("orientation"),flex:2,listKey:"orientation",loadStore:!0,editable:!1}]}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"mitos.datetime",name:"DOB",format:"m/d/Y",width:230,fieldLabel:_("dob"),enableKeyEvents:!0,allowBlank:!1},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:_("multiple_birth"),items:[{xtype:"combobox",name:"birth_multiple",editable:!1,width:50,store:[[null,"-"],[!0,"Yes"],[!1,"No"]]},{xtype:"box",margin:"5 5 5 5",html:" birth order"},{xtype:"numberfield",name:"birth_order",width:50,value:1,maxValue:15,minValue:1}]},{xtype:"textfield",name:"birth_place",fieldLabel:_("birth_place"),flex:1}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,height:125,layout:{type:"hbox",align:"stretch"},defaults:{labelAlign:"top",flex:1},items:[{xtype:"fieldcontainer",fieldLabel:_("postal_address"),margin:"0 5 0 0",layout:"anchor",items:[{xtype:"textfield",anchor:"100%",emptyText:_("street"),name:"postal_address"},{xtype:"textfield",anchor:"100%",emptyText:"("+_("optional")+")",name:"postal_address_cont"},{xtype:"fieldcontainer",anchor:"100%",layout:"hbox",defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",emptyText:_("city"),width:119,name:"postal_city"},{xtype:"textfield",emptyText:_("state"),width:30,name:"postal_state"},{xtype:"textfield",emptyText:_("zip"),width:80,name:"postal_zip"},{xtype:"textfield",emptyText:_("country"),flex:1,name:"postal_country",margin:0}]}]},{xtype:"button",itemId:"DemographicAddressCopyBtn",text:">",width:20,flex:null,margin:"18 0 4 0",tooltip:_("copy_postal_to_physical_address")},{xtype:"fieldcontainer",fieldLabel:_("physical_address"),margin:"0 0 0 5",layout:"anchor",items:[{xtype:"textfield",emptyText:_("street"),anchor:"100%",name:"physical_address"},{xtype:"textfield",emptyText:"("+_("optional")+")",anchor:"100%",name:"physical_address_cont"},{xtype:"container",layout:"hbox",anchor:"100%",defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",emptyText:_("city"),width:119,name:"physical_city"},{xtype:"textfield",emptyText:_("state"),width:30,name:"physical_state"},{xtype:"textfield",emptyText:_("zip"),width:80,name:"physical_zip"},{xtype:"textfield",emptyText:_("country"),flex:1,name:"physical_country",margin:0}]}]}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"phone_home",emptyText:"000-000-0000",fieldLabel:_("home"),allowBlank:"0"===g("require_patient_home_phone"),plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],flex:1},{xtype:"textfield",name:"phone_mobile",emptyText:"000-000-0000",allowBlank:"0"===g("require_patient_mobile_phone"),fieldLabel:_("mobile"),plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],flex:1},{xtype:"gaiaehr.combo",name:"phone_mobile_supplier",emptyText:_("supplier"),fieldLabel:_("supplier"),flex:1,listKey:"cellular_prov",loadStore:!0,editable:!1},{xtype:"textfield",name:"email",emptyText:"example@email.com",allowBlank:"0"===g("require_patient_email"),fieldLabel:_("email"),flex:2}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",layout:"hbox",width:me.containersWidth,defaults:{margin:"0 5 0 0"},items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"racecombo",name:"race",fieldLabel:_("race"),labelAlign:"top",flex:1},{xtype:"racecombo",name:"secondary_race",fieldLabel:_("secondary_race"),labelAlign:"top",flex:1}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"ethnicitycombo",name:"ethnicity",fieldLabel:_("ethnicity"),labelAlign:"top"},{xtype:"ethnicitycombo",name:"secondary_ethnicity",fieldLabel:_("secondary_ethnicity"),labelAlign:"top"}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"gaiaehr.combo",name:"language",fieldLabel:_("language"),labelAlign:"top",listKey:"lang",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",name:"religion",fieldLabel:_("religion"),labelAlign:"top",flex:1,listKey:"religion",loadStore:!0,editable:!1}]}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"activefacilitiescombo",name:"primary_facility",flex:1,fieldLabel:_("facility"),queryMode:"local",forceSelection:!0},{xtype:"datefield",name:"first_visit_date",format:"m/d/Y",width:130,fieldLabel:_("first_visit")}]}]}]},{xtype:"panel",title:_("contacts"),itemId:"DemographicsContactFieldSet",border:!1,bodyBorder:!1,bodyPadding:10,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 250 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth,defaults:{labelWidth:50,margin:"5 0 5 5",labelAlign:"top"},items:[{xtype:"textfield",name:"father_fname",fieldLabel:_("first_name")+" ("+_("father")+")",flex:1,maxLength:20},{xtype:"textfield",name:"father_mname",fieldLabel:_("init"),width:50,maxLength:20},{xtype:"textfield",name:"father_lname",fieldLabel:_("last_name"),flex:2,maxLength:40}]},{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth,defaults:{labelWidth:50,margin:"5 0 5 5",labelAlign:"top"},items:[{xtype:"textfield",name:"mother_fname",fieldLabel:_("first_name")+" ("+_("mother")+")",flex:1,maxLength:20},{xtype:"textfield",name:"mother_mname",fieldLabel:_("init"),width:50,maxLength:20},{xtype:"textfield",name:"mother_lname",fieldLabel:_("last_name"),flex:2,maxLength:40}]},{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth,defaults:{labelWidth:50,margin:"5 0 5 5",labelAlign:"top"},items:[{xtype:"textfield",name:"spouse_fname",fieldLabel:_("first_name")+" ("+_("spouse")+")",flex:1,maxLength:20},{xtype:"textfield",name:"spouse_mname",fieldLabel:_("init"),width:50,maxLength:20},{xtype:"textfield",name:"spouse_lname",fieldLabel:_("last_name"),flex:2,maxLength:40}]}]},{xtype:"fieldset",title:_("employer"),cls:"highlight_fieldset",margin:"5 250 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"employer_name",fieldLabel:_("employer_name"),flex:2},{xtype:"textfield",name:"occupation",fieldLabel:_("occupation"),flex:1},{xtype:"textfield",name:"phone_work",fieldLabel:_("phone"),emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:100},{xtype:"textfield",name:"phone_work_ext",width:105,labelWidth:30,fieldLabel:_("ext")+"."},{xtype:"textfield",name:"phone_fax",fieldLabel:_("fax"),emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:160,labelWidth:30}]},{xtype:"fieldset",title:_("persons_authorized"),cls:"highlight_fieldset",margin:"5 250 5 0",padding:"15 10 10 10",layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth,defaults:{labelWidth:50,margin:"5 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"authorized_01_relation",fieldLabel:_("relationship"),width:125,listKey:"rela_hl70063",loadStore:!0,editable:!1},{xtype:"textfield",name:"authorized_01_fname",fieldLabel:_("first_name"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_01_mname",fieldLabel:_("init"),width:50,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_01_lname",fieldLabel:_("last_name"),flex:2,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_01_phone",fieldLabel:_("phone"),emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:115},{xtype:"gaiaehr.combo",name:"authorized_01_phone_type",fieldLabel:_("phone_type"),width:120,listKey:"phone_type",loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{labelWidth:50,margin:"5 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"authorized_02_relation",fieldLabel:_("relationship"),width:125,listKey:"rela_hl70063",loadStore:!0,editable:!1},{xtype:"textfield",name:"authorized_02_fname",fieldLabel:_("first_name"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_02_mname",fieldLabel:_("init"),width:50,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_02_lname",fieldLabel:_("last_name"),flex:2,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_02_phone",fieldLabel:_("phone"),emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:115},{xtype:"gaiaehr.combo",name:"authorized_02_phone_type",fieldLabel:_("phone_type"),width:120,listKey:"phone_type",loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{labelWidth:50,margin:"5 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"authorized_03_relation",fieldLabel:_("relationship"),width:125,listKey:"rela_hl70063",loadStore:!0,editable:!1},{xtype:"textfield",name:"authorized_03_fname",fieldLabel:_("first_name"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_03_mname",fieldLabel:_("init"),width:50,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_03_lname",fieldLabel:_("last_name"),flex:2,enableKeyEvents:!0},{xtype:"textfield",name:"authorized_03_phone",fieldLabel:_("phone"),emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:115},{xtype:"gaiaehr.combo",name:"authorized_03_phone_type",fieldLabel:_("phone_type"),width:120,listKey:"phone_type",loadStore:!0,editable:!1}]}]},{xtype:"fieldset",title:_("emer_contact"),cls:"highlight_fieldset",margin:"5 250 5 0",padding:"15 10 10 10",layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth-10,defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"emergency_contact_relation",emptyText:_("relationship"),width:125,listKey:"rela_hl70063",loadStore:!0,editable:!1},{xtype:"textfield",name:"emergency_contact_fname",emptyText:_("first_name"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"emergency_contact_mname",emptyText:_("middle_name"),width:50,enableKeyEvents:!0},{xtype:"textfield",name:"emergency_contact_lname",emptyText:_("last_name"),flex:2,enableKeyEvents:!0},{xtype:"textfield",name:"emergency_contact_phone",emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:115},{xtype:"gaiaehr.combo",name:"emergency_contact_phone_type",emptyText:_("phone_type"),width:120,listKey:"phone_type",loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth-10,defaults:{margin:"5 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"emergency_contact_address",emptyText:_("street"),flex:2},{xtype:"textfield",name:"emergency_contact_address_cont",emptyText:"("+_("optional")+")",flex:2},{xtype:"textfield",name:"emergency_contact_city",emptyText:_("city"),flex:1},{xtype:"textfield",name:"emergency_contact_state",emptyText:_("state"),width:30},{xtype:"textfield",name:"emergency_contact_zip",emptyText:_("zip"),width:80},{xtype:"textfield",name:"emergency_contact_country",emptyText:_("country"),width:120}]}]},{xtype:"fieldset",title:_("guardians_contact"),cls:"highlight_fieldset",margin:"5 250 5 0",padding:"15 10 10 10",layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth-10,defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"guardians_relation",emptyText:_("relationship"),width:125,listKey:"rela_hl70063",loadStore:!0,editable:!1},{xtype:"textfield",name:"guardians_fname",emptyText:_("first_name"),flex:1,enableKeyEvents:!0},{xtype:"textfield",name:"guardians_mname",emptyText:_("middle_name"),width:50,enableKeyEvents:!0},{xtype:"textfield",name:"guardians_lname",emptyText:_("last_name"),flex:2,enableKeyEvents:!0},{xtype:"textfield",name:"guardians_phone",emptyText:"000-000-0000",plugins:[Ext.create("App.ux.form.fields.InputTextMask","999-999-9999")],width:115},{xtype:"gaiaehr.combo",name:"guardians_phone_type",emptyText:_("phone_type"),width:120,listKey:"phone_type",loadStore:!0,editable:!1}]},{xtype:"fieldcontainer",layout:"hbox",width:me.containersWidth-10,defaults:{margin:"5 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"guardians_address",emptyText:_("street"),flex:2},{xtype:"textfield",name:"guardians_address_cont",emptyText:"("+_("optional")+")",flex:2},{xtype:"textfield",name:"guardians_city",emptyText:_("city"),flex:1},{xtype:"textfield",name:"guardians_state",emptyText:_("state"),width:30},{xtype:"textfield",name:"guardians_zip",emptyText:_("zip"),width:80},{xtype:"textfield",name:"guardians_country",emptyText:_("country"),width:120}]}]}]},{xtype:"panel",title:_("communication"),action:"DemographicWhoFieldSet",margin:"5 250 5 0",border:!1,bodyBorder:!1,bodyPadding:10,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldset",cls:"highlight_fieldset",layout:"hbox",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",name:"phone_publicity",fieldLabel:_("publicity"),emptyText:_("publicity"),width:450,listKey:"publicity_code",loadStore:!0,editable:!1,margin:"10 5 5 0"},{xtype:"datefield",fieldLabel:_("effective_date"),name:"phone_publicity_date",margin:"10 0 5 0"}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"mitos.pharmaciescombo",name:"pharmacy",fieldLabel:_("pharmacy"),emptyText:_("pharmacy"),width:450,margin:"10 0 5 0",forceSelection:!0}]},{xtype:"fieldset",title:_("allow"),fieldLabel:"allow",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"checkbox",name:"allow_sms",flex:1,boxLabel:_("text_mobile_msg"),margin:"5 0 0 15",labelWidth:100},{xtype:"checkbox",name:"allow_voice_msg",boxLabel:_("voice_msg"),flex:1,labelWidth:95},{xtype:"checkbox",name:"allow_email",boxLabel:_("email"),flex:1,labelWidth:70},{xtype:"checkbox",name:"allow_mail_msg",boxLabel:_("mail_msg"),flex:1,labelWidth:85}]},{xtype:"fieldset",title:_("allow"),fieldLabel:"allow",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldset",checkboxName:"allow_patient_web_portal",title:_("patient_access_web_portal"),checkboxToggle:!0,width:225,margin:"5 0 5 0",items:[{xtype:"textfield",name:"portal_username",fieldLabel:_("username"),width:200,labelWidth:60},{xtype:"textfield",name:"portal_password",fieldLabel:_("password"),inputType:"password",width:200,labelWidth:60}]},{xtype:"fieldset",title:_("emergency_access_web_portal"),checkboxName:"allow_emergency_contact_web_portal",checkboxToggle:!0,width:225,margin:"5 0 5 10",items:[{xtype:"textfield",name:"emergency_contact_portal_username",fieldLabel:_("username"),width:200,labelWidth:70},{xtype:"textfield",name:"emergency_contact_portal_password",fieldLabel:_("password"),inputType:"password",width:200,labelWidth:70},{xtype:"checkbox",fieldLabel:_("view_record"),name:"allow_emergency_contact_web_portal_cda",labelWidth:70}]},{xtype:"fieldset",title:_("guardian_access_web_portal"),checkboxName:"allow_guardian_web_portal",checkboxToggle:!0,collapsible:!1,width:225,margin:"5 0 5 10",items:[{xtype:"textfield",name:"guardian_portal_username",fieldLabel:_("username"),width:200,labelWidth:70},{xtype:"textfield",name:"guardian_portal_password",fieldLabel:_("password"),inputType:"password",width:200,labelWidth:70},{xtype:"checkbox",fieldLabel:_("view_record"),name:"allow_guardian_web_portal_cda",labelWidth:70}]}]},{xtype:"fieldset",title:_("allow"),cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"checkbox",name:"allow_immunization_info_sharing",boxLabel:_("immunization_info_sharing"),width:225,margin:"0 5 0 15"},{xtype:"checkbox",name:"allow_immunization_registry",boxLabel:_("immunization_registry_use"),width:225,margin:"0 5 0 5"},{xtype:"checkbox",name:"allow_health_info_exchange",boxLabel:_("health_information_exchange"),width:225,margin:"0 5 0 5"}]}]},{xtype:"panel",title:_("aditional_info")+".",action:"DemographicWhoFieldSet",margin:"5 250 5 0",border:!1,bodyBorder:!1,bodyPadding:10,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",name:"birth_fname",fieldLabel:_("birth_first_name"),flex:1,maxLength:35},{xtype:"textfield",name:"birth_mname",fieldLabel:_("birth_init"),width:75,enableKeyEvents:!0,maxLength:35},{xtype:"textfield",name:"birth_lname",fieldLabel:_("birth_last_name"),flex:2,maxLength:35},{xtype:"textfield",name:"alias",fieldLabel:_("alias_name"),flex:1,labelWidth:100,hideLabel:!1},{xtype:"gaiaehr.combo",name:"citizenship",fieldLabel:_("citizenship"),hideLabel:!1,flex:1,labelWidth:60,listKey:"citiz",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",fieldLabel:_("veteran"),boxLabel:"Yes",name:"is_veteran",flex:1,loadStore:!0,editable:!1}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"textfield",fieldLabel:_("social_security"),emptyText:_("social_security"),name:"SS",flex:1},{xtype:"textfield",emptyText:_("license_no"),fieldLabel:_("drivers_info"),enableKeyEvents:!0,flex:1,name:"drivers_license"},{xtype:"gaiaehr.combo",name:"drivers_license_state",emptyText:_("license"),fieldLabel:_("state"),flex:1,listKey:"state",loadStore:!0,editable:!1},{xtype:"datefield",name:"drivers_license_exp",fieldLabel:_("expiration"),emptyText:_("license"),flex:1,format:"Y-m-d"}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"combobox",name:"deceased",fieldLabel:_("deceased"),editable:!1,width:100,store:[[""," -"],["1","Yes"],["0","No"]]},{xtype:"mitos.datetime",name:"death_date",fieldLabel:_("death_date"),hideLabel:!1,width:200},{xtype:"textfield",name:"death_cause",fieldLabel:_("cause"),flex:1}]},{xtype:"fieldset",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"15 10 10 10",width:me.containersWidth,layout:"hbox",defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"gaiaehr.combo",fieldLabel:_("hipaa_notice"),name:"hipaa_notice",flex:1,listKey:"boolean",loadStore:!0,editable:!1},{xtype:"gaiaehr.combo",name:"organ_donor_code",fieldLabel:_("organ_donor"),listKey:"organ_donor",flex:1,loadStore:!0,editable:!1}]},{xtype:"fieldset",title:"PBM (Pharmacy Benefit Management)",cls:"highlight_fieldset",margin:"5 0 5 0",padding:"5 10 10 10",width:me.containersWidth,layout:"hbox",items:[{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"fieldcontainer",layout:{type:"hbox",align:"stretch"},fieldLabel:_("card_name"),items:[{xtype:"textfield",emptyText:_("last_name"),name:"pbm_card_lname",flex:1,margin:"0 5 0 0"},{xtype:"textfield",fieldLabel:",",labelSeparator:"",labelWidth:3,emptyText:_("first_name"),name:"pbm_card_fname",flex:1}]},{xtype:"textfield",fieldLabel:_("member_id"),name:"pbm_member_id"}]},{xtype:"container",flex:1,defaults:{margin:"0 5 0 0",labelAlign:"top",fex:1},layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:_("group"),name:"pbm_group"},{xtype:"textfield",fieldLabel:_("bin"),name:"pbm_bin"},{xtype:"textfield",fieldLabel:_("pcn"),name:"pbm_pcn"}]},{xtype:"container",flex:1,defaults:{margin:"0 5 0 0",labelAlign:"top"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:_("payer_id"),name:"pbm_payer_id"},{xtype:"textfield",fieldLabel:_("payer_name"),name:"pbm_payer_name"}]},{xtype:"textfield",fieldLabel:_("consent"),name:"pbm_consent",margin:"0 5 0 0",labelAlign:"top"}]},{xtype:"fieldset",title:_("immunization_registry_information"),cls:"highlight_fieldset",margin:"5 0 5 0",padding:"5 10 10 10",width:me.containersWidth,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 5 0 0",labelAlign:"top"},items:[{xtype:"container",flex:1,defaults:{margin:"0 5 0 0",labelAlign:"top"},layout:{type:"hbox",align:"stretch"},items:[{xtype:"gaiaehr.combo",fieldLabel:_("status"),name:"immunization_registry_status",listKey:"immu_registry_status",width:320},{xtype:"datefield",fieldLabel:_("effective_date"),name:"immunization_registry_status_date",margin:"0 10 0 0"}]},{xtype:"container",flex:1,defaults:{margin:"0 5 0 0",labelAlign:"top"},layout:{type:"hbox",align:"bottom"},items:[{xtype:"combobox",fieldLabel:_("protection_indicator"),boxLabel:_("enabled"),name:"protection_indicator",width:320,editable:!1,store:[[!0,"Yes"],[!1,"No"]]},{xtype:"datefield",fieldLabel:_("effective_date"),name:"protection_indicator_date",margin:"0 10 0 0"}]}]}]}]}]})]},configs.dockedItems=[{xtype:"toolbar",dock:"bottom",itemId:"PatientDemographicsBottomBar",items:[{xtype:"button",action:"readOnly",text:_("possible_duplicates"),minWidth:75,itemId:"PatientPossibleDuplicatesBtn"},"-",{xtype:"button",action:"readOnly",text:_("merge_record"),minWidth:75,acl:a("allow_merge_patients"),itemId:"PatientMergeBtn"},"-",{xtype:"button",action:"readOnly",text:_("ccda_import"),minWidth:75,itemId:"PatientCdaImportBtn"},"-","->","-",{xtype:"button",action:"readOnly",text:_("save"),itemId:"PatientDemographicSaveBtn",minWidth:75,disableOnCLick:!0,scope:me,handler:me.formSave},"-",{xtype:"button",text:_("cancel"),action:"readOnly",itemId:"PatientDemographicCancelBtn",minWidth:75,scope:me,handler:me.formCancel}]}],configs.listeners={scope:me,beforerender:me.beforePanelRender},Ext.apply(me,configs),me.callParent(arguments)},beforePanelRender:function(){var a=this,b=a.demoForm.getForm(),c=b.findField("fname"),d=b.findField("mname"),e=b.findField("lname"),f=(b.findField("sex"),b.findField("DOB"));c&&(c.vtype="nonspecialcharacters"),d&&(d.vtype="nonspecialcharacters"),e&&(e.vtype="nonspecialcharacters"),f&&f.setMaxValue(new Date)},verifyPatientRequiredInfo:function(){var a,b=this;b.patientAlertsStore.load({scope:b,params:{pid:b.pid},callback:function(c){for(var d=0;d<c.length;d++)a=b.demoForm.getForm().findField(c[d].data.name),c[d].data.val?a&&a.removeCls("x-field-yellow"):a&&a.addCls("x-field-yellow")}})},readOnlyFields:function(){},formSave:function(){var a=this,b=a.demoForm.getForm(),c=b.getRecord(),d=b.getValues();return b.isValid()?void(c.isSaving!==!0&&(c.set(d),app.fireEvent("beforedemographicssave",c,a),c.isSaving=!0,c.save({scope:a,callback:function(c){app.setPatient(c.data.pid,null,null,function(){a.verifyPatientRequiredInfo(),a.readOnlyFields(b.getFields())}),app.fireEvent("afterdemographicssave",c,a),a.msg(_("sweet"),_("record_saved")),c.isSaving=!1}}))):void a.msg(_("oops"),_("missing_required_data"),!0)},formCancel:function(){var a=this,b=a.demoForm.getForm(),c=b.getRecord();b.loadRecord(c)},loadNew:function(){var a=Ext.create("App.model.patient.Patient",{create_uid:app.user.id,update_uid:app.user.id,create_date:new Date,update_date:new Date,DOB:"0000-00-00 00:00:00"});this.demoForm.getForm().loadRecord(a)},loadPatient:function(a){var b=this,c=b.demoForm.getForm();b.pid=a,c.reset(),c.loadRecord(app.patient.record),app.fireEvent("demographicsrecordload",app.patient.record,b),b.setReadOnly(app.patient.readOnly),b.setButtonsDisabled(b.query('button[action="readOnly"]')),b.verifyPatientRequiredInfo()}}),Ext.define("App.view.patient.InsurancesPanel",{extend:"Ext.tab.Panel",xtype:"insurancestabpanel",requires:["App.view.patient.InsuranceForm"],title:_("insurance"),defaults:{autoScroll:!0,padding:10},plugins:[{ptype:"AddTabButton",iconCls:"icoAdd",toolTip:_("new_insurance"),btnText:_("add_insurance"),forceText:!0,panelConfig:{xtype:"patientinsuranceform"}}],bbar:["->","-",{xtype:"button",text:_("save"),minWidth:75,disableOnCLick:!0,itemId:"PatientInsurancesPanelSaveBtn"},"-",{xtype:"button",text:_("cancel"),action:"readOnly",minWidth:75,itemId:"PatientInsurancesPanelCancelBtn"}]}),Ext.define("App.view.patient.Summary",{extend:"App.ux.RenderPanel",pageTitle:_("patient_summary"),pageLayout:"border",requires:["Ext.XTemplate","Ext.ux.IFrame","App.view.patient.Documents","App.view.patient.CCD","App.ux.ManagedIframe","App.view.patient.Patient","App.view.patient.Reminders","App.view.patient.Alerts","App.view.patient.Amendments","App.view.patient.InsurancesPanel","App.view.patient.CareTeamGrid","App.view.patient.DisclosuresGrid","App.view.patient.EncountersGrid","App.view.patient.LegalLetters","App.view.patient.PatientNotesGrid"],itemId:"PatientSummaryPanel",showRating:!0,pid:null,demographicsData:null,initComponent:function(){var b=this;b.stores=[],b.auditLogCtrl=app.getController("administration.TransactionLog"),b.patientNotesCtrl=app.getController("patient.PatientNotes"),app.on("patientset",function(a){b.hidden||b.updateTitle(a.name+" - "+a.sexSymbol+" - "+a.age.str+" - ("+_("patient_summary")+")",app.patient.readOnly,null)},b),b.pageBody=[b.tabPanel=Ext.widget("tabpanel",{flex:1,margin:"3 0 0 0",bodyPadding:0,frame:!1,border:!1,plain:!0,region:"center",layout:"fit",itemId:"PatientSummaryTabPanel"})],b.sidePanelItems=[],Ext.Array.push(b.sidePanelItems,{xtype:"patientcareteamgrid",itemId:"PatientSummaryCareTeamGrid"}),a("access_patient_visits")&&(b.stores.push(b.patientEncountersStore=Ext.create("App.store.patient.Encounters",{autoLoad:!1,remoteSort:!0,pageSize:999,sorters:[{property:"service_date",direction:"DESC"}]})),Ext.Array.push(b.sidePanelItems,{xtype:"grid",title:_("encounters"),itemId:"PatientSummaryEncountersPanel",hideHeaders:!0,scrollable:!0,maxHeight:200,store:b.patientEncountersStore,tools:[{xtype:"button",text:_("new_progress"),itemId:"PatientSummeryNewProgressNoteBtn",acl:a("add_encounters")}],columns:[{xtype:"datecolumn",width:90,dataIndex:"service_date",format:g("date_display_format"),renderer:function(a,b,c){var d=c.get("service_date");return d?(d.toLocaleDateString()===(new Date).toLocaleDateString()&&(b.style="font-weight:bold;background-color:yellow;"),Ext.Date.format(a,g("date_display_format"))):a}},{dataIndex:"brief_description",flex:1,renderer:function(a,b,c){var d=c.get("service_date"),e=a;return c.isPrivate()&&(e='<i class="fas fa-shield-check" style="color: red"></i> '+e),c.isClose()&&(e='<i class="fas fa-shield-check" style="color: #1b9bfc"></i> '+e),d?(d.toLocaleDateString()===(new Date).toLocaleDateString()&&(b.style="font-weight:bold;background-color:yellow;"),e):e}}]})),a("access_patient_medications")&&(b.stores.push(b.patientMedicationsStore=Ext.create("App.store.patient.Medications",{autoLoad:!1})),Ext.Array.push(b.sidePanelItems,{xtype:"grid",title:_("active_medications"),itemId:"PatientSummaryMedicationsPanel",hideHeaders:!0,scrollable:!0,maxHeight:200,store:b.patientMedicationsStore,tools:[{xtype:"button",text:_("details"),action:"medications",scope:b,handler:b.medicalWin}],columns:[{header:_("name"),dataIndex:"STR",flex:1},{text:_("alert"),width:55,dataIndex:"alert",renderer:b.boolRenderer}]})),a("access_patient_immunizations")&&(b.stores.push(b.immuCheckListStore=Ext.create("App.store.patient.ImmunizationCheck",{autoLoad:!1})),Ext.Array.push(b.sidePanelItems,{xtype:"grid",title:_("immunizations"),itemId:"PatientSummaryImmunizationPanel",hideHeaders:!0,scrollable:!0,maxHeight:200,store:b.immuCheckListStore,region:"center",tools:[{xtype:"button",text:_("quick"),iconCls:"icoAdd",margin:"0 3 0 0",acl:a("add_patient_immunizations"),itemId:"PatientSummaryImmunizationPanelQuickAddBtn"},{xtype:"button",text:_("details"),action:"immunization",scope:b,handler:b.medicalWin}],columns:[{header:_("name"),dataIndex:"vaccine_name",flex:1},{text:_("alert"),width:55,dataIndex:"alert",renderer:b.alertRenderer}]})),a("access_patient_allergies")&&(b.stores.push(b.patientAllergiesListStore=Ext.create("App.store.patient.Allergies",{autoLoad:!1})),Ext.Array.push(b.sidePanelItems,{xtype:"grid",title:_("allergies"),itemId:"PatientSummaryAllergiesPanel",hideHeaders:!0,scrollable:!0,maxHeight:200,store:b.patientAllergiesListStore,region:"center",tools:[{xtype:"button",text:_("details"),action:"allergies",scope:b,handler:b.medicalWin}],columns:[{header:_("name"),dataIndex:"allergy",flex:1},{text:_("alert"),width:55,dataIndex:"alert",renderer:b.boolRenderer}]})),a("access_active_problems")&&(b.stores.push(b.patientActiveProblemsStore=Ext.create("App.store.patient.PatientActiveProblems",{autoLoad:!1})),Ext.Array.push(b.sidePanelItems,{xtype:"grid",title:_("active_problems"),itemId:"PatientSummaryActiveProblemsPanel",hideHeaders:!0,scrollable:!0,maxHeight:200,store:b.patientActiveProblemsStore,tools:[{xtype:"button",text:_("details"),action:"issues",scope:b,handler:b.medicalWin}],columns:[{header:_("name"),dataIndex:"code_text",flex:1},{text:_("alert"),width:55,dataIndex:"alert",renderer:b.boolRenderer}]})),a("access_patient_calendar_events"),b.sidePanelItems.length>0&&(b.sidePanel=Ext.widget("panel",{width:250,bodyPadding:0,frame:!1,border:!1,bodyBorder:!0,region:"east",split:!0,layout:{type:"vbox",align:"stretch"},defaults:{margin:"5 5 0 5"},itemId:"PatientSummarySidePanel",items:b.sidePanelItems}),Ext.Array.push(b.pageBody,b.sidePanel)),a("access_demographics")&&(b.demographics=b.tabPanel.add({xtype:"patientdeomgraphics",newPatient:!1,autoScroll:!0,title:_("demographics")}),b.insTabPanel=b.tabPanel.add({xtype:"insurancestabpanel",itemId:"PatientInsurancesPanel"}),b.tabPanel.add({xtype:"patientlegalletters",itemId:"PatientLegalLettersGrid"})),a("access_patient_disclosures")&&b.tabPanel.add({xtype:"patientdisclosuresgrid",bodyPadding:0}),a("access_patient_notes")&&b.tabPanel.add({xtype:"patientnotesgrid",itemId:"PatientNotesGrid",frame:!0,title:_("notes")}),a("access_patient_reminders")&&b.tabPanel.add({itemId:"PatientSummaryRemindersPanel",xtype:"patientreminderspanel",bodyPadding:0}),a("access_patient_alerts")&&b.tabPanel.add({itemId:"PatientSummaryAlertsPanel",xtype:"patientalertspanel",bodyPadding:0}),b.tabPanel.add({xtype:"patientamendmentspanel",itemId:"PatientAmendmentsPanel",border:!0}),a("access_patient_documents")&&b.tabPanel.add({xtype:"patientdocumentspanel",border:!1}),a("access_patient_preventive_care_alerts"),a("access_patient_vitals")&&b.tabPanel.add({xtype:"vitalspanel",border:!0}),a("access_enc_history")&&b.tabPanel.add({xtype:"encountersgrid",border:!0}),b.callParent()
},onAddNew:function(a){var b,c=a.up("grid"),d=c.store;"disclosure"==a.action?b={date:new Date,pid:app.patient.pid,global_id:app.uuidv4(),active:1}:"note"==a.action&&(b={date:new Date,create_date:new Date,pid:app.patient.pid,create_uid:app.user.id,uid:app.user.id,eid:app.patient.eid,global_id:app.uuidv4(),user_fname:app.user.fname,user_mname:app.user.mname,user_lname:app.user.lname}),c.plugins[0].cancelEdit(),d.insert(0,b),c.plugins[0].startEdit(0,0)},onGridBeforeEdit:function(){return a("edit_patient_notes")?void 0:(app.msg(_("oops"),_("not_authorized"),!0),!1)},onGridValidateEdit:function(a,b){b.record.data.update_user_fname=app.user.fname,b.record.data.update_user_mname=app.user.mname,b.record.data.update_user_lname=app.user.lname,b.record.data.update_date=app.getDate(),b.record.data.update_uid=app.user.id},onPatientSummaryNotesGridContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showPatientSummaryNotesGridContextMenu(a,b,e)},showPatientSummaryNotesGridContextMenu:function(b,c,d){if(a("access_patient_notes_transaction_log")){var e=this;return e.PatientSummaryNotesGridContextMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("transaction_log"),icon:"modules/billing/resources/images/icoList.png",itemId:"showPatientSummaryNotesGridContextMenuDetailLog",acl:!0,listeners:{click:e.onPatientSummaryNotesGridContextMenuDetailLogClick,scope:e}}]}),e.PatientSummaryNotesGridContextMenu.patient_notes_panel_grid=b,e.PatientSummaryNotesGridContextMenu.patient_notes_panel_record=c,e.PatientSummaryNotesGridContextMenu.showAt(d.getXY()),e.PatientSummaryNotesGridContextMenu}},onPatientSummaryNotesGridContextMenuDetailLogClick:function(a){var b=a.parentMenu.patient_notes_panel_record;this.auditLogCtrl.doTransactionLogDetailByTableAndPk(b.table.name,b.get("id"))},medicalWin:function(a){app.onMedicalWin(a.action)},verifyPatientRequiredInfo:function(){var a,b,c=this,d=c.query('[action="demoFormPanel"]')[0];c.patientAlertsStore.load({scope:c,params:{pid:c.pid},callback:function(c){for(b=0;b<c.length;b++)a=d.getForm().findField(c[b].data.name),c[b].data.val?a&&a.removeCls("x-field-yellow"):a&&a.addCls("x-field-yellow")}})},loadStores:function(){var a=this;a.stores.forEach(function(b){b.removeAll(),b.commitChanges(),b.clearFilter(!0),b.load({params:{pid:a.pid,active:!0},filters:[{property:"pid",value:a.pid}]})})},loadPatient:function(){var b,c=this;c.el.mask(_("loading...")),c.pid=app.patient.pid,b=app.patient,c.updateTitle(b.name+" - "+b.sexSymbol+" - "+b.age.str+" - ("+_("patient_summary")+")",app.patient.readOnly,null),c.setReadOnly(app.patient.readOnly),c.setButtonsDisabled(c.query('button[action="readOnly"]')),a("access_demographics")&&c.demographics.loadPatient(c.pid),c.tabPanel.setActiveTab(0),c.loadStores(),app.fireEvent("patientsummaryload",c,b),c.el.unmask()},onActive:function(a){var b=this;b.checkIfCurrPatient()?(b.loadPatient(),"function"==typeof a&&a(!0)):(a(!1),b.pid=null,b.currPatientError())}}),Ext.define("App.ux.grid.exporter.FileSaver",{statics:{saveAs:function(a,b,c,d,e,f,g,h){window.URL=window.URL||window.webkitURL;try{var i=new Blob([a],{type:b+";charset="+c+","});if(e&&"download"in e)return blobURL=window.URL.createObjectURL(i),e.href=blobURL,e.download=d,g&&g.call(h),void this.cleanBlobURL(blobURL);if(window.navigator.msSaveOrOpenBlob)return window.navigator.msSaveOrOpenBlob(i,d),void(g&&g.call(h))}catch(j){Ext.log("Browser doesn't support Blob: "+j.message)}f?this.downloadUsingServer(a,b,c,d,g,h):(this.openUsingDataURI(a,b,c),g&&g.call(h))},downloadUsingServer:function(a,b,c,d,e,f){var g=Ext.getDom("formDummy");g||(g=document.createElement("form"),g.id="formDummy",g.name="formDummy",g.className="x-hidden",document.body.appendChild(g)),Ext.Ajax.request({url:"/ExportFileAction",method:"POST",form:g,isUpload:!0,params:{userAction:"download",data:a,mimeType:b,charset:c,filename:d},callback:function(){e&&e.call(f)}})},openUsingDataURI:function(a,b,c){Ext.isIE9m?(w=window.open(),doc=w.document,doc.open(b,"replace"),doc.charset=c,doc.write(a),doc.close(),doc.execCommand("SaveAs",null,filename)):window.open("data:"+b+";charset="+c+","+encodeURIComponent(a),"_blank")},cleanBlobURL:function(a){setTimeout(function(){window.URL.revokeObjectURL(a)},1e4)}}}),Ext.define("App.ux.grid.exporter.Formatter",{format:Ext.emptyFn,constructor:function(a){a=a||{},Ext.applyIf(a,{})}}),Ext.define("App.ux.grid.exporter.ExporterButton",{extend:"Ext.Button",requires:["App.ux.grid.exporter.Exporter","App.ux.grid.exporter.FileSaver"],alias:"widget.exporterbutton",text:"Download",format:"csv",preventDefault:!1,saveDelay:300,remote:!1,title:"export",constructor:function(a){var b=this;App.ux.grid.exporter.ExporterButton.superclass.constructor.call(b,a),b.on("afterrender",function(){b.component&&(b.component=Ext.isString(b.component)?Ext.ComponentQuery.query(b.component)[0]:b.component),b.setComponent(b.store||b.component||b.up("gridpanel")||b.up("treepanel"),a)})},onClick:function(){var a,b,c=this,d=c.format,e=c.title,f=c.remote,g=new Date,h=c.el.dom;c.fireEvent("start",c),a=App.ux.grid.exporter.Exporter.exportAny(c.component,d,{title:e}),b=e+"_"+Ext.Date.format(g,"Y-m-d h:i:s")+"."+a.ext,App.ux.grid.exporter.FileSaver.saveAs(a.data,a.mimeType,a.charset,b,h,f,c.onComplete,c),c.callParent(arguments)},setComponent:function(a){var b=this;b.component=a,b.store=a.is?a.getStore():a},onComplete:function(){this.fireEvent("complete",this)}}),Ext.define("App.ux.grid.exporter.csvFormatter.CsvFormatter",{extend:"App.ux.grid.exporter.Formatter",mimeType:"text/csv",charset:"UTF-8",separator:",",extension:"csv",format:function(a,b){return this.columns=b.columns||(a.fields?a.fields.items:a.model.prototype.fields.items),this.parserDiv=document.createElement("div"),this.getHeaders()+"\n"+this.getRows(a)},getHeaders:function(){var a=[];return Ext.each(this.columns,function(b){var c;"rownumberer"!=b.getXType()&&(void 0!=b.text?c=b.text:b.name&&(c=b.name.replace(/_/g," "),c=Ext.String.capitalize(c)),a.push(c))},this),a.join(this.separator)},getRows:function(a){var b=[];return a.each(function(a,c){b.push(this.getCell(a,c))},this),b.join("\n")},getCell:function(a){var b=[];return Ext.each(this.columns,function(c){var d=c.name||c.dataIndex||c.stateId;if(d&&"rownumberer"!=c.getXType()){if(Ext.isFunction(c.renderer)){var e=c.renderer(a.get(d),{},a);this.parserDiv.innerHTML=e;var f=[],g=this.parserDiv.getElementsByTagName("div");g&&g.length>0?Ext.each(g,function(a){var b=[],c=a.getElementsByTagName("img");Ext.each(c,function(a){b.push(a.getAttribute("title"))}),b.push(a.innerText||a.textContent),f.push(b.join(":"))}):f.push(this.parserDiv.innerText||this.parserDiv.textContent),e=f.join("\n")}else var e=a.get(d);b.push('"'+e+'"')}},this),b.join(this.separator)}}),Ext.define("App.ux.grid.exporter.excelFormatter.ExcelFormatter",{extend:"App.ux.grid.exporter.Formatter",uses:["App.ux.grid.exporter.excelFormatter.Cell","App.ux.grid.exporter.excelFormatter.Style","App.ux.grid.exporter.excelFormatter.Worksheet","App.ux.grid.exporter.excelFormatter.Workbook"],mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",charset:"UTF-8",extension:"xls",format:function(a,b){var c=new App.ux.grid.exporter.excelFormatter.Workbook(b);return c.addWorksheet(a,b||{}),c.render()}}),Ext.define("App.ux.grid.exporter.excelFormatter.Cell",{constructor:function(a){Ext.applyIf(a,{type:"String"}),Ext.apply(this,a),App.ux.grid.exporter.excelFormatter.Cell.superclass.constructor.apply(this,arguments)},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<ss:Cell ss:StyleID="{style}">','<ss:Data ss:Type="{type}">{value}</ss:Data>',"</ss:Cell>")}),Ext.define("App.ux.grid.exporter.excelFormatter.Style",{constructor:function(a){if(a=a||{},Ext.apply(this,a,{parentStyle:"",attributes:[]}),App.ux.grid.exporter.excelFormatter.Style.superclass.constructor.apply(this,arguments),void 0==this.id)throw new Error("An ID must be provided to Style");this.preparePropertyStrings()},preparePropertyStrings:function(){Ext.each(this.attributes,function(a,b){this.attributes[b].propertiesString=this.buildPropertyString(a),this.attributes[b].children=a.children||[],Ext.each(a.children,function(a,c){this.attributes[b].children[c].propertiesString=this.buildPropertyString(a)},this)},this)},buildPropertyString:function(a){var b="";return Ext.each(a.properties||[],function(a){b+=Ext.String.format('ss:{0}="{1}" ',a.name,a.value)},this),b},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<tpl if="parentStyle.length == 0">','<ss:Style ss:ID="{id}">',"</tpl>",'<tpl if="parentStyle.length != 0">','<ss:Style ss:ID="{id}" ss:Parent="{parentStyle}">',"</tpl>",'<tpl for="attributes">','<tpl if="children.length == 0">',"<ss:{name} {propertiesString} />","</tpl>",'<tpl if="children.length != 0">',"<ss:{name} {propertiesString}>",'<tpl for="children">',"<ss:{name} {propertiesString} />","</tpl>","</ss:{name}>","</tpl>","</tpl>","</ss:Style>")}),Ext.define("App.ux.grid.exporter.excelFormatter.Worksheet",{constructor:function(a,b){b=b||{},this.store=a,Ext.applyIf(b,{hasTitle:!0,hasHeadings:!0,stripeRows:!0,parserDiv:document.createElement("div"),title:"Workbook",columns:void 0==a.fields?{}:a.fields.items}),Ext.apply(this,b),App.ux.grid.exporter.excelFormatter.Worksheet.superclass.constructor.apply(this,arguments)},dateFormatString:"Y-m-d",worksheetTpl:new Ext.XTemplate('<ss:Worksheet ss:Name="{title}">',"<ss:Names>",'<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />',"</ss:Names>",'<ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">',"{columns}",'<ss:Row ss:Height="38">','<ss:Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" />',"</ss:Cell>","</ss:Row>",'<ss:Row ss:AutoFitHeight="1">',"{header}","</ss:Row>","{rows}","</ss:Table>","<x:WorksheetOptions>","<x:PageSetup>",'<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />',"</x:PageSetup>","<x:FitToPage />","<x:Print>","<x:PrintErrors>Blank</x:PrintErrors>","<x:FitWidth>1</x:FitWidth>","<x:FitHeight>32767</x:FitHeight>","<x:ValidPrinterInfo />","<x:VerticalResolution>600</x:VerticalResolution>","</x:Print>","<x:Selected />","<x:DoNotDisplayGridlines />","<x:ProtectObjects>False</x:ProtectObjects>","<x:ProtectScenarios>False</x:ProtectScenarios>","</x:WorksheetOptions>","</ss:Worksheet>"),render:function(){var a=this.isGrouped?this.store.groups.length:0,b=this.hasSummary?this.store.groups.length:0;return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+a+b+10,title:this.title})},buildColumns:function(){var a=[];return Ext.each(this.columns,function(){a.push(this.buildColumn())},this),a},buildColumn:function(a){return Ext.String.format('<ss:Column ss:AutoFitWidth="1" ss:Width="{0}" />',a||164)},buildRows:function(){var a=[];return this.isGrouped?Ext.Object.each(this.store.groups.map,function(b,c){a.push(this.buildGroupRow(b)),c.records.forEach(function(b,c){a.push(this.buildRow(b,c))},this),this.hasGroupingSummary&&c.aggregate&&a.push(this.buildSummaryRow(c.aggregate))},this):this.store.each(function(b,c){a.push(this.buildRow(b,c))},this),this.hasSummary&&(say("hasSummary"),say(this),a.push(this.buildSummaryRow(this.summary.summaryRecord))),a},buildHeader:function(){var a=[];return Ext.each(this.columns,function(b){var c;void 0!=b.text?c=b.text:b.name&&(c=b.name.replace(/_/g," "),c=Ext.String.capitalize(c)),a.push(Ext.String.format('<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">{0}</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>',c))},this),a.join("")},buildGroupRow:function(a){return Ext.String.format('<ss:Row ss:Height="25"><ss:Cell ss:StyleID="groupcell" ss:MergeAcross="{0}"><ss:Data ss:Type="String">{1}</ss:Data><ss:NamedCell ss:Name="Print_Titles"/></ss:Cell></ss:Row>',this.columns.length-1,a)},buildSummaryRow:function(a){var b=[];return Ext.each(this.columns,function(c){var d,e,f=c.name||c.dataIndex,g="summarycell";f&&(Ext.isFunction(c.summaryRenderer)?(d=c.summaryRenderer(a.get(f),{},a),this.parserDiv.innerHTML=d,d=this.parserDiv.innerText||this.parserDiv.textContent||"",e=Ext.isNumeric(d)?"Number":"String"):(d=a.get(f)||"",this.parserDiv.innerHTML=d,d=this.parserDiv.innerText||this.parserDiv.textContent||"",e=this.typeMappings[c.type],void 0===e&&(e=Ext.isNumeric(d)?"Number":"String")),b.push(this.buildCell(d,e,g).render()))},this),Ext.String.format('<ss:Row ss:Height="25">{0}</ss:Row>',b.join(""))},buildRow:function(a,b){var c,d=[];return this.stripeRows===!0&&(c=b%2==0?"even":"odd"),Ext.each(this.columns,function(b){var e,f,g=b.name||b.dataIndex;if(g){if(Ext.isFunction(b.renderer)){e=b.renderer(a.get(g),{},a),f="String";var h=[];this.parserDiv.innerHTML=e;var i=this.parserDiv.getElementsByTagName("div");i&&i.length>0?Ext.each(i,function(a){var b=[],c=a.getElementsByTagName("img");Ext.each(c,function(a){b.push(a.getAttribute("title"))}),b.push(a.innerText||a.textContent),h.push(b.join(":"))}):h.push(this.parserDiv.innerText||this.parserDiv.textContent),e=h.join(" ").trim(),Ext.isNumeric(e)&&(f="Number")}else e=a.get(g),f=this.typeMappings[b.type||a.fields.get(g).type.type];d.push(this.buildCell(e,f,c).render())}},this),Ext.String.format("<ss:Row>{0}</ss:Row>",d.join(""))},buildCell:function(a,b,c){return"DateTime"==b&&Ext.isFunction(a.format)&&(a=a.format(this.dateFormatString)),new App.ux.grid.exporter.excelFormatter.Cell({value:a,type:b,style:c})},typeMappings:{"int":"Number",string:"String","float":"Number",date:"DateTime"}}),Ext.define("App.ux.grid.exporter.excelFormatter.Workbook",{constructor:function(a){a=a||{},Ext.apply(this,a,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:!0,hasStripeStyles:!0,windowHeight:9e3,windowWidth:5e4,protectStructure:!1,protectWindows:!1}),this.hasDefaultStyle&&this.addDefaultStyle(),this.hasStripeStyles&&this.addStripedStyles(),this.addTitleStyle(),this.addHeaderStyle(),this.addGroupStyle(),this.addSummaryStyle()},render:function(){return this.compileStyles(),this.joinedCompiledStyles=this.compiledStyles.join(""),this.compileWorksheets(),this.joinedWorksheets=this.compiledWorksheets.join(""),this.tpl.apply(this)},addWorksheet:function(a,b){var c=new App.ux.grid.exporter.excelFormatter.Worksheet(a,b);return this.worksheets.push(c),c},addStyle:function(a){var b=new App.ux.grid.exporter.excelFormatter.Style(a||{});return this.styles.push(b),b},compileStyles:function(){return this.compiledStyles=[],Ext.each(this.styles,function(a){this.compiledStyles.push(a.render())},this),this.compiledStyles},compileWorksheets:function(){return this.compiledWorksheets=[],Ext.each(this.worksheets,function(a){this.compiledWorksheets.push(a.render())},this),this.compiledWorksheets},tpl:new Ext.XTemplate('<?xml version="1.0" encoding="utf-8"?>','<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">',"<o:DocumentProperties>","<o:Title>{title}</o:Title>","</o:DocumentProperties>","<x:ExcelWorkbook>","<x:WindowHeight>{windowHeight}</x:WindowHeight>","<x:WindowWidth>{windowWidth}</x:WindowWidth>","<x:ProtectStructure>{protectStructure}</x:ProtectStructure>","<x:ProtectWindows>{protectWindows}</x:ProtectWindows>","</x:ExcelWorkbook>","<ss:Styles>","{joinedCompiledStyles}","</ss:Styles>","{joinedWorksheets}","</ss:Workbook>"),addDefaultStyle:function(){var a=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:"Default",attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"11"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(a)}]}]})},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Left"},{name:"Vertical",value:"Center"}]}]})},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"12"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#9c9c9c"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]})},addGroupStyle:function(){this.addStyle({id:"groupcell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"12"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#ffffff"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Left"}]},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Bottom"},{name:"LineStyle",value:"Continuous"},{name:"Color",value:"#acacac"},{name:"Weight",value:"2"}]}]}]})},addSummaryStyle:function(){this.addStyle({id:"summarycell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"11"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#ffffff"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Right"},{name:"Vertical",value:"Top"}]},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"},{name:"LineStyle",value:"Continuous"},{name:"Color",value:"#acacac"},{name:"Weight",value:"1"}]}]}]})},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#ffffff"}]}]}),this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#efefef"}]}]}),Ext.each(["even","odd"],function(a){this.addChildNumberFormatStyle(a,a+"date","[ENG][$-409]dd-mmm-yyyy;@"),this.addChildNumberFormatStyle(a,a+"int","0"),this.addChildNumberFormatStyle(a,a+"float","0.00")},this)},addChildNumberFormatStyle:function(a,b,c){this.addStyle({id:b,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:c}]}]})}}),Ext.define("App.controller.administration.UsersTransaction",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"UserTransactionWindow",selector:"#UserTransactionWindow"},{ref:"UserTransactionWindowFields",selector:"#UserTransactionWindowFields"},{ref:"UserTransactionWindowCreateDateField",selector:"#UserTransactionWindowCreateDateField"},{ref:"UserTransactionWindowCreateUserNameField",selector:"#UserTransactionWindowCreateUserNameField"},{ref:"UserTransactionWindowUpdateDateField",selector:"#UserTransactionWindowUpdateDateField"},{ref:"UserTransactionWindowButtonCloseBtn",selector:"#UserTransactionWindowButtonCloseBtn"}],init:function(){var a=this;a.control({"#UserTransactionWindow":{beforerender:a.onUserTransactionWindowBeforeRender},"#UserTransactionWindowButtonCloseBtn":{click:a.onUserTransactionWindowButtonCloseBtnClick}})},onUserTransactionWindowBeforeRender:function(a){var b=this,c=a.create_date,d=a.user_username,e=a.update_date;b.getUserTransactionWindowCreateDateField().setValue(c),b.getUserTransactionWindowCreateUserNameField().setValue(d),b.getUserTransactionWindowUpdateDateField().setValue(e)},onUserTransactionWindowButtonCloseBtnClick:function(a){var b=a.up("window");b.close()}}),Ext.define("App.model.administration.PrintJob",{extend:"Ext.data.Model",table:{name:"print_jobs"},fields:[{name:"id",type:"int"},{name:"uid",type:"int"},{name:"document_id",type:"int"},{name:"printer_id",type:"string"},{name:"printer_type",type:"string",len:25},{name:"print_status",type:"string",len:30},{name:"priority",type:"int"},{name:"number_of_copies",type:"int",defaultValue:1},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"user_username",type:"string",store:!1},{name:"user_fname",type:"string",store:!1},{name:"user_lname",type:"string",store:!1},{name:"user_mname",type:"string",store:!1},{name:"document_doc_type",type:"string",store:!1},{name:"document_title",type:"string",store:!1},{name:"document_note",type:"string",store:!1}],proxy:{type:"direct",api:{read:"PrintJob.getPrintJobs",create:"PrintJob.addPrintJob",update:"PrintJob.updatePrintJob",destroy:"PrintJob.destroyPrintJob"},reader:{root:"data"},writer:{writeAllFields:!0}}}),Ext.define("App.store.administration.PrintJob",{extend:"Ext.data.Store",requires:["App.model.administration.PrintJob"],model:"App.model.administration.PrintJob"}),Ext.define("App.controller.BrowserHelper",{extend:"Ext.app.Controller",requires:[],refs:[],socket:void 0,host:"local.tranextgen.com",port:9595,connected:!1,waiting:!1,callback:void 0,reconnect_interval:5e3,connect_delay:1e4,debug:!1,initiated:!1,init:function(){var a=this;Ext.Function.defer(a.connect,a.connect_delay,a)},connect:function(){var a=this;a.socket||(a.socket=new WebSocket("wss://"+a.host+":"+a.port+"/"),a.socket.onopen=function(b){a.onOpen(b.data)},a.socket.onclose=function(b){a.onClose(b.data)},a.socket.onmessage=function(b){a.onMessage(b.data)},a.socket.onerror=function(b){a.onError(b.data)})},reconnect:function(){var a=this;a.initiated&&(this.log("reconnect"),a.connected=!1,delete a.socket,Ext.Function.defer(function(){a.connect()},a.reconnect_interval))},send:function(a,b){this.socket.send(a),this.callback=b},onOpen:function(a){this.log("onOpen"),this.log(a),this.initiated=!0,this.connected=!0,Ext.Function.defer(function(){app.fireEvent("browserhelperopen",this)},1e3,this)},onClose:function(a){this.log("onClose"),this.log(a),this.reconnect(),Ext.Function.defer(function(){app.fireEvent("browserhelperclose",this)},1e3,this)},onMessage:function(a){this.log("onMessage"),this.log(a),a=JSON.parse(a),a.action&&"command"===a.action?(this.log("fireEvent: "+a.msg),app.fireEvent(a.msg,this)):a.action&&"burnermsg"===a.action?(this.log("fireEvent: "+a.msg),app.fireEvent("burnermsg",this,a)):a.action&&"printermsg"===a.action?(this.log("fireEvent: "+a.msg),app.fireEvent("printermsg",this,a)):this.callback&&(this.callback(a),this.callback=void 0)},onError:function(a){this.log("onError"),this.log(a),this.reconnect()},log:function(a){this.debug&&say(a)},sendMessage:function(a,b){this.connected?this.send(JSON.stringify(a),b):app.msg(_("oops"),_("not_conneted"),!0)}}),Ext.define("App.controller.patient.Disclosures",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientDisclosuresGrid",selector:"#PatientDisclosuresGrid"},{ref:"DisclosureEditWindow",selector:"#DisclosureEditWindow"},{ref:"DisclosureEditWindowForm",selector:"#DisclosureEditWindowForm"},{ref:"DisclosuresRecipientWindow",selector:"#DisclosuresRecipientWindow"},{ref:"DisclosuresRecipientForm",selector:"#DisclosuresRecipientForm"},{ref:"DisclosuresRecipientField",selector:"#DisclosuresRecipientField"},{ref:"DisclosuresDescriptionField",selector:"#DisclosuresDescriptionField"},{ref:"DisclosuresRecipientCancelBtn",selector:"#DisclosuresRecipientCancelBtn"},{ref:"DisclosuresRecipientSaveBtn",selector:"#DisclosuresRecipientSaveBtn"},{ref:"PatientDisclosuresPrinterCmb",selector:"#PatientDisclosuresPrinterCmb"},{ref:"PatientDisclosuresBurnersCmb",selector:"#PatientDisclosuresBurnersCmb"}],init:function(){var a=this;a.control({"#PatientDisclosuresGrid":{activate:a.onPatientDisclosuresGridActivate,beforeitemcontextmenu:a.onPatientDisclosuresGridBeforeItemContextMenu,itemdblclick:a.onPatientDisclosuresGridDblClick},"#PatientDisclosuresGridAddBtn":{click:a.onPatientDisclosuresGridAddBtnClick},"#DisclosureEditWindowFormCancelBtn":{click:a.onDisclosureEditWindowFormCancelBtnClick},"#DisclosureEditWindowFormSaveBtn":{click:a.onDisclosureEditWindowFormSaveBtnClick},"#DisclosuresRecipientCancelBtn":{click:a.onDisclosuresRecipientCancelBtnClick},"#DisclosuresRecipientSaveBtn":{click:a.onDisclosuresRecipientSaveBtnClick},"#PatientDisclosuresAttacheDocumentsMenu":{click:a.onPatientDisclosuresAttacheDocumentsMenuClick},"#PatientDisclosuresAttacheDocumentsCancelBtn":{click:a.onPatientDisclosuresAttacheDocumentsCancelBtnClick},"#PatientDisclosuresAttacheDocumentsSaveBtn":{click:a.onPatientDisclosuresAttacheDocumentsSaveBtnClick},"#PatientDisclosuresPrintBtn":{click:a.onPatientDisclosuresPrintBtnClick},"#PatientDisclosuresDownloadBtn":{click:a.onPatientDisclosuresDownloadBtnClick},"#PatientDisclosuresBurnBtn":{click:a.onPatientDisclosuresBurnBtnClick},"#PatientDisclosuresBurnersCmb":{beforerender:a.onPatientDisclosuresBurnersCmbBeforeRender}})},onPatientDisclosuresPrintBtnClick:function(){var a=this,b=a.getPatientDisclosuresGrid(),c=b.getSelectionModel().getSelection(),d=a.getPatientDisclosuresPrinterCmb().getValue();return c.length<=0?void app.msg(_("warning"),"No disclosures selected",!0):null===d?void app.msg(_("warning"),"No printer selected",!0):(app.msg("Printing... ","Printing disclosure",!1),void c.forEach(function(a){a.get("document_inventory_count")>0&&Disclosure.printDisclosure(a.getData(),d,function(a){a.success||app.msg("Error",a.errorMsg,!0)})}))},onPatientDisclosuresDownloadBtnClick:function(){var a=this,b=a.getPatientDisclosuresGrid(),c=b.getSelectionModel().getSelection();return c.length<=0?void app.msg(_("warning"),"No disclosures selected",!0):(app.msg("Downloading... ","Downloading disclosure",!1),void c.forEach(function(b,c){Ext.Function.defer(function(){a.disclosureDownload(b)},1e3*c)}))},onPatientDisclosuresBurnBtnClick:function(){var a=this,b=a.getPatientDisclosuresGrid(),c=b.getSelectionModel().getSelection(),d=a.getPatientDisclosuresBurnersCmb().getValue(),e=a.getPatientDisclosuresBurnersCmb().findRecordByValue(d);return c.length<=0?void app.msg(_("warning"),"No disclosures selected",!0):null===d?void app.msg(_("warning"),"No burner selected",!0):(app.msg("Burning... ","Burning disclosure",!1),void c.forEach(function(a){a.get("document_inventory_count")>0&&Disclosure.burnDisclosure(a.getData(),e.getData(),function(a){a.success||app.msg("Error",a.errorMsg,!0)})}))},onPatientDisclosuresAttacheDocumentsCancelBtnClick:function(a){a.up("window").close()},onPatientDisclosuresAttacheDocumentsSaveBtnClick:function(a){var b=a.up("window"),c=b.down("grid"),d=c.getSelectionModel().getSelection(),e=this.getPatientDisclosuresGrid(),f=e.getSelectionModel().getLastSelected(),g=[];d.forEach(function(a){g.push({disclosure_id:f.get("id"),document_id:a.get("id")})}),Disclosure.removeDisclosuresDocumentsById(f.get("id")),Disclosure.addDisclosuresDocument(g,function(){b.close(),e.getStore().reload()}),e.getSelectionModel().deselectAll()},onDisclosureEditWindowFormSaveBtnClick:function(){var a=this,b=a.getPatientDisclosuresGrid(),c=a.getDisclosureEditWindow(),d=b.getSelectionModel().getSelection(),e=a.getDisclosureEditWindowForm().getValues(),f=a.getDisclosureEditWindowForm().getRecord();e.id=null,d.length>0&&(e.id=d[0].get("id")),c.mask("Saving..."),f.set(e),b.store.sync({callback:function(){c.unmask(),c.close()}})},onPatientDisclosuresBurnersCmbBeforeRender:function(a){var b=a.getStore();b.getCount()>0&&a.setValue(b.first())},onDocumentsLoad:function(a,b){var c=a.getSelectionModel(),d=this.getPatientDisclosuresGrid(),e=d.getSelectionModel().getLastSelected(),f=e.get("document_inventory_ids").split(","),g=!1;f.forEach(function(a){c.select([b.getById(parseInt(a))],!0,g),g=!0})},onPatientDisclosuresGridBeforeItemContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showPatientDisclosuresGridBeforeItemContextMenu(b,e)},onPatientDisclosuresGridDblClick:function(a,b){var c=this.showDisclosureEditWindow(),d=c.down("form").getForm();d.loadRecord(b)},showPatientDisclosuresGridBeforeItemContextMenu:function(a,b){return this.patientDisclosuresGridMenu||(this.patientDisclosuresGridMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("attach_documents"),itemId:"PatientDisclosuresAttacheDocumentsMenu"}]})),this.patientDisclosuresGridMenu.showAt(b.getXY())},onPatientDisclosuresAttacheDocumentsMenuClick:function(){var a=this,b={buttons:[{xtype:"button",text:_("cancel"),width:70,itemId:"PatientDisclosuresAttacheDocumentsCancelBtn"},{xtype:"button",text:_("save"),width:70,itemId:"PatientDisclosuresAttacheDocumentsSaveBtn"}]},c=a.getController("patient.Documents").showDocumentWindow(b),d=c.down("grid");d.getStore().on("load",function(b,c){a.onDocumentsLoad(d,b,c)})},onPatientDisclosuresGridActivate:function(a){a.store.load({filters:[{property:"pid",value:app.patient.pid}]})},onPatientDisclosuresGridAddBtnClick:function(){this.getPatientDisclosuresGrid().getSelectionModel().deselectAll();var a=this.getPatientDisclosuresGrid().getStore(),b=this.showDisclosureEditWindow(),c=b.down("form").getForm(),d=a.add({pid:app.patient.pid,uid:app.user.id,request_date:app.getDate(),active:!0});c.loadRecord(d[0])},onDisclosureEditWindowFormCancelBtnClick:function(a){this.getPatientDisclosuresGrid().getStore().rejectChanges(),a.up("window").close()},showDisclosureEditWindow:function(){return this.getDisclosureEditWindow()||Ext.create("App.view.patient.DisclosureEditWindow"),this.getDisclosureEditWindow().show()},onDisclosuresRecipientCancelBtnClick:function(){this.getDisclosuresRecipientWindow().close()},onDisclosuresRecipientSaveBtnClick:function(){var a=this.getDisclosuresRecipientWindow(),b=this.getDisclosuresRecipientForm().getForm(),c=b.getValues(),d=a.disclosure_data;b.isValid()&&(d.recipient=c.recipient,d.description=c.description,Disclosure.addDisclosure(d,a.disclosure_callback),a.close())},addRawDisclosure:function(a,b){var c=this;a.pid&&Ext.Msg.show({title:_("wait"),msg:_("raw_disclosure_message"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(d){"yes"==d&&c.promptRecipient(a,b)}})},promptRecipient:function(a,b){var c=this.showRecipientWindow();c.disclosure_data=a,c.disclosure_callback=b,this.getDisclosuresRecipientField().reset(),this.getDisclosuresDescriptionField().setValue(a.description)},showRecipientWindow:function(){return this.getDisclosuresRecipientWindow()||Ext.create("Ext.window.Window",{title:_("disclosures"),layout:"fit",itemId:"DisclosuresRecipientWindow",items:[{xtype:"form",itemId:"DisclosuresRecipientForm",width:300,bodyPadding:10,items:[{xtype:"combobox",labelAlign:"top",fieldLabel:"Choose Recipient",queryMode:"local",displayField:"text",valueField:"value",itemId:"DisclosuresRecipientField",allowBlank:!1,anchor:"100%",editable:!1,name:"recipient",store:Ext.create("Ext.data.Store",{fields:["text","value"],data:[{text:_("emer_contact"),value:"emer_contact"},{text:_("father"),value:"father"},{text:_("guardian"),value:"guardian"},{text:_("mother"),value:"mother"},{text:_("patient"),value:"patient"}]})},{xtype:"textareafield",labelAlign:"top",fieldLabel:"Description",name:"description",itemId:"DisclosuresDescriptionField",allowBlank:!1,anchor:"100%"}]}],buttons:[{text:_("cancel"),itemId:"DisclosuresRecipientCancelBtn"},{text:_("save"),itemId:"DisclosuresRecipientSaveBtn"}]}),this.getDisclosuresRecipientWindow().show()},disclosureDownload:function(a){if(a.get("document_inventory_count")>0){var b=Ext.create("Ext.form.Panel",{url:"dataProvider/DisclosureDownload.php"}),c=b.getForm();c.standardSubmit=!0,window.onbeforeunload=null,c.submit({params:{disclosure:JSON.stringify(a.getData())},success:function(){say("success"),window.onbeforeunload=function(){return _("you_should_logout_before_quitting")
},Ext.destroy(b)},failure:function(a,c){switch(c.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert("Failure","Form fields may not be submitted with invalid values");break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert("Failure","Ajax communication failed");break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert("Failure","????")}Ext.destroy(b),window.onbeforeunload=function(){return _("you_should_logout_before_quitting")}}})}}}),Ext.define("App.view.Viewport",{extend:"Ext.Viewport",user:window.user,version:window.version,minWidthToFullMode:1700,currency:g("gbl_currency_symbol"),patientImage:"resources/images/icons/user-light.svg",enablePoolAreaFadeInOut:eval(g("enable_poolarea_fade_in_out")),userInteracted:!1,itemId:"Viewport",ip:null,initComponent:function(){Ext.tip.QuickTipManager.init();var me=window.app=this;me.user.getFullName=function(){var a=me.user.title+" "+me.user.fname+" "+me.user.mname+" "+me.user.lname;return a.replace("  "," ").trim()},me.nav=me.getController("Navigation"),me.cron=me.getController("Cron"),me.log=me.getController("LogOut"),me.dual=me.getController("DualScreen"),me.notification=me.getController("Notification"),me.logged=!0,me.lastCardNode=null,me.prevNode=null,me.fullMode=window.innerWidth>=me.minWidthToFullMode,me.record_flags={TOTAL_FALGS:0},me.record_flags_buff=g("record_number_renderer_flags"),(me.record_flags_buff!==!1||""!==me.record_flags_buff&&me.record_flags_buff.split)&&(me.record_flags_buff=me.record_flags_buff.split("|"),this.record_flags_buff.forEach(function(a){if(-1!=a.indexOf(":")){var b=a.split(":");me.record_flags[b[0]]=b[1]}else me.record_flags[a]=!0;me.record_flags.TOTAL_FALGS++})),delete me.record_flags_buff,me.patient={pid:null,pubpid:null,name:null,pic:null,sex:null,sexSymbol:null,dob:null,age:null,eid:null,priority:null,readOnly:!1,rating:null,covid_status:null,is_pregnant:null},me.patientPoolStore=Ext.create("App.store.areas.PatientAreas"),"$"==me.currency?me.icoMoney="icoDollar":""==me.currency?me.icoMoney="icoEuro":""==me.currency?me.icoMoney="icoLibra":""==me.currency&&(me.icoMoney="icoYen"),me.Header=Ext.create("Ext.container.Container",{region:"north",height:44,split:!1,collapsible:!1,collapsed:!1,frame:!1,border:!1,cls:"appHeader",bodyStyle:"background: transparent",margins:"0 0 0 0",layout:"hbox"}),me.HeaderLeft=Ext.widget("container",{margin:0,flex:1,layout:"hbox",itemId:"AppHeaderLeft"}),me.HeaderRight=Ext.widget("container",{margin:0,layout:"hbox",itemId:"AppHeaderRight"}),me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-home",scope:me,handler:me.openDashboard,tooltip:_("patient_visits_history")}),me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-calendar-alt",scope:me,handler:me.openCalendar,tooltip:_("patient_visits_history")}),me.HeaderLeft.add({xtype:"tbseparator"}),me.patientBtn=me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",style:"height: 42px",tooltip:_("patient_btn_drag"),listeners:{scope:me,afterrender:me.patientBtnRender},tpl:me.patientBtnTpl()}),me.HeaderLeft.add({xtype:"tbseparator"}),me.patientSummaryBtn=me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-info-circle",scope:me,handler:me.openPatientSummary,tooltip:_("patient_summary")}),a("access_patient_visits")&&(me.patientOpenVisitsBtn=me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-history",scope:me,handler:me.openPatientVisits,tooltip:_("patient_visits_history")})),a("add_encounters")&&(me.patientCreateEncounterBtn=me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-plus-circle",scope:me,handler:me.createNewEncounter,disableOnCLick:!0,tooltip:_("new_encounter")})),me.patientCloseCurrEncounterBtn=me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,iconCls:"fal fa-folder-download",scope:me,handler:me.stowPatientRecord,tooltip:_("stow_patient_record")}),a("access_patient_search")&&me.HeaderLeft.add({xtype:"panel",bodyPadding:"8 11 5 11",margin:"0 3 0 0",items:[{xtype:"patienlivetsearch",emptyText:_("patient_live_search")+"...",width:300,itemId:"HeaderPatientLiveSearchField",listeners:{scope:me,select:me.liveSearchSelect,blur:function(a){a.reset()}}}]}),a("add_patient")&&me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",padding:4,itemId:"HeaderNewPatientBtn",iconCls:"fal fa-user-plus",disableOnCLick:!0,tooltip:_("create_a_new_patient")}),a("create_emergency_encounter")&&me.HeaderLeft.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn emerBtn",overCls:"emerBtnOver",padding:0,itemId:"createEmergency",iconCls:"fas fa-plus-circle",scope:me,disableOnCLick:!0,handler:me.createEmergency,tooltip:_("create_new_emergency")}),a("access_floor_plan_panel")&&me.HeaderRight.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,itemId:"floorPlans",iconCls:"icoZoneAreasBig",scope:me,handler:me.goToFloorPlans,tooltip:_("floor_plans")}),a("access_pool_areas_panel")&&me.HeaderRight.add([{xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,itemId:"HeaderSendToPoolAreaBtn",icon:"resources/images/icons/next_pool.png",scope:me,tooltip:_("send_to_area")},{xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,itemId:"patientPoolArea",iconCls:"icoPoolArea",scope:me,handler:me.goToPoolAreas,tooltip:_("pool_areas")}]),a("access_poolcheckin")&&me.HeaderRight.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,itemId:"patientCheckIn",iconCls:"icoCheckIn",scope:me,handler:me.onPatientLog,tooltip:_("arrival_log")}),a("allow_user_switch")&&me.HeaderRight.add({xtype:"button",scale:"large",margin:"0 3 0 0",cls:"headerLargeBtn",padding:0,itemId:"SwitchUserBtn",icon:"resources/images/icons/switch-user.png",scope:me,tooltip:_("switch_user")}),me.userSplitBtn=me.HeaderRight.add({xtype:"button",text:me.user.title+" "+me.user.fname[0]+"."+me.user.lname,scale:"large",iconCls:isEmerAccess?"icoUnlocked32":"icoDoctor",iconAlign:"left",style:"height: 42px",plugins:[{ptype:"badgetext",defaultText:0}],itemId:"userSplitButton",cls:"drButton",margin:"0 3 0 0",menu:[{xtype:"menuseparator"},{text:_("help_documents"),itemId:"AppHelpDocumentMenu",icon:"resources/images/icons/icohelp.png",menu:[{text:"Appointment Module User Guide",icon:"resources/images/icons/icohelp.png",documentTitle:"Appointment Software User Guide",documentUrl:"https://docs.google.com/document/d/e/2PACX-1vRaSxKq1stGH8zwCRHvXCIfzBVlOlOSehQSctFeEpzZV6x7LJKo3TB9SgN2w54fuHIQ-WMKkgB2QJ8q/pub?embedded=true"},{text:"Billing Module User Guide",icon:"resources/images/icons/icohelp.png",documentTitle:"Appointment Software User Guide",documentUrl:"https://docs.google.com/document/d/e/2PACX-1vTTgjeV0lX6S9mijo7dnCSAmIcZofMAEY4oGcKd-UNkJ6fzPIPB6X0JXr77AQ8B1SAZO1-lQZSzWSDL/pub?embedded=true"},{text:"RIS Module User Guide",icon:"resources/images/icons/icohelp.png",documentTitle:"RIS Software User Guide",documentUrl:"https://docs.google.com/document/d/e/2PACX-1vTA3ymEgqFz8JhE0AxcGghVyEkuCxnoiiJmnbcL-FIIz3MIvv8DSHxWi5Xe4Atg8vMus-u9WSgUKjEW/pub?embedded=true"}]},{xtype:"menuseparator"},{text:_("my_account"),iconCls:"icoUser",handler:function(){me.nav.navigateTo("App.view.miscellaneous.MyAccount")}},{text:_("light_theme"),itemId:"AppThemeSwitcher",action:"light",icon:"resources/images/icons/theme.png"},{text:_("clear_stateful_state"),itemId:"AppCleatState",iconCls:"fas fa-eraser"},{text:_("logout"),iconCls:"icoLogout",action:"logout"}]}),a("emergency_access")&&me.userSplitBtn.menu.insert(0,{text:_("emergency_access"),cls:"emergency",iconCls:"icoUnlocked",scope:me,handler:me.onEmergencyAccessClick}),me.HeaderRight.add({xtype:"box",margin:0,itemId:"AppNetworkStatusBox",width:10,height:42,cls:"x-btn-default-large app-network-status-box"}),me.Header.add([me.HeaderLeft,me.HeaderRight]),me.navColumn=Ext.create("Ext.panel.Panel",{title:_("navigation"),action:"mainNavPanel",layout:"border",region:g("main_navigation_menu_left"),width:parseFloat(g("gbl_nav_area_width")),split:!0,collapsible:!0,collapsed:!0,animCollapse:!1,stateId:"mainNavPanel",stateful:!0,items:[{xtype:"treepanel",region:"center",action:"mainNav",cls:"nav_tree",hideHeaders:!0,rootVisible:!1,border:!1,width:parseFloat(g("gbl_nav_area_width")),store:Ext.create("App.store.navigation.Navigation",{autoLoad:!0})},me.patientPoolArea=Ext.create("Ext.Panel",{title:_("patient_pool_areas"),region:"south",action:"patientPoolArea",stateful:!0,stateId:"PatientPoolAreaSateId",bodyPadding:5,height:200,cls:"patient-pool",split:!0,collapsible:!0,border:!1,overflowY:"auto",items:[{xtype:"dataview",loadMask:!1,cls:"patient-pool-view",itemId:"NavigationPatientPoolAreaDatView",tpl:new Ext.XTemplate('<tpl for="."><div class="patient-pool-btn x-btn x-btn-default-large {priority}"><div class="patient_btn_img"><img src="{[this.getPatientImage(values.patient)]}" width="50" height="50"></div><div class="patient_btn_info"><div class="patient-name">{shortName}</div><div class="patient-name">({poolArea})</div></div></div></tpl>',{getPatientImage:function(a){return a.image?a.image:me.patientImage}}),itemSelector:"div.patient-pool-btn",overItemCls:"patient-over",selectedItemClass:"patient-selected",singleSelect:!0,store:me.patientPoolStore,listeners:{scope:me,render:me.onEncounterDragZoneRender}}],bbar:[{xtype:"floorplanazonescombo",multiSelect:!0,itemId:"NavigationPatientPoolAreaFloorPlanZonesCombo",stateful:!0,stateId:"NavigationPatientPoolAreaFloorPlanZonesComboState",flex:1}]})],dockedItems:[{xtype:"toolbar",dock:"bottom",border:!0,margin:"3 0 0 0",padding:5,layout:{type:"hbox",pack:"center"},items:["-",{xtype:"button",frame:!0,text:"MD Timeline Support",iconCls:"icoHelp",action:"supportBtn",src:"https://mdtimeline.freshdesk.com/support/login"},"-"]}]}),me.MainPanel=Ext.create("Ext.container.Container",{region:"center",layout:"card",border:!0,itemId:"MainPanel",deferredRender:!0,defaults:{layout:"fit",xtype:"container"},listeners:{scope:me,afterrender:me.initializeOpenEncounterDropZone}}),me.nav.App_view_dashboard_Dashboard=me.MainPanel.add(Ext.create("App.view.dashboard.Dashboard")),me.nav.App_view_areas_FloorPlan=me.MainPanel.add(Ext.create("App.view.areas.FloorPlan")),me.nav.App_view_areas_PatientPoolAreas=me.MainPanel.add(Ext.create("App.view.areas.PatientPoolAreas")),me.Footer=Ext.create("Ext.container.Container",{height:30,split:!1,padding:"3 0",region:"south",action:"appFooter",items:[{xtype:"dataview",margin:"0 0 3 0",hidden:!0,hideMode:"offsets",cls:"patient-pool-view-footer x-toolbar x-toolbar-default x-box-layout-ct",tpl:'<div class="x-toolbar-separator x-toolbar-item x-toolbar-separator-horizontal" style="float:left; margin-top:5px;" role="presentation" tabindex="-1"></div><tpl for="."><div class="patient-pool-btn-small x-btn x-btn-default-small {priority}" style="float:left"><div class="patient_btn_info"><div class="patient-name">{shortName} ({pid})</div></div></div><div class="x-toolbar-separator x-toolbar-item x-toolbar-separator-horizontal" style="float:left; margin-top:5px; margin-left:3px;" role="presentation" tabindex="-1"></div></tpl>',itemSelector:"div.patient-pool-btn-small",overItemCls:"patient-over",selectedItemClass:"patient-selected",singleSelect:!0,loadMask:!1,store:me.patientPoolStore,listeners:{scope:me,render:me.onEncounterDragZoneRender}},{xtype:"toolbar",dock:"bottom",items:[{xtype:"activefacilitiescombo",emptyText:"Facilities",width:parseFloat(g("gbl_nav_area_width"))-4,hidden:!eval(a("access_to_other_facilities")),itemId:"ApplicationFacilityCombo"},"-",{xtype:"button",text:_("dual_screen"),itemId:"ApplicationDualScreenBtn",enableToggle:!0,iconCls:"fa fa-desktop",toggleGroup:"ApplicationDualScreenBtnGroup",stateful:!0,stateId:"ApplicationDualScreenBtnState"+app.user.id},"-",{xtype:"container",itemId:"ApplicationFooterContainer",flex:1,layout:"hbox",defaults:{xtype:"button",minWidth:70},items:[{xtype:"printerscombo",fieldLabel:_("default_printer"),labelWidth:80,labelAlign:"right",itemId:"ApplicationFooterDefaultPrinterCmb",stateful:!0,stateId:"ApplicationFooterDefaultPrinterCmbState",margin:"0 5 0 0",width:300,emptyText:"None",resetable:!0},{xtype:"button",text:_("print_jobs"),iconCls:"fa fa-briefcase",itemId:"ApplicationFooterPrintJobsBtn"}]},"-",{xtype:"tbtext",text:"Copyright (C) 2019 MDTIMELINE, LLC |:| v"+me.version},"-",{xtype:"tbtext",text:"IP: 0.0.0.0",itemId:"ApplicationIpAddress"},"-",{xtype:"container",itemId:"ApplicationClockContainer",margin:"0 10 0 0"}]}]}),me.layout={type:"border",padding:3},me.defaults={split:!0},me.items=[me.Header,me.navColumn,me.MainPanel,me.Footer],me.listeners={scope:me,render:me.appRender,beforerender:me.beforeAppRender},me.callParent(arguments),me.ChartsWindow=Ext.create("App.view.patient.windows.Charts"),me.PaymentEntryWindow=Ext.create("App.view.fees.PaymentEntryWindow"),me.newEncounterWindow=Ext.create("App.view.patient.windows.NewEncounter"),a("access_encounter_checkout")&&(me.checkoutWindow=Ext.create("App.view.patient.windows.EncounterCheckOut")),me.el.on("click",me.onUserViewportClick,me)},setIpAddress:function(a){this.ip!==a&&this.Footer.query("#ApplicationIpAddress")[0].update("IP: "+a)},onUserViewportClick:function(){this.userInteracted=!0,this.el.un("click",this.onUserViewportClick,this),this.fireEvent("userinteraction",this)},getUserFullname:function(){return this.user.lname+", "+this.user.fname+" "+this.user.mname},getController:function(a){return App.Current.getController(a)},setWindowTitle:function(a){window.document.title="MDTL :: "+a},onMedicalWin:function(a){this.MedicalWindow||(this.MedicalWindow=Ext.create("App.view.patient.windows.Medical")),a&&(this.MedicalWindow.show(),this.MedicalWindow.cardSwitch(a))},onChartsWin:function(){this.ChartsWindow.show()},onWebCamComplete:function(){var a=this.getActivePanel();"panelSummary"==a.id&&a.demographics.completePhotoId(),this.msg(_("sweet"),_("patient_image_saved"))},onPatientLog:function(){this.patientArrivalLog?this.patientArrivalLog.show():this.patientArrivalLog=Ext.create("App.view.patient.windows.ArrivalLog").show()},onPaymentEntryWindow:function(){this.PaymentEntryWindow.show()},createEmergency:function(){var a,b=this;Ext.Msg.show({title:_("wait")+"!!!",msg:_("are_you_sure_you_want_to_create_a_new")+' <span style="color: red">"'+_("emergency")+'"</span>?',buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:function(c){"yes"==c&&Emergency.createNewEmergency(function(c,d){a=d.result.emergency,d.result.success&&(b.setPatient(a.pid,a.eid,null,function(){b.openEncounter(a.eid)}),b.msg(_("sweet"),a.name+" "+_("created")))})}})},onEmergencyAccessClick:function(){var a=this;Ext.Msg.show({title:_("wait"),msg:_("emergency_access_question")+"<br>"+_("emergency_access_disclaimer"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b){"yes"==b&&a.doEmergencyAccess()}})},doEmergencyAccess:function(){ACL.emergencyAccess(app.user.id,function(a){return a?void window.location.reload():void Ext.Msg.alert(_("oops"),_("emergency_access_error"))})},createNewEncounter:function(){var b=this;a("access_encounters")&&a("add_encounters")?b.newEncounterWindow.show():b.accessDenied()},updateEncounter:function(b){var c=this;a("access_encounters")&&a("edit_encounters")?(c.newEncounterWindow.loadRecord(b),c.newEncounterWindow.show()):c.accessDenied()},openPatientSummary:function(){var a=this,b=a.nav.getNavRefByClass("App.view.patient.Summary"),c=a.nav[b];c&&c==a.nav.activePanel&&c.loadPatient(),a.nav.navigateTo("App.view.patient.Summary")},openDashboard:function(){this.nav.navigateTo("App.view.dashboard.Dashboard")},openCalendar:function(){{var a=this,b=a.nav.getNavRefByClass("Modules.appointments.view.CalendarPanel");a.nav[b]}a.nav.navigateTo("Modules.appointments.view.CalendarPanel")},stowPatientRecord:function(){this.unsetPatient(null,!0),app.fireEvent("stowpatientrecord",this)!==!1&&this.nav.navigateTo("App.view.dashboard.Dashboard")},openEncounter:function(b){var c=this;a("access_encounters")?(app.patient.eid=b,c.nav.navigateTo("App.view.patient.Encounter",function(a){a&&Ext.Function.defer(function(){c.nav.getPanelByCls("App.view.patient.Encounter").openEncounter(b)},100)})):c.accessDenied()},checkOutPatient:function(){var a=this;this.nav.navigateTo("App.view.patient.VisitCheckout",function(b){b&&Ext.Function.defer(function(){a.nav.getPanelByCls("App.view.patient.VisitCheckout").setVisitPanel()},100)})},openPatientVisits:function(){this.nav.navigateTo("App.view.patient.Visits")},goToPoolAreas:function(){this.nav.navigateTo("App.view.areas.PatientPoolAreas")},goToFloorPlans:function(){this.nav.navigateTo("App.view.areas.FloorPlan")},getActivePanel:function(){return this.MainPanel.getLayout().getActiveItem()},addPrintJob:function(a,b,c,d,e){this.getController("PrintJob").addPrintJob(a,b,c,d,e)},liveSearchSelect:function(a,b){var c=this,d=b[0];d&&c.setPatient(d.get("pid"),null,null,function(){a.reset(),"function"==typeof c.onAppPatientSearchCallback?c.onAppPatientSearchCallback(c.patient):c.openPatientSummary()})},setPatient:function(a,b,c,d,e){var f=this;f.unsetPatient(null,!0),Patient.getPatientSetDataByPid({pid:a,prevPid:f.patient.pid,site:c},function(a){function c(c){f.patient={pid:a.patient.pid,pubpid:a.patient.pubpid,name:a.patient.name,pic:a.patient.pic,sex:a.patient.sex,sexSymbol:"F"==a.patient.sex?"&#9792":"&#9794",dob:Ext.Date.parse(a.patient.dob,"Y-m-d H:i:s"),age:a.patient.age,eid:b,priority:a.patient.priority,readOnly:c,rating:a.patient.rating,covid_status:a.patient.covid_status,is_pregnant:a.patient.is_pregnant,record:Ext.create("App.model.patient.Patient",a.patient.record)},f.fireEvent("patientset",f.patient);for(var g=f.MainPanel.items.items,h=0;h<g.length;h++)g[h].pageRankingDiv&&g[h].pageRankingDiv.setValue(f.patient.rating);f.patientButtonSet(f.patient),f.patientSummaryBtn&&f.patientSummaryBtn.enable(),f.patientOpenVisitsBtn&&f.patientOpenVisitsBtn.enable(),f.patientCreateEncounterBtn&&f.patientCreateEncounterBtn.enable(),f.patientCloseCurrEncounterBtn&&f.patientCloseCurrEncounterBtn.enable(),f.patientCheckOutBtn&&f.patientCheckOutBtn.enable(),(f.fireEvent("beforepatientsetcallback",f.patient)!==!1||e===!0)&&"function"==typeof d&&d(f.patient)}var g,h;return a.success===!1?(f.msg(_("oops"),a.error,!0),void f.nav.navigateTo("App.view.dashboard.Dashboard")):void(a.readOnly?(g=a.user+" "+_("is_currently_working_with")+' "'+a.patient.name+'" '+_("in")+' "'+a.area+'" '+_("area")+".<br>"+_("override_read_mode_will_remove_the_patient_from_previous_user")+".<br>"+_("do_you_would_like_to_override_read_mode"),h=a.user+" "+_("is_currently_working_with")+' "'+a.patient.name+'" '+_("in")+' "'+a.area+'" '+_("area")+".<br>",Ext.Msg.show({title:_("wait")+"!!!",msg:a.overrideReadOnly?g:h,buttons:a.overrideReadOnly?Ext.Msg.YESNO:Ext.Msg.OK,icon:Ext.MessageBox.WARNING,fn:function(a){c("yes"!=a)}})):c(!1))})},unsetPatient:function(a,b){var c=this;if(b&&Patient.unsetPatient(c.patient.pid),c.currEncounterId=null,c.patient.record&&delete c.patient.record,c.patient={pid:null,pubpid:null,name:null,pic:null,sex:null,sexSymbol:null,dob:null,age:null,eid:null,priority:null,readOnly:!1,rating:null,record:null,covid_status:null,is_pregnant:null},c.patientButtonRemoveCls(),"function"==typeof a)a(!0);else{c.fireEvent("patientunset");for(var d=c.MainPanel.items.items,e=0;e<d.length;e++)d[e].pageRankingDiv&&d[e].pageRankingDiv.setValue(0);c.patientCreateEncounterBtn&&c.patientCreateEncounterBtn.disable(),c.patientSummaryBtn&&c.patientSummaryBtn.disable(),c.patientOpenVisitsBtn&&c.patientOpenVisitsBtn.disable(),c.patientCloseCurrEncounterBtn&&c.patientCloseCurrEncounterBtn.disable(),c.patientChargeBtn&&c.patientChargeBtn.disable(),c.patientCheckOutBtn&&c.patientCheckOutBtn.disable(),c.patientButtonSet()}},patientButtonSet:function(data){var me=this,patient=data||{},displayPid=eval(g("display_pubpid"))?me.recordNumberRenderer(patient.pubpid):patient.pid,patient_btn_icons_tpl="";(null==displayPid||""==displayPid)&&(displayPid=patient.pid),data&&("vaccinated"===data.covid_status?patient_btn_icons_tpl+='<img src="resources/images/icons/vacuid.png" alt="vaccinated" style="width: 24px; margin: 5px 0 0 -10px" />':"partially_vaccinated"===data.covid_status&&(patient_btn_icons_tpl+='<img src="resources/images/icons/vacuid_partial.png" alt="partially vaccinated" style="width: 24px; margin: 5px 0 0 -10px;" />'),data.is_pregnant&&(patient_btn_icons_tpl+='<img src="resources/images/icons/pregnant.png" alt="pregnant" style="width: 24px; margin: 5px 0 0 5px" />')),me.patientBtn.update({displayPid:displayPid||"record number",pid:patient.pid,pic:patient.pic||me.patientImage,name:patient.name||_("no_patient_selected"),patient_btn_icons_tpl:patient_btn_icons_tpl,covid_status:patient.covid_status?"covid_status_"+patient.covid_status:""}),me.patientButtonRemoveCls(),patient.priority&&me.patientBtn.addCls(data.priority),me.patientBtn.setDisabled(!patient.pid)},patientButtonRemoveCls:function(){var a=this;a.patientBtn.removeCls("Minimal"),a.patientBtn.removeCls("Delayed"),a.patientBtn.removeCls("Immediate"),a.patientBtn.removeCls("Expectant"),a.patientBtn.removeCls("Deceased")},patientBtnTpl:function(){return Ext.create("Ext.XTemplate",'<div class="patient_btn {priority} {covid_status}">','   <div class="patient_btn_img">       <img src="{pic}" width="50" height="50">   </div>','   <div class="patient_btn_icons">',"      {patient_btn_icons_tpl}","   </div>",'   <div class="patient_btn_info">','       <div class="patient_btn_name">{name}</div>','       <div class="patient_btn_record">( {displayPid} )</div>',"   </div>","</div>")},patientBtnRender:function(a){this.patientButtonSet(),this.initializePatientPoolDragZone(a)},getPatientsInPoolArea:function(){if(a("use_pool_areas")){var b=this,c=b.patientPoolArea,d=b.getController("areas.PatientPoolAreas").getSelectedPoolAreaZones(),e=35;this.patientPoolStore.load({params:{uid:b.user.id,zones:d},callback:function(a){if(a.length>=1)for(var d=0;d<a.length;d++)e+=45;else e=25;b.navColumn.collapsed!==!1||b.navColumn.isCollapsingOrExpanding||c.down("dataview").refresh()}}),b.nav.App_view_areas_PatientPoolAreas.isVisible()&&b.nav.App_view_areas_PatientPoolAreas.reloadStores()}},initializePatientPoolDragZone:function(a){a.dragZone=Ext.create("Ext.dd.DragZone",a.getEl(),{ddGroup:"patientPoolAreas",getDragData:function(){if(app.patient.pid){var b,c=a.getEl().dom;if(c)return b=document.createElement("div"),b.id=Ext.id(),b.innerHTML=_("drag_patient_to_new_area"),a.dragData={copy:!0,sourceEl:c,repairXY:Ext.fly(c).getXY(),ddel:b,records:[a.data],patient:!0}}},getRepairXY:function(){return this.dragData.repairXY},onBeforeDrag:function(){return app.nav.navigateTo("App.view.areas.PatientPoolAreas"),!0}})},onEncounterDragZoneRender:function(a){this.initializeOpenEncounterDragZone(a),this.enablePoolAreaFadeInOut&&(a.el.setStyle({opacity:.1}),a.el.on("mouseenter",function(){a.el.setStyle({opacity:1})}),a.el.on("mouseleave",function(){a.el.setStyle({opacity:.1})}))},initializeOpenEncounterDragZone:function(a){a.dragZone=Ext.create("Ext.dd.DragZone",a.getEl(),{ddGroup:"patient",newGroupReset:!0,b4MouseDown:function(b){if(this.newGroupReset){var c=b.getTarget(a.itemSelector,10),d=a.getRecord(c).data;this.removeFromGroup(this.ddGroup),0!=d.floorPlanId&&0==d.patientZoneId?(app.nav.navigateTo("App.view.areas.FloorPlan"),this.ddGroup="patientPoolAreas"):(this.ddGroup="patient",app.MainPanel.el.mask(_("drop_here_to_open")+' <strong>"'+a.getRecord(c).data.shortName+'"</strong> '+_("current_encounter"))),this.addToGroup(this.ddGroup),this.newGroupReset=!1}this.autoOffset(b.getPageX(),b.getPageY())},endDrag:function(){this.newGroupReset=!0},getDragData:function(b){var c,d=b.getTarget(a.itemSelector,10),e=a.getRecord(d).data;return d?(c=d.cloneNode(!0),c.id=Ext.id(),a.dragData={sourceEl:d,repairXY:Ext.fly(d).getXY(),ddel:c,patientData:e}):!1},getRepairXY:function(){return app.MainPanel.el.unmask(),this.newGroupReset=!0,this.dragData.repairXY}})},onDocumentView:function(a,b,c){app.getController("DocumentViewer").doDocumentView(a,b,c)},initializeOpenEncounterDropZone:function(b){var c=this;b.dropZone=Ext.create("Ext.dd.DropZone",b.getEl(),{ddGroup:"patient",notifyOver:function(){return Ext.dd.DropZone.prototype.dropAllowed},notifyDrop:function(b,d,e){app.MainPanel.el.unmask(),e.patientData.eid&&"Check Out"==e.patientData.poolArea||e.patientData.eid&&a("access_encounters")||null===e.patientData.floorPlanId||0===e.patientData.floorPlanId,c.setPatient(e.patientData.pid,e.patientData.eid,null,function(){e.patientData.eid&&"Checkout"==e.patientData.poolArea?c.checkOutPatient(e.patientData.eid):e.patientData.eid&&a("access_encounters")?c.openEncounter(e.patientData.eid):c.openPatientSummary()})}})},appRender:function(){this.loadModules()},loadModules:function(){Modules.getEnabledModules(function(a,b){for(var c=b.result,d=0;d<c.length;d++)try{app.getController("Modules."+c[d].dir+".Main")}catch(e){app.msg(_("oops"),_("unable_to_load_module")+" "+c[d].title+"<br>Error: "+e,!0)}app.doLayout()})},removeAppMask:function(){Ext.get("mainapp-loading")&&Ext.get("mainapp-loading").remove(),Ext.get("mainapp-loading-mask")&&Ext.get("mainapp-loading-mask").remove()},beforeAppRender:function(){var a=this,b=a.nav.getUrlParams();b[1]?a.setPatient(b[1],null,null,function(){Ext.Function.defer(function(){a.nav.navigateTo("App.view.patient.Summary")},500)}):a.unsetPatient(null,!1)},getCurrPatient:function(){return this.patient.pid},getApp:function(){return this},accessDenied:function(){Ext.Msg.show({title:_("oops"),msg:_("access_denied"),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},msg:function(a,b,c,d){var e=c===!0?"msg-red":"msg-green";"string"==typeof c&&(e="msg-"+c),this.msgCt=Ext.get("msg-div"),this.msgCt||(this.msgCt=Ext.fly("msg-div"));var f=Ext.String.format.apply(String,Array.prototype.slice.call(arguments,1)),g=Ext.core.DomHelper.append(this.msgCt,{html:'<div class="flyMsg '+e+'"><h3>'+(a||"")+"</h3><p>"+f+"</p></div>"},!0);return this.msgCt.alignTo(document,"t-t"),d===!0?g:(g.addCls("fadeded"),Ext.create("Ext.fx.Animator",{target:g,duration:c?8e3:3e3,keyframes:{0:{opacity:0},10:{opacity:1},80:{opacity:1},100:{opacity:0,height:0}},listeners:{afteranimate:function(a){a.target.target.destroy()}}}),g.on("click",function(){g.applyStyles("visibility:hidden; display:none")}),!0)},alert:function(a,b){b="error"==b?Ext.Msg.ERROR:"warning"==b?Ext.Msg.WARNING:"question"==b?Ext.Msg.QUESTION:Ext.Msg.INFO,Ext.Msg.show({msg:a,buttons:Ext.Msg.OK,icon:b,maxWidth:1200,modal:!1})},fullname:function(a,b,c,d){var e="";return a&&(e+=a+" "),b&&(e+=b+" "),c&&(e+=c+" "),d&&(e+=d+" "),e},recordNumberRenderer:function(a){if(!a)return a;if(0===this.record_flags.TOTAL_FALGS)return a;if(this.record_flags.NUM_LENGTH){var b=a.split("-");3==b.length&&(b[1]=b[1].substring(b[1].length-this.record_flags.NUM_LENGTH)),a=b.join("-")}return this.record_flags.STRIP_DASHES&&(a=a.replace(/-/g,"")),a},getDate:function(){return this.getController("Clock").getDate()},calculateAge:function(a,b){var c=+new Date(b);return~~((Ext.Date.now(a)-c)/315576e5)},getAge:function(a,b){var c=new Date(a),d=b?new Date(b):new Date,e=30.436875,f=d.getFullYear(),g=c.getFullYear(),h=f-g;c.setFullYear(f);var i=d.getTime(),j=c.getTime();j>i&&(--h,c.setFullYear(f-1),j=c.getTime());var k=(i-j)/864e5,l=k/e,m=Math.floor(l);return k=Math.floor(e*(l-m)),{years:h,months:m,days:k}},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}),Ext.define("App.ux.combo.ReferringProviders",{extend:"Ext.form.ComboBox",alias:"widget.referringproviderscombo",displayField:"fullname",valueField:"id",initComponent:function(){var a=this;Ext.define("ReferringProvidersModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.title+" "+b.data.lname+", "+b.data.fname+" "+b.data.mname}}],proxy:{type:"direct",api:{read:"ReferringProviders.getReferringProviders"},reader:{root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"ReferringProvidersModel",autoLoad:!1}),Ext.apply(this,{emptyText:_("select"),store:a.store}),a.callParent(arguments)}}),Ext.define("App.controller.patient.PatientNotes",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"PatientNotesGrid",selector:"#PatientNotesGrid"},{ref:"PatientNotesWindow",selector:"#PatientNotesWindow"},{ref:"PatientNotesGridAddNotesBtn",selector:"#PatientNotesGridAddNotesBtn"},{ref:"PatientNotesWindowCloseBtn",selector:"#PatientNotesWindowCloseBtn"},{ref:"PatientNotesGridNotesContextMenuDetailLog",selector:"#PatientNotesGridNotesContextMenuDetailLog"}],init:function(){var a=this;a.auditLogCtrl=app.getController("administration.TransactionLog"),a.control({"#PatientNotesGrid":{activate:a.onPatientNotesGridActivate,beforeitemcontextmenu:a.onPatientNotesGridContextMenu,beforeedit:a.onPatientNotesGridBeforeEdit,validateedit:a.onPatientNotesGridValidateEdit,beforerender:a.onPatientNotesGridBeforeRender},"#PatientNotesWindow":{show:a.onPatientNotesWindowShow},"#PatientNotesWindowCloseBtn":{click:a.onPatientNotesWindowCloseBtnClick},"#PatientNotesGridNotesContextMenuDetailLog":{click:a.onPatientNotesGridContextMenuDetailLogClick},"#PatientNotesGridAddNotesBtn":{click:a.onPatientNotesGridAddNotesBtn}})},onPatientNotesWindowShow:function(a){this.doFilterGrid(a.down("grid"))},onPatientNotesGridActivate:function(a){this.doFilterGrid(a)},onAddNew:function(a){var b,c=a.up("grid"),d=c.store;"disclosure"==a.action?b={date:new Date,pid:app.patient.pid,global_id:app.uuidv4(),active:1}:"note"==a.action&&(b={date:new Date,create_date:new Date,pid:app.patient.pid,create_uid:app.user.id,uid:app.user.id,eid:app.patient.eid,global_id:app.uuidv4(),user_fname:app.user.fname,user_mname:app.user.mname,user_lname:app.user.lname}),c.plugins[0].cancelEdit(),d.insert(0,b),c.plugins[0].startEdit(0,0)},onPatientNotesGridBeforeEdit:function(){return a("edit_patient_notes")?void 0:(app.msg(_("oops"),_("not_authorized"),!0),!1)},onPatientNotesGridValidateEdit:function(a,b){b.record.data.update_user_fname=app.user.fname,b.record.data.update_user_mname=app.user.mname,b.record.data.update_user_lname=app.user.lname,b.record.data.update_date=app.getDate(),b.record.data.update_uid=app.user.id},onPatientNotesGridContextMenu:function(a,b,c,d,e){e.preventDefault(),this.showPatientNotesGridContextMenu(a,b,e)},showPatientNotesGridContextMenu:function(b,c,d){if(a("access_patient_notes_transaction_log")){var e=this;return e.PatientNotesGridContextMenu=Ext.widget("menu",{margin:"0 0 10 0",items:[{text:_("transaction_log"),icon:"modules/billing/resources/images/icoList.png",itemId:"PatientNotesGridNotesContextMenuDetailLog",acl:!0}]}),e.PatientNotesGridContextMenu.patient_notes_panel_grid=b,e.PatientNotesGridContextMenu.patient_notes_panel_record=c,e.PatientNotesGridContextMenu.showAt(d.getXY()),e.PatientNotesGridContextMenu}},onPatientNotesGridContextMenuDetailLogClick:function(a){var b=a.parentMenu.patient_notes_panel_record;this.auditLogCtrl.doTransactionLogDetailByTableAndPk(b.table.name,b.get("id"))},onPatientNotesWindowCloseBtnClick:function(){this.getPatientNotesWindow().close()},onPatientNotesGridAddNotesBtn:function(a){var b,c=a.up("grid"),d=c.store;say(a),"disclosure"==a.action?b={date:new Date,pid:app.patient.pid,global_id:app.uuidv4(),active:1}:"note"==a.action&&(b={date:new Date,create_date:new Date,pid:app.patient.pid,create_uid:app.user.id,uid:app.user.id,eid:app.patient.eid,global_id:app.uuidv4(),user_fname:app.user.fname,user_mname:app.user.mname,user_lname:app.user.lname}),c.plugins[0].cancelEdit(),d.insert(0,b),c.plugins[0].startEdit(0,0)
},onPatientNotesGridBeforeRender:function(){},doFilterGrid:function(a){var b=a.getStore();b.clearFilter(!0),b.filter([{property:"pid",value:app.patient.pid}])},showPatientNotesWindow:function(){return this.getPatientNotesWindow()||Ext.create("App.view.patient.windows.PatientNotesWindow"),this.getPatientNotesWindow().show()}}),Ext.define("App.ux.combo.RolesGroups",{extend:"Ext.form.ComboBox",alias:"widget.mitos.rolesgroupscombo",editable:!1,queryMode:"local",valueField:"id",displayField:"title",emptyText:_("select"),includeAllOption:!1,initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!0,fields:[{name:"id",type:"int"},{name:"title",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getRolesGroups"},extraParams:{includeAllOption:a.includeAllOption}}}),a.callParent(arguments)}}),Ext.define("App.ux.LiveLoincRadiologyCodesSearch",{extend:"Ext.form.ComboBox",requires:[],xtype:"liveloincradiologycodessearch",hideLabel:!0,displayField:"LongCommonName",valueField:"LoincNumber",emptyText:_("search")+"...",typeAhead:!1,hideTrigger:!1,minChars:1,queryDelay:1e3,forceSelection:!0,acl:null,trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.LoincRadiologyCodes"),Ext.apply(a,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><b>{LoincNumber}:</b>  {LongCommonName}</div>'}},pageSize:10}),a.callParent()},onTrigger1Click:function(){var a=this;a.setValue(""),a.store.removeAll(),a.store.commitChanges(),a.updateLayout(),a.fireEvent("reset",a)}}),Ext.define("App.ux.LiveCPTRadiologyCodesSearch",{extend:"Ext.form.ComboBox",requires:[],xtype:"livecptradiologycodessearch",hideLabel:!0,displayField:"code_text_short",valueField:"code",emptyText:_("search")+"...",typeAhead:!1,hideTrigger:!1,minChars:1,queryDelay:1e3,acl:null,queryParam:"radiology_query",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.CPT"),Ext.apply(a,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><b>{code}:</b>  {code_text_short}</div>'}},pageSize:10}),a.callParent()},onTrigger1Click:function(){var a=this;a.setValue(""),a.store.removeAll(),a.store.commitChanges(),a.updateLayout(),a.fireEvent("reset",a)}}),Ext.define("App.ux.form.fields.HtmlEditor",{extend:"Ext.form.field.HtmlEditor",alias:"widget.customhtmleditor",componentTpl:["{beforeTextAreaTpl}",'<textarea id="{id}-textareaEl" name="{name}" tabIndex="-1" {inputAttrTpl}',' class="{textareaCls}" autocomplete="off" >',"{[Ext.util.Format.htmlEncode(values.value)]}","</textarea>","{afterTextAreaTpl}","{beforeIFrameTpl}",'<iframe id="{id}-iframeEl" name="{iframeName}" frameBorder="0" data-nusa-enabled="true" data-nusa-custom-container-type="Frame_Type" {iframeAttrTpl}',' src="{iframeSrc}" class="{iframeCls}"></iframe>','<div id="{id}-editEl" data-nusa-enabled="true" data-nusa-custom-container-id="{id}-iframeEl" data-nusa-custom-control-type="Control_Type"></div>',"{afterIFrameTpl}",{disableFormats:!0}],getDocMarkup:function(){var a=this,b=a.iframeEl.getHeight()-2*a.iframePad,c=Ext.isIE8m;return Ext.String.format((c?"":"<!DOCTYPE html>")+'<html><head><style type="text/css">'+(Ext.isOpera?"p{margin:0}":"")+"body{border:0;margin:0;padding:{0}px;direction:"+(a.rtl?"rtl;":"ltr;")+(c?Ext.emptyString:"min-")+"height:{1}px;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;cursor:text;background-color:white;"+(Ext.isIE?"":"font-size:12px;font-family:{2}")+'}</style></head><body contentEditable="true" ></body></html>',a.iframePad,b,a.defaultFont)},initEvents:function(){var a=this;a.callParent(arguments),a.on({scope:a,initialize:a.onInitializeHtmlEditor})},onInitializeHtmlEditor:function(){var a=this,b=a.getWin(),c=Ext.bind(a.onHtmlEditorBlur,a),d=Ext.bind(a.onHtmlEditorFocus,a);b.attachEvent?(b.addEventListener("blur",c),b.addEventListener("focus",d)):(b.addEventListener("blur",c,!1),b.addEventListener("focus",d,!1))},onHtmlEditorBlur:function(){this.fireEvent("blur",this)},onHtmlEditorFocus:function(){this.fireEvent("focus",this)}}),Ext.define("App.ux.form.fields.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],multiSelect:!0,forceSelection:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,triggerOnClick:!0,stacked:!1,pinList:!0,filterPickList:!1,selectOnFocus:!0,grow:!0,growMin:!1,growMax:!1,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list x-tab-default">','<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],childEls:["listWrapper","itemList","inputEl","inputElCt","emptyEl"],componentLayout:"boxselectfield",emptyInputCls:"x-boxselect-emptyinput",initComponent:function(){var a=this,b=a.typeAhead;b&&!a.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings."),Ext.apply(a,{typeAhead:!1}),a.callParent(),a.typeAhead=b,a.selectionModel=new Ext.selection.Model({store:a.valueStore,mode:"MULTI",lastFocused:null,onSelectChange:function(a,b,c,d){d()}}),!Ext.isEmpty(a.delimiter)&&a.multiSelect&&(a.delimiterRegexp=new RegExp(String(a.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")))},initEvents:function(){var a=this;a.callParent(arguments),a.enableKeyEvents||a.mon(a.inputEl,"keydown",a.onKeyDown,a),a.mon(a.inputEl,"paste",a.onPaste,a),a.mon(a.listWrapper,"click",a.onItemListClick,a),a.mon(a.selectionModel,{selectionchange:function(b,c){a.applyMultiselectItemMarkup(),a.fireEvent("valueselectionchange",a,c)},focuschange:function(b,c,d){a.fireEvent("valuefocuschange",a,c,d)},scope:a})},onBindStore:function(a){var b=this;a&&(b.valueStore=new Ext.data.Store({model:a.model,proxy:{type:"memory"}}),b.mon(b.valueStore,"datachanged",b.applyMultiselectItemMarkup,b),b.selectionModel&&b.selectionModel.bindStore(b.valueStore))},onUnbindStore:function(){var a=this,b=a.valueStore;b&&(a.selectionModel&&(a.selectionModel.setLastFocused(null),a.selectionModel.deselectAll(),a.selectionModel.bindStore(null)),a.mun(b,"datachanged",a.applyMultiselectItemMarkup,a),b.destroy(),a.valueStore=null),a.callParent(arguments)},createPicker:function(){var a=this,b=a.callParent(arguments);return a.mon(b,{beforerefresh:a.onBeforeListRefresh,scope:a}),a.filterPickList&&b.addCls("x-boxselect-hideselections"),b},onDestroy:function(){var a=this;Ext.destroyMembers(a,"valueStore","selectionModel"),a.callParent(arguments)},getSubTplData:function(){var a=this,b=a.callParent(),c=a.emptyText&&b.value.length<1;return b.value="",c?(b.emptyText=a.emptyText,b.emptyCls=a.emptyCls,b.inputElCls=a.emptyInputCls):(b.emptyText="",b.emptyCls=a.emptyInputCls,b.inputElCls=""),b},afterRender:function(){var a=this;Ext.supports.Placeholder&&a.inputEl&&a.emptyText&&delete a.inputEl.dom.placeholder,a.bodyEl.applyStyles("vertical-align:top"),a.grow&&(Ext.isNumber(a.growMin)&&a.growMin>0&&a.listWrapper.applyStyles("min-height:"+a.growMin+"px"),Ext.isNumber(a.growMax)&&a.growMax>0&&a.listWrapper.applyStyles("max-height:"+a.growMax+"px")),a.stacked===!0&&a.itemList.addCls("x-boxselect-stacked"),a.multiSelect||a.itemList.addCls("x-boxselect-singleselect"),a.applyMultiselectItemMarkup(),a.callParent(arguments)},findRecord:function(a,b){var c,d=this.store;return d?(c=d.queryBy(function(c){return c.isEqual(c.get(a),b)}),c.getCount()>0?c.first():!1):!1},onLoad:function(){var a=this,b=a.valueField,c=a.valueStore,d=!1;c&&(Ext.isEmpty(a.value)||0!=c.getCount()||a.setValue(a.value,!1,!0),c.suspendEvents(),c.each(function(e){var f=a.findRecord(b,e.get(b)),g=f?c.indexOf(e):-1;g>=0&&(c.removeAt(g),c.insert(g,f),d=!0)}),c.resumeEvents(),d&&c.fireEvent("datachanged",c)),a.callParent(arguments)},isFilteredRecord:function(a){var b,c=this,d=c.store,e=c.valueField,f=!1;return b=d.findExact(e,a.get(e)),f=-1===b&&(!d.snapshot||c.findRecord(e,a.get(e))!==!1),f=f||!f&&-1===b&&c.forceSelection!==!0&&c.valueStore.findExact(e,a.get(e))>=0},doRawQuery:function(){var a=this,b=a.inputEl.dom.value;a.multiSelect&&(b=b.split(a.delimiter).pop()),this.doQuery(b,!1,!0)},onBeforeListRefresh:function(){this.ignoreSelection++},onListRefresh:function(){this.callParent(arguments),this.ignoreSelection>0&&--this.ignoreSelection},onListSelectionChange:function(a,b){var c,d=this,e=d.valueStore,f=[];d.ignoreSelection<=0&&d.isExpanded&&(e.each(function(a){(Ext.Array.contains(b,a)||d.isFilteredRecord(a))&&f.push(a)}),f=Ext.Array.merge(f,b),c=Ext.Array.intersect(f,e.getRange()).length,(c!=f.length||c!=d.valueStore.getCount())&&(d.setValue(f,!1),d.multiSelect&&d.pinList||Ext.defer(d.collapse,1,d),e.getCount()>0&&d.fireEvent("select",d,e.getRange())),d.inputEl.focus(),d.pinList||(d.inputEl.dom.value=""),d.selectOnFocus&&d.inputEl.dom.select())},syncSelection:function(){var a,b,c,d=this,e=d.picker,f=d.valueField;e&&(a=e.store,b=[],d.valueStore&&d.valueStore.each(function(c){var d=a.findExact(f,c.get(f));d>=0&&b.push(a.getAt(d))}),d.ignoreSelection++,c=e.getSelectionModel(),c.deselectAll(),b.length>0&&c.select(b),d.ignoreSelection>0&&--d.ignoreSelection)},doAlign:function(){var a,b=this,c=b.picker,d="-above";b.picker.alignTo(b.listWrapper,b.pickerAlign,b.pickerOffset),a=c.el.getY()<b.inputEl.getY(),b.bodyEl[a?"addCls":"removeCls"](b.openCls+d),c[a?"addCls":"removeCls"](c.baseCls+d)},alignPicker:function(){var a=this,b=a.picker,c=b.getTargetEl().dom.scrollTop;a.callParent(arguments),a.isExpanded&&(a.matchFieldWidth&&b.setWidth(a.listWrapper.getWidth()),b.getTargetEl().dom.scrollTop=c)},getCursorPosition:function(){var a;return Ext.isIE?(a=document.selection.createRange(),a.collapse(!0),a.moveStart("character",-this.inputEl.dom.value.length),a=a.text.length):a=this.inputEl.dom.selectionStart,a},hasSelectedText:function(){var a,b;return Ext.isIE?(a=document.selection,b=a.createRange(),b.parentElement()==this.inputEl.dom):this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd},onKeyDown:function(a){var b=this,c=a.getKey(),d=b.inputEl.dom.value,e=b.valueStore,f=b.selectionModel,g=!1;if(!b.readOnly&&!b.disabled&&b.editable){if(b.isExpanded&&c==a.A&&a.ctrlKey)b.select(b.getStore().getRange()),f.setLastFocused(null),f.deselectAll(),b.collapse(),b.inputEl.focus(),g=!0;else if(e.getCount()>0&&(""==d||0===b.getCursorPosition()&&!b.hasSelectedText())){var h=f.getCount()>0?e.indexOf(f.getLastSelected()||f.getLastFocused()):-1;c==a.BACKSPACE||c==a.DELETE?(h>-1?(f.getCount()>1&&(h=-1),b.valueStore.remove(f.getSelection())):b.valueStore.remove(b.valueStore.last()),f.clearSelections(),b.setValue(b.valueStore.getRange()),h>0&&f.select(h-1),g=!0):c==a.RIGHT||c==a.LEFT?-1==h&&c==a.LEFT?(f.select(e.last()),g=!0):h>-1&&(c==a.RIGHT?h<e.getCount()-1?(f.select(h+1,a.shiftKey),g=!0):a.shiftKey||(f.setLastFocused(null),f.deselectAll(),g=!0):c==a.LEFT&&h>0&&(f.select(h-1,a.shiftKey),g=!0)):c==a.A&&a.ctrlKey&&(f.selectAll(),g=a.A),b.inputEl.focus()}if(g)return b.preventKeyUpEvent=g,void a.stopEvent();b.isExpanded&&c==a.ENTER&&b.picker.highlightedItem&&(b.preventKeyUpEvent=!0),b.enableKeyEvents&&b.callParent(arguments),a.isSpecialKey()||a.hasModifier()||(b.selectionModel.setLastFocused(null),b.selectionModel.deselectAll(),b.inputEl.focus())}},onKeyUp:function(a,b){var c=this,d=c.inputEl.dom.value;return c.preventKeyUpEvent?(a.stopEvent(),void((c.preventKeyUpEvent===!0||a.getKey()===c.preventKeyUpEvent)&&delete c.preventKeyUpEvent)):((c.multiSelect&&c.delimiterRegexp&&c.delimiterRegexp.test(d)||c.createNewOnEnter===!0&&a.getKey()==a.ENTER)&&(d=Ext.Array.clean(d.split(c.delimiterRegexp)),c.inputEl.dom.value="",c.setValue(c.valueStore.getRange().concat(d)),c.inputEl.focus()),void c.callParent([a,b]))},onPaste:function(a){var b=this,c=b.inputEl.dom.value,d=a&&a.browserEvent&&a.browserEvent.clipboardData?a.browserEvent.clipboardData:!1;b.multiSelect&&b.delimiterRegexp&&b.delimiterRegexp.test(c)&&(d&&d.getData&&(/text\/plain/.test(d.types)?c=d.getData("text/plain"):/text\/html/.test(d.types)&&(c=d.getData("text/html"))),c=Ext.Array.clean(c.split(b.delimiterRegexp)),b.inputEl.dom.value="",b.setValue(b.valueStore.getRange().concat(c)),b.inputEl.focus())},onExpand:function(){var a=this,b=a.listKeyNav;a.callParent(arguments),!b&&a.filterPickList&&(b=a.listKeyNav,b.highlightAt=function(a){var b,c=this.boundList,d=c.all.item(a),e=c.all.getCount();if(d&&d.hasCls("x-boundlist-selected")){b=0==a||!c.highlightedItem||c.indexOf(c.highlightedItem)<a?1:-1;do a+=b,d=c.all.item(a);while(a>0&&e>a&&d.hasCls("x-boundlist-selected"));if(d.hasCls("x-boundlist-selected"))return}d&&(d=d.dom,c.highlightItem(d),c.getTargetEl().scrollChildIntoView(d,!1))})},onTypeAhead:function(){var a,b,c,d,e=this,f=e.displayField,g=e.inputEl.dom,h=e.valueStore,i=e.getPicker();if(e.filterPickList){var j=this.createFilterFn(f,g.value);a=e.store.findBy(function(a){return-1===h.indexOfId(a.getId())&&j(a)}),a=-1===a?!1:e.store.getAt(a)}else a=e.store.findRecord(f,g.value);a&&(b=a.get(f),c=b.length,d=g.value.length,i.highlightItem(i.getNode(a)),0!==d&&d!==c&&(g.value=b,e.selectText(d,b.length)))},onItemListClick:function(a){var b=this,c=a.getTarget(".x-boxselect-item"),d=c?a.getTarget(".x-boxselect-item-close"):!1;b.readOnly||b.disabled||(a.stopPropagation(),c?(d?(b.removeByListItemNode(c),b.valueStore.getCount()>0&&b.fireEvent("select",b,b.valueStore.getRange())):b.toggleSelectionByListItemNode(c,a.shiftKey),b.inputEl.focus()):(b.selectionModel.getCount()>0&&(b.selectionModel.setLastFocused(null),b.selectionModel.deselectAll()),b.triggerOnClick&&b.onTriggerClick()))},getMultiSelectItemMarkup:function(){var a=this;return a.multiSelectItemTpl||(a.labelTpl?(Ext.isString(a.labelTpl)||Ext.isArray(a.labelTpl))&&(a.labelTpl=Ext.create("Ext.XTemplate",a.labelTpl)):a.labelTpl=Ext.create("Ext.XTemplate","{[values."+a.displayField+"]}"),a.multiSelectItemTpl=['<tpl for=".">','<li class="x-boxselect-item ','<tpl if="this.isSelected(values.'+a.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : values.'+a.displayField+']}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function(b){var c=a.valueStore.findExact(a.valueField,b);return c>=0?a.selectionModel.isSelected(a.valueStore.getAt(c)):!1},getItemLabel:function(b){return a.getTpl("labelTpl").apply(b)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function(){var a,b=this,c=b.itemList;if(c){for(;null!=(a=b.inputElCt.prev());)a.remove();b.inputElCt.insertHtml("beforeBegin",b.getMultiSelectItemMarkup())}Ext.Function.defer(function(){b.picker&&b.isExpanded&&b.alignPicker(),b.hasFocus&&b.inputElCt&&b.listWrapper&&b.inputElCt.scrollIntoView(b.listWrapper)},15)},getRecordByListItemNode:function(a){for(var b=this,c=0,d=b.itemList.dom.firstChild;d&&d.nextSibling&&d!=a;)c++,d=d.nextSibling;return c=d==a?c:!1,c===!1?!1:b.valueStore.getAt(c)},toggleSelectionByListItemNode:function(a,b){var c=this,d=c.getRecordByListItemNode(a),e=c.selectionModel;d&&(e.isSelected(d)?(e.isFocused(d)&&e.setLastFocused(null),e.deselect(d)):e.select(d,b))},removeByListItemNode:function(a){var b=this,c=b.getRecordByListItemNode(a);c&&(b.valueStore.remove(c),b.setValue(b.valueStore.getRange()))},getRawValue:function(){var a,b=this,c=b.inputEl;return b.inputEl=!1,a=b.callParent(arguments),b.inputEl=c,a},setRawValue:function(a){var b,c=this,d=c.inputEl;return c.inputEl=!1,b=c.callParent([a]),c.inputEl=d,b},addValue:function(a){var b=this;a&&b.setValue(Ext.Array.merge(b.value,Ext.Array.from(a)))},removeValue:function(a){var b=this;a&&b.setValue(Ext.Array.difference(b.value,Ext.Array.from(a)))},setValue:function(a,b,c){var d,e,f,g,h=this,i=h.valueStore,j=h.valueField,k=[];for(Ext.isEmpty(a)&&(a=null),Ext.isString(a)&&h.multiSelect&&(a=a.split(h.delimiter)),a=Ext.Array.from(a,!0),f=0,e=a.length;e>f;f++)d=a[f],d&&d.isModel||(g=i.findExact(j,d),g>=0?a[f]=i.getAt(g):(g=h.findRecord(j,d),g||(h.forceSelection?k.push(d):(g={},g[h.valueField]=d,g[h.displayField]=d,g=new h.valueStore.model(g))),g&&(a[f]=g)));if(c!==!0&&k.length>0&&"remote"===h.queryMode){var l={};return l[h.valueParam||h.valueField]=k.join(h.delimiter),h.store.load({params:l,callback:function(){h.itemList&&h.itemList.unmask(),h.setValue(a,b,!0),h.autoSize(),h.lastQuery=!1}}),!1}if(!h.multiSelect&&a.length>0){for(f=a.length-1;f>=0;f--)if(a[f].isModel){a=a[f];break}Ext.isArray(a)&&(a=a[a.length-1])}return h.callParent([a,b])},getValueRecords:function(){return this.valueStore.getRange()},getSubmitData:function(){var a=this,b=a.callParent(arguments);return a.multiSelect&&a.encodeSubmitValue&&b&&b[a.name]&&(b[a.name]=Ext.encode(b[a.name])),b},mimicBlur:function(){var a=this;a.selectOnTab&&a.picker&&a.picker.highlightedItem&&(a.inputEl.dom.value=""),a.callParent(arguments)},assertValue:function(){var a=this,b=a.inputEl.dom.value,c=Ext.isEmpty(b)?!1:a.findRecordByDisplay(b),d=!1;c||a.forceSelection||!a.createNewOnBlur||Ext.isEmpty(b)?c&&(d=c):d=b,d&&a.addValue(d),a.inputEl.dom.value="",a.collapse()},checkChange:function(){if(!this.suspendCheckChange&&!this.isDestroyed){var a=this,b=a.valueStore,c=a.lastValue||"",d=a.valueField,e=Ext.Array.map(Ext.Array.from(a.value),function(a){return a.isModel?a.get(d):a},this).join(this.delimiter),f=a.isEqual(e,c);(!f||e.length>0&&b.getCount()<e.length)&&(b.suspendEvents(),b.removeAll(),Ext.isArray(a.valueModels)&&b.add(a.valueModels),b.resumeEvents(),b.fireEvent("datachanged",b),f||(a.lastValue=e,a.fireEvent("change",a,e,c),a.onChange(e,c)))}},isEqual:function(a,b){var c,d,e,f,g=Ext.Array.from,h=this.valueField;if(a=g(a),b=g(b),d=a.length,d!==b.length)return!1;for(c=0;d>c;c++)if(e=a[c].isModel?a[c].get(h):a[c],f=b[c].isModel?b[c].get(h):b[c],e!==f)return!1;return!0},applyEmptyText:function(){var a,b,c=this,d=c.emptyText;c.rendered&&d&&(b=Ext.isEmpty(c.value)&&!c.hasFocus,a=c.inputEl,b?(a.dom.value="",c.emptyEl.update(d),c.emptyEl.addCls(c.emptyCls),c.emptyEl.removeCls(c.emptyInputCls),c.listWrapper.addCls(c.emptyCls),c.inputEl.addCls(c.emptyInputCls)):(c.emptyEl.addCls(c.emptyInputCls),c.emptyEl.removeCls(c.emptyCls),c.listWrapper.removeCls(c.emptyCls),c.inputEl.removeCls(c.emptyInputCls)),c.autoSize())},preFocus:function(){var a=this,b=a.inputEl,c=(a.emptyText,""==b.dom.value);a.emptyEl.addCls(a.emptyInputCls),a.emptyEl.removeCls(a.emptyCls),a.listWrapper.removeCls(a.emptyCls),a.inputEl.removeCls(a.emptyInputCls),(a.selectOnFocus||c)&&b.dom.select()},onFocus:function(){var a=this,b=a.focusCls,c=a.itemList;b&&c&&c.addCls(b),a.callParent(arguments)},onBlur:function(){var a=this,b=a.focusCls,c=a.itemList;b&&c&&c.removeCls(b),a.callParent(arguments)},renderActiveError:function(){var a=this,b=a.invalidCls,c=a.itemList,d=a.hasActiveError();b&&c&&c[d?"addCls":"removeCls"](a.invalidCls+"-field"),a.callParent(arguments)},autoSize:function(){var a=this;return a.grow&&a.rendered&&(a.autoSizing=!0,a.updateLayout()),a},afterComponentLayout:function(){var a=this;a.autoSizing&&(height=a.getHeight(),height!==a.lastInputHeight&&(a.isExpanded&&a.alignPicker(),a.fireEvent("autosize",a,height),a.lastInputHeight=height,delete a.autoSizing))}}),Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",waitForOuterWidthInDom:!0,beginLayout:function(a){var b=this,c=b.owner;b.callParent(arguments),a.inputElCtContext=a.getEl("inputElCt"),c.inputElCt.setStyle("width",""),b.skipInputGrowth=!c.grow||!c.multiSelect},beginLayoutFixed:function(a){var b=this,c=a.target;c.triggerEl.setStyle("height","24px"),b.callParent(arguments),a.heightModel.fixed&&a.lastBox&&(c.listWrapper.setStyle("height",a.lastBox.height+"px"),c.itemList.setStyle("height","100%"))},publishInnerWidth:function(){}}),Ext.define("App.ux.LiveSnomedProblemMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"livesnomedproblemmultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("problem_search")+"...",queryMode:"remote",labelTpl:"{Term} &#60;{ConceptId}&#62;",forceSelection:!1,displayField:"Term",valueField:"ConceptId",pageSize:25,enableReset:!1,minChars:3,listConfig:{tpl:['<tpl for=".">','<div role="option" class="x-boundlist-item">({CodeType}) {Term}  &#60;{ConceptId}&#62;</div>',"</tpl>"]},initComponent:function(){var a=this,b="SnomedProblemsMultipleSearchModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"ConceptId",type:"string"},{name:"Term",type:"string"},{name:"CodeType",type:"string"},{name:"OCCURRENCE",type:"int"}],proxy:{idProperty:"ConceptId",type:"direct",api:{read:"SnomedCodes.liveProblemCodeSearch"},reader:{totalProperty:"totals",root:"data"}}}),a.store=Ext.create("Ext.data.Store",{model:"SnomedProblemsMultipleSearchModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{Term}<span style="font-weight: normal"> ({ConceptId}) </span></h3></div>'}},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveRXNORMAllergyMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"liverxnormallergymultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("allergy_search")+"...",queryMode:"remote",labelTpl:"{STR} &#60;{RXCUI}&#62;",forceSelection:!1,displayField:"STR",valueField:"STR",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="RXNORMAllergyMultipleSearchModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"RXCUI",type:"auto"},{name:"CODE",type:"auto"},{name:"STR",type:"auto"},{name:"DST",type:"auto"},{name:"DRT",type:"auto"},{name:"DDF",type:"auto"},{name:"DDFA",type:"auto"},{name:"RXN_QUANTITY",type:"auto"},{name:"SAB",type:"auto"},{name:"RXAUI",type:"auto"},{name:"CodeType",defaultValue:"RXNORM"},{name:"occurrences",type:"int"}],proxy:{type:"direct",api:{read:"Rxnorm.getRXNORMAllergyLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"RXNORMAllergyMultipleSearchModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item"><h3>{STR}<span style="font-weight: normal"> ({RXCUI}) ({occurrences})</span></h3></div>'}},pageSize:25}),a.callParent(),a.on("select",a.addOccurrence)},addOccurrence:function(a,b){b.length>0&&""!==b[0].get("RXCUI")&&Rxnorm.addOccurrence(b[0].get("RXCUI"))}}),Ext.define("App.ux.LiveRXNORMMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",requires:["App.model.administration.MedicationInstruction"],xtype:"liverxnormmultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("medication_search")+"...",queryMode:"remote",labelTpl:"{STR} &#60;{RXCUI}&#62;",forceSelection:!1,displayField:"STR",valueField:"STR",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="RXNORMMultipleSearchModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"RXCUI",type:"string"},{name:"CODE",type:"string"},{name:"NDC",type:"string"},{name:"STR",type:"string",convert:function(a){var b=/\(.*\) | \(.*\)|\(.*\)/g;return a.replace(b,"")}},{name:"DST",type:"auto"},{name:"DRT",type:"auto"},{name:"DDF",type:"auto"},{name:"DDFA",type:"auto"},{name:"RXN_QUANTITY",type:"auto"},{name:"SAB",type:"auto"},{name:"RXAUI",type:"auto"},{name:"CodeType",defaultValue:"RXNORM"},{name:"occurrences",type:"int"}],proxy:{type:"direct",api:{read:"Rxnorm.getRXNORMLiveSearch"},reader:{totalProperty:"totals",root:"rows"}}}),a.store=Ext.create("Ext.data.Store",{model:"RXNORMMultipleSearchModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"...",getInnerTpl:function(){return'<div class="search-item">{STR} ( <b>RxNorm:</b> {RXCUI} <b>NDC:</b> {NDC} ) ({occurrences})</div>'}},pageSize:25}),a.callParent(),a.on("select",a.addOccurrence)},addOccurrence:function(a,b){b.length>0&&""!==b[0].get("RXCUI")&&Rxnorm.addOccurrence(b[0].get("RXCUI"))}}),Ext.define("App.ux.LiveProviderMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"liveprovidermultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("select_provider")+"...",queryMode:"remote",labelTpl:"{option_name}",forceSelection:!1,displayField:"option_name",valueField:"id",pageSize:25,enableReset:!0,initComponent:function(){var a=this,b="ActiveProvidersMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"title",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"fullname",type:"string",convert:function(a,b){return b.data.title+" "+b.data.lname+", "+b.data.fname+" "+b.data.mname}},{name:"option_name",type:"string",convert:function(a,b){return b.data.title+" "+b.data.lname+", "+b.data.fname+" "+b.data.mname}},{name:"option_value",type:"int",convert:function(a,b){return b.data.id}}],proxy:{idProperty:"ConceptId",type:"direct",api:{read:"User.getActiveProviders"}}}),a.store=Ext.create("Ext.data.Store",{model:"ActiveProvidersMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveSexMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"sexmultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("sex_search")+"...",queryMode:"remote",forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="SexMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:19}}}),a.store=Ext.create("Ext.data.Store",{model:"SexMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveEthnicityMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"ethnicitymultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("ethnicity_search")+"...",queryMode:"remote",minChars:3,forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="EthnicityMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:59}}}),a.store=Ext.create("Ext.data.Store",{model:"EthnicityMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveRaceMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"racemultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("race_search")+"...",queryMode:"remote",forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="RaceMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:14}}}),a.store=Ext.create("Ext.data.Store",{model:"RaceMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveMaritalMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"maritalmultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("patient_marital_status")+"...",queryMode:"remote",forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="MaritalMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:12}}}),a.store=Ext.create("Ext.data.Store",{model:"MaritalMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LiveLanguageMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"languagemultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("language_search")+"...",queryMode:"remote",forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="LangMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:10}}}),a.store=Ext.create("Ext.data.Store",{model:"LangMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LivePhoneCommunicationMultipleSearch",{extend:"App.ux.form.fields.BoxSelect",xtype:"communicationmultiple",allowBlank:!0,editable:!0,typeAhead:!1,autoSelect:!1,emptyText:_("communication")+"...",queryMode:"remote",forceSelection:!1,displayField:"option_name",valueField:"option_value",pageSize:25,enableReset:!1,initComponent:function(){var a=this,b="CommunicationMultipleModel"+a.id;a.enableReset&&(a.trigger2Cls="x-form-clear-trigger",a.onTrigger2Click=function(){a.reset()}),Ext.define(b,{extend:"Ext.data.Model",fields:[{name:"option_name",type:"string"},{name:"option_value",type:"string"}],proxy:{type:"direct",api:{read:"CombosData.getOptionsByListId"},extraParams:{list_id:132}}}),a.store=Ext.create("Ext.data.Store",{model:"CommunicationMultipleModel"+a.id,pageSize:25,autoLoad:!1}),Ext.apply(this,{store:a.store,listConfig:{loadingText:_("searching")+"..."},pageSize:25}),a.callParent()}}),Ext.define("App.ux.LabResultValuesFilter",{extend:"Ext.form.FieldContainer",alias:"widget.labresultvalues",fieldLabel:_("lab_results"),labelAlign:"top",layout:"anchor",initComponent:function(){var a=this;a.addEvents("addItem"),a.addEvents("removeItem"),a.addEvents("reset"),Ext.define("ReportLabResultValueFilterModel",{extend:"Ext.data.Model",fields:[{name:"code",type:"string"},{name:"code_text",type:"string"}],proxy:{type:"direct",api:{read:"LabResultsValuesFilter.getDistinctResults"},reader:{root:"rows",totalProperty:"totals"}},idProperty:"code"}),a.items=[{xtype:"combo",store:Ext.create("Ext.data.Store",{model:"ReportLabResultValueFilterModel",autoLoad:!1}),anchor:"100%",emptyText:_("select_lab_result"),itemId:"LabResultValuesFilterLabField",displayField:"code_text",valueField:"code",editable:!1,submitValue:!1},{xtype:"combo",store:Ext.create("Ext.data.Store",{fields:["name","value"],data:[{name:"More than",value:">"},{name:"Less than",value:"<"},{name:"Equal to",value:"="}]}),anchor:"100%",editable:!1,emptyText:_("select_comparison"),itemId:"LabResultValuesFilterOperatorField",displayField:"name",valueField:"value",submitValue:!1},{xtype:"textfield",anchor:"100%",itemId:"LabResultValuesFilterValueField",emptyText:_("lab_enter_value"),submitValue:!1},{xtype:"container",layout:"hbox",anchor:"100%",height:30,items:[{xtype:"button",text:"Reset Labs",flex:1,listeners:{click:a.reset,scope:a}},{xtype:"button",text:"Add Lab",flex:1,listeners:{click:a.addFieldValue,scope:a}}]},{xtype:"fieldcontainer",itemId:"LabResultValuesFilterFieldsContainer",anchor:"100%"}],a.callParent()
},addFieldValue:function(){var a,b=this,c=b.getComponent("LabResultValuesFilterLabField").getValue(),d=b.getComponent("LabResultValuesFilterLabField").findRecordByValue(c).get("code_text"),e=b.getComponent("LabResultValuesFilterOperatorField").getValue(),f=b.getComponent("LabResultValuesFilterValueField").getValue(),g=b.getComponent("LabResultValuesFilterFieldsContainer");return""==c||""==e||""==f?void app.msg(_("oops"),"Laboratory Result, Operator, and Value are required",!0):(g.add({xtype:"checkboxfield",boxLabel:Ext.String.format("{0} {1} {2}",d,e,f),name:b.name,checked:!0,inputValue:{lab_code:c,lab_name:d,operator:e,value:f},listeners:{change:function(a,c){c||(Ext.Function.defer(function(){a.destroy()},200),b.fireEvent("removeItem",b,a,c))}}}),a={lab_code:c,lab_name:d,operator:e,value:f},void b.fireEvent("addItem",b,a))},reset:function(){this.getComponent("LabResultValuesFilterLabField").reset(),this.getComponent("LabResultValuesFilterOperatorField").reset(),this.getComponent("LabResultValuesFilterValueField").reset(),this.fireEvent("reset",me)}}),Ext.define("App.view.patient.Search",{extend:"App.ux.RenderPanel",pageTitle:_("patient_search"),pageLayout:"border",itemId:"PatientSearchPanel",requires:["Ext.form.field.Date","Ext.ux.SlidingPager","App.ux.combo.ActiveProviders","App.ux.LiveSnomedProblemMultipleSearch","App.ux.LiveRXNORMAllergyMultipleSearch","App.ux.LiveRXNORMMultipleSearch","App.ux.LiveProviderMultipleSearch","App.ux.LiveSexMultipleSearch","App.ux.LiveEthnicityMultipleSearch","App.ux.LiveRaceMultipleSearch","App.ux.LiveMaritalMultipleSearch","App.ux.LiveLanguageMultipleSearch","App.ux.LivePhoneCommunicationMultipleSearch","App.ux.LabResultValuesFilter"],initComponent:function(){var a=this;a.search_store=Ext.create("App.store.patient.PatientSearch",{remoteSort:!0}),a.pageBody=[{xtype:"form",region:"west",collapsible:!0,border:!0,split:!0,bodyPadding:5,width:300,itemId:"PatientSearchFrom",defaults:{enableReset:!0,anchor:"100%",labelAlign:"top"},items:[{xtype:"datefield",name:"date_from",fieldLabel:_("date_from"),labelWidth:100,format:g("date_display_format"),allowBlank:!1,submitFormat:"Y-m-d",value:new Date},{xtype:"datefield",name:"date_to",fieldLabel:_("date_to"),labelWidth:100,allowBlank:!1,format:g("date_display_format"),submitFormat:"Y-m-d",value:new Date},{xtype:"fieldset",title:_("patient"),defaults:{enableReset:!0,anchor:"100%",labelAlign:"top"},items:[{xtype:"textfield",name:"lname",emptyText:_("last_name")},{xtype:"textfield",name:"fname",emptyText:_("first_name")},{xtype:"container",layout:"hbox",margin:"0 0 5 0",items:[{xtype:"numberfield",flex:1,name:"ageFrom",emptyText:_("ageFrom")},{xtype:"numberfield",flex:1,name:"ageTo",emptyText:_("ageTo")}]},{xtype:"racemultiple",name:"race"},{xtype:"ethnicitymultiple",name:"ethnicity"},{xtype:"sexmultiple",name:"sex"},{xtype:"communicationmultiple",name:"phone_publicity"},{xtype:"maritalmultiple",name:"marital_status"},{xtype:"languagemultiple",name:"language"}]},{xtype:"liveprovidermultiple",name:"providers"},{xtype:"liverxnormallergymultiple",name:"allergy_codes",displayField:"STR",valueField:"RXCUI"},{xtype:"livesnomedproblemmultiple",name:"problem_codes"},{xtype:"liverxnormmultiple",name:"medication_codes",displayField:"STR",valueField:"RXCUI"},{xtype:"labresultvalues",submitValue:!0,name:"lab_results"}],bbar:[{text:_("search"),itemId:"PatientSearchFromSearchBtn",flex:1}]},{xtype:"grid",region:"center",frame:!0,title:_("results"),itemId:"PatientSearchGrid",store:a.search_store,columns:[{text:_("record_number"),dataIndex:"pubpid"},{text:_("date"),dataIndex:"service_date"},{text:_("patient"),dataIndex:"lname",renderer:function(a,b,c){return Ext.String.format("{0}, {1} {2}",c.get("lname"),c.get("fname"),c.get("mname"))}},{text:_("sex"),dataIndex:"sex",renderer:function(a){return"M"==a?"Male":"F"==a?"Female":a}},{text:_("language"),dataIndex:"language"},{text:_("dob")+" (age)",dataIndex:"DOB",renderer:function(a,b,c){return Ext.String.format("{0} ({1})",c.get("DOBFormatted"),c.getAge(c.get("DOB")))}},{text:_("communication"),dataIndex:"phone_publicity",renderer:function(a){return"01"==a?"No reminder/recall":"02"==a?"Reminder/recall - any method":"03"==a?"Reminder/recall - no calls":"04"==a?"Reminder only - any method":"05"==a?"Reminder only - no calls":"06"==a?"Recall only - any method":"07"==a?"Recall only - no calls":"08"==a?"Reminder/recall - to provider":"09"==a?"Reminder to provider":"10"==a?"Only reminder to provider no recall":"11"==a?"Recall to provider":"12"==a?"Only recall to provider no reminder":a}},{text:_("marital_status"),dataIndex:"marital_status",renderer:function(a){return"M"==a?"Married":"S"==a?"Single":"D"==a?"Divorced":"W"==a?"Widowed":"A"==a?"Separated":"P"==a?"Domestic Partner":"O"==a?"Other":a}},{text:_("race"),dataIndex:"race",renderer:function(a){return"1002-5"==a?"American Indian or Alaska Native":"2028-9"==a?"Asian":"2054-5"==a?"Black or African American":"2076-8"==a?"Native Hawaiian or Other Pacific Islander":"2106-3"==a?"White":"ASKU"==a?"Declined to specify":"2131-1"==a?"Other Race":a}},{text:_("ethnicity"),dataIndex:"ethnicity",renderer:function(a){return"H"==a?"Hispanic or Latino":"N"==a?"Not Hispanic or Latino":"ASKU"==a?"Declined to specify":"U"==a?"Unknown":a}},{text:_("providers"),dataIndex:"providers",width:200},{text:_("allergies"),dataIndex:"allergies",width:200},{text:_("problems"),dataIndex:"problems",width:200},{text:_("medications"),dataIndex:"medications",width:200},{text:_("lab_results"),dataIndex:"lab_results",width:200}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:a.search_store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}],a.callParent(arguments)}}),Ext.define("App.model.patient.PatientSearch",{extend:"Ext.data.Model",fields:[{name:"pid",type:"int"},{name:"title",type:"string"},{name:"fname",type:"string"},{name:"mname",type:"string"},{name:"lname",type:"string"},{name:"sex",type:"string"},{name:"DOB",type:"date",dateFormat:"Y-m-d H:i:s",defaultValue:"0000-00-00 00:00:00"},{name:"DOBFormatted",type:"string",persist:!1,convert:function(a,b){return Ext.Date.format(b.get("DOB"),g("date_display_format"))}},{name:"marital_status",type:"string",comment:"marital status"},{name:"pubpid",type:"string",index:!0,comment:"external reference id"},{name:"race",type:"string",comment:"race"},{name:"secondary_race",type:"string",comment:"secondary race"},{name:"ethnicity",type:"string",comment:"ethnicity"},{name:"language",type:"string",comment:"language"},{name:"first_visit_date",type:"date",dataType:"date",dateFormat:"Y-m-d"},{name:"administrative_status",type:"string",comment:"active | inactive | merged"},{name:"phone_publicity",type:"string"},{name:"service_date",ype:"date",dateFormat:"Y-m-d H:i:s"},{name:"providers",type:"string"},{name:"allergies",type:"string"},{name:"problems",type:"string"},{name:"medications",type:"string"},{name:"lab_results",type:"string"}],idProperty:"pid",proxy:{type:"direct",api:{read:"Patient.search"},reader:{root:"data"}},getAge:function(a){var b=new Date,c=b.getFullYear()-a.getFullYear(),d=b.getMonth()-a.getMonth();return(0>d||0===d&&b.getDate()<a.getDate())&&c--,c}}),Ext.define("App.store.patient.PatientSearch",{extend:"Ext.data.Store",model:"App.model.patient.PatientSearch"}),Ext.define("App.model.administration.LegalLetterSignature",{extend:"Ext.data.Model",table:{name:"legal_letters_signatures"},fields:[{name:"id",type:"int"},{name:"pid",type:"int",index:!0},{name:"letter_id",type:"int",index:!0},{name:"document_id",type:"int",index:!0},{name:"letter_version",type:"string",index:!0,len:20},{name:"signature",type:"string",dataType:"TEXT"},{name:"signature_ip",type:"string",len:80},{name:"signature_date",type:"date"},{name:"signature_hash",type:"string",len:128},{name:"letter_title",type:"string",store:!1},{name:"letter_content",type:"string",store:!1},{name:"document_code",type:"string",store:!1},{name:"signer_fname",type:"string",store:!1},{name:"signer_mname",type:"string",store:!1},{name:"signer_lname",type:"string",store:!1}],proxy:{type:"direct",api:{read:"LegalLetters.getLegalLetterSignatures",create:"LegalLetters.addLegalLetterSignature"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.store.administration.LegalLetterSignatures",{model:"App.model.administration.LegalLetterSignature",extend:"Ext.data.Store"}),Ext.define("App.model.patient.SocialPsychologicalBehavioral",{extend:"Ext.data.Model",table:{name:"patient_social_psycho_behavioral"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"pay_basics",type:"int"},{name:"edu_highest_grade",type:"int"},{name:"stress_level",type:"int"},{name:"stress_sleep",type:"int"},{name:"interest_pleasure",type:"int"},{name:"feeling_down_depressed",type:"int"},{name:"patient_health_score",type:"int",comment:"interest_pleasure + feeling_down_depressed"},{name:"exercise_past_days_amount",type:"int"},{name:"exercise_past_days_minutes",type:"int"},{name:"drink_often",type:"int"},{name:"drink_per_day",type:"int"},{name:"drink_more_than_6",type:"int"},{name:"patient_drink_score",type:"int",comment:"drink_often + drink_per_day + patient_health_score"},{name:"marital_status",type:"int"},{name:"phone_family",type:"int"},{name:"together_friends",type:"int"},{name:"religious_services",type:"int"},{name:"belong_organizations",type:"int"},{name:"patient_isolation_score",type:"int",comment:"marital_status + phone_family + together_friends + religious_services + belong_organizations"},{name:"abused_by_partner",type:"int"},{name:"afraid_of_partner",type:"int"},{name:"raped_by_partner",type:"int"},{name:"physically_hurt_by_partner",type:"int"},{name:"patient_humiliation_score",type:"int",comment:"abused_by_partner + afraid_of_partner + raped_by_partner + physically_hurt_by_partner + patient_humiliation_score"},{name:"create_uid",type:"int",comment:"user ID who created the record"},{name:"update_uid",type:"int",comment:"user ID who updated the record"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"SocialPsychologicalBehavioral.getSocialPsychologicalBehaviors",create:"SocialPsychologicalBehavioral.addSocialPsychologicalBehavior",update:"SocialPsychologicalBehavioral.updateSocialPsychologicalBehavior"}}}),Ext.define("App.store.patient.SocialPsychologicalBehavioral",{extend:"Ext.data.Store",model:"App.model.patient.SocialPsychologicalBehavioral"}),Ext.define("App.view.patient.MiniMentalStateExam",{extend:"Ext.grid.Panel",requires:[],itemId:"MiniMentalStateExamGridPanel",xtype:"minimentalstateexamgridpanel",title:_("mini_mental"),tbar:[{text:_("mini_mental"),iconCls:"icoAdd",action:"encounterRecordAdd",itemId:"MiniMentalStateExamAddBtn"}],initComponent:function(){var a=this;a.store=Ext.create("App.store.patient.MiniMentalStateExams",{remoteFilter:!0}),a.columns=[{xtype:"datecolumn",text:_("observation_date"),dataIndex:"create_date",format:"F j, Y",width:110},{text:_("total_score"),dataIndex:"total_score",width:110,renderer:function(a){return a}},{text:_("questionary"),dataIndex:"id",flex:1,renderer:function(a,b,c){var d='<div style="display: table">';return d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("orientation_time"),c.get("orientation_time_score"),_("notes"),c.get("orientation_time_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("orientation_place"),c.get("orientation_place_score"),_("notes"),c.get("orientation_place_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("registration"),c.get("registration_score"),_("notes"),c.get("registration_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("attention_calculation"),c.get("attention_calculation_score"),_("notes"),c.get("attention_calculation_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("recall"),c.get("recall_score"),_("notes"),c.get("recall_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("language"),c.get("language_score"),_("notes"),c.get("language_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("repetition"),c.get("repetition_score"),_("notes"),c.get("repetition_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"> - {2}: {3}</div></div>',_("complex_commands"),c.get("complex_commands_score"),_("notes"),c.get("complex_commands_notes")),d+=Ext.String.format('<div style="display: table-row"><div style="display: table-cell; padding-bottom: 3px;"><b>{0}: </b></div><div style="display: table-cell; padding-left: 5px;">{1}</div> <div style="display: table-cell"></div></div>',_("assess_lvl"),c.get("assess_lvl")),d+="</div>"}}],a.callParent()}}),Ext.define("App.model.patient.MiniMentalStateExam",{extend:"Ext.data.Model",table:{name:"patient_mini_mental_exams"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"orientation_time_score",type:"int"},{name:"orientation_place_score",type:"int"},{name:"registration_score",type:"int"},{name:"attention_calculation_score",type:"int"},{name:"recall_score",type:"int"},{name:"language_score",type:"int"},{name:"repetition_score",type:"int"},{name:"complex_commands_score",type:"int"},{name:"total_score",type:"int"},{name:"orientation_time_notes",type:"string",dataType:"text"},{name:"orientation_place_notes",type:"string",dataType:"text"},{name:"registration_notes",type:"string",dataType:"text"},{name:"attention_calculation_notes",type:"string",dataType:"text"},{name:"recall_notes",type:"string",dataType:"text"},{name:"language_notes",type:"string",dataType:"text"},{name:"repetition_notes",type:"string",dataType:"text"},{name:"complex_commands_notes",type:"string",dataType:"text"},{name:"assess_lvl",type:"string",len:10},{name:"create_uid",type:"int",comment:"user ID who created the record"},{name:"update_uid",type:"int",comment:"user ID who updated the record"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"MiniMentalStateExam.getMiniMentalStateExams",create:"MiniMentalStateExam.addMiniMentalStateExam",update:"MiniMentalStateExam.updateMiniMentalStateExam"}}}),Ext.define("App.store.patient.MiniMentalStateExams",{extend:"Ext.data.Store",model:"App.model.patient.MiniMentalStateExam"}),Ext.define("App.model.administration.EncounterSnippet",{extend:"Ext.data.Model",table:{name:"soap_snippets"},fields:[{name:"id",type:"string"},{name:"uid",type:"int",index:!0},{name:"specialty_id",type:"int",index:!0},{name:"index",type:"int"},{name:"description",type:"string",len:80},{name:"category",type:"string",len:50},{name:"subjective",type:"string",dataType:"text"},{name:"objective",type:"string",dataType:"text"},{name:"assessment",type:"string",dataType:"text"},{name:"instructions",type:"string",dataType:"text"},{name:"diagnoses",type:"string",dataType:"text"}],proxy:{type:"direct",api:{read:"Snippets.getSoapSnippets",create:"Snippets.addSoapSnippets",update:"Snippets.updateSoapSnippets",destroy:"Snippets.deleteSoapSnippets"}}}),Ext.define("App.store.administration.EncounterSnippets",{model:"App.model.administration.EncounterSnippet",extend:"Ext.data.Store"}),Ext.define("App.controller.Speak",{extend:"Ext.app.Controller",refs:[],init:function(){var a=this;a.voices=[],a.voice_enabled=!1,a.voice_lang="en",a.voice_gender="female",SpeechSynthesisUtterance&&(a.voices=window.speechSynthesis.getVoices())},speak:function(a){var b,c,d=this;SpeechSynthesisUtterance&&(c=window.speechSynthesis.getVoices(),b=new SpeechSynthesisUtterance,b.voice="female"===d.voice_gender?c[32]:c[0],b.text=a,window.speechSynthesis.speak(b))}}),Ext.define("App.model.patient.encounter.Addendum",{extend:"Ext.data.Model",table:{name:"encounter_addenda"},fields:[{name:"id",type:"int"},{name:"pid",type:"int"},{name:"eid",type:"int"},{name:"source",type:"string",len:60},{name:"notes",type:"string",dataType:"TEXT"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"created_by_fname",type:"string",store:!1},{name:"created_by_mname",type:"string",store:!1},{name:"created_by_lname",type:"string",store:!1},{name:"created_by",type:"string",convert:function(a,b){return Ext.String.format("{0}, {1} {2}",b.get("created_by_lname"),b.get("created_by_fname"),b.get("created_by_mname"))},store:!1}],proxy:{type:"direct",api:{read:"EncounterAddenda.getEncounterAddenda",create:"EncounterAddenda.addEncounterAddendum",update:"EncounterAddenda.updateEncounterAddendum",destroy:"EncounterAddenda.destroyEncounterAddendum"}}}),Ext.define("App.store.patient.encounter.Addenda",{model:"App.model.patient.encounter.Addendum",extend:"Ext.data.Store",autoLoad:!1}),Ext.define("App.model.patient.ProgressNotesHistory",{extend:"Ext.data.Model",fields:[{name:"service_date",type:"date"},{name:"brief_description",type:"string"},{name:"subjective",type:"string"},{name:"objective",type:"string"},{name:"assessment",type:"string"},{name:"plan",type:"string"},{name:"addenda",type:"string"},{name:"instructions",type:"string"},{name:"specialty_id",type:"int"},{name:"provider_uid",type:"int"},{name:"provider_title",type:"string"},{name:"provider_lname",type:"string"},{name:"provider_fname",type:"string"},{name:"provider_mname",type:"string"},{name:"provider_npi",type:"string"},{name:"provider",type:"string",convert:function(a,b){return Ext.String.format("{0}, {1} {2} - {3}",b.get("provider_lname"),b.get("provider_fname"),b.get("provider_mname"),b.get("provider_npi"))}},{name:"progress",type:"string",convert:function(a,b){var c=b.get("provider_uid")===app.user.id?"background-color:#ffff003d;":"",d='<div style="width:90%; display: inline-block; font-size: 125%; padding: 5px 0 5px 5px; color: black; '+c+'">';return d+="<b>"+_("provider")+":</b> "+Ext.String.htmlDecode(b.get("provider"))+"<br>",d+="<b>"+_("service_date")+":</b> "+Ext.Date.format(b.get("service_date"),"F j, Y, g:i a (l)")+"<br>",d+="--------------------- <br>",d+="<b>"+_("chief_complaint")+":</b> "+Ext.String.htmlDecode(b.get("brief_description"))+"<br>",d+="--------------------- <br>",d+="<b>"+_("subjective")+":</b> "+Ext.String.htmlDecode(b.get("subjective"))+"<br>",d+="<b>"+_("objective")+":</b> "+Ext.String.htmlDecode(b.get("objective"))+"<br>",d+="<b>"+_("assessment")+":</b> "+Ext.String.htmlDecode(b.get("assessment"))+"<br>",d+="<b>"+_("plan")+":</b> "+Ext.String.htmlDecode(b.get("plan"))+"<br>","NONE"!==b.get("addenda")&&(d+="<b>"+_("addenda")+":</b> "+Ext.String.htmlDecode(b.get("addenda"))+"<br>"),d+"</div>"}}],proxy:{type:"direct",api:{read:"Encounter.getSoapHistory"}}}),Ext.define("App.store.patient.ProgressNotesHistory",{extend:"Ext.data.TreeStore",requires:["App.model.patient.ProgressNotesHistory"],model:"App.model.patient.ProgressNotesHistory",remoteFilter:!1}),Ext.define("App.view.administration.ContentManagement",{extend:"App.ux.RenderPanel",pageTitle:_("content_management"),itemId:"AdministrationContentManagement",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.ContentManagement"),a.grid=Ext.create("Ext.grid.Panel",{itemId:"ContentManagementGrid",store:a.store,title:_("content_management"),columnsLines:!0,tbar:[{xtype:"button",iconCls:"icoAdd",itemId:"ContentManagementAddBtn",text:_("add_content")}],columns:[{xtype:"griddeletecolumn",acl:!0,width:20},{text:_("content_type"),dataIndex:"content_type",flex:1},{text:_("content_lang"),dataIndex:"content_lang",flex:1},{text:_("content_body"),dataIndex:"content_body",flex:1},{text:_("content_version"),dataIndex:"content_version",flex:1}],bbar:{xtype:"pagingtoolbar",pageSize:50,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.grid],a.callParent(arguments)}}),Ext.define("App.model.administration.ContentManagement",{extend:"Ext.data.Model",table:{name:"content_management"},fields:[{name:"id",type:"int"},{name:"content_type",type:"string",len:45,index:!0},{name:"content_lang",type:"string",len:3,index:!0},{name:"content_body",type:"string",dataType:"mediumtext"},{name:"is_html",type:"bool"},{name:"content_version",type:"string",len:10,index:!0}],proxy:{type:"direct",api:{read:"ContentManagement.getContentManagements",create:"ContentManagement.addContentManagement",update:"ContentManagement.updateContentManagement",destroy:"ContentManagement.destroyContentManagement"},reader:{root:"data"},writer:{writeAllFields:!0},remoteGroup:!1}}),Ext.define("App.store.administration.ContentManagement",{extend:"Ext.data.Store",requires:["App.model.administration.ContentManagement"],model:"App.model.administration.ContentManagement"}),Ext.define("App.model.administration.DecisionSupportRuleConcept",{extend:"Ext.data.Model",table:{name:"support_rule_concepts"},fields:[{name:"id",type:"int"},{name:"rule_id",type:"int",comment:"support_rule.id"},{name:"concept_type",type:"string",len:10,comment:"PROC PROB MEDI SOCI ALLE LAB VITA"},{name:"concept_text",type:"string",len:25},{name:"concept_code",type:"string",len:25},{name:"concept_code_type",type:"string",len:10},{name:"frequency",type:"int",len:3},{name:"frequency_interval",type:"string",len:3,comment:"1D = one day 2M = two month 1Y = one year"},{name:"frequency_operator",type:"string",len:5,comment:"== != <= >= < >",convert:function(a){return Ext.util.Format.htmlDecode(a)}},{name:"value_operator",type:"string",len:5,comment:"== != <= >= < >",convert:function(a){return Ext.util.Format.htmlDecode(a)}},{name:"value",type:"string",len:10}],proxy:{type:"direct",api:{read:"DecisionSupport.getDecisionSupportRuleConcepts",create:"DecisionSupport.addDecisionSupportRuleConcept",update:"DecisionSupport.updateDecisionSupportRuleConcept",destroy:"DecisionSupport.deleteDecisionSupportRuleConcept"}}}),Ext.define("App.model.administration.DecisionSupportRule",{extend:"Ext.data.Model",requires:"App.model.administration.DecisionSupportRuleConcept",table:{name:"support_rules"},fields:[{name:"id",type:"int"},{name:"category",type:"string",len:10,defaultValue:"C",comment:"C = Clinical A = Administrative P = Physician N = Nurse"},{name:"category_name",type:"string",store:!1},{name:"alert_type",type:"string",len:2,defaultValue:"P",comment:"A = Active P = Passive"},{name:"description",type:"string"},{name:"service_type",type:"string",len:10,comment:"PROC IMMU DX MEDI LAB RAD"},{name:"service_text",type:"string"},{name:"service_code",type:"string",len:25},{name:"service_code_type",type:"string",len:10},{name:"age_start",type:"int",defaultValue:"0"},{name:"age_end",type:"int",defaultValue:"0"},{name:"sex",type:"string",len:5},{name:"warning",type:"string",len:5,comment:"examples 1W or 5M or 1Y"},{name:"past_due",type:"string",len:5,comment:"examples 1W or 5M or 1Y"},{name:"reference",type:"string"},{name:"reference_type",type:"string",len:40},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"DecisionSupport.getDecisionSupportRules",create:"DecisionSupport.addDecisionSupportRule",update:"DecisionSupport.updateDecisionSupportRule",destroy:"DecisionSupport.deleteDecisionSupportRule"},reader:{root:"data"}},hasMany:[{model:"App.model.administration.DecisionSupportRuleConcept",name:"concepts",foreignKey:"rule_id"}]}),Ext.define("App.store.administration.DecisionSupportRules",{requires:["App.model.administration.DecisionSupportRule"],model:"App.model.administration.DecisionSupportRule",extend:"Ext.data.Store"}),Ext.define("App.store.administration.DecisionSupportRulesConcepts",{requires:["App.model.administration.DecisionSupportRuleConcept"],model:"App.model.administration.DecisionSupportRuleConcept",extend:"Ext.data.Store"}),Ext.define("App.view.administration.DecisionSupport",{extend:"App.ux.RenderPanel",requires:["App.ux.grid.RowFormEditing","Ext.grid.plugin.CellEditing","App.store.administration.DecisionSupportRules","App.store.administration.DecisionSupportRulesConcepts","App.ux.combo.Combo","App.ux.LiveCPTSearch","App.ux.LiveSnomedProblemSearch","App.ux.LiveRXNORMSearch","App.ux.LiveRXNORMAllergySearch"],itemId:"decisionSupportAdminPanel",pageTitle:_("decision_support"),pageBody:[{xtype:"grid",itemId:"decisionSupportAdminGrid",region:"center",store:this._adminDecisionSupportStore=Ext.create("App.store.administration.DecisionSupportRules"),columns:[{xtype:"actioncolumn",width:30,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRule(f)}}]},{flex:1,header:_("description"),sortable:!0,dataIndex:"description"},{width:100,header:_("category"),sortable:!0,dataIndex:"category_name"},{width:100,header:_("age_start"),sortable:!0,dataIndex:"age_start"},{width:100,header:_("age_end"),sortable:!0,dataIndex:"age_end"},{width:100,header:_("sex"),sortable:!0,dataIndex:"sex"},{width:100,header:_("frequency"),sortable:!0,dataIndex:"frequency"},{width:50,header:_("active"),dataIndex:"active",renderer:function(a){return app.boolRenderer(a)}}],tbar:Ext.create("Ext.PagingToolbar",{displayInfo:!0,emptyMsg:_("no_office_notes_to_display"),plugins:Ext.create("Ext.ux.SlidingPager"),store:this._adminDecisionSupportStore,items:["-",{xtype:"button",text:_("new_rule"),iconCls:"icoAdd",itemId:"decisionSupportRuleAddBtn"}]}),plugins:Ext.create("App.ux.grid.RowFormEditing",{autoCancel:!1,errorSummary:!1,clicksToEdit:2,items:[{xtype:"tabpanel",action:_("immunizations"),layout:"fit",itemId:"decisionSupportEditorTabPanel",items:[{xtype:"container",title:_("general"),padding:10,layout:"vbox",items:[{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",action:"field"},items:[{xtype:"textfield",fieldLabel:_("description"),name:"description",width:703},{fieldLabel:_("active"),xtype:"checkboxfield",labelWidth:75,name:"active"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",action:"field"},items:[{xtype:"mitos.codestypescombo",fieldLabel:_("coding_system"),name:"service_code_type"},{xtype:"textfield",fieldLabel:_("code"),width:458,name:"service_code"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",action:"field"},items:[{xtype:"numberfield",fieldLabel:_("age_start"),name:"age_start",value:0,minValue:0},{xtype:"gaiaehr.sexcombo",fieldLabel:_("sex"),name:"sex",margin:"0 10 5 0"}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",action:"field"},items:[{xtype:"numberfield",fieldLabel:_("age_end"),name:"age_end",value:0,minValue:0},{xtype:"textfield",fieldLabel:_("reference"),name:"reference",width:458}]},{xtype:"fieldcontainer",layout:"hbox",defaults:{margin:"0 10 0 0",action:"field"},items:[{xtype:"combo",fieldLabel:_("category"),name:"category",queryMode:"local",displayField:"category_name",valueField:"category",store:Ext.create("Ext.data.Store",{fields:["category_name","category"],data:[{category:"C",category_name:"Clinical"},{category:"A",category_name:"Administrative"},{category:"P",category_name:"Physician"},{category:"N",category_name:"Nurse"}]})},{xtype:"combo",fieldLabel:_("reference_type"),name:"reference_type",queryMode:"local",displayField:"option",valueField:"value",editable:!1,width:458,store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"Diagnostic and Therapeutic Reference",value:"D"},{option:"Evidence-Based CDS Intervention",value:"E"}]})}]}]},{xtype:"grid",title:_("procedures"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"PROC",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"livecptsearch",fieldLabel:_("add_procedure"),hideLabel:!1,margin:"0 0 0 5",flex:1,itemId:"DecisionSupportProcedureCombo"}]},{xtype:"grid",title:_("active_problems"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"PROB",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"snomedliveproblemsearch",fieldLabel:_("add_problem"),hideLabel:!1,margin:"0 0 0 5",flex:1,itemId:"DecisionSupportProblemCombo"}]},{xtype:"grid",title:_("social_lifestyle"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"SOCI",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("value"),columns:[{header:_("operator"),dataIndex:"value_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("value"),dataIndex:"value",editor:{xtype:"textfield"}}]},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"gaiaehr.combo",fieldLabel:_("add_social_lifestyle"),itemId:"DecisionSupportSocialHistoryCombo",margin:"0 0 0 5",width:350,list:101},{xtype:"button",iconCls:"icoAdd",itemId:"DecisionSupportSocialHistoryAddBtn"}]},{xtype:"grid",title:_("medications"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"MEDI",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)
}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("value"),columns:[{header:_("operator"),dataIndex:"value_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("value"),dataIndex:"value",editor:{xtype:"textfield"}}]},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("within"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"rxnormlivetsearch",fieldLabel:_("add_medication"),hideLabel:!1,margin:"0 0 0 5",flex:1,itemId:"DecisionSupportMedicationCombo"}]},{xtype:"grid",title:_("medication_allergies"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"ALLE",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("value"),columns:[{header:_("operator"),dataIndex:"value_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("value"),dataIndex:"value",editor:{xtype:"textfield"}}]},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"rxnormallergylivetsearch",fieldLabel:_("add_medication"),hideLabel:!1,margin:"0 0 0 5",flex:1,itemId:"DecisionSupportMedicationAllergyCombo"}]},{xtype:"grid",title:_("labs"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"LAB",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("value"),columns:[{header:_("operator"),dataIndex:"value_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("value"),dataIndex:"value",editor:{xtype:"textfield"}}]},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"labslivetsearch",fieldLabel:_("add_labs"),hideLabel:!1,margin:"0 0 0 5",flex:1,itemId:"DecisionSupportLabCombo"}]},{xtype:"grid",title:_("vitals"),store:Ext.create("App.store.administration.DecisionSupportRulesConcepts"),action:"VITA",columns:[{xtype:"actioncolumn",width:20,items:[{icon:"resources/images/icons/delete.png",tooltip:_("remove"),handler:function(a,b,c,d,e,f){App.app.getController("administration.DecisionSupport").doRemoveRuleConcept(f)}}]},{header:_("concept"),flex:1,dataIndex:"concept_text"},{text:_("value"),columns:[{header:_("operator"),dataIndex:"value_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("value"),dataIndex:"value",editor:{xtype:"textfield"}}]},{text:_("frequency"),columns:[{header:_("operator"),dataIndex:"frequency_operator",width:180,editor:{xtype:"gaiaehr.combo",list:111}},{header:_("frequency"),dataIndex:"frequency",editor:{xtype:"numberfield"}},{header:_("interval"),dataIndex:"frequency_interval",editor:{xtype:"textfield"}}]}],plugins:[{ptype:"cellediting",autoCancel:!0,errorSummary:!1,clicksToEdit:2}],tbar:[{xtype:"gaiaehr.combo",fieldLabel:_("add_vital"),labelWidth:60,hideLabel:!1,margin:"0 0 0 5",list:110,width:350,itemId:"DecisionSupportVitalCombo"},{xtype:"button",iconCls:"icoAdd",itemId:"DecisionSupportVitalAddBtn"}]}]}]})}]}),Ext.define("App.model.administration.DocumentsPdfTemplate",{extend:"Ext.data.Model",table:{name:"documents_pdf_templates"},fields:[{name:"id",type:"int"},{name:"facility_id",type:"int",index:!0},{name:"template",type:"string",len:250},{name:"body_margin_left",type:"int",len:3},{name:"body_margin_top",type:"int",len:3},{name:"body_margin_right",type:"int",len:3},{name:"body_margin_bottom",type:"int",len:3},{name:"body_font_family",type:"string",len:60},{name:"body_font_style",type:"string",len:3},{name:"body_font_size",type:"string",len:3},{name:"header_data",type:"array"},{name:"header_line",type:"bool"},{name:"footer_margin",type:"int",len:3},{name:"is_interface_tpl",type:"bool",index:!0},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"DocumentsPdfTemplates.getDocumentsPdfTemplates",create:"DocumentsPdfTemplates.addDocumentsPdfTemplate",update:"DocumentsPdfTemplates.updateDocumentsPdfTemplate",destroy:"DocumentsPdfTemplates.destroyDocumentsPdfTemplate"}}}),Ext.define("App.store.administration.DocumentsPdfTemplates",{extend:"Ext.data.Store",model:"App.model.administration.DocumentsPdfTemplate"}),Ext.define("App.view.administration.EmailTemplates",{extend:"App.ux.RenderPanel",pageTitle:_("email_templates"),itemId:"AdministrationEmailTemplates",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.EmailTemplates"),a.grid=Ext.create("Ext.grid.Panel",{itemId:"AdministrationEmailTemplatesGrid",store:a.store,columns:[{text:_("facility"),width:200,dataIndex:"facility_id"},{text:_("template_type"),sortable:!0,dataIndex:"template_type"},{text:_("language"),sortable:!0,dataIndex:"language"},{text:_("subject"),sortable:!0,dataIndex:"subject",flex:1},{text:_("from_email"),sortable:!0,dataIndex:"from_email",flex:1},{text:_("from_name"),sortable:!0,dataIndex:"from_name",flex:1},{text:_("active?"),width:60,sortable:!0,renderer:a.boolRenderer,dataIndex:"active",editor:{xtype:"checkbox"}}],bbar:{xtype:"pagingtoolbar",pageSize:25,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.grid],a.callParent(arguments)}}),Ext.define("App.model.administration.EmailTemplate",{extend:"Ext.data.Model",table:{name:"email_templates"},fields:[{name:"id",type:"int"},{name:"facility_id",type:"int",index:!0},{name:"template_type",type:"string",len:40,index:!0},{name:"language",type:"string",len:5},{name:"subject",type:"string",len:250},{name:"from_email",type:"string",len:250},{name:"from_name",type:"string",len:250},{name:"body",type:"string",dataType:"mediumtext"},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"EmailTemplates.getEmailTemplates",create:"EmailTemplates.addEmailTemplate",update:"EmailTemplates.updateEmailTemplate"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.store.administration.EmailTemplates",{model:"App.model.administration.EmailTemplate",extend:"Ext.data.Store"}),Ext.define("App.view.administration.EncounterTemplates",{extend:"App.ux.RenderPanel",pageTitle:_("encounter_templates"),itemId:"AdministrationEncounterTemplatesPanel",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.EncounterTemplatePanels"),a.grid=Ext.create("Ext.grid.Panel",{itemId:"AdministrationEncounterTemplatesGrid",store:a.store,columns:[{text:_("specialty"),width:200,sortable:!0,dataIndex:"specialty"},{text:_("description"),flex:1,sortable:!0,dataIndex:"description"},{text:_("active?"),width:60,sortable:!0,renderer:a.boolRenderer,dataIndex:"active",editor:{xtype:"checkbox"}}],tbar:["->",{xtype:"button",text:_("template"),itemId:"EncounterTemplatesAddBtn",iconCls:"icoAdd"}],bbar:{xtype:"pagingtoolbar",pageSize:25,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.grid],a.callParent(arguments)}}),Ext.define("App.store.administration.EncounterTemplatePanels",{model:"App.model.administration.EncounterTemplatePanel",extend:"Ext.data.Store"}),Ext.define("App.view.administration.Encryption",{extend:"App.ux.RenderPanel",pageTitle:_("encryption"),initComponent:function(){var a=this;a.container=Ext.widget("container",{bodyPadding:10,layout:"fit",items:[a.textbox=Ext.widget("textarea")]}),a.pageTBar=[{text:_("encrypt"),enableToggle:!0,toggleGroup:"encryption",scope:a,handler:a.onEncrypt},"-",{text:_("decrypt"),enableToggle:!0,toggleGroup:"encryption",scope:a,handler:a.onDecrypt}],a.pageBody=[a.container],a.callParent(arguments)},onEncrypt:function(){var a=this,b=a.textbox.getValue();Encryption.Encrypt(b,function(b,c){a.textbox.setValue(c.result)})},onDecrypt:function(){var a=this,b=a.textbox.getValue();Encryption.Decrypt(b,function(b,c){a.textbox.setValue(c.result)})},onActive:function(a){a(!0)}}),Ext.define("App.view.administration.FileSystems",{extend:"App.ux.RenderPanel",requires:[],pageTitle:_("file_systems"),itemId:"AdminFileSystemsPanel",pageLayout:{type:"border"},initComponent:function(){var a=this,b=Ext.create("App.store.administration.FileSystems");a.pageBody=[{xtype:"grid",title:"ONLINE File Systems",flex:1,region:"center",padding:0,frame:!0,store:b,itemId:"FileSystemsGrid",plugins:[{ptype:"rowediting"}],columns:[{text:_("id"),dataIndex:"id"},{text:_("next_id"),dataIndex:"next_id",editor:{xtype:"textfield"}},{text:_("dir_path"),dataIndex:"dir_path",flex:2,editor:{xtype:"textfield"}},{text:_("status"),dataIndex:"status",editor:{xtype:"combobox",displayField:"option",valueField:"value",editable:!1,store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"ACTIVE",value:"ACTIVE"},{option:"FULL",value:"FULL"},{option:"ONLINE",value:"ONLINE"},{option:"OFFLINE",value:"OFFLINE"}]})}},{text:_("total_space"),dataIndex:"total_space"},{text:_("free_space"),dataIndex:"free_space"},{text:_("percent_used"),dataIndex:"percent",renderer:function(a,b,c){return Math.floor(Math.abs(c.get("free_space")/c.get("total_space")*100-100))+"% Used"}},{text:_("error"),dataIndex:"error",flex:1}],tbar:[{text:_("file_system"),itemId:"FileSystemsAddBtn",iconCls:"icoAdd"}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:b,displayInfo:!0,plugins:new Ext.ux.SlidingPager,items:["-",{text:_("analyze"),itemId:"FileSystemsAnalyzeBtn"},"-"]}},{xtype:"grid",title:"NEARLINE File Systems",flex:1,padding:0,frame:!0,region:"south",split:!0,itemId:"FileSystemsNearlineGrid",plugins:[{ptype:"rowediting"}],columns:[{text:_("id"),dataIndex:"id"},{text:_("next_id"),dataIndex:"next_id",editor:{xtype:"textfield"}},{text:_("dir_path"),dataIndex:"dir_path",flex:2,editor:{xtype:"textfield"}},{text:_("status"),dataIndex:"status",editor:{xtype:"combobox",displayField:"option",valueField:"value",editable:!1,store:Ext.create("Ext.data.Store",{fields:["option","value"],data:[{option:"ACTIVE",value:"ACTIVE"},{option:"FULL",value:"FULL"},{option:"ONLINE",value:"ONLINE"},{option:"OFFLINE",value:"OFFLINE"}]})}},{text:_("total_space"),dataIndex:"total_space"},{text:_("free_space"),dataIndex:"free_space"},{text:_("percent_used"),dataIndex:"percent",renderer:function(a,b,c){return Math.floor(Math.abs(c.get("free_space")/c.get("total_space")*100-100))+"% Used"}},{text:_("error"),dataIndex:"error",flex:1}],tbar:[{text:_("file_system"),itemId:"FileSystemsNearlineAddBtn",iconCls:"icoAdd"}],bbar:{xtype:"pagingtoolbar",pageSize:10,displayInfo:!0,plugins:new Ext.ux.SlidingPager,items:["-",{text:_("analyze"),itemId:"FileSystemsNearlineAnalyzeBtn"},"-"]}}],a.callParent(arguments)}}),Ext.define("App.model.administration.FileSystem",{extend:"Ext.data.Model",table:{name:"filesystems"},fields:[{name:"id",type:"int"},{name:"next_id",type:"int",index:!0},{name:"dir_path",type:"string",len:180},{name:"status",type:"string",len:15,index:!0},{name:"total_space",type:"float",len:11},{name:"free_space",type:"float",len:11},{name:"error",type:"string",len:200}],proxy:{type:"direct",api:{read:"FileSystem.getFileSystems",create:"FileSystem.addFileSystem",update:"FileSystem.updateFileSystem"}},reader:{totalProperty:"total",root:"data"}}),Ext.define("App.store.administration.FileSystems",{model:"App.model.administration.FileSystem",extend:"Ext.data.Store"}),Ext.define("App.model.administration.HL7Server",{extend:"Ext.data.Model",table:{name:"hl7_servers"},fields:[{name:"id",type:"int"},{name:"server_name",type:"string"},{name:"allow_messages",type:"array",dataType:"longtext"},{name:"allow_ips",type:"array",dataType:"longtext"},{name:"ip",type:"string",len:40},{name:"port",type:"string",len:10},{name:"allow_messages_string",type:"string",store:!1,convert:function(a,b){return Ext.isArray(b.data.allow_messages)?b.data.allow_messages.join(", "):b.data.allow_messages}},{name:"allow_ips_string",type:"string",store:!1,convert:function(a,b){return Ext.isArray(b.data.allow_ips)?b.data.allow_ips.join(", "):b.data.allow_ips}},{name:"token",type:"string",len:100},{name:"config",type:"string",dataType:"TEXT"},{name:"started",type:"bool",index:!0},{name:"online",type:"bool",store:!1}],proxy:{type:"direct",api:{read:"HL7Server.getServers",create:"HL7Server.addServer",update:"HL7Server.updateServer",destroy:"HL7Server.deleteServer"},reader:{totalProperty:"total",root:"data"}}}),Ext.define("App.store.administration.HL7Servers",{requires:["App.model.administration.HL7Server"],extend:"Ext.data.Store",model:"App.model.administration.HL7Server"}),Ext.define("App.model.administration.HL7Client",{extend:"Ext.data.Model",table:{name:"hl7_clients",comment:"hl7 Clients"},fields:[{name:"id",type:"int"},{name:"facility",type:"string",len:80,comment:"Facility Name"},{name:"facility_iso_id",type:"string",len:80,comment:"ISO ID"},{name:"physical_address",type:"string",len:1e3,comment:"Facility Name"},{name:"application_name",type:"string",len:80,comment:"Application Name"},{name:"application_iso_id",type:"string",len:80,comment:"ISO ID"},{name:"route",type:"string",comment:"socket or http"},{name:"allow_messages",type:"string",dataType:"text"},{name:"address",type:"string",comment:"URL IP"},{name:"port",type:"string",len:10,comment:"url port if any"},{name:"isSecure",type:"bool",comment:"If secure then user secret_key"},{name:"secret_key",type:"string"},{name:"config",type:"string",dataType:"TEXT"},{name:"active",type:"bool"}],proxy:{type:"direct",api:{read:"HL7Clients.getClients",create:"HL7Clients.addClient",update:"HL7Clients.updateClient",destroy:"HL7Clients.deleteClient"},reader:{totalProperty:"total",root:"data"}}}),Ext.define("App.store.administration.HL7Clients",{model:"App.model.administration.HL7Client",extend:"Ext.data.Store"}),Ext.define("App.view.administration.HL7",{extend:"App.ux.RenderPanel",requires:["Ext.grid.plugin.RowEditing"],xtype:"hl7serverspanel",pageTitle:_("hl7"),pageLayout:{type:"vbox",align:"stretch"},pageBody:[{xtype:"grid",title:_("hl7_servers"),store:this.sStore=Ext.create("App.store.administration.HL7Servers"),itemId:"hl7serversgrid",flex:1,frame:!0,columnLines:!0,margin:"0 0 5 0",padding:0,columns:[{text:_("online"),dataIndex:"online",width:50,renderer:function(a){return app.boolRenderer(a)}},{text:_("server_name"),dataIndex:"server_name",width:150},{text:_("server_ip"),dataIndex:"ip",width:110},{text:_("port"),dataIndex:"port",width:70},{text:_("allowed_messages"),dataIndex:"allow_messages_string",flex:1},{text:_("allowed_ips"),dataIndex:"allow_ips_string",flex:1},{xtype:"actioncolumn",width:50,items:[{icon:"resources/images/icons/icoDotGreen.png",tooltip:_("start"),margin:"0 5 0 0",handler:function(a,b,c,d,e,f){App.Current.getController("administration.HL7").serverStartHandler(f)}},{icon:"resources/images/icons/icoDotRed.png",tooltip:_("stop"),handler:function(a,b,c,d,e,f){App.Current.getController("administration.HL7").serverStopHandler(f)}}]}],plugins:[{ptype:"rowformediting",clicksToEdit:2,items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"fieldset",layout:"anchor",title:_("general"),width:300,margin:"0 5 0 0",items:[{xtype:"textfield",fieldLabel:_("server_name"),name:"server_name",anchor:"100%"},{xtype:"textfield",fieldLabel:_("ip"),name:"ip",anchor:"100%"},{xtype:"textfield",fieldLabel:_("port"),name:"port",anchor:"100%"}]},{xtype:"fieldset",layout:"anchor",title:_("allow_ips"),width:200,margin:"0 5 0 0",items:[{xtype:"multitextfield",numbers:!1,name:"allow_ips"}]},{xtype:"fieldset",title:_("messages"),layout:"fit",flex:1,items:[{xtype:"checkboxgroup",columns:5,vertical:!0,defaults:{xtype:"checkbox",name:"allow_messages",uncheckedValue:null},items:[{boxLabel:"ADT_A01",inputValue:"ADT_A01"},{boxLabel:"ADT_A04",inputValue:"ADT_A04"},{boxLabel:"ADT_A08",inputValue:"ADT_A08"},{boxLabel:"ADT_A09",inputValue:"ADT_A09"},{boxLabel:"ADT_A10",inputValue:"ADT_A10"},{boxLabel:"ADT_A18",inputValue:"ADT_A18"},{boxLabel:"ADT_A28",inputValue:"ADT_A28"},{boxLabel:"ADT_A29",inputValue:"ADT_A29"},{boxLabel:"ADT_A31",inputValue:"ADT_A31"},{boxLabel:"ADT_A32",inputValue:"ADT_A32"},{boxLabel:"ADT_A33",inputValue:"ADT_A33"},{boxLabel:"ADT_A39",inputValue:"ADT_A39"},{boxLabel:"ADT_A40",inputValue:"ADT_A40"},{boxLabel:"ADT_A41",inputValue:"ADT_A41"},{boxLabel:"ORU_R01",inputValue:"ORU_R01"},{boxLabel:"ORU_R21",inputValue:"ORU_R21"},{boxLabel:"SIU_S12",inputValue:"SIU_S12"},{boxLabel:"SIU_S13",inputValue:"SIU_S13"},{boxLabel:"SIU_S14",inputValue:"SIU_S14"},{boxLabel:"SIU_S15",inputValue:"SIU_S15"},{boxLabel:"SIU_S22",inputValue:"SIU_S22"}]}]}]}]}],tbar:Ext.create("Ext.PagingToolbar",{store:this.sStore,displayInfo:!0,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No Servers to display",items:["-",{text:_("add_server"),iconCls:"icoAdd",itemId:"addHL7ServerBtn"},"-",{text:_("remove_server"),iconCls:"icoDelete",itemId:"removeHL7ServerBtn",disabled:!0},"-",{text:_("messages"),itemId:"HL7MessagesViewBtn"},"-",{text:_("config"),itemId:"HL7ServerConfigBtn"},"-"]})},{xtype:"grid",title:_("hl7_clients"),store:this.cStore=Ext.create("App.store.administration.HL7Clients"),itemId:"hl7clientsgrid",flex:1,columnLines:!0,frame:!0,padding:0,columns:[{text:_("active"),dataIndex:"active",width:50,renderer:function(a){return app.boolRenderer(a)},editor:{xtype:"checkbox"}},{text:_("facility"),dataIndex:"facility",flex:1,editor:{xtype:"textfield"}},{text:_("facility_id"),dataIndex:"facility_iso_id",flex:1,editor:{xtype:"textfield"}},{text:_("application_name"),dataIndex:"application_name",flex:1,editor:{xtype:"textfield"}},{text:_("application_id"),dataIndex:"application_iso_id",flex:1,editor:{xtype:"textfield"}},{text:_("physical_address"),dataIndex:"physical_address",flex:1,editor:{xtype:"textfield"}},{text:_("url_ip_or_domain"),dataIndex:"address",flex:1,editor:{xtype:"textfield"}},{text:_("port"),dataIndex:"port",width:70,editor:{xtype:"textfield"}},{text:_("allow_messages"),dataIndex:"allow_messages",width:200,editor:{xtype:"textfield"}},{text:_("secret_key"),dataIndex:"secret_key",width:200,hidden:!0,editor:{xtype:"textfield"}}],plugins:[{ptype:"rowediting",clicksToEdit:2}],tbar:Ext.create("Ext.PagingToolbar",{store:this.cStore,displayInfo:!0,displayMsg:"Displaying {0} - {1} of {2}",emptyMsg:"No Clients to display",items:["-",{text:_("add_client"),iconCls:"icoAdd",itemId:"addHL7ClientBtn"},"-",{text:_("remove_client"),iconCls:"icoDelete",itemId:"removeHL7ClientBtn",disabled:!0},"-",{text:_("config"),itemId:"HL7ClientConfigBtn"},"-"]})}]}),Ext.define("App.view.administration.LegalLetters",{extend:"App.ux.RenderPanel",pageTitle:_("legal_letters"),itemId:"AdministrationLegalLetters",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.LegalLetters"),a.grid=Ext.create("Ext.grid.Panel",{itemId:"AdministrationLegalLettersGrid",store:a.store,tools:[{xtype:"button",text:_("letter"),iconCls:"icoAdd",itemId:"AdministrationLegalLettersAddBtn"}],columns:[{text:_("title"),dataIndex:"title",flex:1},{text:_("facility"),dataIndex:"facility_id",flex:1},{text:_("workflow"),dataIndex:"workflow",flex:1},{text:_("version"),dataIndex:"version"},{text:_("days_valid_for"),dataIndex:"days_valid_for",flex:1},{text:_("active"),dataIndex:"active",renderer:app.boolRenderer}],bbar:{xtype:"pagingtoolbar",pageSize:50,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.grid],a.callParent(arguments)}}),Ext.define("App.model.administration.LegalLetter",{extend:"Ext.data.Model",table:{name:"legal_letters"},fields:[{name:"id",type:"int"},{name:"facility_id",type:"int",index:!0},{name:"workflow",type:"string",len:45,index:!0},{name:"title",type:"string",len:120},{name:"document_code",type:"string",len:20},{name:"content",type:"string",dataType:"TEXT"},{name:"version",type:"string",len:20},{name:"days_valid_for",type:"int"},{name:"active",type:"bool",index:!0},{name:"create_uid",type:"int"},{name:"create_date",type:"date"},{name:"update_uid",type:"int"},{name:"update_date",type:"date"},{name:"facility",type:"string",store:!1}],proxy:{type:"direct",api:{read:"LegalLetters.getLegalLetters",create:"LegalLetters.addLegalLetter",update:"LegalLetters.updateLegalLetter"},reader:{root:"data"},remoteGroup:!1}}),Ext.define("App.store.administration.LegalLetters",{model:"App.model.administration.LegalLetter",extend:"Ext.data.Store"}),Ext.define("App.view.administration.MeasureCalculation",{extend:"App.ux.RenderPanel",requires:["App.ux.combo.Insurances"],pageTitle:"Measure Calculations",itemId:"MeasureCalculation",initComponent:function(){var a=this;a.pageBody=[{xtype:"tabpanel",items:[{xtype:"grid",title:"Meaningful Use",itemId:"MeaningfulUseGrid",store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"group",type:"string"},{name:"provider",type:"string"},{name:"title",type:"string"},{name:"denominator",type:"int"},{name:"numerator",type:"int"},{name:"goal",type:"string"},{name:"description",type:"string"},{name:"description_denominator",type:"string"},{name:"description_numerator",type:"string"},{name:"denominator_pids"},{name:"numerator_pids"},{name:"numerator_types"}],groupers:[{property:"group",sorterFn:function(a,b){var c=function(a){return parseInt(a.get("group").replace(/\..*/,""))},d=c(a),e=c(b);return d===e?0:e>d?-1:1}}]}),features:[{ftype:"grouping",collapsible:!1,groupHeaderTpl:"{name}"}],tbar:[{xtype:"datefield",fieldLabel:_("from"),labelWidth:35,width:135,allowBlank:!1,value:Ext.Date.subtract(new Date,Ext.Date.YEAR,1),itemId:"MeaningfulUseFromField"},{xtype:"datefield",fieldLabel:_("to"),labelWidth:25,width:125,allowBlank:!1,value:new Date,itemId:"MeaningfulUseToField"},{xtype:"activeproviderscombo",fieldLabel:_("provider"),labelWidth:50,width:300,allowBlank:!1,itemId:"MeaningfulUseProviderField"},"-",{xtype:"button",text:_("refresh"),itemId:"MeaningfulUseRefreshBtn"},"->",{xtype:"button",text:_("print"),itemId:"MeaningfulUseGridPrintBtn"}],columns:[{text:_("title"),dataIndex:"title",flex:1},{text:_("provider"),dataIndex:"provider",flex:1},{text:_("denominator"),dataIndex:"denominator",width:150},{text:_("numerator"),dataIndex:"numerator",width:150},{text:_("percent"),dataIndex:"goal",width:150,renderer:function(a,b,c){var d=c.get("numerator")/c.get("denominator")*100;return Number.isNaN(d)?"N/A":d.toFixed(1)+"%"}},{text:_("goal"),dataIndex:"goal",width:150}]},{xtype:"grid",title:"MIPS",itemId:"MIPSGrid",store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"group",type:"string"},{name:"provider",type:"string"},{name:"title",type:"string"},{name:"denominator",type:"int"},{name:"numerator",type:"int"},{name:"goal",type:"string"},{name:"description",type:"string"},{name:"description_denominator",type:"string"},{name:"description_numerator",type:"string"},{name:"denominator_pids"},{name:"numerator_pids"},{name:"numerator_types"}],groupers:[{property:"group",sorterFn:function(a,b){var c=function(a){return parseInt(a.get("group").replace(/\..*/,""))},d=c(a),e=c(b);return d===e?0:e>d?-1:1}}]}),features:[{ftype:"grouping",collapsible:!1,groupHeaderTpl:"{name}"}],tbar:[{xtype:"datefield",fieldLabel:_("from"),labelWidth:35,width:135,allowBlank:!1,value:Ext.Date.subtract(new Date,Ext.Date.YEAR,1),itemId:"MIPSGridFromField"},{xtype:"datefield",fieldLabel:_("to"),labelWidth:25,width:125,allowBlank:!1,value:new Date,itemId:"MIPSGridToField"},{xtype:"activeproviderscombo",fieldLabel:_("provider"),labelWidth:50,width:300,allowBlank:!1,itemId:"MIPSGridProviderField"},{xtype:"insurancescombo",fieldLabel:_("insurance"),labelWidth:50,width:300,itemId:"MIPSGridInsuranceField"},{xtype:"gaiaehr.combo",name:"sex",fieldLabel:_("sex"),labelWidth:25,width:125,enableKeyEvents:!0,allowBlank:!1,listKey:"sex",loadStore:!0,editable:!1,resetable:!0,itemId:"MIPSGridSexField"},{xtype:"ethnicitycombo",name:"ethnicity",fieldLabel:_("ethnicity"),labelWidth:45,width:250,itemId:"MIPSGridEthnicityField"},{xtype:"racecombo",name:"race",fieldLabel:_("race"),labelWidth:30,width:250,itemId:"MIPSGridRaceField"},"-",{xtype:"button",text:_("refresh"),itemId:"MIPSGridRefreshBtn"},"->",{xtype:"button",text:_("print"),itemId:"MIPSGridPrintBtn"}],columns:[{text:_("title"),dataIndex:"title",flex:1},{text:_("provider"),dataIndex:"provider",flex:1},{text:_("denominator"),dataIndex:"denominator",width:150},{text:_("numerator"),dataIndex:"numerator",width:150},{text:_("percent"),dataIndex:"goal",width:150,renderer:function(a,b,c){var d=c.get("numerator")/c.get("denominator")*100;return Number.isNaN(d)?"N/A":d.toFixed(1)+"%"}},{text:_("goal"),dataIndex:"goal",width:150}]}]}],a.callParent(arguments)}}),Ext.define("App.view.administration.DataPortability",{extend:"App.ux.RenderPanel",requires:["App.ux.form.fields.BoxSelect"],pageTitle:_("patients_export"),pageBody:[{xtype:"panel",itemId:"DataPortabilityPanel",layout:"fit",items:[{xtype:"miframe",itemId:"DataPortabilityPanelIFrame"}],tbar:[{xtype:"form",itemId:"ExportFilterForm",items:[{xtype:"label",text:_("service_date")},{xtype:"datefield",name:"service_from",text:_("from"),itemId:"ServiceFromDate"},{xtype:"datefield",name:"service_to",text:_("to"),itemId:"ServiceToDate"}]},"-",{xtype:"button",text:_("export"),itemId:"DataPortabilityExportBtn"},{xtype:"button",text:_("import"),itemId:"DataPortabilityImportBtn"}]}]}),Ext.define("App.model.administration.DocumentForm",{extend:"Ext.data.Model",table:{name:"documents_pdf_forms"},fields:[{name:"id",type:"int",index:!0},{name:"facility_id",type:"int",index:!0},{name:"document_type",type:"string",len:40,index:!0},{name:"document_title",type:"string",len:80},{name:"document_path",type:"string",len:300},{name:"document_path",type:"string",len:300},{name:"signature_x",type:"int",len:6},{name:"signature_y",type:"int",len:6},{name:"signature_w",type:"int",len:6},{name:"signature_h",type:"int",len:6},{name:"flatten",type:"bool"},{name:"is_active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"DocumentPdfForms.getDocumentPdfForms",create:"DocumentPdfForms.addDocumentPdfForm",update:"DocumentPdfForms.updateDocumentPdfForm"}}}),Ext.define("App.store.administration.DocumentForms",{model:"App.model.administration.DocumentForm",extend:"Ext.data.Store"}),Ext.define("App.view.administration.PoolAreas",{extend:"App.ux.RenderPanel",itemId:"PoolAreasPanel",pageTitle:_("pool_areas"),initComponent:function(){var a=this,b=Ext.create("App.store.areas.PoolAreas",{groupField:"facility_name"});a.pageBody=[{xtype:"grid",itemId:"PoolAreasGrid",store:b,features:[{ftype:"grouping",groupHeaderTpl:"{name}"}],plugins:[{ptype:"rowediting"}],columns:[{text:_("title"),dataIndex:"title",flex:1,editor:{xtype:"textfield",allowBlank:!1}},{text:_("concept"),dataIndex:"concept",flex:1,editor:{xtype:"combobox",queryMode:"local",editable:!1,allowBlank:!1,store:["CHECKIN","TRIAGE","PHYSICIAN","TREATMENT","CHECKOUT"]}},{text:_("facility"),dataIndex:"facility_id",flex:1,editor:{xtype:"mitos.facilitiescombo",allowBlank:!1},renderer:function(a,b,c){return c.get("facility_name")}},{text:_("floor_plan"),dataIndex:"floor_plan_id",flex:1,editor:{xtype:"floorplanareascombo"},renderer:function(a,b,c){return c.get("floor_plan_title")}},{text:_("sort"),dataIndex:"sequence",editor:{xtype:"numberfield",allowBlank:!1,minValue:0,maxValue:99}},{text:_("active"),dataIndex:"active",editor:{xtype:"checkboxfield"}}],tbar:["->",{xtype:"button",text:_("pool_area"),iconCls:"icoAdd",itemId:"PoolAreasPanelAddBtn"}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:b,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}],a.callParent()}}),Ext.define("App.store.administration.ReferringProviders",{model:"App.model.administration.ReferringProvider",extend:"Ext.data.Store"}),Ext.define("App.model.administration.DecisionAids",{extend:"Ext.data.Model",table:{name:"decision_aids_instructions"},fields:[{name:"id",type:"int"},{name:"trigger_code",type:"string",len:40,index:!0},{name:"instruction_code",type:"string",len:40},{name:"instruction_code_type",type:"string",len:40},{name:"instruction_code_description",type:"string",len:600},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"DecisionAids.getDecisionAids",create:"DecisionAids.addDecisionAid",update:"DecisionAids.updateDecisionAid",destroy:"DecisionAids.destroyDecisionAid"}}}),Ext.define("App.store.administration.DecisionAids",{model:"App.model.administration.DecisionAids",extend:"Ext.data.Store"}),Ext.define("App.view.administration.Printers",{extend:"App.ux.RenderPanel",pageTitle:_("printers"),itemId:"AdministrationPrinters",initComponent:function(){var a=this;a.store=Ext.create("App.store.administration.Printer",{autoSync:!1,autoLoad:!0}),a.grid=Ext.create("Ext.grid.Panel",{requires:["Ext.grid.plugin.CellEditing"],itemId:"AdministrationPrintersGrid",store:a.store,title:_("printers"),columnsLines:!0,plugins:[{ptype:"rowediting"}],tbar:["->",{xtype:"button",text:_("remove_printer"),iconCls:"icoDelete",itemId:"AdministrationPrintersRemoveBtn"},{xtype:"button",text:_("add_printer"),iconCls:"icoAdd",itemId:"AdministrationPrintersAddBtn"}],columns:[{text:_("facility_id"),dataIndex:"facility_id",flex:1,editor:"mitos.facilitiescombo"},{text:_("department_id"),dataIndex:"department_id",flex:1,editor:"depatmentscombo"},{text:_("printer_description"),dataIndex:"printer_description",flex:1,editor:{xtype:"textfield",maxLength:120}},{text:_("printer_name"),dataIndex:"printer_name",flex:1,editor:{xtype:"textfield",maxLength:80}},{text:_("printer_protocol"),dataIndex:"printer_protocol",flex:1,editor:{xtype:"textfield",maxLength:10}},{text:_("printer_options"),dataIndex:"printer_options",flex:1,editor:{xtype:"textfield",maxLength:250}},{text:_("printer_host"),dataIndex:"printer_host",flex:1,editor:{xtype:"textfield",maxLength:180}},{text:_("printer_port"),dataIndex:"printer_port",flex:1,editor:{xtype:"textfield",maxLength:10}},{text:_("printer_uri"),dataIndex:"printer_uri",flex:1,editor:{xtype:"textfield",maxLength:180}},{text:_("printer_user"),dataIndex:"printer_user",flex:1,editor:{xtype:"textfield",maxLength:40}},{text:_("printer_pass"),dataIndex:"printer_pass",flex:1,editor:{xtype:"textfield",maxLength:20}},{text:_("active"),width:60,sortable:!0,renderer:a.boolRenderer,dataIndex:"active",editor:"checkbox"}],bbar:{xtype:"pagingtoolbar",pageSize:50,store:a.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}),a.pageBody=[a.grid],a.callParent(arguments)}}),Ext.define("App.model.administration.Printer",{extend:"Ext.data.Model",table:{name:"printers"},fields:[{name:"id",type:"int"},{name:"facility_id",type:"int",index:!0},{name:"department_id",type:"int",index:!0},{name:"printer_description",type:"string",len:120},{name:"printer_name",type:"string",len:80},{name:"printer_protocol",type:"string",len:10,comment:"lpr or ipp"},{name:"printer_options",type:"string",len:250},{name:"printer_host",type:"string",len:180},{name:"printer_uri",type:"string",len:180},{name:"printer_user",type:"string",len:40},{name:"printer_pass",type:"string",len:20},{name:"active",type:"bool",index:!0}],proxy:{type:"direct",api:{read:"Printer.getPrinters",create:"Printer.addPrinter",update:"Printer.updatePrinter",destroy:"Printer.destroyPrinter"}}}),Ext.define("App.store.administration.Printer",{extend:"Ext.data.Store",requires:["App.model.administration.Printer"],model:"App.model.administration.Printer"}),Ext.define("App.view.administration.SnippetsManager",{extend:"App.ux.RenderPanel",pageTitle:"Snippets Manager",requires:[],initComponent:function(){var a=this;
a.nurse_store=Ext.create("App.store.administration.NursesNoteSnippets",{groupField:"category"}),a.provider_store=Ext.create("App.store.administration.EncounterSnippets",{autoLoad:!1,pageSize:1e3,groupField:"category"}),a.pageBody=[{xtype:"tabpanel",items:[{xtype:"grid",title:"Nurse Snippets",itemId:"NursesNoteSnippetsGrid",region:"west",store:a.nurse_store,features:[{ftype:"grouping"}],tools:[{xtype:"button",text:_("snippet"),iconCls:"icoAdd",itemId:"NursesNoteSnippetAddBtn"}],columns:[{text:_("edit"),width:25,menuDisabled:!0,xtype:"actioncolumn",tooltip:"Edit Snippet",align:"center",icon:"resources/images/icons/edit.png",handler:function(a,b,c,d,e,f){var g=app.getController("patient.NursesNotes");g.onSnippetBtnEdit(a,b,c,d,e,f)}},{text:_("description"),dataIndex:"description",flex:1}],tbar:["->",{xtype:"button",text:_("snippet"),iconCls:"icoAdd",itemId:"NursesNoteSnippetAddBtn"}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:a.nurse_store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}},{xtype:"grid",title:"Provider Snippets",itemId:"SnippetsTreePanel",store:a.provider_store,features:[{ftype:"grouping"}],tools:[{xtype:"button",text:_("snippet"),iconCls:"icoAdd",itemId:"SnippetAddBtn"}],columns:[{text:_("edit"),width:25,menuDisabled:!0,xtype:"actioncolumn",tooltip:"Edit Snippet",align:"center",icon:"resources/images/icons/edit.png",handler:function(a,b,c,d,e,f){var g=app.getController("administration.EncounterSnippets");g.onSnippetBtnEdit(a,b,c,d,e,f)}},{text:_("description"),dataIndex:"description",flex:1}],tbar:[{xtype:"specialtiescombo",itemId:"SoapTemplateSpecialtiesCombo",flex:1},{xtype:"button",text:_("snippet"),iconCls:"icoAdd",itemId:"SnippetAddBtn"}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:a.provider_store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}]}],a.callParent()}}),Ext.define("App.model.administration.NursesNoteSnippet",{extend:"Ext.data.Model",table:{name:"nurses_note_snippets"},fields:[{name:"id",type:"string"},{name:"uid",type:"int",index:!0},{name:"index",type:"int"},{name:"description",type:"string",len:80},{name:"category",type:"string",len:50},{name:"snippet",type:"string",dataType:"text"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"NursesNotes.getNursesNoteSnippets",create:"NursesNotes.addNursesNoteSnippet",update:"NursesNotes.updateNursesNoteSnippet",destroy:"NursesNotes.deleteNursesNoteSnippet"}}}),Ext.define("App.store.administration.NursesNoteSnippets",{model:"App.model.administration.NursesNoteSnippet",extend:"Ext.data.Store"}),Ext.define("App.model.administration.AuditLog",{extend:"Ext.data.Model",table:{name:"audit_log"},fields:[{name:"id",type:"int"},{name:"eid",type:"int",index:!0},{name:"pid",type:"int",index:!0},{name:"uid",type:"int",index:!0},{name:"foreign_id",type:"string",index:!0},{name:"foreign_table",type:"string",len:80},{name:"event",type:"string",index:!0,len:80},{name:"event_description",type:"string",index:!0,len:200},{name:"event_date",type:"date",format:"Y-m-d H:i:s"},{name:"ip",type:"string",len:40},{name:"user_fname",type:"string",store:!1},{name:"user_mname",type:"string",store:!1},{name:"user_lname",type:"string",store:!1},{name:"user_name",type:"string",convert:function(a,b){return b.data.user_lname+", "+b.data.user_fname+" "+b.data.user_mname},store:!1},{name:"patient_lname",type:"string",store:!1},{name:"patient_fname",type:"string",store:!1},{name:"patient_mname",type:"string",store:!1},{name:"patient_name",type:"string",convert:function(a,b){var c="";return b.data.patient_lname&&(c+=b.data.patient_lname+", "),b.data.patient_fname&&(c+=b.data.patient_fname+" "),b.data.patient_mname&&(c+=b.data.patient_mname),c},store:!1},{name:"site",type:"string",store:!1}],proxy:{type:"direct",api:{read:"AuditLog.getLog"},reader:{root:"data"}}}),Ext.define("App.store.administration.AuditLogs",{model:"App.model.administration.AuditLog",extend:"Ext.data.Store"}),Ext.define("App.ux.combo.LayoutForms",{extend:"Ext.form.ComboBox",xtype:"layoutformscombo",editable:!1,valueField:"id",displayField:"name",emptyText:_("select"),initComponent:function(){var a=this;a.store=Ext.create("Ext.data.Store",{autoLoad:!0,model:"App.model.administration.FormsList"}),a.callParent()}}),Ext.define("App.model.miscellaneous.webSearch",{extend:"Ext.data.Model",table:{name:"websearch",comment:"Web Search"},fields:[{name:"id",type:"int",comment:"Web Search ID"},{name:"title",type:"string"},{name:"source",type:"string"},{name:"FullSummary",type:"string"},{name:"snippet",type:"string"}]}),Ext.define("App.store.miscellaneous.webSearch",{model:"App.model.miscellaneous.webSearch",extend:"Ext.data.Store",proxy:{type:"ajax",url:"dataProvider/WebSearch.php",noCache:!1,startParam:"retstart",limitParam:"retmax",pageParam:"file",reader:{type:"json",root:"row",totalProperty:"totals",idProperty:"id"}}}),Ext.define("App.model.miscellaneous.Users",{extend:"Ext.data.Model",fields:[{name:"id",type:"int",comment:"User Account ID"},{name:"create_uid",type:"int",comment:"create user ID"},{name:"update_uid",type:"int",comment:"update user ID"},{name:"create_date",type:"date",comment:"create date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",comment:"last update date",dateFormat:"Y-m-d H:i:s"},{name:"username",type:"string",comment:"username"},{name:"title",type:"string",comment:"title (Mr. Mrs.)"},{name:"fname",type:"string",comment:"first name"},{name:"mname",type:"string",comment:"middle name"},{name:"lname",type:"string",comment:"last name"},{name:"pin",type:"string",comment:"pin number"},{name:"npi",type:"string",comment:"National Provider Identifier"},{name:"fedtaxid",type:"string",comment:"federal tax id"},{name:"feddrugid",type:"string",comment:"federal drug id"},{name:"email",type:"string",comment:"email"},{name:"specialty",type:"string",comment:"specialty"},{name:"taxonomy",type:"string",comment:"taxonomy",defaultValue:"207Q00000X"},{name:"facility_id",type:"int"}],proxy:{type:"direct",api:{read:"User.getCurrentUserData",update:"User.updateUser"}}}),Ext.define("App.store.miscellaneous.Users",{model:"App.model.miscellaneous.Users",extend:"Ext.data.Store",proxy:{type:"direct",api:{read:User.getCurrentUserData,update:User.getCurrentUserData}}}),Ext.define("App.view.reports.ReportsPanel",{extend:"App.ux.RenderPanel",pageTitle:_("reports"),itemId:"ReportsPanel",requires:[],initComponent:function(){var b=this;b.store=Ext.create("App.store.reports.Reports",{remoteFilter:!0,remoteSort:!0,groupField:"category"}),b.pageBody=[{xtype:"grid",frame:!0,title:_("reports"),itemId:"ReportsGrid",store:b.store,features:[{ftype:"grouping"}],tools:[{xtype:"button",text:_("report"),iconCls:"icoAdd",itemId:"AdministrationReportsAddBtn",acl:a("access_admin_reports")}],columns:[{text:_("category"),dataIndex:"category",width:300},{text:_("title"),dataIndex:"title",width:300},{text:_("description"),dataIndex:"description",flex:1},{text:_("description"),dataIndex:"store_procedure_name",width:300,hidden:!0}],bbar:{xtype:"pagingtoolbar",pageSize:10,store:b.store,displayInfo:!0,plugins:new Ext.ux.SlidingPager}}],b.callParent(arguments)}}),Ext.define("App.model.reports.Report",{extend:"Ext.data.Model",table:{name:"reports"},fields:[{name:"id",type:"int"},{name:"category",type:"string"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"store_procedure_name",type:"string"},{name:"parameters",type:"auto"},{name:"group_fields",type:"string"},{name:"report_perm",type:"string"},{name:"columns",type:"string"}],proxy:{type:"direct",api:{read:"Reports.getReports",create:"Reports.addReport",update:"Reports.updateReport",destroy:"Reports.deleteReport"},reader:{root:"data"}}}),Ext.define("App.store.reports.Reports",{model:"App.model.reports.Report",extend:"Ext.data.Store"}),Ext.define("App.view.patient.AlertWindow",{extend:"Ext.window.Window",requires:["Ext.grid.plugin.RowEditing"],title:_("reminders_alerts"),width:700,closeAction:"hide",initComponent:function(){var a=this;a.items=[{xtype:"grid",itemId:"AlertsAlertGrid",margin:5,frame:!0,store:Ext.create("App.store.patient.Alerts"),plugins:{ptype:"cellediting",autoCancel:!1,errorSummary:!1,clicksToEdit:2},columns:[{xtype:"datecolumn",text:_("date"),format:g("date_display_format"),dataIndex:"date"},{text:_("note"),dataIndex:"body",flex:1},{text:_("active"),width:50,dataIndex:"active",renderer:function(a,b,c){return app.boolRenderer(a,b,c)},editor:{xtype:"checkbox"}}]}],a.callParent()},buttons:["->",{text:_("ok"),itemId:"AlertsAlertOkBtn"},"-",{text:_("cancel"),itemId:"AlertsAlertCancelBtn"}]}),Ext.define("App.model.patient.InsuranceCover",{extend:"Ext.data.Model",table:{name:"patient_insurance_covers",comment:"Patient Insurance_covers"},fields:[{name:"id",type:"int"},{name:"patient_insurance_id",type:"int"},{name:"service_type_id",type:"int"},{name:"isDollar",type:"bool"},{name:"copay",type:"float"},{name:"exception_isDollar",type:"bool"},{name:"exception_copay",type:"float"},{name:"exception",type:"bool"},{name:"active",type:"bool"},{name:"create_uid",type:"int"},{name:"update_uid",type:"int"},{name:"department_id",type:"string",store:!1},{name:"department_title",type:"string",store:!1},{name:"specialty_id",type:"string",store:!1},{name:"specialty_title",type:"string",store:!1},{name:"service_type_description",type:"string",store:!1},{name:"create_date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"update_date",type:"date",dateFormat:"Y-m-d H:i:s"}],proxy:{type:"direct",api:{read:"Insurance.getInsuranceCovers",create:"Insurance.addInsuranceCover",update:"Insurance.updateInsuranceCover",destroy:"Insurance.destroyInsuranceCover"},writer:{writeAllFields:!0}},associations:[{type:"belongsTo",model:"App.model.patient.Patient",associationKey:"pid",foreignKey:"pid"}]}),Ext.define("App.store.patient.InsuranceCovers",{extend:"Ext.data.Store",model:"App.model.patient.InsuranceCover"}),Ext.define("App.view.patient.windows.EncounterTemplatePanels",{extend:"App.ux.window.Window",title:_("templates"),closeAction:"hide",layout:"fit",modal:!0,width:600,height:500,itemId:"TemplatePanelsWindow",bodyPadding:5,tbar:[{xtype:"combobox",store:Ext.create("App.store.administration.EncounterTemplatePanels"),displayField:"description",valueField:"id",itemId:"TemplatePanelsCombo",width:300,editable:!1,allowBlank:!1,queryMode:"local"}],items:[{xtype:"grid",frame:!0,itemId:"TemplatePanelsGrid",selType:"checkboxmodel",features:[{ftype:"grouping",groupHeaderTpl:"{name}",collapsible:!1}],columns:[{text:_("description"),dataIndex:"description",flex:1,sortable:!1,groupable:!1,hideable:!1,menuDisabled:!0}]}],buttons:[{text:_("add"),itemId:"TemplatePanelsAddBtn"},{text:_("cancel"),itemId:"TemplatePanelsCancelBtn"}]}),Ext.define("App.view.patient.windows.DocumentWindow",{extend:"Ext.window.Window",requires:["App.view.patient.Documents"],title:_("patient_documents"),itemId:"DocumentWindow",layout:"fit",height:700,width:1e3,maximizable:!0,items:[{xtype:"patientdocumentspanel",title:null}]}),Ext.define("App.ux.form.fields.plugin.MacroRecorder",{extend:"Ext.AbstractPlugin",alias:"plugin.macrorecorder",init:function(a){a.recording=!1,a.enableKeyEvents=!0,a.on("keydown",this.onKeyDown,this),a.on("keyup",this.onKeyUp,this)},metaKey:!1,isFKey:function(a){return a>=112&&123>=a},onKeyUp:function(a,b){91==b.getKey()&&(this.metaKey=!1)},onKeyDown:function(a,b){b.preventDefault();var c=b.getKey(),d=String.fromCharCode(b.getKey()),e=this.isFKey(c),f=[];if(say(c),say(d),(91==c||224==c)&&(this.metaKey=!0),8==c)return void a.setValue("");if((e||!b.isSpecialKey()&&-1!==d.search(/[A-Z0-9]/))&&(this.metaKey&&f.push("META"),b.altKey&&f.push("ALT"),b.ctrlKey&&!this.metaKey&&f.push("CTRL"),b.shiftKey&&f.push("SHIFT"),0!==f.length||e)){if(f=f.sort(),e)switch(c){case 112:f.push("F1");break;case 113:f.push("F2");break;case 114:f.push("F3");break;case 115:f.push("F4");break;case 116:f.push("F5");break;case 117:f.push("F6");break;case 118:f.push("F7");break;case 119:f.push("F8");break;case 120:f.push("F9");break;case 121:f.push("F10");break;case 122:f.push("F11");break;case 123:f.push("F12")}else f.push(d);a.setValue(f.join("-"))}}});